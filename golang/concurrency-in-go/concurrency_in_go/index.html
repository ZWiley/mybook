


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.2">
    
    
      
        <title>Concurrency In Go - ZWiley的随记</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a2408e81.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>body,input{font-family:"",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-an-introduction-to-concurrency" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="ZWiley的随记" class="md-header-nav__button md-logo" aria-label="ZWiley的随记">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ZWiley的随记
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Concurrency In Go
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/zwiley/mybook/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ZWiley的随记" class="md-nav__button md-logo" aria-label="ZWiley的随记">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ZWiley的随记
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/zwiley/mybook/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="简介" class="md-nav__link">
      简介
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      C++
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="C++" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        C++
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/STL/" title="C++ STL" class="md-nav__link">
      C++ STL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E7%BC%96%E8%AF%91%E5%BA%95%E5%B1%82/" title="C++编译底层" class="md-nav__link">
      C++编译底层
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="C++基础知识" class="md-nav__link">
      C++基础知识
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88_%E5%BC%82%E5%B8%B8%E6%9C%BA%E5%88%B6_%E5%BC%BA%E5%88%B6%E8%BD%AC%E6%8D%A2_RTTI/" title="C++智能指针" class="md-nav__link">
      C++智能指针
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" title="C++面向对象" class="md-nav__link">
      C++面向对象
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      计算机基础
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="计算机基础" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        计算机基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="操作系统" class="md-nav__link">
      操作系统
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络" class="md-nav__link">
      计算机网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="数据结构" class="md-nav__link">
      数据结构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" title="海量数据处理" class="md-nav__link">
      海量数据处理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      基本手写代码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="基本手写代码" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        基本手写代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E6%9C%AC%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81/%E5%9F%BA%E6%9C%AC%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81%E9%A2%98%E7%9B%AE/" title="常见基本代码" class="md-nav__link">
      常见基本代码
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      项目基础知识
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="项目基础知识" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        项目基础知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E5%8F%8A%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/" title="Linux系统编程及基本命令" class="md-nav__link">
      Linux系统编程及基本命令
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Redis/" title="Redis" class="md-nav__link">
      Redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Socket%E7%BC%96%E7%A8%8B/" title="Socket编程" class="md-nav__link">
      Socket编程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      webserver项目
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="webserver项目" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        webserver项目
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/0%20%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0/" title="0 项目概述" class="md-nav__link">
      0 项目概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/1%20%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E5%B0%81%E8%A3%85%E7%B1%BB/" title="1 线程同步机制封装类" class="md-nav__link">
      1 线程同步机制封装类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/2%20%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%8D%8A%E5%8F%8D%E5%BA%94%E5%A0%86%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88%E4%B8%8A%EF%BC%89/" title="2 半同步半反应堆线程池（上）" class="md-nav__link">
      2 半同步半反应堆线程池（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/3%20%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%8D%8A%E5%8F%8D%E5%BA%94%E5%A0%86%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="3 半同步半反应堆线程池（下）" class="md-nav__link">
      3 半同步半反应堆线程池（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/4%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%8A%EF%BC%89/" title="4 http连接处理（上）" class="md-nav__link">
      4 http连接处理（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/5%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%AD%EF%BC%89/" title="5 http连接处理（中）" class="md-nav__link">
      5 http连接处理（中）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/6%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%8B%EF%BC%89/" title="6 http连接处理（下）" class="md-nav__link">
      6 http连接处理（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/7%20%E5%AE%9A%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86%E9%9D%9E%E6%B4%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%EF%BC%88%E4%B8%8A%EF%BC%89/" title="7 定时器处理非活动连接（上）" class="md-nav__link">
      7 定时器处理非活动连接（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/8%20%E5%AE%9A%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86%E9%9D%9E%E6%B4%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%EF%BC%88%E4%B8%8B%EF%BC%89/" title="8 定时器处理非活动连接（下）" class="md-nav__link">
      8 定时器处理非活动连接（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/9%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%8A%EF%BC%89/" title="9 日志系统（上）" class="md-nav__link">
      9 日志系统（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/10%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%8B%EF%BC%89/" title="10 日志系统（下）" class="md-nav__link">
      10 日志系统（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/11%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/" title="11 数据库连接池" class="md-nav__link">
      11 数据库连接池
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/12%20%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" title="12 常见问题" class="md-nav__link">
      12 常见问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/13%20%E9%A1%B9%E7%9B%AE%E6%A2%B3%E7%90%86/" title="13 项目梳理" class="md-nav__link">
      13 项目梳理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      源码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="源码" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        源码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB_sourcecode/" title="源码阅读" class="md-nav__link">
      源码阅读
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Muduo
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Muduo" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Muduo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-2-1" type="checkbox" id="nav-7-2-1">
    
    <label class="md-nav__link" for="nav-7-2-1">
      base
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="base" data-md-level="3">
      <label class="md-nav__title" for="nav-7-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        base
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/base/1.%20%E6%97%B6%E9%97%B4_%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C_%E5%BC%82%E5%B8%B8/" title="时间_原子操作_异常" class="md-nav__link">
      时间_原子操作_异常
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/base/2.%20%E7%BA%BF%E7%A8%8B/" title="线程" class="md-nav__link">
      线程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/base/3.%20%E7%BA%BF%E7%A8%8B2/" title="线程2" class="md-nav__link">
      线程2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/base/4.%20%E6%97%A5%E5%BF%97/" title="日志" class="md-nav__link">
      日志
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-2-2" type="checkbox" id="nav-7-2-2">
    
    <label class="md-nav__link" for="nav-7-2-2">
      net
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="net" data-md-level="3">
      <label class="md-nav__title" for="nav-7-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        net
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/net/1.%20EventLoop/" title="EventLoop" class="md-nav__link">
      EventLoop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/net/2.%20%E8%BF%9E%E6%8E%A5%E6%97%B6%E5%BA%8F/" title="连接时序" class="md-nav__link">
      连接时序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/net/3.%20%E5%85%B3%E9%97%AD%E6%97%B6%E5%BA%8F/" title="关闭时序" class="md-nav__link">
      关闭时序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/net/4.%20Buffer/" title="Buffer" class="md-nav__link">
      Buffer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/net/5.%20callback/" title="callback" class="md-nav__link">
      callback
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/net/6.%20Client/" title="Client" class="md-nav__link">
      Client
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/0%20%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1/" title="服务器方案设计" class="md-nav__link">
      服务器方案设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/1%20%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="基础知识" class="md-nav__link">
      基础知识
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/2%20%E6%80%BB%E4%BD%93%E8%A7%A3%E6%9E%90/" title="总体解析" class="md-nav__link">
      总体解析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/3%20muduo%E8%AF%A6%E7%BB%86%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B/" title="muduo详细运行流程" class="md-nav__link">
      muduo详细运行流程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/4%20muduo%E4%B8%AD%E7%9A%84%E5%AE%9A%E6%97%B6%E5%99%A8/" title="muduo中的定时器" class="md-nav__link">
      muduo中的定时器
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/5%20muduo%E4%B8%AD%E7%9A%84%E7%BA%BF%E7%A8%8B/" title="muduo中的线程" class="md-nav__link">
      muduo中的线程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Muduo/6%20muduo%E4%B8%AD%E7%9A%84%E5%9B%9E%E8%B0%83/" title="muduo中的回调" class="md-nav__link">
      muduo中的回调
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      数据库
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="数据库" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        数据库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/getting_started_with_impala/" title="Getting started with impala" class="md-nav__link">
      Getting started with impala
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" title="mysql必知必会" class="md-nav__link">
      mysql必知必会
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/mysql%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%8E%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/" title="mysql性能调优与架构实践" class="md-nav__link">
      mysql性能调优与架构实践
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/Mysql%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" title="Mysql技术内幕InnoDB存储引擎" class="md-nav__link">
      Mysql技术内幕InnoDB存储引擎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/redis%E5%AE%9E%E6%88%98/" title="Redis实战" class="md-nav__link">
      Redis实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/redis%E6%B7%B1%E5%BA%A6%E5%8E%86%E9%99%A9%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%92%8C%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/book/" title="Redis深度历险核心原理和应用实践" class="md-nav__link">
      Redis深度历险核心原理和应用实践
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="redis设计与实现" class="md-nav__link">
      redis设计与实现
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93/" title="七周七数据库" class="md-nav__link">
      七周七数据库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAmysql/" title="深入浅出mysql" class="md-nav__link">
      深入浅出mysql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/%E9%AB%98%E6%80%A7%E8%83%BDmysql%E7%AC%AC%E4%B8%89%E7%89%88/" title="高性能mysql第三版" class="md-nav__link">
      高性能mysql第三版
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      代码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="代码" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8/" title="代码大全" class="md-nav__link">
      代码大全
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E4%BB%A3%E7%A0%81%E7%9A%84%E6%9C%AA%E6%9D%A5/" title="代码的未来" class="md-nav__link">
      代码的未来
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E5%9F%BA%E6%9C%AC%E5%8A%9F/" title="基本功" class="md-nav__link">
      基本功
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E6%95%8F%E6%8D%B7%E6%8A%80%E8%83%BD%E4%BF%AE%E7%82%BC/" title="敏捷技能修炼" class="md-nav__link">
      敏捷技能修炼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%8497%E4%BB%B6%E4%BA%8B/" title="程序员应该知道的97件事" class="md-nav__link">
      程序员应该知道的97件事
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E7%BC%96%E5%86%99%E5%8F%AF%E8%AF%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF/" title="编写可读代码的艺术" class="md-nav__link">
      编写可读代码的艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E7%BC%96%E7%A8%8B%E5%8C%A0%E8%89%BA/" title="编程匠艺" class="md-nav__link">
      编程匠艺
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" title="领域驱动设计" class="md-nav__link">
      领域驱动设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/codelife_%E4%B8%8D%E6%AD%A2%E4%BB%A3%E7%A0%81/" title="codelife_不止代码" class="md-nav__link">
      codelife_不止代码
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      调试技术
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="调试技术" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        调试技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../debug/%E8%BD%AF%E4%BB%B6%E8%B0%83%E8%AF%95%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93/book/" title="软件调试修炼之道" class="md-nav__link">
      软件调试修炼之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../debug/Effective_Debugging/" title="Effective Debugging" class="md-nav__link">
      Effective Debugging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      前端
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="前端" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        前端
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/CSS_The_Missing_Manual/" title="CSS_The_Missing_Manual" class="md-nav__link">
      CSS_The_Missing_Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/reactjs_%E5%B0%8F%E4%B9%A6/" title="reactjs小书" class="md-nav__link">
      reactjs小书
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/es6%E6%A0%87%E5%87%86%E5%85%A5%E9%97%A8/" title="ES6标准入门" class="md-nav__link">
      ES6标准入门
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/jquery_pocket_reference/" title="jquery_pocket_reference" class="md-nav__link">
      jquery_pocket_reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3bootstrap/" title="深入理解bootstrap" class="md-nav__link">
      深入理解bootstrap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" checked>
    
    <label class="md-nav__link" for="nav-12">
      golang
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="golang" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        golang
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../1_the_go_programming_lauguage/" title="1 The Go Programming Language" class="md-nav__link">
      1 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2_the_go_programming_lauguage/" title="2 The Go Programming Language" class="md-nav__link">
      2 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_the_go_programming_lauguage/" title="3 The Go Programming Language" class="md-nav__link">
      3 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../build-web-application-with-golang/" title="Build Web Application With Golang" class="md-nav__link">
      Build Web Application With Golang
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go101/book/" title="Go101" class="md-nav__link">
      Go101
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../network-programming-with-go/book/" title="Network Programming with go" class="md-nav__link">
      Network Programming with go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices-with-go/book/" title="Building Microservices With Go" class="md-nav__link">
      Building Microservices With Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building_restful_web_services_with_go/book/" title="Building Restful Web Services with Go" class="md-nav__link">
      Building Restful Web Services with Go
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Concurrency In Go
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Concurrency In Go" class="md-nav__link md-nav__link--active">
      Concurrency In Go
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deadlocks-livelocks-and-starvation" class="md-nav__link">
    Deadlocks, Livelocks, and Starvation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#determining-concurrency-safety" class="md-nav__link">
    Determining Concurrency Safety
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simplicity-in-the-face-of-complexity" class="md-nav__link">
    Simplicity in the Face of Complexity
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go_in_action%28go%E8%AF%AD%E8%A8%80%E5%AE%9E%E6%88%98%29/" title="Go In Action(Go 实战)" class="md-nav__link">
      Go In Action(Go 实战)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/" title="Go学习笔记语言详解" class="md-nav__link">
      Go学习笔记语言详解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/" title="Go学习笔记源码剖析" class="md-nav__link">
      Go学习笔记源码剖析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B/" title="go语言编程" class="md-nav__link">
      go语言编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../the_way_to_go/book/" title="go book" class="md-nav__link">
      go book
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-go-programming-book/advanced-go-programming/" title="advanced-go-programming" class="md-nav__link">
      advanced-go-programming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go-build-web-applications/module1/go-build-web-applications/go-build-web-applications/" title="go-build-web-applications" class="md-nav__link">
      go-build-web-applications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      python
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="python" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/fluent_python/" title="Fluent Python" class="md-nav__link">
      Fluent Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/Python_Microservices_Development/" title="Python Microservices Development" class="md-nav__link">
      Python Microservices Development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/high_performance_python/" title="High Performance Python" class="md-nav__link">
      High Performance Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/python_%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="Python网络编程" class="md-nav__link">
      Python网络编程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      java
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="java" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../java/java-basic-introduction/" title="java basic introduction" class="md-nav__link">
      java basic introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      网络
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="网络" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        网络
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../network/tcp_ip%E8%AF%A6%E8%A7%A3%E5%8D%B7%E4%B8%80/tcp_ip%E8%AF%A6%E8%A7%A3%E5%8D%B7%E4%B8%80/" title="TCP IP详解卷一" class="md-nav__link">
      TCP IP详解卷一
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      unix/linux
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="unix/linux" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        unix/linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix_linux/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/" title="Linux高性能服务器编程" class="md-nav__link">
      Linux高性能服务器编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix_linux/unix%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF/" title="unix编程艺术" class="md-nav__link">
      unix编程艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix_linux/unix%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%8D%B7%E4%B8%80/" title="unix网络编程卷一" class="md-nav__link">
      unix网络编程卷一
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix_linux/unix%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF/" title="unix编程艺术" class="md-nav__link">
      unix编程艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix_linux/unp/unp%E7%AC%94%E8%AE%B0/" title="UNP" class="md-nav__link">
      UNP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      分布式
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="分布式" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        分布式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%88%86%E5%B8%83%E5%BC%8F/Kafka%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/" title="Kafka 权威指南" class="md-nav__link">
      Kafka 权威指南
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/" title="分布式框架原理与应用" class="md-nav__link">
      分布式框架原理与应用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%88%86%E5%B8%83%E5%BC%8F/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" title="大规模分布式存储系统" class="md-nav__link">
      大规模分布式存储系统
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%88%86%E5%B8%83%E5%BC%8F/%E6%B7%B1%E5%85%A5%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E4%BB%8E%E5%8E%9F%E7%90%86%E5%88%B0%E5%AE%9E%E8%B7%B5/" title="深入分布式缓存从原理到实践" class="md-nav__link">
      深入分布式缓存从原理到实践
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-18" type="checkbox" id="nav-18">
    
    <label class="md-nav__link" for="nav-18">
      搜索引擎
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="搜索引擎" data-md-level="1">
      <label class="md-nav__title" for="nav-18">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        搜索引擎
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/Elasticsearch%E5%AE%9E%E6%88%98/book/" title="Elasticsearch实战" class="md-nav__link">
      Elasticsearch实战
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-19" type="checkbox" id="nav-19">
    
    <label class="md-nav__link" for="nav-19">
      容器
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="容器" data-md-level="1">
      <label class="md-nav__title" for="nav-19">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        容器
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../devops/%E7%8E%A9%E8%BD%ACKubernets-CloudMan/" title="玩转Kubernets" class="md-nav__link">
      玩转Kubernets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../devops/%E7%AC%AC%E4%B8%80%E6%9C%ACdocker%E4%B9%A6/" title="第一本docker书" class="md-nav__link">
      第一本docker书
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-20" type="checkbox" id="nav-20">
    
    <label class="md-nav__link" for="nav-20">
      开发工具
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="开发工具" data-md-level="1">
      <label class="md-nav__title" for="nav-20">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        开发工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/practical_vim/practical_vim/" title="Practical Vim" class="md-nav__link">
      Practical Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/vim8%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98/vim8%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98/" title="Vim8文本处理实战" class="md-nav__link">
      Vim8文本处理实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/learn_vim_the_hard_way/" title="Learn vim scrpt the hard way" class="md-nav__link">
      Learn vim scrpt the hard way
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/pro_git/" title="Pro Git" class="md-nav__link">
      Pro Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Mastering_vim/" title="Mastering Vim" class="md-nav__link">
      Mastering Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/mastering_vim_quickly/" title="Mastering Vim Quickly" class="md-nav__link">
      Mastering Vim Quickly
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-21" type="checkbox" id="nav-21">
    
    <label class="md-nav__link" for="nav-21">
      网站架构微服务
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="网站架构微服务" data-md-level="1">
      <label class="md-nav__title" for="nav-21">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        网站架构微服务
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/microservices_patterns_%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/book/" title="微服务架构设计模式" class="md-nav__link">
      微服务架构设计模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%9E%B6%E6%9E%84/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%9E%B6%E6%9E%84/" title="从0开始学架构" class="md-nav__link">
      从0开始学架构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/web_scalavility_for_startup_engineers/" title="web scalavility for startup engineers" class="md-nav__link">
      web scalavility for startup engineers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/design_data_instensive_application/" title="design_data_instensive_application" class="md-nav__link">
      design_data_instensive_application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/clean_architecture/" title="clean_architecture" class="md-nav__link">
      clean_architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/" title="微服务设计" class="md-nav__link">
      微服务设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/2_design_data_instensive_application/" title="2_design_data_instensive_application" class="md-nav__link">
      2_design_data_instensive_application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/3_design_data_instensive_application/" title="3_design_data_instensive_application" class="md-nav__link">
      3_design_data_instensive_application
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-22" type="checkbox" id="nav-22">
    
    <label class="md-nav__link" for="nav-22">
      软件工程/项目管理
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="软件工程/项目管理" data-md-level="1">
      <label class="md-nav__title" for="nav-22">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        软件工程/项目管理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/" title="人月神话" class="md-nav__link">
      人月神话
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BB%A3%E7%A0%81%E4%B9%8B%E6%AE%87/" title="代码之殇" class="md-nav__link">
      代码之殇
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E8%A7%A3%E6%9E%90%E6%9E%81%E9%99%90%E7%BC%96%E7%A8%8B-%E6%8B%A5%E6%8A%B1%E5%8F%98%E5%8C%96/" title="解析极限编程" class="md-nav__link">
      解析极限编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93/" title="项目管理修炼之道" class="md-nav__link">
      项目管理修炼之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BF%AE%E6%94%B9%E8%BD%AF%E4%BB%B6%E7%9A%84%E8%89%BA%E6%9C%AF/" title="修改软件的艺术" class="md-nav__link">
      修改软件的艺术
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-23" type="checkbox" id="nav-23">
    
    <label class="md-nav__link" for="nav-23">
      运维
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="运维" data-md-level="1">
      <label class="md-nav__title" for="nav-23">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        运维
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BF%90%E7%BB%B4/linux%E9%9B%86%E7%BE%A4%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" title="linux集群和自动化运维" class="md-nav__link">
      linux集群和自动化运维
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BF%90%E7%BB%B4/python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" title="python自动化运维" class="md-nav__link">
      python自动化运维
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-24" type="checkbox" id="nav-24">
    
    <label class="md-nav__link" for="nav-24">
      互联网
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="互联网" data-md-level="1">
      <label class="md-nav__title" for="nav-24">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        互联网
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E4%BA%92%E8%81%94%E7%BD%91/%E6%88%91%E7%9A%84%E4%BA%92%E8%81%94%E7%BD%91%E6%96%B9%E6%B3%95%E8%AE%BA-%E5%91%A8%E9%B8%BF%E7%A5%8E/" title="我的互联网方法论-周鸿祎" class="md-nav__link">
      我的互联网方法论-周鸿祎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E4%BA%92%E8%81%94%E7%BD%91/%E7%94%A8%E6%88%B7%E6%80%9D%E7%BB%B4/" title="用户思维" class="md-nav__link">
      用户思维
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-25" type="checkbox" id="nav-25">
    
    <label class="md-nav__link" for="nav-25">
      区块链
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="区块链" data-md-level="1">
      <label class="md-nav__title" for="nav-25">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        区块链
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%8C%BA%E5%9D%97%E9%93%BE/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E6%8C%87%E5%8D%97%28blockchain_guide%29/" title="区块链技术指南" class="md-nav__link">
      区块链技术指南
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-26" type="checkbox" id="nav-26">
    
    <label class="md-nav__link" for="nav-26">
      技术演讲
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="技术演讲" data-md-level="1">
      <label class="md-nav__title" for="nav-26">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        技术演讲
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lecture/Gopher/%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E7%9A%84go%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98/note/" title="哔哩哔哩的go微服务实战" class="md-nav__link">
      哔哩哔哩的go微服务实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lecture/Gopher/Go_Error/go%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E5%BA%93%E4%B9%8BError%26Context/" title="go业务基础库之Error&Context" class="md-nav__link">
      go业务基础库之Error&Context
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lecture/Gopher/Go%E5%90%8C%E6%AD%A5%E5%92%8C%E5%B9%B6%E5%8F%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/note/" title="Go同步和并发设计模式" class="md-nav__link">
      Go同步和并发设计模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lecture/%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2/%E5%B7%A6%E8%80%B3%E6%9C%B5%E8%80%97%E5%AD%90-%E6%88%91%E8%BF%99%E6%8A%80%E6%9C%AF%E4%BA%8C%E5%8D%81%E5%B9%B4/" title="左耳朵耗子-我这技术二十年" class="md-nav__link">
      左耳朵耗子-我这技术二十年
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-27" type="checkbox" id="nav-27">
    
    <label class="md-nav__link" for="nav-27">
      金融理财
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="金融理财" data-md-level="1">
      <label class="md-nav__title" for="nav-27">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        金融理财
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%87%91%E8%9E%8D%E7%90%86%E8%B4%A2/%E5%AE%9A%E6%8A%95%E5%8D%81%E5%B9%B4/" title="定投十年" class="md-nav__link">
      定投十年
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%87%91%E8%9E%8D%E7%90%86%E8%B4%A2/%E7%A9%B7%E6%9F%A5%E7%90%86%E5%AE%9D%E5%85%B8/" title="穷查理宝典" class="md-nav__link">
      穷查理宝典
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-28" type="checkbox" id="nav-28">
    
    <label class="md-nav__link" for="nav-28">
      写作
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="写作" data-md-level="1">
      <label class="md-nav__title" for="nav-28">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        写作
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%86%99%E4%BD%9C/%E5%88%B7%E5%B1%8F%E6%96%87%E6%A1%88%E5%86%99%E4%BD%9C%E6%8A%80%E5%B7%A7/" title="刷屏文案写作技巧" class="md-nav__link">
      刷屏文案写作技巧
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-29" type="checkbox" id="nav-29">
    
    <label class="md-nav__link" for="nav-29">
      思维
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="思维" data-md-level="1">
      <label class="md-nav__title" for="nav-29">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        思维
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E4%B8%93%E6%B3%A8%E5%8A%9B_%E5%8C%96%E7%B9%81%E4%B8%BA%E7%AE%80%E7%9A%84%E6%83%8A%E4%BA%BA%E5%8A%9B%E9%87%8F/" title="专注力" class="md-nav__link">
      专注力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E4%B8%BA%E4%BB%80%E4%B9%88%E7%B2%BE%E8%8B%B1%E8%BF%99%E6%A0%B7%E7%94%A8%E8%84%91%E4%B8%8D%E4%BC%9A%E7%B4%AF/" title="为什么精英这样用脑不会累" class="md-nav__link">
      为什么精英这样用脑不会累
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%88%BB%E6%84%8F%E7%BB%83%E4%B9%A0/" title="刻意练习" class="md-nav__link">
      刻意练习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%A6%82%E4%BD%95%E6%83%B3%E5%88%B0%E5%8F%88%E5%81%9A%E5%88%B0/" title="如何想到又做到" class="md-nav__link">
      如何想到又做到
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%AD%A6%E4%B9%A0%E4%B9%8B%E9%81%93/" title="学习之道" class="md-nav__link">
      学习之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%AD%A6%E4%B9%A0%E5%8A%9B/" title="学习力" class="md-nav__link">
      学习力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E6%89%B9%E5%88%A4%E6%80%A7%E6%80%9D%E7%BB%B4%E5%B7%A5%E5%85%B7/" title="批判性思维工具" class="md-nav__link">
      批判性思维工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%80%9D%E7%BB%B4%E4%BF%AE%E7%82%BC%28%E5%BC%80%E5%8F%91%E8%AE%A4%E7%9F%A5%E6%BD%9C%E8%83%BD%E7%9A%84%E4%B9%9D%E5%A0%82%E8%AF%BE%29/" title="程序员的思维修炼" class="md-nav__link">
      程序员的思维修炼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E8%AE%A4%E7%9F%A5%E5%A4%A9%E6%80%A7/" title="认知天性" class="md-nav__link">
      认知天性
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E8%B6%85%E6%95%88%E7%8E%87%E6%89%8B%E5%86%8C/" title="超效率手册" class="md-nav__link">
      超效率手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E8%AE%B0%E5%BF%86/" title="如何高效记忆" class="md-nav__link">
      如何高效记忆
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E7%A7%91%E5%AD%A6%E5%AD%A6%E4%B9%A0/" title="科学学习" class="md-nav__link">
      科学学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E9%AB%98%E6%95%88%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%8445%E4%B8%AA%E4%B9%A0%E6%83%AF/" title="高效程序员的45个习惯" class="md-nav__link">
      高效程序员的45个习惯
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-30" type="checkbox" id="nav-30">
    
    <label class="md-nav__link" for="nav-30">
      职场
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="职场" data-md-level="1">
      <label class="md-nav__title" for="nav-30">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        职场
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/give_and_take/" title="give and take" class="md-nav__link">
      give and take
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/the_effective_engineer/" title="the_effective_engineer" class="md-nav__link">
      the_effective_engineer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E5%85%89%E9%80%9F%E6%88%90%E9%95%BF/" title="光速成长" class="md-nav__link">
      光速成长
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E5%90%91%E4%B8%8A%E7%AE%A1%E7%90%86/" title="向上管理" class="md-nav__link">
      向上管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E6%88%90%E5%8A%9F%E5%8A%A8%E6%9C%BA%E4%B8%8E%E7%9B%AE%E6%A0%87/" title="成功动机与目标" class="md-nav__link">
      成功动机与目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E7%95%AA%E8%8C%84%E5%B7%A5%E4%BD%9C%E6%B3%95/" title="番茄工作法" class="md-nav__link">
      番茄工作法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%81%86%E5%90%AC%E6%B2%9F%E9%80%9A%E5%AD%A6/" title="聆听沟通学" class="md-nav__link">
      聆听沟通学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E7%9F%A5%E4%B9%8E%E8%81%8C%E4%BA%BA%E8%A7%89%E9%86%92/" title="知乎职人觉醒" class="md-nav__link">
      知乎职人觉醒
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E7%9F%A5%E8%AF%86%E5%8F%98%E7%8E%B0/" title="知识变现" class="md-nav__link">
      知识变现
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%81%86%E5%90%AC%E6%B2%9F%E9%80%9A%E5%AD%A6/" title="聆听沟通学" class="md-nav__link">
      聆听沟通学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%81%8C%E5%9C%BA%E5%8A%A8%E7%89%A9%E8%BF%9B%E5%8C%96%E6%89%8B%E5%86%8C/" title="职场动物进化手册" class="md-nav__link">
      职场动物进化手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%81%8C%E5%9C%BA%E8%A7%A3%E9%87%8A%E7%B3%BB/" title="职场解释系" class="md-nav__link">
      职场解释系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%AF%B7%E5%81%9C%E6%AD%A2%E6%97%A0%E6%95%88%E5%8A%AA%E5%8A%9B/" title="请停止无效努力" class="md-nav__link">
      请停止无效努力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%BD%AF%E6%8A%80%E8%83%BD/" title="软技能" class="md-nav__link">
      软技能
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E9%AB%98%E6%95%8815%E6%B3%95%E5%88%99/" title="高效15法则" class="md-nav__link">
      高效15法则
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E9%AB%98%E6%95%88%E6%B8%85%E5%8D%95%E5%B7%A5%E4%BD%9C%E6%B3%95/" title="高效清单工作法" class="md-nav__link">
      高效清单工作法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/" title="程序员的自我修养" class="md-nav__link">
      程序员的自我修养
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-31" type="checkbox" id="nav-31">
    
    <label class="md-nav__link" for="nav-31">
      心理学
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="心理学" data-md-level="1">
      <label class="md-nav__title" for="nav-31">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        心理学
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E7%AB%A5%E5%B9%B4%E7%9A%84%E9%94%99%E5%90%97/" title="一切都是童年的错吗" class="md-nav__link">
      一切都是童年的错吗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E4%BA%B2%E5%AF%86%E5%85%B3%E7%B3%BB/" title="亲密关系" class="md-nav__link">
      亲密关系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E6%83%85%E5%95%86/" title="情商" class="md-nav__link">
      情商
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E9%80%86%E5%95%86/" title="逆商" class="md-nav__link">
      逆商
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E6%8B%96%E5%BB%B6%E5%BF%83%E7%90%86%E5%AD%A6/" title="拖延心理学" class="md-nav__link">
      拖延心理学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E7%A7%AF%E6%9E%81%E5%BF%83%E7%90%86%E5%AD%A6/" title="积极心理学" class="md-nav__link">
      积极心理学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B/" title="自控力" class="md-nav__link">
      自控力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B-%E5%AE%9E%E6%93%8D%E7%AF%87/" title="自控力-实操篇" class="md-nav__link">
      自控力-实操篇
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B-%E5%92%8C%E5%8E%8B%E5%8A%9B%E5%81%9A%E6%9C%8B%E5%8F%8B/" title="自控力:和压力做朋友" class="md-nav__link">
      自控力:和压力做朋友
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E6%B4%BB%E5%87%BA%E6%9C%80%E4%B9%90%E8%A7%82%E7%9A%84%E8%87%AA%E5%B7%B1/" title="活出最乐观的自己" class="md-nav__link">
      活出最乐观的自己
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E6%94%B9%E5%8F%98%E5%BF%83%E7%90%86%E5%AD%A6%E7%9A%8440%E9%A1%B9%E7%A0%94%E7%A9%B6/" title="改变心理学的40项研究" class="md-nav__link">
      改变心理学的40项研究
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E8%B6%85%E8%B6%8A%E8%87%AA%E5%8D%91/" title="超越自卑" class="md-nav__link">
      超越自卑
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E5%8F%8D%E8%84%86%E5%BC%B1/" title="反脆弱" class="md-nav__link">
      反脆弱
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-32" type="checkbox" id="nav-32">
    
    <label class="md-nav__link" for="nav-32">
      创业
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="创业" data-md-level="1">
      <label class="md-nav__title" for="nav-32">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        创业
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../startup/hello_startup/" title="Hello Startup" class="md-nav__link">
      Hello Startup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../startup/%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%85%AC%E5%BC%80%E8%AF%BE-%E5%A6%82%E4%BD%95%E5%88%9B%E4%B8%9A/" title="斯坦福公开课如何创业" class="md-nav__link">
      斯坦福公开课如何创业
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../startup/%E8%BF%90%E8%90%A5%E5%85%B6%E5%AE%9E%E5%BE%88%E7%AE%80%E5%8D%95/" title="运营其实很简单" class="md-nav__link">
      运营其实很简单
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deadlocks-livelocks-and-starvation" class="md-nav__link">
    Deadlocks, Livelocks, and Starvation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#determining-concurrency-safety" class="md-nav__link">
    Determining Concurrency Safety
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simplicity-in-the-face-of-complexity" class="md-nav__link">
    Simplicity in the Face of Complexity
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/zwiley/mybook/edit/master/docs/golang/concurrency-in-go/concurrency_in_go.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <p>《Concurrency In Go》</p>
<h1 id="1-an-introduction-to-concurrency">1 An Introduction to Concurrency<a class="headerlink" href="#1-an-introduction-to-concurrency" title="Permanent link">&para;</a></h1>
<p>critical section（临界区）：for a section of your program needs exclusive access to a shared resource.</p>
<h3 id="deadlocks-livelocks-and-starvation">Deadlocks, Livelocks, and Starvation<a class="headerlink" href="#deadlocks-livelocks-and-starvation" title="Permanent link">&para;</a></h3>
<p>Deadlocks conditions:</p>
<ul>
<li>Mutual Exclusion</li>
<li>Wait For Condition</li>
<li>No Preemption</li>
<li>Circular Wait</li>
</ul>
<p>Livelocks: 活锁。想象两个人迎面走来，一个人向一边转，然后另一个人也同方向转，如此循环一直僵持谁都过不去。</p>
<p>Starvation: 饥饿 ，一个并发的进程无法获取所有需要工作的资源。一个贪心的进程阻止其他进程获取执行资源。</p>
<h3 id="determining-concurrency-safety">Determining Concurrency Safety<a class="headerlink" href="#determining-concurrency-safety" title="Permanent link">&para;</a></h3>
<ul>
<li>who is responsible for the Concurrency?</li>
<li>how is the problem space mapped onto concurrency primitives?</li>
<li>who is responsible for the synchronization?</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">CalculatePi</span><span class="p">(</span><span class="nx">begin</span><span class="p">,</span><span class="nx">end</span> <span class="kt">int64</span><span class="p">,</span> <span class="nx">pi</span> <span class="o">*</span><span class="nx">Pi</span><span class="p">)</span>
<span class="kd">func</span> <span class="nx">CalculatePi</span><span class="p">(</span><span class="nx">begin</span><span class="p">,</span><span class="nx">end</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">[]</span><span class="kt">int64</span>
<span class="kd">func</span> <span class="nx">CalculatePi</span><span class="p">(</span><span class="nx">begin</span><span class="p">,</span><span class="nx">end</span> <span class="kt">int64</span><span class="p">)</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint</span>
</code></pre></div>


<h3 id="simplicity-in-the-face-of-complexity">Simplicity in the Face of Complexity<a class="headerlink" href="#simplicity-in-the-face-of-complexity" title="Permanent link">&para;</a></h3>
<h1 id="2-modeling-your-code-communicating-sequential-processes">2 Modeling Your Code: Communicating Sequential Processes<a class="headerlink" href="#2-modeling-your-code-communicating-sequential-processes" title="Permanent link">&para;</a></h1>
<h3 id="concurrency-vs-parallelism">Concurrency vs Parallelism<a class="headerlink" href="#concurrency-vs-parallelism" title="Permanent link">&para;</a></h3>
<p>Concurrency is a property of the code; parallelism is a property of the runnning programm.</p>
<h3 id="what-is-csp">What Is CSP?<a class="headerlink" href="#what-is-csp" title="Permanent link">&para;</a></h3>
<h3 id="gos-philosophy-on-concurrency">Go&rsquo;s Philosophy on Concurrency<a class="headerlink" href="#gos-philosophy-on-concurrency" title="Permanent link">&para;</a></h3>
<p>CSP primitives or Memory access synchronizations.
Use whichever is most expressive and/or most simple.</p>
<p><img alt="" src="../decision_tree.png" /></p>
<p>Aim for simplicity, use channels when possible, and treat goroutines like a free resource.</p>
<h1 id="3-gos-concurrency-building-blocks">3 Go&rsquo;s Concurrency Building Blocks<a class="headerlink" href="#3-gos-concurrency-building-blocks" title="Permanent link">&para;</a></h1>
<p>Coroutines are simply concurrent subroutines(functions, clousures or methods in Go) that are nonpreemptive.(非抢占式)</p>
<p>Go follows a model of concurrency called the fork-join model.</p>
<p><img alt="" src="../join_point.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

<span class="nx">sayHello</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">go</span> <span class="nx">sayHello</span><span class="p">()</span>
<span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span> <span class="err">#</span> <span class="nx">this</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">join</span> <span class="nx">point</span><span class="err">，</span><span class="nx">等</span> <span class="nx">child</span> <span class="nx">执行完毕</span>
</code></pre></div>


<h3 id="the-sync-package">The sync Package<a class="headerlink" href="#the-sync-package" title="Permanent link">&para;</a></h3>
<p>The sync package contains the concurrency primitives that are most useful for low-level memory access synchronization.</p>
<h4 id="waitgroup">WaitGroup<a class="headerlink" href="#waitgroup" title="Permanent link">&para;</a></h4>
<p>Wait for a set of concurrent operations to complete when you either don&rsquo;t care about the result of the concurrent
operations , or you have other means of collecting their results.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;sync&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>

    <span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// 注意 Add 必须在外边而不是在 go func() 函数体里边</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;1st goroutine sleeping...&quot;</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}()</span>

    <span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">defer</span> <span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;2nd goroutine sleeping...&quot;</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">}()</span>

    <span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;All goroutines complete&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="mutex-and-rwmutex">Mutex and RWMutex<a class="headerlink" href="#mutex-and-rwmutex" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// Mutex demo</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">count</span> <span class="kt">int</span>
    <span class="kd">var</span> <span class="nx">lock</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>

    <span class="nx">incr</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">lock</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
        <span class="k">defer</span> <span class="nx">lock</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
        <span class="nx">count</span><span class="o">++</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Incr: %d\n&quot;</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">decr</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">lock</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
        <span class="k">defer</span> <span class="nx">lock</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
        <span class="nx">count</span><span class="o">--</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Decr: %d\n&quot;</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">arithmetic</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">arithmetic</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">defer</span> <span class="nx">arithmetic</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
            <span class="nx">incr</span><span class="p">()</span>
        <span class="p">}()</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">arithmetic</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">defer</span> <span class="nx">arithmetic</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
            <span class="nx">decr</span><span class="p">()</span>
        <span class="p">}()</span>
    <span class="p">}</span>

    <span class="nx">arithmetic</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>RWMutex: 适合读多写少场景。可以获取多个读锁，除非锁用来持有写入。</p>
<h4 id="cond">Cond<a class="headerlink" href="#cond" title="Permanent link">&para;</a></h4>
<p>A rendezvous point for goroutine waiting for or announcing the occurrence of an event.</p>
<div class="codehilite"><pre><span></span><code><span class="err">for conditoinTrue() == false{</span>
<span class="err">    time.Sleep(1*time.Millisecond) //sleep多久是个问题，太久效率低下，太快消耗 cpu</span>
<span class="err">}</span>
</code></pre></div>


<p>use Cond, we cloud write like this:</p>
<div class="codehilite"><pre><span></span><code><span class="err">c := sync.NewCond(&amp;sync.Mutex{})</span>
<span class="err">c.L.Lock()</span>
<span class="err">for conditoinTrue() == false {</span>
<span class="err">    c.Wait() // blocking call, will suspend</span>
<span class="err">}</span>
<span class="err">c.L.UnLock()</span>
</code></pre></div>


<p>考虑有一个固定长度为2的队列，10个 items 想要 push 进去。
只要有空间我们就希望入队，被尽早通知。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;sync&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">c</span> <span class="p">:</span><span class="o">=</span> <span class="n">sync</span><span class="o">.</span><span class="n">NewCond</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span><span class="p">{})</span>
    <span class="n">queue</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">([]</span><span class="n">interface</span><span class="p">{},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">removeFromQueue</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">delay</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span> <span class="o">//</span> <span class="n">enter</span> <span class="n">the</span> <span class="n">critical</span> <span class="n">section</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">//</span><span class="n">simulate</span> <span class="n">dequeuing</span> <span class="n">an</span> <span class="n">item</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;removed from queue&quot;</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span> <span class="o">//</span> <span class="nb">exit</span> <span class="n">critical</span> <span class="n">section</span>
        <span class="n">c</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span> <span class="o">//</span> <span class="n">let</span> <span class="n">a</span> <span class="n">goroutine</span> <span class="n">waiting</span> <span class="n">on</span> <span class="n">the</span> <span class="n">condition</span> <span class="n">know</span> <span class="n">that</span> <span class="n">something</span> <span class="n">has</span> <span class="n">occured</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">c</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span> <span class="o">//</span><span class="err">进入临界区</span><span class="p">,</span> <span class="n">critical</span> <span class="n">section</span>
        <span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">{</span>
            <span class="n">c</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span> <span class="o">//</span><span class="n">will</span> <span class="n">suspend</span> <span class="n">the</span> <span class="n">main</span> <span class="n">goroutine</span> <span class="n">until</span> <span class="n">a</span> <span class="n">signal</span> <span class="n">on</span> <span class="n">the</span> <span class="n">condition</span> <span class="n">has</span> <span class="n">been</span> <span class="n">sent</span>
        <span class="p">}</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Adding to queue&quot;</span><span class="p">)</span>
        <span class="n">queue</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">struct</span><span class="p">{}{})</span>
        <span class="n">go</span> <span class="n">removeFromQueue</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span> <span class="o">//</span><span class="nb">exit</span> <span class="n">critical</span> <span class="n">section</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="once">Once<a class="headerlink" href="#once" title="Permanent link">&para;</a></h4>
<p>only one call to &ldquo;Do&rdquo;, even on different goroutines.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">count</span> <span class="nb">int</span>

    <span class="n">increment</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">count</span><span class="o">++</span>
    <span class="p">}</span>

    <span class="n">var</span> <span class="n">once</span> <span class="n">sync</span><span class="o">.</span><span class="n">Once</span>
    <span class="n">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
            <span class="n">once</span><span class="o">.</span><span class="n">Do</span><span class="p">(</span><span class="n">increment</span><span class="p">)</span>
        <span class="p">}()</span>
    <span class="p">}</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;count is </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="o">//</span><span class="mi">1</span>
<span class="p">}</span>
</code></pre></div>


<p>NOTES: sync.Once only counts the number of times Do is Called, not
how many times unique functions passed into Do are called.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">count</span> <span class="nb">int</span>
    <span class="n">increment</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">count</span><span class="o">++</span> <span class="p">}</span>
    <span class="n">decremet</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">count</span><span class="o">--</span> <span class="p">}</span>

    <span class="n">var</span> <span class="n">once</span> <span class="n">sync</span><span class="o">.</span><span class="n">Once</span>
    <span class="n">once</span><span class="o">.</span><span class="n">Do</span><span class="p">(</span><span class="n">increment</span><span class="p">)</span>
    <span class="n">once</span><span class="o">.</span><span class="n">Do</span><span class="p">(</span><span class="n">decremet</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;count is </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="o">//</span><span class="mi">1</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="pool">Pool(并发安全对象池)<a class="headerlink" href="#pool" title="Permanent link">&para;</a></h4>
<p>Pool is a concurrent-safe implementation of the object pool pattern.</p>
<div class="codehilite"><pre><span></span><code><span class="n">myPool</span> <span class="p">:</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">sync</span><span class="p">.</span><span class="n">Pool</span><span class="err">{</span>
    <span class="k">New</span><span class="p">:</span> <span class="n">func</span><span class="p">()</span> <span class="n">interface</span><span class="err">{}{</span>
        <span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="ss">&quot;Creating new instance.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">struct</span><span class="err">{}{}</span>
    <span class="err">}</span><span class="p">,</span>
<span class="err">}</span>

<span class="n">myPool</span><span class="p">.</span><span class="k">Get</span><span class="p">()</span>
<span class="n">instance</span><span class="p">:</span><span class="o">=</span><span class="n">myPool</span><span class="p">.</span><span class="k">Get</span><span class="p">()</span>
<span class="n">myPool</span><span class="p">.</span><span class="n">Put</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
<span class="n">myPool</span><span class="p">.</span><span class="k">Get</span><span class="p">()</span>
</code></pre></div>


<p>Another common situation where a Pool is useful is for warming a cache of pre-allocated
objects for operations that must run as quickly as possible.</p>
<p>When working with sync.Pool:</p>
<ul>
<li>give it a New member variable that is thread-safe when called</li>
<li>when receive an instance from Get,make no assumptions regarding the state of the object you receive back</li>
<li>Make sure to call Put when you&rsquo;re finished with the object you pulled out of the pool.(with defer)</li>
<li>Objects in the pool must be roughly uniform in makeup</li>
</ul>
<h3 id="channels">Channels<a class="headerlink" href="#channels" title="Permanent link">&para;</a></h3>
<p>Go will implicitly convert bidirectional channels to unidirectional channels when needed.</p>
<div class="codehilite"><pre><span></span><code><span class="n">var</span> <span class="n">receiveChan</span> <span class="o">&lt;-</span> <span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span>
<span class="n">var</span> <span class="n">sendChan</span> <span class="n">chan</span> <span class="o">&lt;-</span> <span class="n">interface</span><span class="p">{}</span>
<span class="n">dataStream</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
<span class="o">//</span><span class="n">valid</span> <span class="n">statements</span><span class="p">,</span> 双向的可以赋值给单向的
<span class="n">receiveChan</span> <span class="o">=</span> <span class="n">dataStream</span>
<span class="n">sendChan</span> <span class="o">=</span> <span class="n">dataStream</span>
</code></pre></div>


<p>Unbufferd channel in Go are said to be blocking.</p>
<div class="codehilite"><pre><span></span><code><span class="n">val</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">stringStream</span> <span class="o">//</span> <span class="n">ok</span> 判断还有没有值，从一个已经 <span class="n">closed</span> 的 <span class="n">channel</span> 依然会获取默认值
</code></pre></div>


<p>The second return value is a way for a read operation to indicate whether the read off the channel
was a value generated by a write elsewhere in the process, or a default value generated from a closed channel.</p>
<p>We can use &ldquo;for range&rdquo; iter channel, it will automatically break the loop when cahnnel is closed.</p>
<p>Buffred channels, even if no reads are performed on the channel, a goroutine can still perform n writes.
You can treat buffered channels are an inmemory FIFO queue for concurrent processes to communicate over.</p>
<p><img alt="" src="../channel1.png" />
<img alt="" src="../channel2.png" /></p>
<p>The first thing we should do to put channels in the right context is to assign channel ownership.</p>
<ul>
<li>Instaniate the channel.</li>
<li>Perform writes, os pass ownership to another goroutine.</li>
<li>Close the channel</li>
<li>Ecapsulate the previous three things in this list and expose them via a reader channel.</li>
</ul>
<p>As a consumer of a channel, I only have to worry about two things.</p>
<ul>
<li>Knowing when a channel is closed (use val, ok)</li>
<li>Responsibly handling blocking for any reason</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">keep</span> <span class="n">the</span> <span class="n">scope</span> <span class="n">of</span> <span class="n">channel</span> <span class="n">ownership</span> <span class="n">small</span>
<span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">chanOwner</span> <span class="o">:=</span> <span class="nf">func</span><span class="p">()</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">int</span> <span class="p">{</span>
        <span class="n">resultStream</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">int</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
        <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">resultStream</span><span class="p">)</span>
            <span class="n">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="m">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
                <span class="n">resultStream</span> <span class="o">&lt;-</span> <span class="n">i</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="n">return</span> <span class="n">resultStream</span> <span class="o">//</span> <span class="n">will</span> <span class="n">implicityly</span> <span class="n">converted</span> <span class="n">to</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span> <span class="n">for</span> <span class="n">consumers</span>
    <span class="p">}</span>

    <span class="n">resultStream</span> <span class="o">:=</span> <span class="nf">chanOwner</span><span class="p">()</span>
    <span class="n">for</span> <span class="n">result</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">resultStream</span> <span class="p">{</span>
        <span class="nf">fmt.Printf</span><span class="p">(</span><span class="s">&quot;received : %d\n&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nf">fmt.Println</span><span class="p">(</span><span class="s">&quot;Done receiving!&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="the-select-statement">The select Statement<a class="headerlink" href="#the-select-statement" title="Permanent link">&para;</a></h3>
<p>The select statement is the glue that binds channels together,
it can help safely bring channels together with concepts like cancellations, timeouts, waiting, and default values.</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">a</span> <span class="n">bit</span> <span class="n">like</span> <span class="n">switch</span>
    <span class="n">var</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span>   <span class="o">//</span> <span class="n">receive</span> <span class="n">only</span> <span class="n">chan</span>
    <span class="n">var</span> <span class="n">c3</span> <span class="n">chan</span><span class="o">&lt;-</span> <span class="n">interface</span><span class="p">{}</span>  <span class="o">//</span> <span class="n">send</span> <span class="n">only</span> <span class="n">chan</span>
    <span class="o">//</span> <span class="n">all</span> <span class="n">channels</span> <span class="n">reads</span> <span class="n">and</span> <span class="n">writes</span> <span class="n">are</span> <span class="n">considered</span> <span class="n">simultaneously</span> <span class="n">to</span> <span class="n">see</span> <span class="n">if</span> <span class="n">any</span> <span class="n">of</span> <span class="n">them</span> <span class="n">are</span> <span class="n">ready</span>
    <span class="o">//</span> <span class="n">populated</span> <span class="n">or</span> <span class="n">closed</span> <span class="n">channels</span> <span class="n">in</span> <span class="n">the</span> <span class="n">case</span> <span class="n">of</span> <span class="n">reads</span><span class="p">,</span> <span class="n">and</span> <span class="n">channels</span> <span class="n">that</span> <span class="n">are</span> <span class="n">not</span> <span class="n">at</span> <span class="n">capacity</span> <span class="n">in</span> <span class="n">the</span> <span class="n">case</span> <span class="n">of</span> <span class="n">writes</span>
    <span class="o">//</span> <span class="n">if</span> <span class="n">none</span> <span class="n">of</span> <span class="n">the</span> <span class="n">channels</span> <span class="n">are</span> <span class="n">ready</span><span class="p">,</span> <span class="n">the</span> <span class="n">entire</span> <span class="n">select</span> <span class="n">statement</span> <span class="n">blocks</span>
    <span class="n">select</span> <span class="p">{</span>
    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">c1</span><span class="o">:</span>
        <span class="o">//</span> <span class="n">do</span> <span class="n">something</span>
    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">c2</span><span class="o">:</span>
        <span class="o">//</span> <span class="n">do</span> <span class="n">something</span>
    <span class="n">case</span> <span class="n">c3</span> <span class="o">&lt;-</span> <span class="n">struct</span><span class="p">{}{}</span><span class="o">:</span>
        <span class="o">//</span> <span class="n">do</span> <span class="n">something</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>
<p>What happens when multiple channels have something to read?</p>
</li>
<li>
<p>random select, each has an equal  chance of being selected as all the others</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">c1</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="nf">close</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
    <span class="n">c2</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="nf">close</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    <span class="n">var</span> <span class="n">c1Count</span><span class="p">,</span> <span class="n">c2Count</span> <span class="n">int</span>
    <span class="n">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">1000</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span> <span class="p">{</span>
        <span class="n">select</span> <span class="p">{</span>
        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">c1</span><span class="o">:</span>
            <span class="n">c1Count</span><span class="o">++</span>
        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">c2</span><span class="o">:</span>
            <span class="n">c2Count</span><span class="o">++</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nf">fmt.Printf</span><span class="p">(</span><span class="s">&quot;c1: %d\n, c2: %d\n&quot;</span><span class="p">,</span> <span class="n">c1Count</span><span class="p">,</span> <span class="n">c2Count</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>
<p>What if there are never any channels that become ready?</p>
</li>
<li>
<p>you may want to timeout</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">c</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">int</span>
    <span class="n">select</span> <span class="p">{</span>
    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">c</span><span class="o">:</span>
    <span class="n">case</span> <span class="o">&lt;-</span><span class="nf">time.After</span><span class="p">(</span><span class="m">1</span> <span class="o">*</span> <span class="n">time.Second</span><span class="p">)</span><span class="o">:</span>
        <span class="nf">fmt.Println</span><span class="p">(</span><span class="s">&quot;Time out&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>
<p>what if we want to do something but no channels are currently ready?</p>
</li>
<li>
<p>use default</p>
</li>
<li>this allows a goroutine to make progress on work while waiting for another goroutine to report a result</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">start</span> <span class="o">:=</span> <span class="nf">time.Now</span><span class="p">()</span>
    <span class="n">var</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">int</span>
    <span class="n">select</span> <span class="p">{</span>
    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">c1</span><span class="o">:</span>
    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">c2</span><span class="o">:</span>
    <span class="n">default</span><span class="o">:</span>
        <span class="nf">fmt.Printf</span><span class="p">(</span><span class="s">&quot;In default after %v\n\n&quot;</span><span class="p">,</span> <span class="nf">time.Since</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">done</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">time.Sleep</span><span class="p">(</span><span class="m">5</span> <span class="o">*</span> <span class="n">time.Second</span><span class="p">)</span>
        <span class="nf">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
    <span class="p">}()</span>
    <span class="n">workCounter</span> <span class="o">:=</span> <span class="m">0</span>
<span class="n">loop</span><span class="o">:</span>
    <span class="n">for</span> <span class="p">{</span>
        <span class="n">select</span> <span class="p">{</span>
        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="o">:</span>
            <span class="n">break</span> <span class="n">loop</span>
        <span class="n">default</span><span class="o">:</span>
        <span class="p">}</span>
        <span class="o">//</span> <span class="n">simulate</span> <span class="n">work</span>
        <span class="n">workCounter</span><span class="o">++</span>
        <span class="nf">time.Sleep</span><span class="p">(</span><span class="m">1</span> <span class="o">*</span> <span class="n">time.Second</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">fmt.Printf</span><span class="p">(</span><span class="s">&quot;Achieved %v cycles of work before signalled to stop.\n&quot;</span><span class="p">,</span> <span class="n">workCounter</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h6 id="empty-select">empty select<a class="headerlink" href="#empty-select" title="Permanent link">&para;</a></h6>
<p><code>seelct {}</code> will block forever.</p>
<h3 id="the-gomaxprocs-lever">The GOMAXPROCS lever<a class="headerlink" href="#the-gomaxprocs-lever" title="Permanent link">&para;</a></h3>
<p>this function controls the number of OS threads that will host so-called &ldquo;work queues&rdquo;</p>
<h1 id="4-concurrency-patterns-in-go">4. Concurrency Patterns in Go<a class="headerlink" href="#4-concurrency-patterns-in-go" title="Permanent link">&para;</a></h1>
<h3 id="confinement">Confinement(限制)<a class="headerlink" href="#confinement" title="Permanent link">&para;</a></h3>
<p>When working with concurrent code</p>
<ul>
<li>Synchronization primitives for sharing memory (sync.Mutex)</li>
<li>Synchronization via Communicating (channels)</li>
<li>Immutable Data (copy of values)</li>
<li>Data protected by confinement (ad hoc and lexical)</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">confines</span> <span class="n">the</span> <span class="n">write</span> <span class="n">aspect</span> <span class="n">of</span> <span class="n">this</span> <span class="n">channel</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">other</span> <span class="n">goroutines</span> <span class="n">from</span> <span class="n">writing</span> <span class="n">to</span> <span class="n">it</span>
    <span class="o">//</span> 限制向 <span class="n">channel</span> 写数据到一个 <span class="n">func</span> 里
    <span class="n">chanOnwer</span> <span class="o">:=</span> <span class="nf">func</span><span class="p">()</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">int</span> <span class="p">{</span>
        <span class="n">results</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">int</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>
        <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
            <span class="n">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="m">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
                <span class="n">results</span> <span class="o">&lt;-</span> <span class="n">i</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="n">return</span> <span class="n">results</span>
    <span class="p">}</span>

    <span class="n">consumer</span> <span class="o">:=</span> <span class="nf">func</span><span class="p">(</span><span class="n">results</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">int</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">for</span> <span class="n">result</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">results</span> <span class="p">{</span>
            <span class="nf">fmt.Printf</span><span class="p">(</span><span class="s">&quot;Received : %d\n&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">fmt.Println</span><span class="p">(</span><span class="s">&quot;Done receiving!&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">results</span> <span class="o">:=</span> <span class="nf">chanOnwer</span><span class="p">()</span>
    <span class="nf">consumer</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="the-for-select-loop">The for-select Loop<a class="headerlink" href="#the-for-select-loop" title="Permanent link">&para;</a></h3>
<ul>
<li>Sending iteration variables out on a channel</li>
</ul>
<div class="codehilite"><pre><span></span><code>    <span class="n">for</span> _<span class="p">,</span> <span class="n">s</span> <span class="o">:=</span> <span class="n">range</span> <span class="p">[]</span><span class="n">string</span><span class="p">{</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">}</span> <span class="p">{</span>
        <span class="n">select</span> <span class="p">{</span>
        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="o">:</span>
            <span class="n">return</span>
        <span class="n">case</span> <span class="n">stringStream</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="o">:</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>


<ul>
<li>Looping infinitely waiting to be stopped</li>
</ul>
<div class="codehilite"><pre><span></span><code>    <span class="n">for</span> <span class="p">{</span>
        <span class="n">select</span> <span class="p">{</span>
        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="o">:</span>
            <span class="n">return</span>
        <span class="n">default</span><span class="o">:</span>
        <span class="p">}</span>
        <span class="o">//</span> <span class="n">do</span> <span class="n">non</span><span class="o">-</span><span class="n">preemptable</span> <span class="n">work</span>
    <span class="p">}</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">for</span> <span class="p">{</span>
    <span class="n">select</span> <span class="p">{</span>
    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="o">:</span>
        <span class="n">return</span>
    <span class="n">default</span><span class="o">:</span>
    <span class="p">}</span>
    <span class="o">//</span> <span class="n">do</span> <span class="n">non</span><span class="o">-</span><span class="n">preemptable</span> <span class="n">work</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="preventing-goroutine-leaksgoroutine">Preventing Goroutine Leaks(goroutine 泄露)<a class="headerlink" href="#preventing-goroutine-leaksgoroutine" title="Permanent link">&para;</a></h3>
<p><strong>Goroutine are not garbage collected by the runtime.</strong>
The goroutine has a few paths to terminiation:</p>
<ul>
<li>when it has completed its work</li>
<li>when it cannnot continue its work due to an unrecoverable error</li>
<li>when it&rsquo;s told to stop working</li>
</ul>
<p>A simple example of a goroutine leak:</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">doWork</span> <span class="o">:=</span> <span class="nf">func</span><span class="p">(</span><span class="n">strings</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">string</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
        <span class="n">completed</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="nf">fmt.Println</span><span class="p">(</span><span class="s">&quot;doWork exited.&quot;</span><span class="p">)</span>
            <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">completed</span><span class="p">)</span>
            <span class="n">for</span> <span class="n">s</span> <span class="o">:=</span> <span class="n">range</span> <span class="n">strings</span> <span class="p">{</span>
                <span class="o">//</span> <span class="n">do</span> <span class="n">something</span> <span class="n">interesting</span>
                <span class="nf">fmt.Println</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="n">return</span> <span class="n">completed</span>
    <span class="p">}</span>
    <span class="o">//</span><span class="n">pass</span> <span class="n">nil</span><span class="p">,</span> <span class="n">the</span> <span class="n">strings</span> <span class="n">channel</span> <span class="n">will</span> <span class="n">never</span> <span class="n">actually</span> <span class="n">gets</span> <span class="n">any</span> <span class="n">strings</span> <span class="n">written</span> <span class="n">onto</span> <span class="n">it</span>
    <span class="o">//</span><span class="n">and</span> <span class="n">the</span> <span class="n">goroutine</span> <span class="n">doWork</span> <span class="n">will</span> <span class="n">remain</span> <span class="n">in</span> <span class="n">memory</span> <span class="n">for</span> <span class="n">the</span> <span class="n">lifetime</span> <span class="n">of</span> <span class="n">this</span> <span class="n">process</span>
    <span class="nf">doWork</span><span class="p">(</span><span class="n">nil</span><span class="p">)</span>
    <span class="o">//</span> <span class="n">perhaps</span> <span class="n">more</span> <span class="n">work</span> <span class="n">is</span> <span class="n">done</span> <span class="n">here</span>
    <span class="nf">fmt.Println</span><span class="p">(</span><span class="s">&quot;Done.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>Use signal done. The parent goroutine passed this channel to child goroutine,
and then closes the channel when it wants to cancel the child goroutine.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">doWork</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span>
        <span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span>
        <span class="n">strings</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">string</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
        <span class="n">terminated</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;doWork exited&quot;</span><span class="p">)</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">terminated</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">{</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="n">s</span> <span class="p">:</span><span class="o">=</span> <span class="o">&lt;-</span><span class="n">strings</span><span class="p">:</span>
                    <span class="o">//</span><span class="n">do</span> <span class="n">somthing</span>
                    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>

        <span class="n">done</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">terminated</span> <span class="p">:</span><span class="o">=</span> <span class="n">doWork</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>

        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="o">//</span> <span class="n">cancel</span> <span class="n">operation</span> <span class="n">after</span> <span class="mi">1</span> <span class="n">second</span>
            <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;canceling doWork goroutine...&quot;</span><span class="p">)</span>
            <span class="n">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
        <span class="p">}()</span>

        <span class="o">&lt;-</span><span class="n">terminated</span> <span class="o">//</span> <span class="n">joined</span> <span class="n">the</span> <span class="n">goroutine</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>What if a goroutine blocked on attempting wo write a value to a channel?</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">newRandStream</span> <span class="o">:=</span> <span class="nf">func</span><span class="p">()</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">int</span> <span class="p">{</span>
        <span class="n">randStream</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">int</span><span class="p">)</span>
        <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="nf">fmt.Println</span><span class="p">(</span><span class="s">&quot;newRandStream closure exited.&quot;</span><span class="p">)</span> <span class="o">//</span><span class="n">never</span> <span class="n">run</span>
            <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">randStream</span><span class="p">)</span>
            <span class="n">for</span> <span class="p">{</span>
                <span class="n">randStream</span> <span class="o">&lt;-</span> <span class="nf">rand.Int</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="n">return</span> <span class="n">randStream</span>
    <span class="p">}</span>

    <span class="n">randStream</span> <span class="o">:=</span> <span class="nf">newRandStream</span><span class="p">()</span>
    <span class="nf">fmt.Println</span><span class="p">(</span><span class="s">&quot;3 random ints:&quot;</span><span class="p">)</span>
    <span class="n">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nf">fmt.Printf</span><span class="p">(</span><span class="s">&quot;%d:%d\n&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&lt;-</span><span class="n">randStream</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">//</span> 依然退出，输出<span class="m">1</span>到<span class="m">3</span>
<span class="p">}</span>
</code></pre></div>


<p>We can also use a done channel:</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">newRandStream</span> <span class="o">:=</span> <span class="nf">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">int</span> <span class="p">{</span>
        <span class="n">randStream</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">int</span><span class="p">)</span>
        <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="nf">fmt.Println</span><span class="p">(</span><span class="s">&quot;newRandStream closure exited.&quot;</span><span class="p">)</span> <span class="o">//</span><span class="n">never</span> <span class="n">run</span>
            <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">randStream</span><span class="p">)</span>
            <span class="n">for</span> <span class="p">{</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="n">randStream</span> <span class="o">&lt;-</span> <span class="nf">rand.Int</span><span class="p">()</span><span class="o">:</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="o">:</span>
                    <span class="n">return</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="n">return</span> <span class="n">randStream</span>
    <span class="p">}</span>

    <span class="n">done</span> <span class="o">:=</span><span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="n">randStream</span> <span class="o">:=</span> <span class="nf">newRandStream</span><span class="p">()</span>
    <span class="nf">fmt.Println</span><span class="p">(</span><span class="s">&quot;3 random ints:&quot;</span><span class="p">)</span>
    <span class="n">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nf">fmt.Printf</span><span class="p">(</span><span class="s">&quot;%d:%d\n&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&lt;-</span><span class="n">randStream</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>NOTE: If a goroutine is responsible for creating a goroutine, it is also responsible for ensuring
it can stop the gorutine.</p>
<h3 id="the-or-channel-pattern">The or-channel pattern<a class="headerlink" href="#the-or-channel-pattern" title="Permanent link">&para;</a></h3>
<p>At times you may find yourself wanting to combine one or more done channels into a single done channel
that closes if any of its component channels close.
This pattern creates a composite done channel through recursion and goroutines.</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">or</span> <span class="nf">func</span><span class="p">(</span><span class="n">channels</span> <span class="kc">...</span><span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span>
    <span class="n">or</span> <span class="o">=</span> <span class="nf">func</span><span class="p">(</span><span class="n">channels</span> <span class="kc">...</span><span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
        <span class="n">switch</span> <span class="nf">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">case</span> <span class="m">0</span><span class="o">:</span>
            <span class="n">return</span> <span class="n">nil</span>
        <span class="n">case</span> <span class="m">1</span><span class="o">:</span>
            <span class="n">return</span> <span class="n">channels</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">orDone</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">orDone</span><span class="p">)</span>
            <span class="n">switch</span> <span class="nf">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">case</span> <span class="m">2</span><span class="o">:</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">channels</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">:</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">channels</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">:</span>
                <span class="p">}</span>
            <span class="n">default</span><span class="o">:</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">channels</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">:</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">channels</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">:</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">channels</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">:</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="nf">or</span><span class="p">(</span><span class="nf">append</span><span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="m">3</span><span class="o">:</span><span class="p">],</span> <span class="n">orDone</span><span class="p">)</span><span class="kc">...</span><span class="p">)</span><span class="o">:</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="n">return</span> <span class="n">orDone</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">sig</span> <span class="o">:=</span> <span class="nf">func</span><span class="p">(</span><span class="n">after</span> <span class="n">time.Duration</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
        <span class="n">c</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="nf">time.Sleep</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>
        <span class="p">}()</span>
        <span class="n">return</span> <span class="n">c</span>
    <span class="p">}</span>
    <span class="n">start</span> <span class="o">:=</span> <span class="nf">time.Now</span><span class="p">()</span>
    <span class="o">&lt;-</span><span class="nf">or</span><span class="p">(</span>
        <span class="nf">sig</span><span class="p">(</span><span class="m">2</span><span class="o">*</span><span class="n">time.Hour</span><span class="p">),</span>
        <span class="nf">sig</span><span class="p">(</span><span class="m">5</span><span class="o">*</span><span class="n">time.Minute</span><span class="p">),</span>
        <span class="nf">sig</span><span class="p">(</span><span class="m">1</span><span class="o">*</span><span class="n">time.Second</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="nf">fmt.Printf</span><span class="p">(</span><span class="s">&quot;done after %v\n&quot;</span><span class="p">,</span> <span class="nf">time.Since</span><span class="p">(</span><span class="n">start</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="o">//</span> <span class="n">Result</span> <span class="ow">is</span> <span class="n">http</span> <span class="n">result</span>
<span class="nb">type</span> <span class="n">Result</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">Error</span>    <span class="n">error</span>
    <span class="n">Response</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Response</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">checkStatus</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">urls</span> <span class="o">...</span><span class="n">string</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">Result</span> <span class="p">{</span>
        <span class="n">results</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">Result</span><span class="p">)</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">url</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">urls</span> <span class="p">{</span>
                <span class="n">var</span> <span class="n">result</span> <span class="n">Result</span>
                <span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">{</span><span class="n">Error</span><span class="p">:</span> <span class="n">err</span><span class="p">,</span> <span class="n">Response</span><span class="p">:</span> <span class="n">resp</span><span class="p">}</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">case</span> <span class="n">results</span> <span class="o">&lt;-</span> <span class="n">result</span><span class="p">:</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="p">}</span>

    <span class="n">done</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
    <span class="n">urls</span> <span class="p">:</span><span class="o">=</span> <span class="p">[]</span><span class="n">string</span><span class="p">{</span><span class="s2">&quot;https://www.baidu.com&quot;</span><span class="p">,</span> <span class="s2">&quot;https://badhost&quot;</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">result</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">checkStatus</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">urls</span><span class="o">...</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">Error</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;error:%v&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">Error</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="p">}</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;Response: %</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">Response</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>Errors should be considered first-class citizens when constructing values to return from goroutines.
If your goroutine can produce errors, those errors should be tightly coupled with your result type,
and passed along through the same lines of communication.</p>
<h3 id="pipelines">Pipelines<a class="headerlink" href="#pipelines" title="Permanent link">&para;</a></h3>
<p>It is a very powerful tool to use when your program needs to process streams, or batched of data.</p>
<p>Stage: taskes data in , performs a transformation on it, and sends the data back out</p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">multiply</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="k">values</span><span class="w"> </span><span class="err">[]</span><span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="n">multiplier</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="err">[]</span><span class="nc">int</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">multipliedValues</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">make</span><span class="p">(</span><span class="err">[]</span><span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="k">values</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">            </span><span class="n">multipliedValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">multiplier</span><span class="w"></span>
<span class="w">        </span><span class="err">}</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">multipliedValues</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
</code></pre></div>


<h4 id="best-practice-for-constructing-pipelines">Best practice for constructing Pipelines<a class="headerlink" href="#best-practice-for-constructing-pipelines" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">generator</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">integers</span> <span class="o">...</span><span class="n">int</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="nb">int</span> <span class="p">{</span>
        <span class="n">intStream</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">intStream</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">integers</span> <span class="p">{</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">case</span> <span class="n">intStream</span> <span class="o">&lt;-</span> <span class="n">i</span><span class="p">:</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">intStream</span>
    <span class="p">}</span>

    <span class="n">multiply</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">intStream</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="nb">int</span><span class="p">,</span> <span class="n">multiplier</span> <span class="nb">int</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="nb">int</span> <span class="p">{</span>
        <span class="n">multipliedStream</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">multipliedStream</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">intStream</span> <span class="p">{</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">case</span> <span class="n">multipliedStream</span> <span class="o">&lt;-</span> <span class="n">i</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">:</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">multipliedStream</span>
    <span class="p">}</span>

    <span class="n">add</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">intStream</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="nb">int</span><span class="p">,</span> <span class="n">additive</span> <span class="nb">int</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="nb">int</span> <span class="p">{</span>
        <span class="n">addedStream</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">addedStream</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">intStream</span> <span class="p">{</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">case</span> <span class="n">addedStream</span> <span class="o">&lt;-</span> <span class="n">i</span> <span class="o">+</span> <span class="n">additive</span><span class="p">:</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">addedStream</span>
    <span class="p">}</span>

    <span class="n">done</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>

    <span class="n">intStream</span> <span class="p">:</span><span class="o">=</span> <span class="n">generator</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">pipeline</span> <span class="p">:</span><span class="o">=</span> <span class="n">multiply</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">multiply</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">intStream</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">pipeline</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>


<h4 id="some-handy-generators">Some Handy Generators<a class="headerlink" href="#some-handy-generators" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">repeat</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">values</span> <span class="o">...</span><span class="n">interface</span><span class="p">{})</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
        <span class="n">valueStream</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">valueStream</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">{</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">values</span> <span class="p">{</span>
                    <span class="n">select</span> <span class="p">{</span>
                    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="n">case</span> <span class="n">valueStream</span> <span class="o">&lt;-</span> <span class="n">v</span><span class="p">:</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">valueStream</span>
    <span class="p">}</span>

    <span class="n">take</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">valueStream</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">num</span> <span class="nb">int</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
        <span class="n">takeStream</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">takeStream</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">case</span> <span class="n">takeStream</span> <span class="o">&lt;-</span> <span class="o">&lt;-</span><span class="n">valueStream</span><span class="p">:</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">takeStream</span>
    <span class="p">}</span>

    <span class="n">done</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">num</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">take</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;%v &quot;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">//</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span>

<span class="p">}</span>
</code></pre></div>


<h3 id="fan-out-fan-in">Fan-Out, Fan-In (扇出，扇入)<a class="headerlink" href="#fan-out-fan-in" title="Permanent link">&para;</a></h3>
<p>Fan-out is a term to describe the process of starting multiple gortouine to handle input from the pipeline,
and Fan-in is a term to describe the process of combining results into one channel.</p>
<p>Fanout one of your stages if both of the following apply:</p>
<ul>
<li>It doesn&rsquo;t rely on values that the stage had calulated before.</li>
<li>It takes a long time to run</li>
</ul>
<h3 id="the-or-done-channel">The or-done-channel<a class="headerlink" href="#the-or-done-channel" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>    <span class="n">orDone</span> <span class="o">:=</span> <span class="nf">func</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">c</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
        <span class="n">valStream</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">valStream</span><span class="p">)</span>
            <span class="n">for</span> <span class="p">{</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="o">:</span>
                    <span class="n">return</span>
                <span class="n">case</span> <span class="n">v</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">c</span><span class="o">:</span>
                    <span class="n">if</span> <span class="n">ok</span> <span class="o">==</span> <span class="n">false</span> <span class="p">{</span>
                        <span class="n">return</span>
                    <span class="p">}</span>
                    <span class="n">select</span> <span class="p">{</span>
                    <span class="n">case</span> <span class="n">valStream</span> <span class="o">&lt;-</span> <span class="n">v</span><span class="o">:</span>
                    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="o">:</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="n">return</span> <span class="n">valStream</span>
    <span class="p">}</span>

    <span class="n">for</span> <span class="n">val</span> <span class="o">:=</span> <span class="n">range</span> <span class="nf">orDone</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">myChan</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Do</span> <span class="n">something</span> <span class="n">with</span> <span class="n">val</span>
    <span class="p">}</span>
</code></pre></div>


<h3 id="the-tee-channel">The tee-channel<a class="headerlink" href="#the-tee-channel" title="Permanent link">&para;</a></h3>
<p>Sometimes you may want to split values coming in from a channel so that you can send them off
into two separate areas of your codebase.</p>
<p>You can pass it a channel to read from , and it will return two seperate channels that will get the same value:</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">tee</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="ow">in</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span> <span class="p">(</span><span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span> <span class="p">{</span>
        <span class="n">out1</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">out2</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">out1</span><span class="p">)</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">out2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">orDone</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="ow">in</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">var</span> <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span> <span class="o">=</span> <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span> <span class="o">//</span><span class="n">shadow</span> <span class="n">the</span> <span class="n">variables</span>
                <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
                    <span class="n">select</span> <span class="p">{</span>
                    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="n">case</span> <span class="n">out1</span> <span class="o">&lt;-</span> <span class="n">val</span><span class="p">:</span>
                        <span class="o">//</span> <span class="nb">set</span> <span class="n">its</span> <span class="n">shadowed</span> <span class="n">copy</span> <span class="n">to</span> <span class="n">nil</span><span class="p">,</span><span class="n">so</span> <span class="n">further</span> <span class="n">writes</span> <span class="n">will</span> <span class="n">block</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">other</span> <span class="n">channel</span> <span class="n">may</span> <span class="k">continue</span>
                        <span class="n">out1</span> <span class="o">=</span> <span class="n">nil</span>
                    <span class="n">case</span> <span class="n">out2</span> <span class="o">&lt;-</span> <span class="n">val</span><span class="p">:</span>
                        <span class="n">out2</span> <span class="o">=</span> <span class="n">nil</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span>
    <span class="p">}</span>

    <span class="n">done</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
    <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span> <span class="p">:</span><span class="o">=</span> <span class="n">tee</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">take</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">val1</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">out1</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;out1: %v, out2:%v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="o">&lt;-</span><span class="n">out2</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="the-bridge-channel">The bridge-channel<a class="headerlink" href="#the-bridge-channel" title="Permanent link">&para;</a></h3>
<p>define a function that can destructure the channel of channels into s simple channel(bridging the channels)</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">bridge</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">chanStream</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
        <span class="n">valStream</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">valStream</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">{</span>
                <span class="n">var</span> <span class="n">stream</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="o">//</span><span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">channel</span> <span class="n">that</span> <span class="n">will</span> <span class="k">return</span> <span class="nb">all</span> <span class="n">values</span> <span class="kn">from</span> <span class="nn">bridge</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="n">maybeStream</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="o">&lt;-</span><span class="n">chanStream</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ok</span> <span class="o">==</span> <span class="n">false</span> <span class="p">{</span>
                        <span class="k">return</span>
                    <span class="p">}</span>
                    <span class="n">stream</span> <span class="o">=</span> <span class="n">maybeStream</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">orDone</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">select</span> <span class="p">{</span>
                    <span class="n">case</span> <span class="n">valStream</span> <span class="o">&lt;-</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="p">}</span>
                <span class="p">}</span>

            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">valStream</span>
    <span class="p">}</span>

    <span class="n">genVals</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">()</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
        <span class="n">chanStream</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="p">(</span><span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}))</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">chanStream</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
                <span class="n">stream</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">stream</span> <span class="o">&lt;-</span> <span class="n">i</span>
                <span class="n">close</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
                <span class="n">chanStream</span> <span class="o">&lt;-</span> <span class="n">stream</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">chanStream</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">v</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">bridge</span><span class="p">(</span><span class="n">nil</span><span class="p">,</span> <span class="n">genVals</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;%v &quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">//</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="queuing">Queuing<a class="headerlink" href="#queuing" title="Permanent link">&para;</a></h3>
<p>queuing should be implemented either:</p>
<ul>
<li>At the entrance to your pipeline</li>
<li>In stages where batching will lead to higher efficiency</li>
</ul>
<h3 id="the-context-package">The context Package<a class="headerlink" href="#the-context-package" title="Permanent link">&para;</a></h3>
<p>context package serves two primary purposes:</p>
<ul>
<li>to provide an API for canceling branches of you call-graph</li>
<li>to provide a data-bag for transporting request-scoped data through your call-graph</li>
</ul>
<h1 id="5-concurrency-at-scale">5. Concurrency at Scale<a class="headerlink" href="#5-concurrency-at-scale" title="Permanent link">&para;</a></h1>
<h3 id="error-progagation">Error Progagation<a class="headerlink" href="#error-progagation" title="Permanent link">&para;</a></h3>
<p>critical information:</p>
<ul>
<li>What happend</li>
<li>When and where it occured(stack track, UTC time, machine)</li>
<li>A friendly usre-facing message</li>
<li>How the user can get more information(track id)</li>
</ul>
<h3 id="timeouts-and-cancellation">Timeouts and Cancellation<a class="headerlink" href="#timeouts-and-cancellation" title="Permanent link">&para;</a></h3>
<p>what the reasons we might want our concurrent processes to support timeouts?</p>
<ul>
<li>System saturation(饱和)</li>
<li>Stale data</li>
<li>Attempting to prevent deadlocks</li>
</ul>
<p>There are a number of reasons why a concurrent process might be canceld:</p>
<ul>
<li>Timeouts, a timeout is an implicit cancellation</li>
<li>User intervention(干预)</li>
<li>Parent cancellation</li>
<li>Replicated requests</li>
</ul>
<h3 id="heartbeats">Heartbeats<a class="headerlink" href="#heartbeats" title="Permanent link">&para;</a></h3>
<p>Heartbeats are a way for concurrent processes to signal life to outside parties. Two diferent types:</p>
<ul>
<li>Heartbeats that occur on a time interval.</li>
<li>Heartbeats that occur at the beginning of a unit of work.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">doWork</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">pulseInterval</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">heartbeat</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
        <span class="n">results</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">)</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">heartbeat</span><span class="p">)</span>
            <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

            <span class="n">pulse</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Tick</span><span class="p">(</span><span class="n">pulseInterval</span><span class="p">)</span>
            <span class="n">workGen</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Tick</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pulseInterval</span><span class="p">)</span> <span class="o">//</span><span class="n">another</span> <span class="n">ticker</span> <span class="n">to</span> <span class="n">simulate</span> <span class="n">work</span> <span class="n">coming</span> <span class="ow">in</span>

            <span class="n">sendPulse</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="n">heartbeat</span> <span class="o">&lt;-</span> <span class="n">struct</span><span class="p">{}{}:</span>
                <span class="n">default</span><span class="p">:</span> <span class="o">//</span> <span class="n">no</span> <span class="n">one</span> <span class="n">maybe</span> <span class="n">listening</span> <span class="n">to</span> <span class="n">our</span> <span class="n">hearteat</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">sendResult</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">r</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">{</span>
                    <span class="n">select</span> <span class="p">{</span>
                    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="n">case</span> <span class="o">&lt;-</span><span class="n">pulse</span><span class="p">:</span>
                        <span class="n">sendPulse</span><span class="p">()</span>
                    <span class="n">case</span> <span class="n">results</span> <span class="o">&lt;-</span> <span class="n">r</span><span class="p">:</span>
                        <span class="k">return</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="p">{</span>
                <span class="n">select</span> <span class="p">{</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">case</span> <span class="o">&lt;-</span><span class="n">pulse</span><span class="p">:</span>
                    <span class="n">sendPulse</span><span class="p">()</span>
                <span class="n">case</span> <span class="n">r</span> <span class="p">:</span><span class="o">=</span> <span class="o">&lt;-</span><span class="n">workGen</span><span class="p">:</span>
                    <span class="n">sendResult</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="k">return</span> <span class="n">heartbeat</span><span class="p">,</span> <span class="n">results</span>
    <span class="p">}</span>

    <span class="n">done</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="n">time</span><span class="o">.</span><span class="n">AfterFunc</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">,</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="p">})</span>

    <span class="n">const</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span>
    <span class="n">heartbeat</span><span class="p">,</span> <span class="n">results</span> <span class="p">:</span><span class="o">=</span> <span class="n">doWork</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">timeout</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">select</span> <span class="p">{</span>
        <span class="n">case</span> <span class="n">_</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="o">&lt;-</span><span class="n">heartbeat</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ok</span> <span class="o">==</span> <span class="n">false</span> <span class="p">{</span>
                <span class="k">return</span>
            <span class="p">}</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;pulse&quot;</span><span class="p">)</span>
        <span class="n">case</span> <span class="n">r</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="o">&lt;-</span><span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ok</span> <span class="o">==</span> <span class="n">false</span> <span class="p">{</span>
                <span class="k">return</span>
            <span class="p">}</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;results %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">Second</span><span class="p">())</span>
        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">time</span><span class="o">.</span><span class="n">After</span><span class="p">(</span><span class="n">timeout</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>


<p>For any long-running goroutines, or goroutines that need to be tested, highly recommend this pattern.</p>
<h3 id="replicated-request">Replicated Request<a class="headerlink" href="#replicated-request" title="Permanent link">&para;</a></h3>
<p>You can replicate the request to mulitple handlers(whether those be gorutines, processes, or servers),
and one of them will run faster than other ones, you can then immediately return the result.
The downside is that you&rsquo;ll have to utilize resources to keep multiple copies of the handlers running.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;math/rand&quot;</span>
    <span class="s2">&quot;sync&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">doWork</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="nb">id</span> <span class="nb">int</span><span class="p">,</span> <span class="n">wg</span> <span class="o">*</span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span><span class="p">,</span> <span class="n">result</span> <span class="n">chan</span><span class="o">&lt;-</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">started</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
        <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>

        <span class="o">//</span><span class="n">Simulate</span> <span class="n">random</span> <span class="n">load</span>
        <span class="n">simulateLoadTime</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rand</span><span class="o">.</span><span class="n">Intn</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span>
        <span class="n">select</span> <span class="p">{</span>
        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">time</span><span class="o">.</span><span class="n">After</span><span class="p">(</span><span class="n">simulateLoadTime</span><span class="p">):</span>
        <span class="p">}</span>
        <span class="n">select</span> <span class="p">{</span>
        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
        <span class="n">case</span> <span class="n">result</span> <span class="o">&lt;-</span> <span class="nb">id</span><span class="p">:</span>
        <span class="p">}</span>

        <span class="n">took</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">started</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">took</span> <span class="o">&lt;</span> <span class="n">simulateLoadTime</span> <span class="p">{</span>
            <span class="n">took</span> <span class="o">=</span> <span class="n">simulateLoadTime</span>
        <span class="p">}</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;%v took %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">took</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">done</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
    <span class="n">result</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">go</span> <span class="n">doWork</span><span class="p">(</span><span class="n">done</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wg</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="o">//</span><span class="n">start</span> <span class="mi">10</span> <span class="n">handlers</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">our</span> <span class="n">request</span>
    <span class="p">}</span>
    <span class="n">firstReturned</span> <span class="p">:</span><span class="o">=</span> <span class="o">&lt;-</span><span class="n">result</span> <span class="o">//</span> <span class="n">grabs</span> <span class="n">the</span> <span class="n">first</span> <span class="k">return</span> <span class="n">value</span> <span class="kn">from</span> <span class="nn">the</span> <span class="nn">group</span> <span class="nn">of</span> <span class="nn">handlers</span>
    <span class="n">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>               <span class="o">//</span><span class="n">cancel</span> <span class="nb">all</span> <span class="n">the</span> <span class="n">remaining</span> <span class="n">handlers</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;Received an answer from #%v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">firstReturned</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="rate-limiting">Rate Limiting<a class="headerlink" href="#rate-limiting" title="Permanent link">&para;</a></h3>
<p>Most rate limitings is done by utilizing an algorithm called the &ldquo;token bucket&rdquo;.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;context&quot;</span>
    <span class="s2">&quot;log&quot;</span>
    <span class="s2">&quot;os&quot;</span>
    <span class="s2">&quot;sync&quot;</span>

    <span class="s2">&quot;golang.org/x/time/rate&quot;</span> <span class="o">//</span> <span class="n">go</span> <span class="n">get</span> <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">golang</span><span class="o">/</span><span class="n">time</span><span class="o">/</span><span class="n">rate</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">Open</span><span class="p">()</span> <span class="o">*</span><span class="n">APIConnection</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">APIConnection</span><span class="p">{</span>
        <span class="n">rateLimiter</span><span class="p">:</span> <span class="n">rate</span><span class="o">.</span><span class="n">NewLimiter</span><span class="p">(</span><span class="n">rate</span><span class="o">.</span><span class="n">Limit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="o">//</span><span class="mi">1</span> <span class="n">event</span> <span class="n">per</span> <span class="n">second</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">APIConnection</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">rateLimiter</span> <span class="o">*</span><span class="n">rate</span><span class="o">.</span><span class="n">Limiter</span> <span class="o">//</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">godoc</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">golang</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">x</span><span class="o">/</span><span class="n">time</span><span class="o">/</span><span class="n">rate</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">APIConnection</span><span class="p">)</span> <span class="n">ReadFile</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">rateLimiter</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>
<span class="n">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">APIConnection</span><span class="p">)</span> <span class="n">ResoveAddress</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">rateLimiter</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">defer</span> <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">SetOutput</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdout</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">SetFlags</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">Ltime</span> <span class="o">|</span> <span class="n">log</span><span class="o">.</span><span class="n">LUTC</span><span class="p">)</span>
    <span class="n">apiConnection</span> <span class="p">:</span><span class="o">=</span> <span class="n">Open</span><span class="p">()</span>
    <span class="n">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
            <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">apiConnection</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
                <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;cannot ReadFile :%v&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;ReadFile&quot;</span><span class="p">)</span>
        <span class="p">}()</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
            <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">apiConnection</span><span class="o">.</span><span class="n">ResoveAddress</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Background</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
                <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;cannot ResolveAddress :%v&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;ResolveAddress&quot;</span><span class="p">)</span>
        <span class="p">}()</span>
    <span class="p">}</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>

<span class="p">}</span>
</code></pre></div>


<p>It&rsquo;s eaiser to keep the limiters separate and then combine them into one rate limiter that manages the interaction for
you.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;context&quot;</span>
    <span class="s2">&quot;sort&quot;</span>
    <span class="s2">&quot;time&quot;</span>

    <span class="s2">&quot;golang.org/x/time/rate&quot;</span> <span class="o">//</span> <span class="n">go</span> <span class="n">get</span> <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">golang</span><span class="o">/</span><span class="n">time</span><span class="o">/</span><span class="n">rate</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">RateLimiter</span> <span class="n">interface</span> <span class="p">{</span>
    <span class="n">Wait</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="n">error</span>
    <span class="n">Limit</span><span class="p">()</span> <span class="n">rate</span><span class="o">.</span><span class="n">Limit</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">MultiLimiter</span><span class="p">(</span><span class="n">limiters</span> <span class="o">...</span><span class="n">RateLimiter</span><span class="p">)</span> <span class="o">*</span><span class="n">multiLimiter</span> <span class="p">{</span>
    <span class="n">byLimit</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">limiters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Limit</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">limiters</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">Limit</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">sort</span><span class="o">.</span><span class="n">Slice</span><span class="p">(</span><span class="n">limiters</span><span class="p">,</span> <span class="n">byLimit</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">multiLimiter</span><span class="p">{</span><span class="n">limiters</span><span class="p">:</span> <span class="n">limiters</span><span class="p">}</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">multiLimiter</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">limiters</span> <span class="p">[]</span><span class="n">RateLimiter</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">multiLimiter</span><span class="p">)</span> <span class="n">Wait</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">l</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">l</span><span class="o">.</span><span class="n">limiters</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">err</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">multiLimiter</span><span class="p">)</span> <span class="n">Limit</span><span class="p">()</span> <span class="n">rate</span><span class="o">.</span><span class="n">Limit</span> <span class="p">{</span>
    <span class="o">//</span> <span class="k">return</span> <span class="n">the</span> <span class="n">most</span> <span class="n">restrictive</span> <span class="n">limit</span>
    <span class="k">return</span> <span class="n">l</span><span class="o">.</span><span class="n">limiters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Limit</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">Open</span><span class="p">()</span> <span class="o">*</span><span class="n">APIConnnection</span> <span class="p">{</span>
    <span class="n">secondLimit</span> <span class="p">:</span><span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">NewLimiter</span><span class="p">(</span><span class="n">Per</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">minuteLimit</span> <span class="p">:</span><span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">NewLimiter</span><span class="p">(</span><span class="n">Per</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Minute</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">APIConnnection</span><span class="p">{</span>
        <span class="n">rateLimiter</span><span class="p">:</span> <span class="n">MultiLimiter</span><span class="p">(</span><span class="n">secondLimit</span><span class="p">,</span> <span class="n">minuteLimit</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">APIConnnection</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">rateLimiter</span> <span class="n">RateLimiter</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">APIConnnection</span><span class="p">)</span> <span class="n">ReadFile</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">rateLimiter</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">APIConnnection</span><span class="p">)</span> <span class="n">ResolveAddress</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="n">errro</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">rateLimiter</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="healing-unhealthy-goroutines">Healing Unhealthy Goroutines<a class="headerlink" href="#healing-unhealthy-goroutines" title="Permanent link">&para;</a></h3>
<p>Ensure your long-lived goroutines stay up and healthy.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;log&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">startGoroutineFn</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">pulseInterval</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="p">(</span><span class="n">heartbeat</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">newSteward</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">timeout</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">,</span> <span class="n">startGoroutine</span> <span class="n">startGoroutineFn</span><span class="p">)</span> <span class="n">startGoroutineFn</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">pulseInterval</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span> <span class="p">{</span>
            <span class="n">heartbeat</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
            <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">heartbeat</span><span class="p">)</span>

                <span class="n">var</span> <span class="n">wardDone</span> <span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span>
                <span class="n">var</span> <span class="n">wardHeartbeat</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{}</span>
                <span class="n">startWard</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
                    <span class="n">wardDone</span> <span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">interface</span><span class="p">{})</span>
                    <span class="n">wardHeartbeat</span> <span class="o">=</span> <span class="n">startGoroutine</span><span class="p">(</span><span class="ow">or</span><span class="p">(</span><span class="n">wardDone</span><span class="p">,</span> <span class="n">done</span><span class="p">),</span> <span class="n">timeout</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="n">startWard</span><span class="p">()</span>
                <span class="n">pulse</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Tick</span><span class="p">(</span><span class="n">pulseInterval</span><span class="p">)</span>

            <span class="n">monitorLoop</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">{</span>
                    <span class="n">timeoutSignal</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">After</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
                    <span class="k">for</span> <span class="p">{</span>
                        <span class="n">select</span> <span class="p">{</span>
                        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">pulse</span><span class="p">:</span>
                            <span class="n">select</span> <span class="p">{</span>
                            <span class="n">case</span> <span class="n">heartbeat</span> <span class="o">&lt;-</span> <span class="n">struct</span><span class="p">{}{}:</span>
                            <span class="n">default</span><span class="p">:</span>
                            <span class="p">}</span>
                        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">wardHeartbeat</span><span class="p">:</span>
                            <span class="k">continue</span> <span class="n">monitorLoop</span>
                        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">timeoutSignal</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;steward: ward unhealthy: restarting&quot;</span><span class="p">)</span>
                            <span class="n">close</span><span class="p">(</span><span class="n">wardDone</span><span class="p">)</span>
                            <span class="n">startWard</span><span class="p">()</span>
                            <span class="k">continue</span> <span class="n">monitorLoop</span>
                        <span class="n">case</span> <span class="o">&lt;-</span><span class="n">done</span><span class="p">:</span>
                            <span class="k">return</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                <span class="p">}</span>
            <span class="p">}()</span>
            <span class="k">return</span> <span class="n">heartbeat</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="6-goroutines-and-the-go-runtime">6 Goroutines and the Go Runtime<a class="headerlink" href="#6-goroutines-and-the-go-runtime" title="Permanent link">&para;</a></h1>
<h3 id="work-stealing">Work Stealing<a class="headerlink" href="#work-stealing" title="Permanent link">&para;</a></h3>
<p>work stealing strategy. Go follows a fork-join model for concurrency.
Forks are when goroutines are started, and join points are when two or more goroutines are
synchronized through channels or types in the sync package.</p>
<p>The work stealing algorithm follows a few basic rules, Given a thread of execution:</p>
<ol>
<li>At A fork point, add tasks to the tail of the deque associated with the thread</li>
<li>If the thread is idle, steal work from the head of deque associated with some other random thread</li>
<li>At a join point that cannot be realized yet(i.e.,the goroutine it is synchronized with has not completed yet), pop
     work off the tail of the thread&rsquo;s own deque.</li>
<li>if the thread&rsquo;s deque is empty, either:
  - stall at a join
  - steal work from the head of a random thread&rsquo;s associated deque</li>
</ol>
<h3 id="stealing-tasks-or-continuations">Stealing Tasks or Continuations?<a class="headerlink" href="#stealing-tasks-or-continuations" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">fib</span> <span class="nf">func</span><span class="p">(</span><span class="n">n</span> <span class="n">int</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">int</span>
    <span class="n">fib</span> <span class="o">=</span> <span class="nf">func</span><span class="p">(</span><span class="n">n</span> <span class="n">int</span><span class="p">)</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="n">int</span> <span class="p">{</span>
        <span class="n">result</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">int</span><span class="p">)</span>
        <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span> <span class="o">//</span> <span class="n">tasks</span>
            <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="m">2</span> <span class="p">{</span>
                <span class="n">result</span> <span class="o">&lt;-</span> <span class="m">1</span>
                <span class="n">return</span>
            <span class="p">}</span>
            <span class="n">result</span> <span class="o">&lt;-</span> <span class="o">&lt;-</span><span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="m">-1</span><span class="p">)</span> <span class="o">+</span> <span class="o">&lt;-</span><span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="m">-2</span><span class="p">)</span>
        <span class="p">}()</span>
        <span class="n">return</span> <span class="n">result</span> <span class="o">//</span> <span class="n">continuation</span>
    <span class="p">}</span>
    <span class="nf">fmt.Printf</span><span class="p">(</span><span class="s">&quot;fib = %d&quot;</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nf">fib</span><span class="p">(</span><span class="m">4</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>In go , goroutines are tasks</li>
<li>Everything after a goroutine is called is the continuation</li>
</ul>
<p>Continuation stealing is how Go&rsquo;s work-stealing algorithm is implemented</p>
<p>Go&rsquo;s scheduler has three main concepts:</p>
<ul>
<li>G: A Goroutine</li>
<li>M: An OS thread(also referenced as a machine in the source code)</li>
<li>P: A context(also referecned as a processor in the source code), GOMAXPROCS</li>
</ul>
<h1 id="appendix">Appendix<a class="headerlink" href="#appendix" title="Permanent link">&para;</a></h1>
<h3 id="anatomy-of-a-goroutine-error">Anatomy of a Goroutine Error<a class="headerlink" href="#anatomy-of-a-goroutine-error" title="Permanent link">&para;</a></h3>
<p>Prior to Go1.6, when a goroutine panicked, the runtime would print stack traces of all the currently executing
goroutines.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span><span class="n">go</span> <span class="n">run</span> <span class="o">-</span><span class="n">race</span> <span class="n">main</span><span class="o">.</span><span class="n">go</span>
    <span class="n">var</span> <span class="n">data</span> <span class="nb">int</span>
    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">data</span><span class="o">++</span>
    <span class="p">}()</span>
    <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;value is %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="race-detection">Race Detection<a class="headerlink" href="#race-detection" title="Permanent link">&para;</a></h3>
<p>go run -race main.go</p>
<h3 id="pprof">pprof<a class="headerlink" href="#pprof" title="Permanent link">&para;</a></h3>
<p><code>runtime/pporf</code> package has predefined profiles to hook into and display:</p>
<ul>
<li>goroutine</li>
<li>heap</li>
<li>threadcreate</li>
<li>block</li>
<li>primitives</li>
<li>mutex</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;log&quot;</span>
    <span class="s2">&quot;os&quot;</span>
    <span class="s2">&quot;runtime/pprof&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">log</span><span class="o">.</span><span class="n">SetFlags</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">Ltime</span> <span class="o">|</span> <span class="n">log</span><span class="o">.</span><span class="n">LUTC</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">SetOutput</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdout</span><span class="p">)</span>

    <span class="o">//</span><span class="n">every</span> <span class="n">second</span> <span class="p">,</span> <span class="n">log</span> <span class="n">how</span> <span class="n">many</span> <span class="n">goroutines</span> <span class="n">are</span> <span class="n">currently</span> <span class="n">running</span>
    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">goroutines</span> <span class="p">:</span><span class="o">=</span> <span class="n">pprof</span><span class="o">.</span><span class="n">Lookup</span><span class="p">(</span><span class="s2">&quot;goroutine&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">range</span> <span class="n">time</span><span class="o">.</span><span class="n">Tick</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;goroutine count:</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">goroutines</span><span class="o">.</span><span class="n">Count</span><span class="p">())</span>
        <span class="p">}</span>
    <span class="p">}()</span>

    <span class="o">//</span><span class="n">create</span> <span class="n">some</span> <span class="n">goroutines</span> <span class="n">which</span> <span class="n">will</span> <span class="n">never</span> <span class="nb">exit</span>
    <span class="n">var</span> <span class="n">blockForever</span> <span class="n">chan</span> <span class="n">struct</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="o">&lt;-</span><span class="n">blockForever</span> <span class="p">}()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">500</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../building_restful_web_services_with_go/book/" title="Building Restful Web Services with Go" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Building Restful Web Services with Go
              </div>
            </div>
          </a>
        
        
          <a href="../../go_in_action%28go%E8%AF%AD%E8%A8%80%E5%AE%9E%E6%88%98%29/" title="Go In Action(Go 实战)" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Go In Action(Go 实战)
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"search.result.none": "No matching documents", "clipboard.copy": "Copy to clipboard", "search.result.placeholder": "Type to start searching", "clipboard.copied": "Copied to clipboard", "search.result.one": "1 matching document", "search.config.separator": "[\\s\\-]+", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: ["instant"],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>