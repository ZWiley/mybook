


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.2">
    
    
      
        <title>1 The Go Programming Language - ZWiley的随记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a2408e81.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>body,input{font-family:"",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="ZWiley的随记" class="md-header-nav__button md-logo" aria-label="ZWiley的随记">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ZWiley的随记
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              1 The Go Programming Language
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/zwiley/mybook/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ZWiley的随记" class="md-nav__button md-logo" aria-label="ZWiley的随记">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ZWiley的随记
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/zwiley/mybook/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="简介" class="md-nav__link">
      简介
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      C++
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="C++" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        C++
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/STL/" title="C++ STL" class="md-nav__link">
      C++ STL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E7%BC%96%E8%AF%91%E5%BA%95%E5%B1%82/" title="C++编译底层" class="md-nav__link">
      C++编译底层
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="C++基础知识" class="md-nav__link">
      C++基础知识
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88_%E5%BC%82%E5%B8%B8%E6%9C%BA%E5%88%B6_%E5%BC%BA%E5%88%B6%E8%BD%AC%E6%8D%A2_RTTI/" title="C++智能指针" class="md-nav__link">
      C++智能指针
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" title="C++面向对象" class="md-nav__link">
      C++面向对象
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      计算机基础
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="计算机基础" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        计算机基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="操作系统" class="md-nav__link">
      操作系统
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络" class="md-nav__link">
      计算机网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="数据结构" class="md-nav__link">
      数据结构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" title="海量数据处理" class="md-nav__link">
      海量数据处理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      基本手写代码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="基本手写代码" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        基本手写代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E6%9C%AC%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81/%E5%9F%BA%E6%9C%AC%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81%E9%A2%98%E7%9B%AE/" title="常见基本代码" class="md-nav__link">
      常见基本代码
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      项目基础知识
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="项目基础知识" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        项目基础知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E5%8F%8A%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/" title="Linux系统编程及基本命令" class="md-nav__link">
      Linux系统编程及基本命令
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Redis/" title="Redis" class="md-nav__link">
      Redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Socket%E7%BC%96%E7%A8%8B/" title="Socket编程" class="md-nav__link">
      Socket编程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      webserver项目
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="webserver项目" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        webserver项目
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/0%20%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0/" title="0 项目概述" class="md-nav__link">
      0 项目概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/1%20%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E5%B0%81%E8%A3%85%E7%B1%BB/" title="1 线程同步机制封装类" class="md-nav__link">
      1 线程同步机制封装类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/2%20%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%8D%8A%E5%8F%8D%E5%BA%94%E5%A0%86%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88%E4%B8%8A%EF%BC%89/" title="2 半同步半反应堆线程池（上）" class="md-nav__link">
      2 半同步半反应堆线程池（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/3%20%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%8D%8A%E5%8F%8D%E5%BA%94%E5%A0%86%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="3 半同步半反应堆线程池（下）" class="md-nav__link">
      3 半同步半反应堆线程池（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/4%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%8A%EF%BC%89/" title="4 http连接处理（上）" class="md-nav__link">
      4 http连接处理（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/5%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%AD%EF%BC%89/" title="5 http连接处理（中）" class="md-nav__link">
      5 http连接处理（中）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/6%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%8B%EF%BC%89/" title="6 http连接处理（下）" class="md-nav__link">
      6 http连接处理（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/7%20%E5%AE%9A%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86%E9%9D%9E%E6%B4%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%EF%BC%88%E4%B8%8A%EF%BC%89/" title="7 定时器处理非活动连接（上）" class="md-nav__link">
      7 定时器处理非活动连接（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/8%20%E5%AE%9A%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86%E9%9D%9E%E6%B4%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%EF%BC%88%E4%B8%8B%EF%BC%89/" title="8 定时器处理非活动连接（下）" class="md-nav__link">
      8 定时器处理非活动连接（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/9%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%8A%EF%BC%89/" title="9 日志系统（上）" class="md-nav__link">
      9 日志系统（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/10%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%8B%EF%BC%89/" title="10 日志系统（下）" class="md-nav__link">
      10 日志系统（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/11%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/" title="11 数据库连接池" class="md-nav__link">
      11 数据库连接池
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/12%20%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" title="12 常见问题" class="md-nav__link">
      12 常见问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/13%20%E9%A1%B9%E7%9B%AE%E6%A2%B3%E7%90%86/" title="13 项目梳理" class="md-nav__link">
      13 项目梳理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      源码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="源码" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        源码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB_sourcecode/" title="源码阅读" class="md-nav__link">
      源码阅读
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Muduo
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Muduo" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Muduo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-2-1" type="checkbox" id="nav-7-2-1">
    
    <label class="md-nav__link" for="nav-7-2-1">
      base
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="base" data-md-level="3">
      <label class="md-nav__title" for="nav-7-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        base
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/base/1.%20%E6%97%B6%E9%97%B4_%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C_%E5%BC%82%E5%B8%B8/" title="时间_原子操作_异常" class="md-nav__link">
      时间_原子操作_异常
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/base/2.%20%E7%BA%BF%E7%A8%8B/" title="线程" class="md-nav__link">
      线程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/base/3.%20%E7%BA%BF%E7%A8%8B2/" title="线程2" class="md-nav__link">
      线程2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/base/4.%20%E6%97%A5%E5%BF%97/" title="日志" class="md-nav__link">
      日志
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7-2-2" type="checkbox" id="nav-7-2-2">
    
    <label class="md-nav__link" for="nav-7-2-2">
      net
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="net" data-md-level="3">
      <label class="md-nav__title" for="nav-7-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        net
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/net/1.%20EventLoop/" title="EventLoop" class="md-nav__link">
      EventLoop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/net/2.%20%E8%BF%9E%E6%8E%A5%E6%97%B6%E5%BA%8F/" title="连接时序" class="md-nav__link">
      连接时序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/net/3.%20%E5%85%B3%E9%97%AD%E6%97%B6%E5%BA%8F/" title="关闭时序" class="md-nav__link">
      关闭时序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/net/4.%20Buffer/" title="Buffer" class="md-nav__link">
      Buffer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/net/5.%20callback/" title="callback" class="md-nav__link">
      callback
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/net/6.%20Client/" title="Client" class="md-nav__link">
      Client
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/0%20%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1/" title="服务器方案设计" class="md-nav__link">
      服务器方案设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/1%20%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="基础知识" class="md-nav__link">
      基础知识
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/2%20%E6%80%BB%E4%BD%93%E8%A7%A3%E6%9E%90/" title="总体解析" class="md-nav__link">
      总体解析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/3%20muduo%E8%AF%A6%E7%BB%86%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B/" title="muduo详细运行流程" class="md-nav__link">
      muduo详细运行流程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/4%20muduo%E4%B8%AD%E7%9A%84%E5%AE%9A%E6%97%B6%E5%99%A8/" title="muduo中的定时器" class="md-nav__link">
      muduo中的定时器
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/5%20muduo%E4%B8%AD%E7%9A%84%E7%BA%BF%E7%A8%8B/" title="muduo中的线程" class="md-nav__link">
      muduo中的线程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Muduo/6%20muduo%E4%B8%AD%E7%9A%84%E5%9B%9E%E8%B0%83/" title="muduo中的回调" class="md-nav__link">
      muduo中的回调
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      数据库
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="数据库" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        数据库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/getting_started_with_impala/" title="Getting started with impala" class="md-nav__link">
      Getting started with impala
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" title="mysql必知必会" class="md-nav__link">
      mysql必知必会
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/mysql%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%8E%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/" title="mysql性能调优与架构实践" class="md-nav__link">
      mysql性能调优与架构实践
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/Mysql%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" title="Mysql技术内幕InnoDB存储引擎" class="md-nav__link">
      Mysql技术内幕InnoDB存储引擎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/redis%E5%AE%9E%E6%88%98/" title="Redis实战" class="md-nav__link">
      Redis实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/redis%E6%B7%B1%E5%BA%A6%E5%8E%86%E9%99%A9%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%92%8C%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/book/" title="Redis深度历险核心原理和应用实践" class="md-nav__link">
      Redis深度历险核心原理和应用实践
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="redis设计与实现" class="md-nav__link">
      redis设计与实现
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93/" title="七周七数据库" class="md-nav__link">
      七周七数据库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAmysql/" title="深入浅出mysql" class="md-nav__link">
      深入浅出mysql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/%E9%AB%98%E6%80%A7%E8%83%BDmysql%E7%AC%AC%E4%B8%89%E7%89%88/" title="高性能mysql第三版" class="md-nav__link">
      高性能mysql第三版
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      代码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="代码" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8/" title="代码大全" class="md-nav__link">
      代码大全
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E4%BB%A3%E7%A0%81%E7%9A%84%E6%9C%AA%E6%9D%A5/" title="代码的未来" class="md-nav__link">
      代码的未来
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E5%9F%BA%E6%9C%AC%E5%8A%9F/" title="基本功" class="md-nav__link">
      基本功
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E6%95%8F%E6%8D%B7%E6%8A%80%E8%83%BD%E4%BF%AE%E7%82%BC/" title="敏捷技能修炼" class="md-nav__link">
      敏捷技能修炼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%8497%E4%BB%B6%E4%BA%8B/" title="程序员应该知道的97件事" class="md-nav__link">
      程序员应该知道的97件事
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E7%BC%96%E5%86%99%E5%8F%AF%E8%AF%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF/" title="编写可读代码的艺术" class="md-nav__link">
      编写可读代码的艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E7%BC%96%E7%A8%8B%E5%8C%A0%E8%89%BA/" title="编程匠艺" class="md-nav__link">
      编程匠艺
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" title="领域驱动设计" class="md-nav__link">
      领域驱动设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/codelife_%E4%B8%8D%E6%AD%A2%E4%BB%A3%E7%A0%81/" title="codelife_不止代码" class="md-nav__link">
      codelife_不止代码
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      调试技术
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="调试技术" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        调试技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../debug/%E8%BD%AF%E4%BB%B6%E8%B0%83%E8%AF%95%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93/book/" title="软件调试修炼之道" class="md-nav__link">
      软件调试修炼之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../debug/Effective_Debugging/" title="Effective Debugging" class="md-nav__link">
      Effective Debugging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      前端
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="前端" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        前端
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/CSS_The_Missing_Manual/" title="CSS_The_Missing_Manual" class="md-nav__link">
      CSS_The_Missing_Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/reactjs_%E5%B0%8F%E4%B9%A6/" title="reactjs小书" class="md-nav__link">
      reactjs小书
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/es6%E6%A0%87%E5%87%86%E5%85%A5%E9%97%A8/" title="ES6标准入门" class="md-nav__link">
      ES6标准入门
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/jquery_pocket_reference/" title="jquery_pocket_reference" class="md-nav__link">
      jquery_pocket_reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3bootstrap/" title="深入理解bootstrap" class="md-nav__link">
      深入理解bootstrap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" checked>
    
    <label class="md-nav__link" for="nav-12">
      golang
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="golang" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        golang
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="1 The Go Programming Language" class="md-nav__link md-nav__link--active">
      1 The Go Programming Language
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2_the_go_programming_lauguage/" title="2 The Go Programming Language" class="md-nav__link">
      2 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3_the_go_programming_lauguage/" title="3 The Go Programming Language" class="md-nav__link">
      3 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../build-web-application-with-golang/" title="Build Web Application With Golang" class="md-nav__link">
      Build Web Application With Golang
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go101/book/" title="Go101" class="md-nav__link">
      Go101
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../network-programming-with-go/book/" title="Network Programming with go" class="md-nav__link">
      Network Programming with go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../building-microservices-with-go/book/" title="Building Microservices With Go" class="md-nav__link">
      Building Microservices With Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../building_restful_web_services_with_go/book/" title="Building Restful Web Services with Go" class="md-nav__link">
      Building Restful Web Services with Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../concurrency-in-go/concurrency_in_go/" title="Concurrency In Go" class="md-nav__link">
      Concurrency In Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go_in_action%28go%E8%AF%AD%E8%A8%80%E5%AE%9E%E6%88%98%29/" title="Go In Action(Go 实战)" class="md-nav__link">
      Go In Action(Go 实战)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/" title="Go学习笔记语言详解" class="md-nav__link">
      Go学习笔记语言详解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/" title="Go学习笔记源码剖析" class="md-nav__link">
      Go学习笔记源码剖析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B/" title="go语言编程" class="md-nav__link">
      go语言编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../the_way_to_go/book/" title="go book" class="md-nav__link">
      go book
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-go-programming-book/advanced-go-programming/" title="advanced-go-programming" class="md-nav__link">
      advanced-go-programming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go-build-web-applications/module1/go-build-web-applications/go-build-web-applications/" title="go-build-web-applications" class="md-nav__link">
      go-build-web-applications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      python
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="python" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/fluent_python/" title="Fluent Python" class="md-nav__link">
      Fluent Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/Python_Microservices_Development/" title="Python Microservices Development" class="md-nav__link">
      Python Microservices Development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/high_performance_python/" title="High Performance Python" class="md-nav__link">
      High Performance Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/python_%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="Python网络编程" class="md-nav__link">
      Python网络编程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      java
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="java" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/java-basic-introduction/" title="java basic introduction" class="md-nav__link">
      java basic introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      网络
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="网络" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        网络
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../network/tcp_ip%E8%AF%A6%E8%A7%A3%E5%8D%B7%E4%B8%80/tcp_ip%E8%AF%A6%E8%A7%A3%E5%8D%B7%E4%B8%80/" title="TCP IP详解卷一" class="md-nav__link">
      TCP IP详解卷一
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      unix/linux
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="unix/linux" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        unix/linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix_linux/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/" title="Linux高性能服务器编程" class="md-nav__link">
      Linux高性能服务器编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix_linux/unix%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF/" title="unix编程艺术" class="md-nav__link">
      unix编程艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix_linux/unix%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%8D%B7%E4%B8%80/" title="unix网络编程卷一" class="md-nav__link">
      unix网络编程卷一
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix_linux/unix%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF/" title="unix编程艺术" class="md-nav__link">
      unix编程艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix_linux/unp/unp%E7%AC%94%E8%AE%B0/" title="UNP" class="md-nav__link">
      UNP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      分布式
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="分布式" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        分布式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%88%86%E5%B8%83%E5%BC%8F/Kafka%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/" title="Kafka 权威指南" class="md-nav__link">
      Kafka 权威指南
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/" title="分布式框架原理与应用" class="md-nav__link">
      分布式框架原理与应用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%88%86%E5%B8%83%E5%BC%8F/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" title="大规模分布式存储系统" class="md-nav__link">
      大规模分布式存储系统
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%88%86%E5%B8%83%E5%BC%8F/%E6%B7%B1%E5%85%A5%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E4%BB%8E%E5%8E%9F%E7%90%86%E5%88%B0%E5%AE%9E%E8%B7%B5/" title="深入分布式缓存从原理到实践" class="md-nav__link">
      深入分布式缓存从原理到实践
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-18" type="checkbox" id="nav-18">
    
    <label class="md-nav__link" for="nav-18">
      搜索引擎
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="搜索引擎" data-md-level="1">
      <label class="md-nav__title" for="nav-18">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        搜索引擎
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/Elasticsearch%E5%AE%9E%E6%88%98/book/" title="Elasticsearch实战" class="md-nav__link">
      Elasticsearch实战
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-19" type="checkbox" id="nav-19">
    
    <label class="md-nav__link" for="nav-19">
      容器
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="容器" data-md-level="1">
      <label class="md-nav__title" for="nav-19">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        容器
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/%E7%8E%A9%E8%BD%ACKubernets-CloudMan/" title="玩转Kubernets" class="md-nav__link">
      玩转Kubernets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/%E7%AC%AC%E4%B8%80%E6%9C%ACdocker%E4%B9%A6/" title="第一本docker书" class="md-nav__link">
      第一本docker书
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-20" type="checkbox" id="nav-20">
    
    <label class="md-nav__link" for="nav-20">
      开发工具
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="开发工具" data-md-level="1">
      <label class="md-nav__title" for="nav-20">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        开发工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/practical_vim/practical_vim/" title="Practical Vim" class="md-nav__link">
      Practical Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/vim8%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98/vim8%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98/" title="Vim8文本处理实战" class="md-nav__link">
      Vim8文本处理实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/learn_vim_the_hard_way/" title="Learn vim scrpt the hard way" class="md-nav__link">
      Learn vim scrpt the hard way
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/pro_git/" title="Pro Git" class="md-nav__link">
      Pro Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Mastering_vim/" title="Mastering Vim" class="md-nav__link">
      Mastering Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/mastering_vim_quickly/" title="Mastering Vim Quickly" class="md-nav__link">
      Mastering Vim Quickly
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-21" type="checkbox" id="nav-21">
    
    <label class="md-nav__link" for="nav-21">
      网站架构微服务
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="网站架构微服务" data-md-level="1">
      <label class="md-nav__title" for="nav-21">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        网站架构微服务
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/microservices_patterns_%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/book/" title="微服务架构设计模式" class="md-nav__link">
      微服务架构设计模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%9E%B6%E6%9E%84/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%9E%B6%E6%9E%84/" title="从0开始学架构" class="md-nav__link">
      从0开始学架构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/web_scalavility_for_startup_engineers/" title="web scalavility for startup engineers" class="md-nav__link">
      web scalavility for startup engineers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/design_data_instensive_application/" title="design_data_instensive_application" class="md-nav__link">
      design_data_instensive_application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/clean_architecture/" title="clean_architecture" class="md-nav__link">
      clean_architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/" title="微服务设计" class="md-nav__link">
      微服务设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/2_design_data_instensive_application/" title="2_design_data_instensive_application" class="md-nav__link">
      2_design_data_instensive_application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/3_design_data_instensive_application/" title="3_design_data_instensive_application" class="md-nav__link">
      3_design_data_instensive_application
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-22" type="checkbox" id="nav-22">
    
    <label class="md-nav__link" for="nav-22">
      软件工程/项目管理
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="软件工程/项目管理" data-md-level="1">
      <label class="md-nav__title" for="nav-22">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        软件工程/项目管理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/" title="人月神话" class="md-nav__link">
      人月神话
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BB%A3%E7%A0%81%E4%B9%8B%E6%AE%87/" title="代码之殇" class="md-nav__link">
      代码之殇
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E8%A7%A3%E6%9E%90%E6%9E%81%E9%99%90%E7%BC%96%E7%A8%8B-%E6%8B%A5%E6%8A%B1%E5%8F%98%E5%8C%96/" title="解析极限编程" class="md-nav__link">
      解析极限编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93/" title="项目管理修炼之道" class="md-nav__link">
      项目管理修炼之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BF%AE%E6%94%B9%E8%BD%AF%E4%BB%B6%E7%9A%84%E8%89%BA%E6%9C%AF/" title="修改软件的艺术" class="md-nav__link">
      修改软件的艺术
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-23" type="checkbox" id="nav-23">
    
    <label class="md-nav__link" for="nav-23">
      运维
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="运维" data-md-level="1">
      <label class="md-nav__title" for="nav-23">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        运维
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BF%90%E7%BB%B4/linux%E9%9B%86%E7%BE%A4%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" title="linux集群和自动化运维" class="md-nav__link">
      linux集群和自动化运维
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BF%90%E7%BB%B4/python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" title="python自动化运维" class="md-nav__link">
      python自动化运维
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-24" type="checkbox" id="nav-24">
    
    <label class="md-nav__link" for="nav-24">
      互联网
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="互联网" data-md-level="1">
      <label class="md-nav__title" for="nav-24">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        互联网
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E4%BA%92%E8%81%94%E7%BD%91/%E6%88%91%E7%9A%84%E4%BA%92%E8%81%94%E7%BD%91%E6%96%B9%E6%B3%95%E8%AE%BA-%E5%91%A8%E9%B8%BF%E7%A5%8E/" title="我的互联网方法论-周鸿祎" class="md-nav__link">
      我的互联网方法论-周鸿祎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E4%BA%92%E8%81%94%E7%BD%91/%E7%94%A8%E6%88%B7%E6%80%9D%E7%BB%B4/" title="用户思维" class="md-nav__link">
      用户思维
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-25" type="checkbox" id="nav-25">
    
    <label class="md-nav__link" for="nav-25">
      区块链
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="区块链" data-md-level="1">
      <label class="md-nav__title" for="nav-25">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        区块链
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%8C%BA%E5%9D%97%E9%93%BE/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E6%8C%87%E5%8D%97%28blockchain_guide%29/" title="区块链技术指南" class="md-nav__link">
      区块链技术指南
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-26" type="checkbox" id="nav-26">
    
    <label class="md-nav__link" for="nav-26">
      技术演讲
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="技术演讲" data-md-level="1">
      <label class="md-nav__title" for="nav-26">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        技术演讲
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lecture/Gopher/%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E7%9A%84go%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98/note/" title="哔哩哔哩的go微服务实战" class="md-nav__link">
      哔哩哔哩的go微服务实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lecture/Gopher/Go_Error/go%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E5%BA%93%E4%B9%8BError%26Context/" title="go业务基础库之Error&Context" class="md-nav__link">
      go业务基础库之Error&Context
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lecture/Gopher/Go%E5%90%8C%E6%AD%A5%E5%92%8C%E5%B9%B6%E5%8F%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/note/" title="Go同步和并发设计模式" class="md-nav__link">
      Go同步和并发设计模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lecture/%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2/%E5%B7%A6%E8%80%B3%E6%9C%B5%E8%80%97%E5%AD%90-%E6%88%91%E8%BF%99%E6%8A%80%E6%9C%AF%E4%BA%8C%E5%8D%81%E5%B9%B4/" title="左耳朵耗子-我这技术二十年" class="md-nav__link">
      左耳朵耗子-我这技术二十年
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-27" type="checkbox" id="nav-27">
    
    <label class="md-nav__link" for="nav-27">
      金融理财
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="金融理财" data-md-level="1">
      <label class="md-nav__title" for="nav-27">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        金融理财
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%87%91%E8%9E%8D%E7%90%86%E8%B4%A2/%E5%AE%9A%E6%8A%95%E5%8D%81%E5%B9%B4/" title="定投十年" class="md-nav__link">
      定投十年
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%87%91%E8%9E%8D%E7%90%86%E8%B4%A2/%E7%A9%B7%E6%9F%A5%E7%90%86%E5%AE%9D%E5%85%B8/" title="穷查理宝典" class="md-nav__link">
      穷查理宝典
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-28" type="checkbox" id="nav-28">
    
    <label class="md-nav__link" for="nav-28">
      写作
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="写作" data-md-level="1">
      <label class="md-nav__title" for="nav-28">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        写作
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%86%99%E4%BD%9C/%E5%88%B7%E5%B1%8F%E6%96%87%E6%A1%88%E5%86%99%E4%BD%9C%E6%8A%80%E5%B7%A7/" title="刷屏文案写作技巧" class="md-nav__link">
      刷屏文案写作技巧
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-29" type="checkbox" id="nav-29">
    
    <label class="md-nav__link" for="nav-29">
      思维
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="思维" data-md-level="1">
      <label class="md-nav__title" for="nav-29">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        思维
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E4%B8%93%E6%B3%A8%E5%8A%9B_%E5%8C%96%E7%B9%81%E4%B8%BA%E7%AE%80%E7%9A%84%E6%83%8A%E4%BA%BA%E5%8A%9B%E9%87%8F/" title="专注力" class="md-nav__link">
      专注力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E4%B8%BA%E4%BB%80%E4%B9%88%E7%B2%BE%E8%8B%B1%E8%BF%99%E6%A0%B7%E7%94%A8%E8%84%91%E4%B8%8D%E4%BC%9A%E7%B4%AF/" title="为什么精英这样用脑不会累" class="md-nav__link">
      为什么精英这样用脑不会累
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%88%BB%E6%84%8F%E7%BB%83%E4%B9%A0/" title="刻意练习" class="md-nav__link">
      刻意练习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%A6%82%E4%BD%95%E6%83%B3%E5%88%B0%E5%8F%88%E5%81%9A%E5%88%B0/" title="如何想到又做到" class="md-nav__link">
      如何想到又做到
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%AD%A6%E4%B9%A0%E4%B9%8B%E9%81%93/" title="学习之道" class="md-nav__link">
      学习之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%AD%A6%E4%B9%A0%E5%8A%9B/" title="学习力" class="md-nav__link">
      学习力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E6%89%B9%E5%88%A4%E6%80%A7%E6%80%9D%E7%BB%B4%E5%B7%A5%E5%85%B7/" title="批判性思维工具" class="md-nav__link">
      批判性思维工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%80%9D%E7%BB%B4%E4%BF%AE%E7%82%BC%28%E5%BC%80%E5%8F%91%E8%AE%A4%E7%9F%A5%E6%BD%9C%E8%83%BD%E7%9A%84%E4%B9%9D%E5%A0%82%E8%AF%BE%29/" title="程序员的思维修炼" class="md-nav__link">
      程序员的思维修炼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E8%AE%A4%E7%9F%A5%E5%A4%A9%E6%80%A7/" title="认知天性" class="md-nav__link">
      认知天性
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E8%B6%85%E6%95%88%E7%8E%87%E6%89%8B%E5%86%8C/" title="超效率手册" class="md-nav__link">
      超效率手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E8%AE%B0%E5%BF%86/" title="如何高效记忆" class="md-nav__link">
      如何高效记忆
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E7%A7%91%E5%AD%A6%E5%AD%A6%E4%B9%A0/" title="科学学习" class="md-nav__link">
      科学学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E9%AB%98%E6%95%88%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%8445%E4%B8%AA%E4%B9%A0%E6%83%AF/" title="高效程序员的45个习惯" class="md-nav__link">
      高效程序员的45个习惯
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-30" type="checkbox" id="nav-30">
    
    <label class="md-nav__link" for="nav-30">
      职场
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="职场" data-md-level="1">
      <label class="md-nav__title" for="nav-30">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        职场
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/give_and_take/" title="give and take" class="md-nav__link">
      give and take
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/the_effective_engineer/" title="the_effective_engineer" class="md-nav__link">
      the_effective_engineer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E5%85%89%E9%80%9F%E6%88%90%E9%95%BF/" title="光速成长" class="md-nav__link">
      光速成长
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E5%90%91%E4%B8%8A%E7%AE%A1%E7%90%86/" title="向上管理" class="md-nav__link">
      向上管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E6%88%90%E5%8A%9F%E5%8A%A8%E6%9C%BA%E4%B8%8E%E7%9B%AE%E6%A0%87/" title="成功动机与目标" class="md-nav__link">
      成功动机与目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E7%95%AA%E8%8C%84%E5%B7%A5%E4%BD%9C%E6%B3%95/" title="番茄工作法" class="md-nav__link">
      番茄工作法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%81%86%E5%90%AC%E6%B2%9F%E9%80%9A%E5%AD%A6/" title="聆听沟通学" class="md-nav__link">
      聆听沟通学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E7%9F%A5%E4%B9%8E%E8%81%8C%E4%BA%BA%E8%A7%89%E9%86%92/" title="知乎职人觉醒" class="md-nav__link">
      知乎职人觉醒
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E7%9F%A5%E8%AF%86%E5%8F%98%E7%8E%B0/" title="知识变现" class="md-nav__link">
      知识变现
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%81%86%E5%90%AC%E6%B2%9F%E9%80%9A%E5%AD%A6/" title="聆听沟通学" class="md-nav__link">
      聆听沟通学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%81%8C%E5%9C%BA%E5%8A%A8%E7%89%A9%E8%BF%9B%E5%8C%96%E6%89%8B%E5%86%8C/" title="职场动物进化手册" class="md-nav__link">
      职场动物进化手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%81%8C%E5%9C%BA%E8%A7%A3%E9%87%8A%E7%B3%BB/" title="职场解释系" class="md-nav__link">
      职场解释系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%AF%B7%E5%81%9C%E6%AD%A2%E6%97%A0%E6%95%88%E5%8A%AA%E5%8A%9B/" title="请停止无效努力" class="md-nav__link">
      请停止无效努力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%BD%AF%E6%8A%80%E8%83%BD/" title="软技能" class="md-nav__link">
      软技能
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E9%AB%98%E6%95%8815%E6%B3%95%E5%88%99/" title="高效15法则" class="md-nav__link">
      高效15法则
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E9%AB%98%E6%95%88%E6%B8%85%E5%8D%95%E5%B7%A5%E4%BD%9C%E6%B3%95/" title="高效清单工作法" class="md-nav__link">
      高效清单工作法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/" title="程序员的自我修养" class="md-nav__link">
      程序员的自我修养
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-31" type="checkbox" id="nav-31">
    
    <label class="md-nav__link" for="nav-31">
      心理学
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="心理学" data-md-level="1">
      <label class="md-nav__title" for="nav-31">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        心理学
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E7%AB%A5%E5%B9%B4%E7%9A%84%E9%94%99%E5%90%97/" title="一切都是童年的错吗" class="md-nav__link">
      一切都是童年的错吗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E4%BA%B2%E5%AF%86%E5%85%B3%E7%B3%BB/" title="亲密关系" class="md-nav__link">
      亲密关系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E6%83%85%E5%95%86/" title="情商" class="md-nav__link">
      情商
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E9%80%86%E5%95%86/" title="逆商" class="md-nav__link">
      逆商
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E6%8B%96%E5%BB%B6%E5%BF%83%E7%90%86%E5%AD%A6/" title="拖延心理学" class="md-nav__link">
      拖延心理学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E7%A7%AF%E6%9E%81%E5%BF%83%E7%90%86%E5%AD%A6/" title="积极心理学" class="md-nav__link">
      积极心理学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B/" title="自控力" class="md-nav__link">
      自控力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B-%E5%AE%9E%E6%93%8D%E7%AF%87/" title="自控力-实操篇" class="md-nav__link">
      自控力-实操篇
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B-%E5%92%8C%E5%8E%8B%E5%8A%9B%E5%81%9A%E6%9C%8B%E5%8F%8B/" title="自控力:和压力做朋友" class="md-nav__link">
      自控力:和压力做朋友
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E6%B4%BB%E5%87%BA%E6%9C%80%E4%B9%90%E8%A7%82%E7%9A%84%E8%87%AA%E5%B7%B1/" title="活出最乐观的自己" class="md-nav__link">
      活出最乐观的自己
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E6%94%B9%E5%8F%98%E5%BF%83%E7%90%86%E5%AD%A6%E7%9A%8440%E9%A1%B9%E7%A0%94%E7%A9%B6/" title="改变心理学的40项研究" class="md-nav__link">
      改变心理学的40项研究
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E8%B6%85%E8%B6%8A%E8%87%AA%E5%8D%91/" title="超越自卑" class="md-nav__link">
      超越自卑
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E5%8F%8D%E8%84%86%E5%BC%B1/" title="反脆弱" class="md-nav__link">
      反脆弱
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-32" type="checkbox" id="nav-32">
    
    <label class="md-nav__link" for="nav-32">
      创业
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="创业" data-md-level="1">
      <label class="md-nav__title" for="nav-32">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        创业
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../startup/hello_startup/" title="Hello Startup" class="md-nav__link">
      Hello Startup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../startup/%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%85%AC%E5%BC%80%E8%AF%BE-%E5%A6%82%E4%BD%95%E5%88%9B%E4%B8%9A/" title="斯坦福公开课如何创业" class="md-nav__link">
      斯坦福公开课如何创业
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../startup/%E8%BF%90%E8%90%A5%E5%85%B6%E5%AE%9E%E5%BE%88%E7%AE%80%E5%8D%95/" title="运营其实很简单" class="md-nav__link">
      运营其实很简单
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/zwiley/mybook/edit/master/docs/golang/1_the_go_programming_lauguage.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <p>最近开始学习 golang，先挑一本入门书《The Go Programming Language》。以下是我的读书笔记，会有一些和 python
的对(tu)比(cao)，动态语言和编译型静态语言写法和思路上还是不小的差别的，不过如果熟悉 C 的话， 还是比较容易上手的。</p>
<h1 id="1tutorial">1.Tutorial<a class="headerlink" href="#1tutorial" title="Permanent link">&para;</a></h1>
<p>第一章通过一些例子介绍了 go 语言，给出了几个直观的例子展示了 golang，还是先从 helloworld 开始:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># go run hello.go 运行，或者 go build 编译后执行二进制文件</span>
<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>go 通过 package（包）组织模块，一个包含多个 go 源文件，每个源文件开头用 package 声明，紧跟一堆 import 语句。
package main 比较特殊，是程序的入口，定义了单独的可执行程序，而不是 library。main 函数也比较特殊，程序从 main 开始执行
go 有个 gofmt 工具可以用来格式化代码（类似 autopep8，笔者用的 vim-go 写完保存会自动执行），消除不同人对代码格式的撕逼大战。</p>
<p>下一个例子我们多重方式实现一个打印命令行参数的代码：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;os&quot;</span>
    <span class="s2">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">s</span><span class="p">,</span> <span class="n">sep</span> <span class="n">string</span>
    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
    <span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main2</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">sep</span> <span class="p">:</span><span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">arg</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">sep</span> <span class="o">+</span> <span class="n">arg</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main3</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">Join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s2">&quot; &quot;</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<p>接着是消除从标准输入读取的重复行的代码(like uniq command)：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;bufio&quot;</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;os&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">counts</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nb">int</span><span class="p">)</span> <span class="o">//</span> <span class="n">like</span> <span class="n">python</span> <span class="nb">dict</span> <span class="p">{</span><span class="n">string</span><span class="p">:</span> <span class="nb">int</span><span class="p">}</span>
    <span class="nb">input</span> <span class="p">:</span><span class="o">=</span> <span class="n">bufio</span><span class="o">.</span><span class="n">NewScanner</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdin</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">input</span><span class="o">.</span><span class="n">Scan</span><span class="p">()</span> <span class="p">{</span> <span class="o">//</span><span class="n">until</span> <span class="n">EOF</span> <span class="p">(</span><span class="n">ctrl</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">counts</span><span class="p">[</span><span class="nb">input</span><span class="o">.</span><span class="n">Text</span><span class="p">()]</span><span class="o">++</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">n</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">counts</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span> <span class="o">//</span> <span class="err">格式化函数一般以</span> <span class="n">f</span> <span class="err">结尾</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>


<span class="o">//</span> <span class="err">同样的功能，同时可以处理从文件读取的行</span>
<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;bufio&quot;</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;os&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">counts</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">files</span> <span class="p">:</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="n">countLines</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdin</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">arg</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">files</span> <span class="p">{</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
                <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stderr</span><span class="p">,</span> <span class="s2">&quot;dup2: %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="p">}</span>
            <span class="n">countLines</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">n</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">counts</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">countLines</span><span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">os</span><span class="o">.</span><span class="n">File</span><span class="p">,</span> <span class="n">counts</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">input</span> <span class="p">:</span><span class="o">=</span> <span class="n">bufio</span><span class="o">.</span><span class="n">NewScanner</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">input</span><span class="o">.</span><span class="n">Scan</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">counts</span><span class="p">[</span><span class="nb">input</span><span class="o">.</span><span class="n">Text</span><span class="p">()]</span><span class="o">++</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="err">还是一样的功能，我们让程序可以处理整个文件，而不是一行一行读取，引入</span> <span class="n">io</span><span class="o">/</span><span class="n">ioutil</span> <span class="err">包</span>
<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;io/ioutil&quot;</span>
    <span class="s2">&quot;os&quot;</span>
    <span class="s2">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">counts</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">filename</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">//</span> <span class="k">return</span> <span class="n">byte</span> <span class="nb">slice</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stderr</span><span class="p">,</span> <span class="s2">&quot;dup3: %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">line</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">strings</span><span class="o">.</span><span class="n">Split</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">//</span> <span class="err">把文件拆成一行一行计数</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">line</span><span class="p">]</span><span class="o">++</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">n</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">counts</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">{</span> <span class="o">//</span> <span class="err">打印重复行</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>接下来是一个爬虫的例子，当然看起来没有用 python requests 那么优雅，有个类似的 grequests 更精简：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;io/ioutil&quot;</span>
    <span class="s2">&quot;net/http&quot;</span>
    <span class="s2">&quot;os&quot;</span>
<span class="p">)</span>

<span class="o">//</span> <span class="n">go</span> <span class="n">run</span> <span class="n">main</span><span class="o">.</span><span class="n">go</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">baidu</span><span class="o">.</span><span class="n">com</span>
<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">url</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stderr</span><span class="p">,</span> <span class="s2">&quot;fetch :%v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">b</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadAll</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stderr</span><span class="p">,</span> <span class="s2">&quot;fetch: reading </span><span class="si">%s</span><span class="s2">: %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>然后我们并发请求数据，并发可是 golang 的卖点之一:</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;io&quot;</span>
    <span class="s2">&quot;io/ioutil&quot;</span>
    <span class="s2">&quot;net/http&quot;</span>
    <span class="s2">&quot;os&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="o">//</span> <span class="n">go</span> <span class="n">run</span> <span class="n">main</span><span class="o">.</span><span class="n">go</span>  <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">baidu</span><span class="o">.</span><span class="n">com</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">zhihu</span><span class="o">.</span><span class="n">com</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">douban</span><span class="o">.</span><span class="n">com</span>
<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">start</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
    <span class="n">ch</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">string</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">url</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="n">go</span> <span class="n">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span> <span class="o">//</span> <span class="err">启动一个</span> <span class="n">goroutine</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nb">range</span> <span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="o">//</span><span class="err">当一个</span> <span class="n">goroutine</span> <span class="err">从</span> <span class="n">channel</span> <span class="err">发送或者接收值的时候，会被</span> <span class="n">block</span> <span class="err">直到另一个</span> <span class="n">goroutine</span> <span class="err">响应</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="n">ch</span><span class="p">)</span> <span class="o">//</span> <span class="n">receive</span> <span class="kn">from</span> <span class="nn">channel</span> <span class="nn">ch</span>
    <span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">s elapsed</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">Seconds</span><span class="p">())</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">fetch</span><span class="p">(</span><span class="n">url</span> <span class="n">string</span><span class="p">,</span> <span class="n">ch</span> <span class="n">chan</span><span class="o">&lt;-</span> <span class="n">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">start</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>
    <span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">ch</span> <span class="o">&lt;-</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprint</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">//</span> <span class="n">send</span> <span class="n">to</span> <span class="n">channel</span> <span class="n">ch</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="n">nbytes</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">ioutil</span><span class="o">.</span><span class="n">Discard</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span> <span class="o">//</span> <span class="err">不得不吐槽下</span> <span class="n">go</span> <span class="err">的错误处理，写异常习惯了，到处都是</span> <span class="n">err</span> <span class="err">真烦人</span>
        <span class="n">ch</span> <span class="o">&lt;-</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;while reanding </span><span class="si">%s</span><span class="s2">:%v&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">//</span> <span class="err">向</span><span class="n">channel</span> <span class="err">发送数据</span><span class="p">(</span><span class="n">ch</span> <span class="o">&lt;-</span> <span class="n">expression</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="n">secs</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">Seconds</span><span class="p">()</span>
    <span class="n">ch</span> <span class="o">&lt;-</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">s </span><span class="si">%7d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">secs</span><span class="p">,</span> <span class="n">nbytes</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>这一个例子是写一个 web echo server，看起来比较简单：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;log&quot;</span>
    <span class="s2">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="o">//</span> <span class="n">echo</span> <span class="n">server</span>
<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span> <span class="o">//</span> <span class="n">each</span> <span class="n">request</span> <span class="n">calls</span> <span class="n">handler</span>
    <span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s2">&quot;localhost:8000&quot;</span><span class="p">,</span> <span class="n">nil</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">handler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;URL.Path = %q</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>然后我们添点料，比如实现个请求计数的功能：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;log&quot;</span>
    <span class="s2">&quot;net/http&quot;</span>
    <span class="s2">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="n">var</span> <span class="n">mu</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>
<span class="n">var</span> <span class="n">count</span> <span class="nb">int</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
    <span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s2">&quot;/count&quot;</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s2">&quot;localhost:8000&quot;</span><span class="p">,</span> <span class="n">nil</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">handler</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span> <span class="o">//</span> <span class="err">限定最多一个</span> <span class="n">goroutine</span> <span class="err">访问</span> <span class="n">count</span> <span class="p">(</span><span class="err">每个请求开一个</span> <span class="n">goroutine</span> <span class="err">处理</span><span class="p">)</span>
    <span class="n">count</span><span class="o">++</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;URL.Path = %q</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">counter</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;count </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<p>最后再几个 golang 的语法特性：</p>
<ul>
<li>控制流 switch</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">switch</span> <span class="nx">coinflip</span><span class="p">()</span> <span class="p">{</span>
<span class="k">case</span> <span class="s">&quot;heads&quot;</span><span class="p">:</span>    <span class="c1">// case 还支持简单的语句 ()。case可以支持 string</span>
    <span class="nx">heads</span><span class="o">++</span>
<span class="k">case</span> <span class="s">&quot;tails&quot;</span><span class="p">:</span>
    <span class="nx">tails</span><span class="o">++</span>
<span class="k">default</span><span class="p">:</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;landed on edge!&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>Named Types:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1">//定义一个 Point 类型</span>
<span class="kd">type</span> <span class="nx">Point</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="nx">Point</span>
</code></pre></div>


<ul>
<li>Pointers(指针)：和 C 类似，go 中也实现了指针</li>
<li>Methods and interfaces（方法和接口）: 方法是关联到一个命名类型的函数。接口是一种把不同类型同等对待的抽象类型</li>
<li>Packages(包): 通过包组织程序</li>
<li>Comments(注释)：和 C 一样的注释,  <code>// or /* XXXX */</code></li>
</ul>
<h1 id="2-program-structure">2. Program Structure<a class="headerlink" href="#2-program-structure" title="Permanent link">&para;</a></h1>
<p>表达式+控制流 -&gt; 语句 -&gt; 函数 -&gt; 源文件 -&gt; 包</p>
<h2 id="21-names">2.1 Names<a class="headerlink" href="#21-names" title="Permanent link">&para;</a></h2>
<p>go 定义了几十个关键字，不能用来给变量命名，go 使用一般使用骆驼命名法(HTTP等缩略词除外)。需要注意的是只有大骆驼命名
&ldquo;fmt.Fprintf&rdquo; 这种是可以被其他包引入使用的。go 通过大小写表示是否能够引入，没有访问控制声明符。</p>
<h2 id="22-declarations">2.2 Declarations<a class="headerlink" href="#22-declarations" title="Permanent link">&para;</a></h2>
<p>var, const ,type, func 声明</p>
<div class="codehilite"><pre><span></span><code><span class="err">func fToC(f float64) float64 {</span>
<span class="err">    return (f - 32) * 5 / 9</span>
<span class="err">}</span>
</code></pre></div>


<h2 id="23-variables">2.3 Variables<a class="headerlink" href="#23-variables" title="Permanent link">&para;</a></h2>
<p>定义变量：如果省略了 type 将会用每个类型的初始值初始化赋值（类似 java）</p>
<div class="codehilite"><pre><span></span><code><span class="n">var</span> <span class="n">name</span> <span class="k">type</span> <span class="o">=</span> <span class="n">expression</span>
<span class="o">//</span> <span class="err">可以一次性定义多个</span>
<span class="n">var</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="nb">int</span>   <span class="o">//</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">var</span> <span class="n">b</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">s</span>  <span class="o">=</span> <span class="k">true</span><span class="p">,</span> <span class="mi">2</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span> <span class="ss">&quot;four&quot;</span>    <span class="o">//</span> <span class="err">同样有类似解包的操作</span>

<span class="o">//</span> <span class="err">接下来是</span> <span class="n">short</span> <span class="k">variable</span> <span class="n">declarations</span><span class="err">，</span> <span class="err">短赋值，</span><span class="o">`</span><span class="p">:</span><span class="o">=`</span> <span class="err">是</span> <span class="err">声明，而</span> <span class="o">`=`</span> <span class="err">是赋值</span>
<span class="n">freq</span> <span class="p">:</span><span class="o">=</span> <span class="n">rand</span><span class="p">.</span><span class="n">Float64</span><span class="p">()</span> <span class="o">*</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span>
<span class="n">t</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>

<span class="o">//</span> <span class="n">multiple</span> <span class="n">variables</span> <span class="n">declared</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span>    <span class="o">//</span> <span class="n">swap</span><span class="p">,</span> <span class="err">这个和</span><span class="n">python一样支持</span>

<span class="n">f</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="k">Open</span><span class="p">()</span>
<span class="n">f</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="k">Close</span><span class="p">()</span>     <span class="o">//</span> <span class="n">wrong</span><span class="p">,</span>  <span class="n">a</span> <span class="n">short</span> <span class="k">variable</span> <span class="n">declaration</span> <span class="n">must</span> <span class="k">declare</span> <span class="k">at</span> <span class="n">least</span> <span class="n">one</span> <span class="k">new</span> <span class="k">variable</span>
</code></pre></div>


<p>指针: 如果学过 c，这里的指针很类似，表示一个变量的地址</p>
<div class="codehilite"><pre><span></span><code><span class="n">x</span> <span class="p">:</span><span class="o">=</span> <span class="mi">1</span>
<span class="n">p</span> <span class="p">:</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">x</span>    <span class="o">//</span> <span class="n">p</span><span class="p">,</span> <span class="k">of</span> <span class="k">type</span> <span class="o">*</span><span class="nb">int</span><span class="p">,</span> <span class="n">points</span> <span class="k">to</span> <span class="n">x</span>
<span class="n">fm</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="o">//</span> <span class="ss">&quot;1&quot;</span>
<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="ss">&quot;2&quot;</span>

<span class="n">var</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span>
<span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span> <span class="o">==</span> <span class="n">nil</span><span class="p">)</span>
<span class="o">//</span> <span class="ss">&quot;true false false&quot;</span><span class="err">，指针可以比较，当指向相同的值的时候相等。但是为了简化，</span><span class="n">go指针不能做运算</span>

<span class="o">//</span> <span class="err">函数返回一个局部变量的指针也是安全的</span>
<span class="n">var</span> <span class="n">p</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
<span class="n">func</span> <span class="n">f</span><span class="p">()</span> <span class="o">*</span><span class="nb">int</span> <span class="err">{</span>
    <span class="n">v</span><span class="p">:</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">v</span>
<span class="err">}</span>

<span class="o">//</span> <span class="err">可以传入指针给函数改变其所指向的值</span>
<span class="n">func</span> <span class="n">incr</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span><span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="err">{</span>
    <span class="o">*</span><span class="n">p</span><span class="o">++</span>
    <span class="k">return</span> <span class="o">*</span><span class="n">p</span>
<span class="err">}</span>
<span class="n">v</span> <span class="p">:</span><span class="o">=</span><span class="mi">1</span>
<span class="n">incr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="p">)</span>
<span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="n">incr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="p">))</span>
</code></pre></div>


<p>new 函数：创建一个变量的另一种方式是使用内置函数 new，new(T)创建一个未命名T
类型的变量，用初始值初始化，然后返回其地址(*T)</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="n">test</span><span class="p">()</span> <span class="err">{</span>
    <span class="n">p</span> <span class="p">:</span><span class="o">=</span> <span class="k">new</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>    <span class="o">//</span><span class="err">可以不通过变量名就访问它（指针的好处之一）</span>
<span class="err">}</span>

<span class="o">//</span><span class="err">两种等价写法</span>
<span class="n">func</span> <span class="n">newInt</span><span class="p">()</span> <span class="o">*</span><span class="nb">int</span> <span class="err">{</span>
    <span class="k">return</span> <span class="k">new</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="err">}</span>
<span class="n">func</span> <span class="n">newInt2</span><span class="p">()</span> <span class="o">*</span><span class="nb">int</span> <span class="err">{</span>
    <span class="n">var</span> <span class="n">dummy</span> <span class="nb">int</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">dummy</span>
<span class="err">}</span>
</code></pre></div>


<p>变量生命周期(lifetime):
package-level变量在整个程序执行过程中都存在。局部变量生存周期是动态的，每次一个实例在生命语句执行的时候被创建，直到不可访问的时候被回收。
虽然 go 有自己的垃圾回收机制，但是代码里尽量让变量的生存周期更短</p>
<h2 id="24">2.4 赋值<a class="headerlink" href="#24" title="Permanent link">&para;</a></h2>
<p>相较于 python，go 支持自增操作符。和 py相同的是同样支持 tuple 的解包赋值，演示一些例子：</p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">    </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">swap</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="ow">like</span><span class="w"> </span><span class="n">python</span><span class="w"></span>

<span class="w">    </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">map</span><span class="w"> </span><span class="n">lookup</span><span class="w"></span>
<span class="w">    </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.(</span><span class="n">T</span><span class="p">)</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">assertion</span><span class="w"></span>
<span class="w">    </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">ch</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="n">receive</span><span class="w"></span>
<span class="w">    </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.(</span><span class="n">T</span><span class="p">)</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">discard</span><span class="w"> </span><span class="k">result</span><span class="w"></span>

<span class="w">    </span><span class="n">medals</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="n">string</span><span class="err">{</span><span class="ss">&quot;gold&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;silver&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;bronze&quot;</span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">隐式赋值等价于</span><span class="w"></span>
<span class="w">    </span><span class="n">medals</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;gold&quot;</span><span class="w"></span>
<span class="w">    </span><span class="n">medals</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;silver&quot;</span><span class="w"></span>
<span class="w">    </span><span class="n">medals</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;bronze&quot;</span><span class="w"></span>
</code></pre></div>


<p>可赋值性：For the types we’ve discussed so far, the rules are simple: the types must exactly match, and nil may be assigned to any variable of interface or reference type.</p>
<h2 id="25-type-declarations">2.5 Type Declarations<a class="headerlink" href="#25-type-declarations" title="Permanent link">&para;</a></h2>
<p>一个变量的类型决定了它的属性和能做哪些操作，比如它的大小（占多少 bit），内部表示，能做哪些操作，关联了哪些方法。
<code>type name underlying-type</code></p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span><span class="err">看一个摄氏温度和华氏温度转换的例子</span>
<span class="k">type</span> <span class="n">Celsius</span> <span class="n">float64</span> <span class="o">//</span>  <span class="err">自定义类型</span>
<span class="k">type</span> <span class="n">Fahrenheit</span> <span class="n">float64</span>

<span class="n">const</span> <span class="p">(</span>
    <span class="n">AbsoluteZeroC</span> <span class="n">Celsius</span> <span class="o">=</span> <span class="o">-</span><span class="mi">273</span><span class="p">.</span><span class="mi">15</span>
    <span class="n">FreezingC</span>     <span class="n">Celsius</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">BoilingC</span>      <span class="n">Celsius</span> <span class="o">=</span> <span class="mi">100</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">CToF</span><span class="p">(</span><span class="k">c</span> <span class="n">Celsius</span><span class="p">)</span> <span class="n">Fahrenheit</span> <span class="err">{</span> <span class="k">return</span> <span class="n">Fahrenheit</span><span class="p">(</span><span class="k">c</span><span class="o">*</span><span class="mi">95</span> <span class="o">+</span> <span class="mi">32</span><span class="p">)</span> <span class="err">}</span>
<span class="n">func</span> <span class="n">FToC</span><span class="p">(</span><span class="n">f</span> <span class="n">Fahrenheit</span><span class="p">)</span> <span class="n">Celsius</span> <span class="err">{</span> <span class="k">return</span> <span class="n">Celsius</span><span class="p">((</span><span class="n">f</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">9</span><span class="p">)</span> <span class="err">}</span>
</code></pre></div>


<p>如果 underlying type 一样可以类型强转, T(x)</p>
<h2 id="26-packages-and-files">2.6 Packages and Files<a class="headerlink" href="#26-packages-and-files" title="Permanent link">&para;</a></h2>
<p>每个包都声明了名字空间，当有名字冲突的时候，需要显式通过包名调用。大写开头的标识符才可以被导出。把上面的例子改成包，</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">gopl</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">ch2</span><span class="o">/</span><span class="n">tempconv</span>
<span class="o">//</span> <span class="n">tempconv</span><span class="o">.</span><span class="n">go</span>
<span class="n">package</span> <span class="n">tempconv</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="o">//</span><span class="err">看一个摄氏温度和华氏温度转换的例子</span>
<span class="nb">type</span> <span class="n">Celsius</span> <span class="n">float64</span> <span class="o">//</span>  <span class="err">自定义类型</span>
<span class="nb">type</span> <span class="n">Fahrenheit</span> <span class="n">float64</span>

<span class="n">const</span> <span class="p">(</span>
    <span class="n">AbsoluteZeroC</span> <span class="n">Celsius</span> <span class="o">=</span> <span class="o">-</span><span class="mf">273.15</span>
    <span class="n">FreezingC</span>     <span class="n">Celsius</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">BoilingC</span>      <span class="n">Celsius</span> <span class="o">=</span> <span class="mi">100</span>
<span class="p">)</span>

<span class="o">//</span> <span class="err">可以给自定义的类型来编写方法</span>
<span class="n">func</span> <span class="p">(</span><span class="n">c</span> <span class="n">Celsius</span><span class="p">)</span> <span class="n">String</span><span class="p">()</span> <span class="n">string</span>    <span class="p">{</span> <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">°C&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">}</span>
<span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="n">Fahrenheit</span><span class="p">)</span> <span class="n">String</span><span class="p">()</span> <span class="n">string</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">°F&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">}</span>

<span class="o">//</span> <span class="n">conv</span><span class="o">.</span><span class="n">go</span>
<span class="n">package</span> <span class="n">tempconv</span>
<span class="n">func</span> <span class="n">CToF</span><span class="p">(</span><span class="n">c</span> <span class="n">Celsius</span><span class="p">)</span> <span class="n">Fahrenheit</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Fahrenheit</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="mi">95</span> <span class="o">+</span> <span class="mi">32</span><span class="p">)</span> <span class="p">}</span>
<span class="n">func</span> <span class="n">FToC</span><span class="p">(</span><span class="n">f</span> <span class="n">Fahrenheit</span><span class="p">)</span> <span class="n">Celsius</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Celsius</span><span class="p">((</span><span class="n">f</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">9</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>


<p>go程序里每个包都通过一个唯一的 import path 标识，比如 &ldquo;gopl.io/ch2/tempconv&rdquo;
包初始化的顺序：以包级别的变量开始按照声明顺序初始化，但是被依赖的值先初始化</p>
<div class="codehilite"><pre><span></span><code><span class="err">var a=b+c // 3</span>
<span class="err">var b=f() // 2</span>
<span class="err">var c=1//1</span>
<span class="err">func f() int {return c+1}</span>
</code></pre></div>


<p>如果一个包有多个 go 源文件，会被给编译器的顺序执行初始化，go tools 通过把文件名排序后给交给编译器
可以在文件里定义 init() 函数，他们不能被引用，程序执行的时候会按照被声明顺序自动运行(比如初始化一个查找表)</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span><span class="n">gopl</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">ch2</span><span class="o">/</span><span class="n">popcount</span><span class="w"></span>
<span class="n">package</span><span class="w"> </span><span class="n">popcount</span><span class="w"></span>

<span class="nf">var</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="o">[</span><span class="n">256</span><span class="o">]</span><span class="n">byte</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="n">init</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">pc</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pc</span><span class="o">[</span><span class="n">i/2</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">byte</span><span class="p">(</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="n">PopCount</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="n">uint64</span><span class="p">)</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nc">int</span><span class="p">(</span><span class="n">pc</span><span class="o">[</span><span class="n">byte(x&gt;&gt;(0*8))</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">        </span><span class="n">pc</span><span class="o">[</span><span class="n">byte(x&gt;&gt;(1*8))</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">        </span><span class="n">pc</span><span class="o">[</span><span class="n">byte(x&gt;&gt;(2*8))</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">        </span><span class="n">pc</span><span class="o">[</span><span class="n">byte(x&gt;&gt;(3*8))</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">        </span><span class="n">pc</span><span class="o">[</span><span class="n">byte(x&gt;&gt;(4*8))</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">        </span><span class="n">pc</span><span class="o">[</span><span class="n">byte(x&gt;&gt;(5*8))</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">        </span><span class="n">pc</span><span class="o">[</span><span class="n">byte(x&gt;&gt;(6*8))</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"></span>
<span class="w">        </span><span class="n">pc</span><span class="o">[</span><span class="n">byte(x&gt;&gt;(7*8))</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<h2 id="27-scope">2.7 Scope<a class="headerlink" href="#27-scope" title="Permanent link">&para;</a></h2>
<p>声明绑定了名字和程序实体，比如函数或者变量，一个声明的作用域表示这个声明的名字在哪些代码块起作用。不要和生命周期（lifetime）
混淆，声明的作用域是一段程序片段，编译时属性，生命周期指的是运行期间可以被程序其他部分所引用的持续时间，运行时属性。
golang 中通过块（block）来圈定作用域。名字查找遵循『就近』原则，内部声明会屏蔽外部声明（最好不要重名，理解各种重名覆盖问题比较费劲）</p>
<h1 id="3-basic-data-types">3. Basic Data Types<a class="headerlink" href="#3-basic-data-types" title="Permanent link">&para;</a></h1>
<p>go的数据类型分成4类：</p>
<ul>
<li>基础类型: numbers, strings, booleans</li>
<li>聚合类型: arrays, structs,</li>
<li>引用类型: pointers, slices, maps, functions, channels</li>
<li>接口类型: interface types</li>
</ul>
<h2 id="31-integers">3.1 Integers<a class="headerlink" href="#31-integers" title="Permanent link">&para;</a></h2>
<p>int8, int16, int32, int64, uint8, uint16, uint32, uint64
rune &lt;=&gt; int32 , byte &lt;=&gt; uint8</p>
<ul>
<li>有符号数： <code>-2**(n-1) to 2**(n-1)-1</code></li>
<li>无符号数: <code>0 to 2**n-1</code></li>
</ul>
<p>尤其注意不同类型之间数字强转可能会有精度损失</p>
<h2 id="32-floating-point-numbers">3.2 Floating-Point Numbers<a class="headerlink" href="#32-floating-point-numbers" title="Permanent link">&para;</a></h2>
<ul>
<li>float32: 1.4e-45 to 3.4e38</li>
<li>float64: 1.8e308 to 4.9e-324</li>
<li>math package</li>
</ul>
<h2 id="33-complex-numbers">3.3 Complex Numbers<a class="headerlink" href="#33-complex-numbers" title="Permanent link">&para;</a></h2>
<ul>
<li>complex64</li>
<li>complex128</li>
<li>
<p>math/cmplx package</p>
<p><code>var x complex128 = complex(1,2)</code></p>
</li>
</ul>
<h2 id="34-booleans">3.4 booleans<a class="headerlink" href="#34-booleans" title="Permanent link">&para;</a></h2>
<ul>
<li>true</li>
<li>false</li>
<li>短路求值特性，比如 a() || b()，如果 a() 返回true，b()不会执行</li>
</ul>
<h2 id="35-strings">3.5 Strings<a class="headerlink" href="#35-strings" title="Permanent link">&para;</a></h2>
<p>不可变字节序列，可以包含任何数据，通常是人类可读的。文本 string 可以方便地解释成 utf8编码的 unicode 码(runes)</p>
<ul>
<li>len: len(string) return number of bytes(not runes), <code>0 &lt;= i &lt; len(s)</code></li>
<li>切片: s[i:j] yield a new substring</li>
<li>字符串字面量: &ldquo;Hello，世界&rdquo; (双引号) 。go 源文件总是用 utf8编码，go 文本字符串被解释成 utf8。</li>
<li>raw string literal: 反引号包含的字符串，转义符不会被处理，经常用来写正则</li>
<li>unicode: go 术语里叫做 rune(int32)</li>
<li>utf8: 一种把 unicode 字节码转成字节序列的一种变长编码方案(utf8由 Ken Thompson and Rob Pike发明，同时还是 go 的创造者)</li>
<li>Go’s range loop, when applied to a string, performs UTF-8 decoding implicitly</li>
<li>A []rune conversion applied to a UTF-8-encoded string returns the sequence of Unicode code points that the string encodes</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;unicode/utf8&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">s</span> <span class="p">:</span><span class="o">=</span> <span class="s2">&quot;hello, 世界&quot;</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>                    <span class="o">//</span> <span class="mi">13</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">utf8</span><span class="o">.</span><span class="n">RuneCountInString</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="o">//</span> <span class="mi">9</span>
<span class="p">}</span>
</code></pre></div>


<p>几个用来处理字符串的包：</p>
<ul>
<li>bytes:  操作 slices of bytes, type []byte</li>
<li>strings: searching, replacing, comparing, trimming, splitting, joining</li>
<li>strconv: boolean, integer, floating-point values 和 他们的 string 表示形式来回转；</li>
<li>unicode: IsDigit, IsLetter, IsUpper, IsLower识别 runes</li>
</ul>
<h2 id="36-constants">3.6 Constants<a class="headerlink" href="#36-constants" title="Permanent link">&para;</a></h2>
<p>const 表达式的值在编译器确定，无法改变。const 值可以是boolean, string or number
The const generator</p>
<p>iota: 定义从0 开始的递增枚举</p>
<div class="codehilite"><pre><span></span><code><span class="err">const (</span>
<span class="err">    Sunday Weekday = iota</span>
<span class="err">    Monday</span>
<span class="err">    Tuesday</span>
<span class="err">    Wednesday</span>
<span class="err">    Thrusday</span>
<span class="err">    Friday</span>
<span class="err">    Saturday</span>
<span class="err">)</span>
</code></pre></div>


<h1 id="4-composite-types">4. Composite Types<a class="headerlink" href="#4-composite-types" title="Permanent link">&para;</a></h1>
<p>本章讨论聚合类型: arrays, slices, maps, structs</p>
<h2 id="41-arrays">4.1 Arrays<a class="headerlink" href="#41-arrays" title="Permanent link">&para;</a></h2>
<p>定长的包含0个或多个相同类型元素的序列，因为不可变长所以一般 slices 更常用。
注意数组的长度也是类型的一部分， [3]int 和 [4]int 是不同类型，相同长度的可以比较。</p>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nf">var</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">[</span><span class="n">3</span><span class="o">]</span><span class="nc">int</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">integers</span><span class="err">，</span><span class="n">第一次看这种写法略奇怪</span><span class="err">，</span><span class="n">理解为</span><span class="w"> </span><span class="o">[</span><span class="n">3</span><span class="o">]</span><span class="n">个int</span><span class="w"> </span><span class="n">就好多啦</span><span class="w"></span>
<span class="w">    </span><span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="n">a</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="ss">&quot;%d %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>

<span class="w">    </span><span class="nf">var</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">[</span><span class="n">3</span><span class="o">]</span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">3</span><span class="o">]</span><span class="nc">int</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="err">}</span><span class="w"> </span><span class="o">//</span><span class="n">初始化</span><span class="w"></span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">...</span><span class="o">]</span><span class="nc">int</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="err">}</span><span class="w">         </span><span class="o">//</span><span class="w"> </span><span class="n">省略号代表长度由右边的长度决定</span><span class="p">,</span><span class="w"> </span><span class="err">[]</span><span class="nc">int</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="err">}</span><span class="w"> </span><span class="n">slice</span><span class="w"></span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">数组还支持用</span><span class="w"> </span><span class="n">下标和值</span><span class="w"> </span><span class="n">初始化</span><span class="w"></span>
<span class="w">    </span><span class="n">type</span><span class="w"> </span><span class="n">Currency</span><span class="w"> </span><span class="nc">int</span><span class="w"></span>
<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">USD</span><span class="w"> </span><span class="n">currency</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iota</span><span class="w"></span>
<span class="w">        </span><span class="n">EUR</span><span class="w"></span>
<span class="w">        </span><span class="n">GBP</span><span class="w"></span>
<span class="w">        </span><span class="n">RMB</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nl">symbol</span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">...</span><span class="o">]</span><span class="n">string</span><span class="err">{</span><span class="nl">USD</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;$&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">EUR</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;€&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">GBP</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;₤&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">RMB</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;￥&quot;</span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="n">RMB</span><span class="p">,</span><span class="w"> </span><span class="n">symbol</span><span class="o">[</span><span class="n">RMB</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="ss">&quot;3 ￥&quot;</span><span class="w"></span>
</code></pre></div>


<p>数组传值，拷贝值，如果需要传递引用可以通过传递指针</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span><span class="w"> </span><span class="n">zero</span><span class="p">(</span><span class="n">ptr</span><span class="w"> </span><span class="o">*[</span><span class="n">32</span><span class="o">]</span><span class="n">byte</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">注意这里的数字长度也是类型的一部分</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">ptr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
<span class="n">func</span><span class="w"> </span><span class="n">zero</span><span class="p">(</span><span class="n">ptr</span><span class="w"> </span><span class="o">*[</span><span class="n">32</span><span class="o">]</span><span class="n">byte</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">32</span><span class="o">]</span><span class="n">byte</span><span class="err">{}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<h2 id="42-slices">4.2 Slices<a class="headerlink" href="#42-slices" title="Permanent link">&para;</a></h2>
<p>包含相同类型元素的可变长序列，写法 []T，类似于没有 size 的数组，由三部分组成：</p>
<ul>
<li>a pointer: 指向数组第一个元素</li>
<li>a length: number of slice elements  (len 函数)</li>
<li>a capacity: the number of elements between the start of the slice and the end of the underlying array (cap函数)</li>
</ul>
<p>slice operator s[i:j], where 0 ≤ i ≤ j ≤ cap(s), 创建一个新的 slice</p>
<p>注意，slice 包含了一个数组的指针，作为函数参数传递的时候允许函数修改数组。(引用类型)</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">reverse</span><span class="p">(</span><span class="n">s</span> <span class="p">[]</span><span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">;</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
        <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">a</span> <span class="p">:</span><span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="nb">int</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">}</span>
    <span class="n">reverse</span><span class="p">(</span><span class="n">a</span><span class="p">[:])</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="n">s</span> <span class="p">:</span><span class="o">=</span> <span class="p">[]</span><span class="nb">int</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">}</span> <span class="o">//</span><span class="err">注意</span> <span class="nb">slice</span> <span class="err">初始化和数组的区别，没有</span> <span class="n">size</span>
    <span class="n">reverse</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">reverse</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
    <span class="n">reverse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p><strong>并且 slice 不像数组一样能直接比较</strong>，基于两个原因：</p>
<ul>
<li>slice 可以包含自己，深度比较无论是复杂度还是实现效率都不好</li>
<li>不适合作为 map 的 key。对于引用类型（pointers and channels）， == 一般比较引用实体是否是同一个。但是这回导致 slice
    和数组的 == 一个是 shallow equality，一个是 deep equality，为了防止歧义最安全的方式就是干脆禁止 slice 比较。唯一合法的
    slice 比较就是判断 <code>if slice == nil {}</code></li>
</ul>
<p>slice 的初始化值（zero value）是 nil，nil slice没有隐含指向的数组，其 length==capacity==0。但是也有包含 nil
的slice，我们看几个比较(我感觉这里 python 的 None 用 is 判断比较优雅)：</p>
<div class="codehilite"><pre><span></span><code><span class="err">var s []int    // len(s) == 0, s == nil，空切片</span>
<span class="err">s = make ([]int, 0)  // or slice := []int{}   // 都是空切片</span>
<span class="err">s = nil        // len(s) == 0, s == nil</span>
<span class="err">s = []int(nil) // len(s) == 0, s == nil</span>
<span class="err">s = []int{}    // len(s) == 0, s != nil</span>
</code></pre></div>


<p>所以如果只是判断一个 slice 是否为空，应该用 len(s) == 0，而不是 s == nil。内置的 make 函数用来创建 slice</p>
<div class="codehilite"><pre><span></span><code><span class="err">    make([]T, len)</span>
<span class="err">    make([]T, len, cap)</span>
</code></pre></div>


<p>向 slice 追加元素用内置的 append 函数。append 会返回一个包含结果的新切片（容量有可能改变）
如果切片的底层数组没有足够的可用容量，append 函数会创建一个新的底层数组，将被引用的现有数组复制到新的数组里，
再追加新的值。</p>
<div class="codehilite"><pre><span></span><code><span class="n">var</span> <span class="n">runes</span> <span class="p">[]</span><span class="n">rune</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">r</span> <span class="p">:</span><span class="o">=</span> <span class="n">range</span> <span class="ss">&quot;hello,世界&quot;</span> <span class="err">{</span>
    <span class="n">runes</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">runes</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="err">}</span> <span class="o">//</span> <span class="k">or</span> <span class="n">just</span> <span class="n">use</span> <span class="p">:</span>  <span class="p">[]</span><span class="n">rune</span><span class="p">(</span><span class="ss">&quot;hello,世界&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="err">我们实现一个</span> <span class="n">appendInt</span> <span class="err">看下</span> <span class="n">append</span> <span class="err">的工作原理</span>
<span class="n">func</span> <span class="n">appendInt</span><span class="p">(</span><span class="n">x</span> <span class="p">[]</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="p">[]</span><span class="nb">int</span> <span class="err">{</span>
    <span class="n">var</span> <span class="n">z</span> <span class="p">[]</span><span class="nb">int</span>
    <span class="n">zlen</span> <span class="p">:</span><span class="o">=</span> <span class="n">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">zlen</span> <span class="o">&lt;=</span> <span class="n">cap</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="err">{</span> <span class="o">//</span> <span class="err">容量够用</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">zlen</span><span class="p">]</span>
    <span class="err">}</span> <span class="k">else</span> <span class="err">{</span>
        <span class="o">//</span> <span class="err">如果容量不够</span> <span class="n">append</span> <span class="err">的了，将容量扩大两倍</span><span class="p">(</span><span class="n">python</span> <span class="err">的</span> <span class="n">list</span> <span class="err">和</span><span class="k">c</span> <span class="err">艹</span> <span class="n">vector</span> <span class="err">类似扩充策略</span><span class="p">)</span>
        <span class="n">zcap</span> <span class="p">:</span><span class="o">=</span> <span class="n">zlen</span>
        <span class="k">if</span> <span class="n">zcap</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="err">{</span>
            <span class="n">zcap</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="err">}</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">make</span><span class="p">([]</span><span class="nb">int</span><span class="p">,</span> <span class="n">zlen</span><span class="p">,</span> <span class="n">zcap</span><span class="p">)</span>
        <span class="k">copy</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="n">build</span> <span class="nb">int</span> <span class="n">funcion</span> <span class="o">`</span><span class="n">func</span> <span class="k">copy</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span> <span class="p">[]</span><span class="k">Type</span><span class="p">)</span> <span class="nb">int</span><span class="o">`</span>
    <span class="err">}</span>
    <span class="n">z</span><span class="p">[</span><span class="n">len</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">z</span>
<span class="err">}</span>
</code></pre></div>


<p>任何改变 长度或者容量的操作都会更新 slice，虽然 slice 指向的数组是间接的，但是指针、长度和容量不是，slice
不是纯引用类型，更像是如下结构：</p>
<div class="codehilite"><pre><span></span><code><span class="err">type IntSlice struct {</span>
<span class="err">    ptr      *int</span>
<span class="err">    len, cap int</span>
<span class="err">}</span>
</code></pre></div>


<p>append 是个可变参数的函数，可以接收多个参数， &hellip; 运算符可以追加一个切片的所有元素到另一个切片里。</p>
<div class="codehilite"><pre><span></span><code><span class="n">s1</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="nc">int</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="err">}</span><span class="w"></span>
<span class="n">s2</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="nc">int</span><span class="err">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="err">}</span><span class="w"></span>
<span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="ss">&quot;%v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">...))</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="n">是元素的副本</span><span class="err">，</span><span class="n">而不是直接返回该元素的引用</span><span class="w"></span>
<span class="w">    </span><span class="n">fmt</span><span class="p">.</span><span class="k">Print</span><span class="p">(</span><span class="k">index</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;\n&quot;</span><span class="p">)</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="k">index</span><span class="o">++</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="n">fmt</span><span class="p">.</span><span class="k">Print</span><span class="p">(</span><span class="n">s</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>

<span class="o">//</span><span class="w"> </span><span class="n">多维切片</span><span class="w"></span>
<span class="n">slice</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="err">[][]</span><span class="nc">int</span><span class="err">{{</span><span class="mi">10</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="err">}}</span><span class="w"></span>
<span class="n">slice</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">slice</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


<p>可以使用省略号来让函数接受任意多个 final arguments：</p>
<div class="codehilite"><pre><span></span><code><span class="err">func appendInt(x []int, y ...int) []int{</span>
<span class="err">    var z[]int</span>
<span class="err">    zlen:=len(x) + len(y)</span>
<span class="err">    // ... expand z to at least zlen...</span>
<span class="err">    copy(z[len(x):], y)</span>
<span class="err">    return z</span>
<span class="err">}</span>
</code></pre></div>


<p>切片作为函数传递的代价很小，不涉及到底层数组复制，只会复制切片自己的结构(24个字节)</p>
<h2 id="43-maps">4.3 Maps<a class="headerlink" href="#43-maps" title="Permanent link">&para;</a></h2>
<p>无序键值对，go 里 map 是 哈希表的引用。要求所有 key 类型相同，所有的 value 类型相同，key
必须是可比较==的。不过用法上和 python 的 map 还是比较类似的。
切片、函数和包含切片的结构类型由于具有引用语句，不能作为映射的键(key)。
作为参数的传递的 map 如果修改了 map 会对所有的引用可见，不会复制底层的数据结构。</p>
<div class="codehilite"><pre><span></span><code><span class="n">var</span> <span class="n">colors</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">string</span><span class="p">]</span> <span class="o">//</span> <span class="err">声明一个未初始化的映射来创建一个值为</span> <span class="n">nil</span> <span class="err">的映射，</span> <span class="n">nil</span> <span class="err">映射不能存储键值对</span>

<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;sort&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">ages</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nb">int</span><span class="p">)</span> <span class="o">//</span><span class="err">创建</span> <span class="nb">map</span>
    <span class="n">ages</span><span class="p">[</span><span class="s2">&quot;alice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">31</span>
    <span class="n">ages</span><span class="p">[</span><span class="s2">&quot;charlie&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">34</span>

    <span class="n">ages2</span> <span class="p">:</span><span class="o">=</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nb">int</span><span class="p">{</span> <span class="o">//</span><span class="err">创建并初始化</span> <span class="nb">map</span>
        <span class="s2">&quot;alice&quot;</span><span class="p">:</span>   <span class="mi">31</span><span class="p">,</span>
        <span class="s2">&quot;charlie&quot;</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">ages2</span><span class="p">)</span>

    <span class="n">ages</span><span class="p">[</span><span class="s2">&quot;bob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ages</span><span class="p">[</span><span class="s2">&quot;bob&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">//</span> <span class="n">bob不存在的</span> <span class="n">key</span> <span class="err">默认是</span><span class="mi">0</span><span class="err">，注意不像</span> <span class="n">py</span> <span class="err">访问不存在的</span> <span class="n">key</span> <span class="err">会</span> <span class="ne">KeyError</span>
    <span class="n">delete</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="s2">&quot;alice&quot;</span><span class="p">)</span>         <span class="o">//</span><span class="err">删除</span> <span class="n">key</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">ages</span><span class="p">)</span>

    <span class="o">//</span> <span class="err">遍历无序的</span> <span class="n">kv</span><span class="err">，注意每次返回顺序是不保证一致的</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">ages</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="err">有序遍历，实现有序遍历需要我们把名字先有序排列</span>
    <span class="n">var</span> <span class="n">names</span> <span class="p">[]</span><span class="n">string</span>
    <span class="k">for</span> <span class="n">name</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">ages</span> <span class="p">{</span> <span class="o">//</span> <span class="err">省略</span> <span class="n">age</span> <span class="err">会只遍历</span> <span class="n">key</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">sort</span><span class="o">.</span><span class="n">Strings</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">names</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ages</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="nb">map</span> <span class="err">对于不存在的</span> <span class="n">key</span> <span class="err">返回类型默认值，要想判断是否存在</span> <span class="n">key</span> <span class="err">得这么写</span>
    <span class="k">if</span> <span class="n">age</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="n">ages</span><span class="p">[</span><span class="s2">&quot;noexists&quot;</span><span class="p">];</span> <span class="err">!</span><span class="n">ok</span> <span class="p">{</span> <span class="o">/*</span> <span class="o">*/</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;not a key in this map, age is </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>map 同样不能直接比较，需要自己写比较函数：</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span><span class="w"> </span><span class="n">equal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k">map</span><span class="o">[</span><span class="n">string</span><span class="o">]</span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">xv</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">yv</span><span class="p">,</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="err">!</span><span class="n">ok</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">xv</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">yv</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="w"></span>
<span class="w">        </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<p>go 里没提供 set 类型，我们可以通过 map[string]bool 之类的来模拟。key 不支持 slice 类型，但是如果想用的话可以用转换函数转成 string 后来作为
map 的 key。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;bufio&quot;</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;io&quot;</span>
    <span class="s2">&quot;os&quot;</span>
    <span class="s2">&quot;unicode&quot;</span>
    <span class="s2">&quot;unicode/utf8&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">counts</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="n">rune</span><span class="p">]</span><span class="nb">int</span><span class="p">)</span> <span class="o">//</span> <span class="n">counts</span> <span class="n">of</span> <span class="nb">unicode</span> <span class="n">chars</span>
    <span class="n">var</span> <span class="n">utflen</span> <span class="p">[</span><span class="n">utf8</span><span class="o">.</span><span class="n">UTFMax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="nb">int</span>
    <span class="n">invalid</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span>

    <span class="ow">in</span> <span class="p">:</span><span class="o">=</span> <span class="n">bufio</span><span class="o">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdin</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="ow">in</span><span class="o">.</span><span class="n">ReadRune</span><span class="p">()</span> <span class="o">//</span> <span class="n">rune</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">error</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">EOF</span> <span class="p">{</span>
            <span class="k">break</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stderr</span><span class="p">,</span> <span class="s2">&quot;charcount: %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="nb">unicode</span><span class="o">.</span><span class="n">ReplacementChar</span> <span class="o">&amp;&amp;</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="n">invalid</span><span class="o">++</span>
            <span class="k">continue</span>
        <span class="p">}</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">++</span>
        <span class="n">utflen</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">++</span>
    <span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;rune</span><span class="se">\t</span><span class="s2">count</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">counts</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;%q</span><span class="se">\t</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">len</span><span class="se">\t</span><span class="s2">count</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">utflen</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">invalid</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%d</span><span class="s2"> invalid UTF-8 characters</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">invalid</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>


<h2 id="44-structs">4.4 Structs<a class="headerlink" href="#44-structs" title="Permanent link">&para;</a></h2>
<p>结构体是聚合数据类型：结合多个任意类型的数据组成单个实体，每个值都叫做一个
field，可以被当做一个单元执行拷贝，传递给函数或者返回，存到数组等。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;time&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">Employee</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">ID</span>        <span class="nb">int</span>
    <span class="n">Name</span>      <span class="n">string</span>    <span class="o">//</span> <span class="err">首字母大写</span> <span class="ow">is</span> <span class="n">exported</span>
    <span class="n">Address</span>   <span class="n">string</span>
    <span class="n">DoB</span>       <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
    <span class="n">Position</span>  <span class="n">string</span>
    <span class="n">Salary</span>    <span class="nb">int</span>
    <span class="n">ManagerID</span> <span class="nb">int</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">dilbert</span> <span class="n">Employee</span>
    <span class="n">dilbert</span><span class="o">.</span><span class="n">Salary</span> <span class="o">-=</span> <span class="mi">5000</span> <span class="o">//</span> <span class="n">demoted</span><span class="p">,</span> <span class="k">for</span> <span class="n">writing</span> <span class="n">too</span> <span class="n">few</span> <span class="n">lines</span> <span class="n">of</span> <span class="n">code</span>

    <span class="n">position</span> <span class="p">:</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">dilbert</span><span class="o">.</span><span class="n">Position</span>
    <span class="o">*</span><span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;Senior &quot;</span> <span class="o">+</span> <span class="o">*</span><span class="n">position</span> <span class="o">//</span> <span class="n">promoted</span><span class="p">,</span> <span class="k">for</span> <span class="n">outsourcing</span> <span class="n">to</span> <span class="n">Elbonia</span>

    <span class="n">var</span> <span class="n">employeeOfTheMonth</span> <span class="o">*</span><span class="n">Employee</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dilbert</span>
    <span class="n">employeeOfTheMonth</span><span class="o">.</span><span class="n">Position</span> <span class="o">+=</span> <span class="s2">&quot; (proactive team player)&quot;</span>

<span class="p">}</span>

<span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="err">一个命名的结构体</span> <span class="n">S</span> <span class="err">无法自己包含自己，但是却可以包含指针类型</span> <span class="nb">type</span> <span class="o">*</span><span class="n">S</span><span class="err">。方便实现链表、树等结构</span>
<span class="nb">type</span> <span class="n">tree</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">value</span>       <span class="nb">int</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">*</span><span class="n">tree</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">sort</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">place</span>
<span class="n">func</span> <span class="n">Sort</span><span class="p">(</span><span class="n">values</span> <span class="p">[]</span><span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">root</span> <span class="o">*</span><span class="n">tree</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">values</span> <span class="p">{</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">appendValues</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span> <span class="n">root</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">appendValues</span><span class="p">(</span><span class="n">values</span> <span class="p">[]</span><span class="nb">int</span><span class="p">,</span> <span class="n">t</span> <span class="o">*</span><span class="n">tree</span><span class="p">)</span> <span class="p">[]</span><span class="nb">int</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">appendValues</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">appendValues</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">values</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">tree</span><span class="p">,</span> <span class="n">value</span> <span class="nb">int</span><span class="p">)</span> <span class="o">*</span><span class="n">tree</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">t</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="p">{</span>
        <span class="n">t</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">t</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">t</span>
<span class="p">}</span>
</code></pre></div>


<p>结构体字面量：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="nb">type</span> <span class="n">Point</span> <span class="n">struct</span><span class="p">{</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="nb">int</span> <span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">p</span> <span class="p">:</span><span class="o">=</span> <span class="n">Point</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span> <span class="o">//</span><span class="err">不指定</span> <span class="n">field</span> <span class="err">初始化需要遵守顺序</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Y</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;%v&quot;</span><span class="p">,</span> <span class="n">Scale</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;%v&quot;</span><span class="p">,</span> <span class="n">ScaleByPointer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>

<span class="o">//</span> <span class="err">结构体作为函数参数</span>
<span class="n">func</span> <span class="n">Scale</span><span class="p">(</span><span class="n">p</span> <span class="n">Point</span><span class="p">,</span> <span class="n">factor</span> <span class="nb">int</span><span class="p">)</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Point</span><span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">factor</span><span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="err">结构体作为函数参数</span>
<span class="n">func</span> <span class="n">ScaleByPointer</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span><span class="n">Point</span><span class="p">,</span> <span class="n">factor</span> <span class="nb">int</span><span class="p">)</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Point</span><span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">factor</span><span class="p">}</span>
<span class="p">}</span>
<span class="o">/*</span>
<span class="n">ppp</span> <span class="p">:</span><span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">Point</span><span class="p">)</span>
<span class="o">*</span><span class="n">pp</span> <span class="o">=</span> <span class="n">Point</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
<span class="o">//</span><span class="err">等价写法</span>
<span class="n">pp</span> <span class="p">:</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">Point</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
<span class="o">*/</span>
</code></pre></div>


<p>可比较性：如果结构体的所有 field 都是可以比较的，struct 本身也可以比较。</p>
<p>golang的 struct 允许嵌套：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="nb">type</span> <span class="n">Point</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="nb">int</span>
<span class="p">}</span>
<span class="nb">type</span> <span class="n">Circle</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">Center</span> <span class="n">Point</span>
    <span class="n">Radius</span> <span class="nb">int</span>
<span class="p">}</span>
<span class="nb">type</span> <span class="n">Wheel</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">Circle</span> <span class="n">Circle</span>
    <span class="n">Spokes</span> <span class="nb">int</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">var</span> <span class="n">w</span> <span class="n">Wheel</span>
    <span class="n">w</span><span class="o">.</span><span class="n">Circle</span><span class="o">.</span><span class="n">Center</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">w</span><span class="o">.</span><span class="n">Circle</span><span class="o">.</span><span class="n">Center</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">w</span><span class="o">.</span><span class="n">Circle</span><span class="o">.</span><span class="n">Radius</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">w</span><span class="o">.</span><span class="n">Spokes</span> <span class="o">=</span> <span class="mi">20</span>

<span class="p">}</span>
</code></pre></div>


<p>之前这种连续赋值写起来很繁琐，可以用匿名 field 简化(其实不喜欢这种方式，虽然多写一些麻烦了点，但是很直观)：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="err">{</span>

    <span class="n">var</span> <span class="n">w</span> <span class="n">Wheel</span>
    <span class="n">w</span><span class="p">.</span><span class="n">X</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">//</span> <span class="n">equivalent</span> <span class="k">to</span> <span class="n">w</span><span class="p">.</span><span class="n">Circle</span><span class="p">.</span><span class="n">Point</span><span class="p">.</span><span class="n">X</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">w</span><span class="p">.</span><span class="n">Y</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">//</span> <span class="n">equivalent</span> <span class="k">to</span> <span class="n">w</span><span class="p">.</span><span class="n">Circle</span><span class="p">.</span><span class="n">Point</span><span class="p">.</span><span class="n">Y</span> <span class="o">=</span> <span class="mi">8</span>
<span class="err">}</span>

<span class="o">//</span><span class="n">go允许匿名</span> <span class="n">field</span><span class="err">，但是它的类型必须是命名类型或者其指针</span>
<span class="k">type</span> <span class="n">Point</span> <span class="n">struct</span> <span class="err">{</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="nb">int</span>
<span class="err">}</span>
<span class="k">type</span> <span class="n">Circle</span> <span class="n">struct</span> <span class="err">{</span>
    <span class="n">Point</span>
    <span class="n">Radius</span> <span class="nb">int</span>
<span class="err">}</span>

<span class="k">type</span> <span class="n">Wheel</span> <span class="n">struct</span> <span class="err">{</span>
    <span class="n">Point</span>
    <span class="n">Spokes</span> <span class="nb">int</span>
<span class="err">}</span>
</code></pre></div>


<h2 id="45-json">4.5 JSON<a class="headerlink" href="#45-json" title="Permanent link">&para;</a></h2>
<p>JavaScript Object Notation (JSON) is a standard notation for sending and receiving structured information.
JSON is an encoding of JavaScript values—strings, numbers, booleans, arrays, and objects—as Unicode text
Go data structure like movies to JSON is called marshaling. Marshaling is done by json.Marshal:</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;encoding/json&quot;</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;log&quot;</span>
<span class="p">)</span>
<span class="o">//</span> <span class="err">大写开头的</span> <span class="n">field</span> <span class="err">才会被</span> <span class="n">marshaled</span>
<span class="nb">type</span> <span class="n">Movie</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">Title</span>  <span class="n">string</span>
    <span class="n">Year</span>   <span class="nb">int</span>  <span class="sb">`json:&quot;released&quot;`</span>
    <span class="n">Color</span>  <span class="nb">bool</span> <span class="sb">`json:&quot;color,omitempty&quot;`</span>     <span class="o">//</span> <span class="n">json</span> <span class="n">tag</span> <span class="err">可以用来重命名字段</span>
    <span class="n">Actors</span> <span class="p">[]</span><span class="n">string</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">movies</span> <span class="o">=</span> <span class="p">[]</span><span class="n">Movie</span><span class="p">{</span>
        <span class="p">{</span><span class="n">Title</span><span class="p">:</span> <span class="s2">&quot;Casablanca&quot;</span><span class="p">,</span> <span class="n">Year</span><span class="p">:</span> <span class="mi">1942</span><span class="p">,</span> <span class="n">Color</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="n">Actors</span><span class="p">:</span> <span class="p">[]</span><span class="n">string</span><span class="p">{</span><span class="s2">&quot;Humphrey Bogart&quot;</span><span class="p">,</span> <span class="s2">&quot;Ingrid Bergman&quot;</span><span class="p">}},</span>
        <span class="p">{</span><span class="n">Title</span><span class="p">:</span> <span class="s2">&quot;Cool Hand Luke&quot;</span><span class="p">,</span> <span class="n">Year</span><span class="p">:</span> <span class="mi">1967</span><span class="p">,</span> <span class="n">Color</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="n">Actors</span><span class="p">:</span> <span class="p">[]</span><span class="n">string</span><span class="p">{</span><span class="s2">&quot;Paul Newman&quot;</span><span class="p">}},</span>
        <span class="p">{</span><span class="n">Title</span><span class="p">:</span> <span class="s2">&quot;Bullitt&quot;</span><span class="p">,</span> <span class="n">Year</span><span class="p">:</span> <span class="mi">1968</span><span class="p">,</span> <span class="n">Color</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="n">Actors</span><span class="p">:</span> <span class="p">[]</span><span class="n">string</span><span class="p">{</span><span class="s2">&quot;Steve McQueen&quot;</span><span class="p">,</span> <span class="s2">&quot;Jacqueline Bisset&quot;</span><span class="p">}},</span>
    <span class="p">}</span>
    <span class="o">//</span> <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">movies</span><span class="p">)</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">MarshalIndent</span><span class="p">(</span><span class="n">movies</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;    &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s2">&quot;JSON marshaling failed:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">var</span> <span class="n">titles</span> <span class="p">[]</span><span class="n">struct</span><span class="p">{</span> <span class="n">Title</span> <span class="n">string</span> <span class="p">}</span>
    <span class="k">if</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">titles</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>    <span class="o">//</span> <span class="n">json</span><span class="o">.</span><span class="n">Unmarshal</span> <span class="err">反序列化</span>
        <span class="n">log</span><span class="o">.</span><span class="n">Fatalf</span><span class="p">(</span><span class="s2">&quot;JSON unmarshaling failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">titles</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>注意到 field 后边的 <code>json:"released"</code> 叫做 field tags，是在编译器就绑定到 field 上的元信息，可以控制序列化/反序列化的行为。
field tag 第一部分指定了 field 的 json 名称（比如从骆驼命名改成下划线命名），第二个可选的选项（omitempty），指定了当如果该 field 是零值的时候不会输出该字段.</p>
<h2 id="46-text-and-html-templates">4.6 Text and HTML Templates<a class="headerlink" href="#46-text-and-html-templates" title="Permanent link">&para;</a></h2>
<p>text/template and html/template packages</p>
<h1 id="5-functions">5. Functions<a class="headerlink" href="#5-functions" title="Permanent link">&para;</a></h1>
<h2 id="51-function-declarations">5.1 Function Declarations<a class="headerlink" href="#51-function-declarations" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="err">func name(parameter-list) (result-list) {</span>
<span class="err">    body</span>
<span class="err">}</span>
</code></pre></div>


<p>定义演示：</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="nb">int</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="n">string</span><span class="p">)</span>                <span class="err">{</span> <span class="cm">/* ... */</span> <span class="err">}</span>
<span class="n">func</span> <span class="n">f</span><span class="p">(</span><span class="n">i</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span> <span class="nb">int</span><span class="p">,</span> <span class="n">s</span> <span class="n">string</span><span class="p">,</span> <span class="n">t</span> <span class="n">string</span><span class="p">)</span> <span class="err">{</span> <span class="cm">/* ... */</span> <span class="err">}</span>
<span class="n">func</span> <span class="k">add</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span>                      <span class="err">{</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="err">}</span>
<span class="n">func</span> <span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="p">(</span><span class="n">z</span> <span class="nb">int</span><span class="p">)</span>                      <span class="err">{</span> <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span> <span class="k">return</span> <span class="err">}</span>
<span class="n">func</span> <span class="k">first</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">_</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span>                    <span class="err">{</span> <span class="k">return</span> <span class="n">x</span> <span class="err">}</span>
<span class="n">func</span> <span class="n">zero</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span>                         <span class="err">{</span> <span class="k">return</span> <span class="mi">0</span> <span class="err">}</span>

<span class="o">//</span> <span class="err">函数类型通常叫做函数签名</span><span class="p">(</span><span class="n">signature</span><span class="p">)</span>
<span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="ss">&quot;%T\n&quot;</span><span class="p">,</span> <span class="k">add</span><span class="p">)</span>
<span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="ss">&quot;%T\n&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
<span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="ss">&quot;%T\n&quot;</span><span class="p">,</span> <span class="k">first</span><span class="p">)</span> <span class="o">//</span> <span class="ss">&quot;func(int, int) int&quot;</span>
<span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="ss">&quot;%T\n&quot;</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>  <span class="o">//</span> <span class="ss">&quot;func(int, int) int&quot;</span>
</code></pre></div>


<p>注意 go 里参数传的是值的拷贝，如果是不可变类型不会影响原参数，但是如果是引用类型比如 pointer, slice, map, function or
channel ，函数是可以修改参数指向的内容的。</p>
<h2 id="52-recursion">5.2 Recursion<a class="headerlink" href="#52-recursion" title="Permanent link">&para;</a></h2>
<p>函数可以直接或者间接调用自己，称为递归</p>
<div class="codehilite"><pre><span></span><code><span class="err">func fib(n int) int {</span>
<span class="err">    if n &lt;= 1 {</span>
<span class="err">        return 1</span>
<span class="err">    }</span>
<span class="err">    return fib(n-1) + fib(n-2)</span>
<span class="err">}</span>
</code></pre></div>


<h2 id="53-multiple-return-values">5.3 Multiple Return values<a class="headerlink" href="#53-multiple-return-values" title="Permanent link">&para;</a></h2>
<p>go和 python 一样可以返回多个值：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;net/http&quot;</span>
    <span class="s2">&quot;os&quot;</span>

    <span class="s2">&quot;golang.org/x/net/html&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">url</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="n">links</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">findLinks</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stderr</span><span class="p">,</span> <span class="s2">&quot;findlinks2: %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">link</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">links</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">findLinks</span> <span class="n">performs</span> <span class="n">an</span> <span class="n">HTTP</span> <span class="n">GET</span> <span class="n">request</span> <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">parses</span> <span class="n">the</span>
<span class="o">//</span> <span class="n">response</span> <span class="k">as</span> <span class="n">HTML</span><span class="p">,</span> <span class="ow">and</span> <span class="n">extracts</span> <span class="ow">and</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">links</span><span class="o">.</span>

<span class="n">func</span> <span class="n">findLinks</span><span class="p">(</span><span class="n">url</span> <span class="n">string</span><span class="p">)</span> <span class="p">([]</span><span class="n">string</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">nil</span><span class="p">,</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">StatusCode</span> <span class="o">!=</span> <span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span> <span class="p">{</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span> <span class="o">//</span><span class="err">必须显示</span> <span class="n">close</span><span class="err">，垃圾回收不会回收系统资源比如打开的文件、网络连接等</span>
        <span class="k">return</span> <span class="n">nil</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;getting </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">resp</span><span class="o">.</span><span class="n">Status</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">doc</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">nil</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;parsing </span><span class="si">%s</span><span class="s2"> as HTML: %v&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">visit</span><span class="p">(</span><span class="n">nil</span><span class="p">,</span> <span class="n">doc</span><span class="p">),</span> <span class="n">nil</span>
<span class="p">}</span>
</code></pre></div>


<p>命名返回值：当函数返回多个同类型的值的时候，挑选好名字可以使返回结构更有意义</p>
<div class="codehilite"><pre><span></span><code><span class="err">func Size(rect image.Rectangle) (width, height int)</span>
<span class="err">func Split(path string) (dir, file string)</span>
<span class="err">func HourMinSec(t time.Time) (hour, minute, second int)</span>
</code></pre></div>


<p>bare return: 如果函数命名了返回值，return 后的返回结果可以省略</p>
<div class="codehilite"><pre><span></span><code><span class="err">func CountWordsAndImages(url string) (words, images int, err error) {</span>
<span class="err">    resp, err := http.Get(url)</span>
<span class="err">    if err != nil {</span>
<span class="err">        return // 等价于 return words, images, err</span>
<span class="err">    }</span>
<span class="err">    doc, err := html.Parse(resp.Body)</span>
<span class="err">    resp.Body.Close()</span>
<span class="err">    if err != nil {</span>
<span class="err">        err = fmt.Errorf(&quot;parsing HTML: %s&quot;, err)</span>
<span class="err">        return // 等价于 return words, images, err</span>
<span class="err">    }</span>
<span class="err">    words, images = countWordsAndImages(doc)</span>
<span class="err">    return // 等价于 return words, images, err</span>
<span class="err">}</span>
</code></pre></div>


<h2 id="54-errors">5.4 Errors<a class="headerlink" href="#54-errors" title="Permanent link">&para;</a></h2>
<p>有些函数总会执行成功，比如 strings.Contains and strconv.FormatBool，但是有些无法预料的场景比如内存用光了就很难恢复了。
其他函数只要先验条件是满足的总会执行成功，比如 time.Date，只要参数正确总会构造出 time.Time，除非最后一个 timezone 参数是
nil，这是就会产生 panic，panic 是调用代码的时候产生 bug 的明确标志，在良好书写的程序中是不该出现的。
对于其他一些编写良好的函数，依然无法保证程序成功执行，因为依赖程序员的控制。任何涉及到 IO
的程序都需要处理出错的可能。错误对于重要的包 API 或应用程序接口是非常重要的一部分，而且应该是预期的几个行为之一。</p>
<p>如果错误是期望行为通常我们多返回一个参数，比如如果只有一种错误，我们多返回一个 ok 标志，例如一个缓存查找的方法</p>
<div class="codehilite"><pre><span></span><code><span class="err">value, ok := cache.Lookup(key)</span>
<span class="err">if !ok {</span>
<span class="err">    // key not exists</span>
<span class="err">}</span>
</code></pre></div>


<p>如果是像处理 IO 这种会有很多类型错误，通常多返回一个error 用来解释出错原因。内置类型  error 是接口类型，是 nil 或者
non-nil，nil 表示成功执行否则失败。non-nil会有出错信息通过调用Error方法或者 fmt.Println(err) or
fmt.Printf(&ldquo;%v&rdquo;,err)打印出来。在处理错误之前，如果需要调用者明确处理一些未完成资源，需要明确用文档表示出来。
go 没有想其他很多语言一样用异常处理错误，因为异常经常样以一种用户无法理解的调用栈形式暴露给一脸懵逼的用户，
缺少明智的上下文信息告诉用户到底什么出错了。而 go 用通常的控制流  if, return 等来响应
errors，这种方式需要付出更多精力来应对错误处理逻辑。</p>
<p><strong>go 的5种常见错误处理策略</strong>：</p>
<ul>
<li>
<p>1.propagate the error：传播错误使得被调用者的错误成为调用者错误。通常直接返回或者构造新的错误信息后返回</p>
<div class="codehilite"><pre><span></span><code><span class="err">resp, err := http.Get(url)</span>
<span class="err">if err != nil {</span>
<span class="err">    return nil, err    // just return</span>
<span class="err">}</span>
<span class="err">// construct new error message includes both: 填充有用信息之后再 return ，需要注意出错信息的结构和内容</span>
<span class="err">doc, err := html.Parse(resp.Body)</span>
<span class="err">resp.Body.Close()</span>
<span class="err">if err != nil {</span>
<span class="err">    return nil, fmt.Errorf(&quot;parsing %s as HTML: %v&quot;, url, err)  // 附加上了 url 信息</span>
<span class="err">}</span>
</code></pre></div>


</li>
<li>
<p>2.对于短暂或者非预期的错误，可以尝试采用一定策略重试。最常见的就是爬虫里的重试策略。</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">func WaitForServer(url string) error {</span>
<span class="err">    const timeout = 1 * time.Minute</span>
<span class="err">    deadline := time.Now().Add(timeout)</span>
<span class="err">    for tries := 0; time.Now().Before(deadline); tries++ {</span>
<span class="err">        _, err := http.Head(url)</span>
<span class="err">        if err == nil {</span>
<span class="err">            return nil // success</span>
<span class="err">        }</span>
<span class="err">        log.Printf(&quot;server not responding (%s); retrying...&quot;, err)</span>
<span class="err">        time.Sleep(time.Second &lt;&lt; uint(tries)) // exponential back-off</span>
<span class="err">    }</span>
<span class="err">    return fmt.Errorf(&quot;server %s failed to respond after %s&quot;, url, timeout)</span>
<span class="err">}</span>
</code></pre></div>


<ul>
<li>3.如果无法继续处理，调用者可以打印 error 然后停止执行，通常是 main
    包的保留行为。库函数通常应该传递错误给调用者，除非遇到了内部不一致性，也就是有 bug。</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">// (In function main.)</span>
<span class="err">if err := WaitForServer(url); err != nil {</span>
<span class="err">    fmt.Fprintf(os.Stderr, &quot;Site is down: %v\n&quot;, err)</span>
<span class="err">    os.Exit(1)</span>
<span class="err">}</span>
<span class="err">// 或者更方便完成一样的功能，调用 log.Fatalf</span>
<span class="err">if err := WaitForServer(url); err != nil {</span>
<span class="err">    log.Fatalf(&quot;Site is down: %v\n&quot;, err)</span>
<span class="err">}</span>
</code></pre></div>


<ul>
<li>4.有些情况直接打印 error 然后继续执行，比如无关紧要的问题</li>
<li>5.极少数情况下可以完全忽略整个错误，但是需要做好代码注释。比如创建临时文件失败了可以不用管，操作系统定期会回收。</li>
</ul>
<p>EOF(End of File): io package 保证任何由 end-of-file 造成的读取失败都会被报告成为另一种不同的 error:io.EOF</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">io</span>
<span class="kn">import</span> <span class="s2">&quot;errors&quot;</span>
<span class="o">//</span> <span class="n">EOF</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">error</span> <span class="n">returned</span> <span class="n">by</span> <span class="n">Read</span> <span class="n">when</span> <span class="n">no</span> <span class="n">more</span> <span class="nb">input</span> <span class="ow">is</span> <span class="n">available</span><span class="o">.</span>
<span class="n">var</span> <span class="n">EOF</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s2">&quot;EOF&quot;</span><span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="ow">in</span> <span class="p">:</span><span class="o">=</span> <span class="n">bufio</span><span class="o">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Stdin</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="ow">in</span><span class="o">.</span><span class="n">ReadRune</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">EOF</span> <span class="p">{</span>
            <span class="k">break</span> <span class="o">//</span> <span class="n">finished</span> <span class="n">reading</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;read failed: %v&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">//</span> <span class="o">...</span><span class="n">use</span> <span class="n">r</span><span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="55-function-values">5.5 Function Values<a class="headerlink" href="#55-function-values" title="Permanent link">&para;</a></h2>
<p>函数在 go 里是第一公民，和其他值一样，有自己的类型，可以被赋值给变量，可以当做函数参数或者返回值（function 零值是
nil，调用会直接 panic）。函数可以和 nil 比较但是无法互相比较，不能作为map 的 key</p>
<div class="codehilite"><pre><span></span><code><span class="err">     func add1(r rune) rune { return r + 1 }</span>
<span class="err">     fmt.Println(strings.Map(add1, &quot;HAL-9000&quot;)) // &quot;IBM.:111&quot;</span>
</code></pre></div>


<h2 id="56-anomymous-functions">5.6 Anomymous Functions<a class="headerlink" href="#56-anomymous-functions" title="Permanent link">&para;</a></h2>
<p>function literal: 写起来和函数声明一样，但是func 后没有名称。它是表达式，值叫做匿名函数</p>
<div class="codehilite"><pre><span></span><code><span class="err">     fmt.Println(strings.Map(func(r, rune) rune {return r + 1}, &quot;HAL-9000&quot;)) // &quot;IBM.:111&quot;</span>
</code></pre></div>


<p>go里同样支持闭包:</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">squares</span><span class="p">()</span> <span class="n">func</span><span class="p">()</span> <span class="nb">int</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">x</span> <span class="nb">int</span>
    <span class="k">return</span> <span class="n">func</span><span class="p">()</span> <span class="nb">int</span> <span class="p">{</span>
        <span class="n">x</span><span class="o">++</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">f</span> <span class="p">:</span><span class="o">=</span> <span class="n">squares</span><span class="p">()</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">f</span><span class="p">())</span> <span class="o">//</span> <span class="s2">&quot;1&quot;</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">f</span><span class="p">())</span> <span class="o">//</span> <span class="s2">&quot;4&quot;</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">f</span><span class="p">())</span> <span class="o">//</span> <span class="s2">&quot;9&quot;</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">f</span><span class="p">())</span> <span class="o">//</span> <span class="s2">&quot;16&quot;</span>
<span class="p">}</span>
</code></pre></div>


<p>来看一个 go 的lexical scope 规则导致的意外结果:</p>
<div class="codehilite"><pre><span></span><code><span class="err">// 考虑一个创建一堆目录然后删除他们的程序</span>
<span class="err">func main() {</span>
<span class="err">    var rmdirs []func() // 函数数组</span>
<span class="err">    for _, d := range tempDirs() {</span>
<span class="err">        dir := d               // NOTE: necessary!</span>
<span class="err">        os.MkdirAll(dir, 0755) // creates parent directories too</span>
<span class="err">        rmdirs = append(rmdirs, func() {</span>
<span class="err">            os.RemoveAll(dir)</span>
<span class="err">        })</span>
<span class="err">    }</span>
<span class="err">    // ...do some work...</span>
<span class="err">    for _, rmdir := range rmdirs {</span>
<span class="err">        rmdir() // clean up</span>
<span class="err">    }</span>
<span class="err">}</span>
</code></pre></div>


<p>loop 循环引入了一个新的词法块，d 在这里声明，所有在 loop
里的函数值捕获并且共享同一个变量，而不是特定情况下当时的值。当执行os.RemoveAll的时候 dir 已经被 &ldquo;now-completed&rdquo;的 for
循环更新到了最后一个。解决方式一般有两种：使用一个内部变量覆盖。比如上例 dir:=d。或者作为参数传给匿名函数</p>
<h2 id="57-variadic-functions">5.7 Variadic Functions<a class="headerlink" href="#57-variadic-functions" title="Permanent link">&para;</a></h2>
<p>可变函数：可以接受变长参数的函数。比如 fmt.Printf。可以通过声明最后一个参数是 省略号&rdquo;&hellip;&rdquo;来指示</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vals</span> <span class="o">...</span><span class="n">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span> <span class="o">//</span><span class="nb">type</span> <span class="n">of</span> <span class="n">vals</span> <span class="ow">is</span> <span class="n">an</span> <span class="p">[]</span><span class="nb">int</span> <span class="nb">slice</span>
    <span class="n">total</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">vals</span> <span class="p">{</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">val</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">total</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="nb">sum</span><span class="p">())</span>        <span class="o">//</span> <span class="s2">&quot;0&quot;</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">//</span> <span class="s2">&quot;3&quot;</span>
    <span class="n">values</span> <span class="p">:</span><span class="o">=</span> <span class="p">[]</span><span class="nb">int</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="o">...</span><span class="p">))</span>    <span class="o">//</span> <span class="nb">slice</span> <span class="err">参数可以通过后缀省略号传入可变参数的函数中</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="58-deferred-funciton-calls">5.8 Deferred Funciton Calls<a class="headerlink" href="#58-deferred-funciton-calls" title="Permanent link">&para;</a></h2>
<p>之前我们写过一个获取 html 页面然后拿到 title 的代码:</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">title</span><span class="p">(</span><span class="n">url</span> <span class="n">string</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>
    <span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="o">//</span> <span class="n">Check</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span> <span class="ow">is</span> <span class="n">HTML</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="p">,</span> <span class="s2">&quot;text/html; charset=utf-8&quot;</span><span class="p">)</span><span class="o">.</span>
    <span class="n">ct</span> <span class="p">:</span><span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ct</span> <span class="o">!=</span> <span class="s2">&quot;text/html&quot;</span> <span class="o">&amp;&amp;</span> <span class="err">!</span><span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="s2">&quot;text/html;&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has type </span><span class="si">%s</span><span class="s2">, not text/html&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">ct</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">doc</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="p">)</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;parsing </span><span class="si">%s</span><span class="s2"> as HTML: %v&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">visitNode</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span><span class="n">html</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="n">html</span><span class="o">.</span><span class="n">ElementNode</span> <span class="o">&amp;&amp;</span> <span class="n">n</span><span class="o">.</span><span class="n">Data</span> <span class="o">==</span> <span class="s2">&quot;title&quot;</span> <span class="o">&amp;&amp;</span>
            <span class="n">n</span><span class="o">.</span><span class="n">FirstChild</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">FirstChild</span><span class="o">.</span><span class="n">Data</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">forEachNode</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">visitNode</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>
</code></pre></div>


<p>注意到这里的 <code>resp.Body.Close()</code> 重复了几次吗，如果逻辑更复杂就需要更多处的调用，为了消除这个问题，go 提供了 defer
声明。语法上来说就是 普通的函数或者方法前面加个 defer 前缀，这样就会在包含 defer
的函数完成的时候才调用，无论是函数正常return 或者 panic 了。多个 defer 声明会按照声明顺序逆序执行。</p>
<p>defer 经常用在结对操作中，比如打开或关闭，连接或断开，加锁和解锁，保证资源正确释放，而不用管代码逻辑多复杂。</p>
<div class="codehilite"><pre><span></span><code>//<span class="n">用</span> <span class="n">defer</span> <span class="n">改写上例</span>
<span class="n">func</span> <span class="n">title</span>(<span class="n">url</span> <span class="n">string</span>) <span class="n">error</span> {
    <span class="n">resp</span>, <span class="n">err</span> := <span class="n">http</span>.<span class="n">Get</span>(<span class="n">url</span>)
    <span class="k">if</span> <span class="n">err</span> != <span class="n">nil</span> {
        <span class="k">return</span> <span class="n">err</span>
    }
    <span class="n">defer</span> <span class="n">resp</span>.<span class="n">Body</span>.<span class="n">Close</span>()    // <span class="n">NOTE</span>：<span class="n">使用</span> <span class="n">defer</span>
    <span class="n">ct</span> := <span class="n">resp</span>.<span class="n">Header</span>.<span class="n">Get</span>(<span class="s">&quot;Content-Type&quot;</span>)
    <span class="k">if</span> <span class="n">ct</span> != <span class="s">&quot;text/html&quot;</span> &amp;&amp; !<span class="n">strings</span>.<span class="n">HasPrefix</span>(<span class="n">ct</span>, <span class="s">&quot;text/html;&quot;</span>) {
        <span class="k">return</span> <span class="nb">fmt</span>.<span class="n">Errorf</span>(<span class="s">&quot;%s has type %s, not text/html&quot;</span>, <span class="n">url</span>, <span class="n">ct</span>)
    }
    <span class="n">doc</span>, <span class="n">err</span> := <span class="n">html</span>.<span class="n">Parse</span>(<span class="n">resp</span>.<span class="n">Body</span>)
    <span class="k">if</span> <span class="n">err</span> != <span class="n">nil</span> {
        <span class="k">return</span> <span class="nb">fmt</span>.<span class="n">Errorf</span>(<span class="s">&quot;parsing %s as HTML: %v&quot;</span>, <span class="n">url</span>, <span class="n">err</span>)
    }
    // ...<span class="nb">print</span> <span class="n">doc&#39;s</span> <span class="n">title</span> <span class="n">element</span>...
    <span class="k">return</span> <span class="n">nil</span>
}
</code></pre></div>


<p>比如打开和关闭文件：</p>
<div class="codehilite"><pre><span></span><code><span class="err">func ReadFile(filename string) ([]byte, error) {</span>
<span class="err">    f, err := os.Open(filename)</span>
<span class="err">    if err != ni {</span>
<span class="err">        return nil, err</span>
<span class="err">    }</span>
<span class="err">    defer f.Close()</span>
<span class="err">    return ReadAll(f)</span>
<span class="err">}</span>
</code></pre></div>


<p>再比如加锁操作:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">var</span><span class="w"> </span><span class="n">mu</span><span class="w"> </span><span class="n">sync</span><span class="p">.</span><span class="n">Mutex</span><span class="w"></span>
<span class="nf">var</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make</span><span class="p">(</span><span class="k">map</span><span class="o">[</span><span class="n">string</span><span class="o">]</span><span class="nc">int</span><span class="p">)</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="n">lookup</span><span class="p">(</span><span class="k">key</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="n">mu</span><span class="p">.</span><span class="n">Lock</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="n">defer</span><span class="w"> </span><span class="n">mu</span><span class="p">.</span><span class="n">Unlock</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<p>还可以用 defer 来调试复杂函数：</p>
<div class="codehilite"><pre><span></span><code><span class="err">func bigSlowOperation() {</span>
<span class="err">    defer trace(&quot;bigSlowOperation&quot;)() // don&#39;t forget the extra parentheses</span>
<span class="err">    // ...lots of work...</span>
<span class="err">    time.Sleep(10 * time.Second) // simulate slow operation by sleeping</span>
<span class="err">}</span>
<span class="err">func trace(msg string) func() {</span>
<span class="err">    start := time.Now()</span>
<span class="err">    log.Printf(&quot;enter %s&quot;, msg)</span>
<span class="err">    return func() { log.Printf(&quot;exit %s (%s)&quot;, msg, time.Since(start)) }</span>
<span class="err">}</span>
</code></pre></div>


<p>defer 是在函数 return 语句更新了函数的结果变量之后执行的。我们可以用defer 加上一个匿名函数实现函数完成后打印参数和返回值</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="n">double</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="err">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
<span class="err">}</span>

<span class="n">func</span> <span class="n">double</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">)</span> <span class="p">(</span><span class="k">result</span> <span class="nb">int</span><span class="p">)</span> <span class="err">{</span>
    <span class="n">defer</span> <span class="n">func</span><span class="p">()</span> <span class="err">{</span> <span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="ss">&quot;double(%d) = %d\n&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="k">result</span><span class="p">)</span> <span class="err">}</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
<span class="err">}</span>
</code></pre></div>


<p>注意由于 defer 是在函数的最后执行的，可能有一些危险问题，比如文件描述符被用光：</p>
<div class="codehilite"><pre><span></span><code><span class="err">    for _, filename := range filenames {</span>
<span class="err">        f, err := os.Open(filename)</span>
<span class="err">        if err != nil {</span>
<span class="err">            return err</span>
<span class="err">        }</span>
<span class="err">        defer f.Close() // NOTE: risky; could run out of file descriptors</span>
<span class="err">        // ...process f...</span>
<span class="err">    }</span>
</code></pre></div>


<p>一种解决方式是把循环体包括 defer 单独提取成一个函数</p>
<div class="codehilite"><pre><span></span><code><span class="err">for _, filename := range filenames {</span>
<span class="err">    if err := doFile(filename); err != nil {</span>
<span class="err">        return err</span>
<span class="err">    }</span>
<span class="err">}</span>
<span class="err">func doFile(filename string) error {</span>
<span class="err">    f, err := os.Open(filename)</span>
<span class="err">    if err != nil {</span>
<span class="err">        return err</span>
<span class="err">    }</span>
<span class="err">    defer f.Close()</span>
<span class="err">    // ...process f...</span>
<span class="err">}</span>
</code></pre></div>


<h2 id="59-panic">5.9 Panic<a class="headerlink" href="#59-panic" title="Permanent link">&para;</a></h2>
<p>go 的类型系统能在编译器找到大量错误，但是对于数组越界访问，nil 指针反解需要运行时确定，当 go
在运行期间遇到了这种问题就会 panic。在一个典型的 panic 期间，正常的执行流程会停止，所有在那个 goroutine 里的 defer
函数会被执行，然后程序 crash 并附上 log 信息，包括 panic 值和栈信息等。不是所有的 panic 都来自运行期间，内置的 panic
函数可以直接调用，接受任何参数。<strong>panic 最适合做一些不可能出现的场景，比如逻辑上不会被执行到的 switch 分之。</strong>
一个好的实践使用 assert 来验证函数的参数，但是这经常被过度使用</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>
<span class="n">switch</span> <span class="n">s</span> <span class="p">:</span><span class="o">=</span> <span class="n">suit</span><span class="p">(</span><span class="n">drawCard</span><span class="p">());</span> <span class="n">s</span> <span class="p">{</span>
     <span class="n">case</span> <span class="s2">&quot;Clubs&quot;</span><span class="p">:</span>    <span class="o">//</span> <span class="o">...</span>
     <span class="n">default</span><span class="p">:</span>
         <span class="n">panic</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;invalid suit %q&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="o">//</span> <span class="n">Joker</span><span class="err">?</span>
     <span class="p">}</span>
 <span class="p">}</span>
</code></pre></div>


<p>对于运行期间会执行检查的参数，我们没必要自己再去 panic（除非你想附加一些信息）:</p>
<div class="codehilite"><pre><span></span><code><span class="err">func Reset(x *Buffer) {</span>
<span class="err">    if x == nil {</span>
<span class="err">        panic(&quot;x is nil&quot;)  // 没必要加</span>
<span class="err">    }</span>
<span class="err">    x.elements = nil</span>
<span class="err">}</span>
</code></pre></div>


<p>panic 会造成程序 crash，通常处理严重的错误，比如逻辑不一致，勤奋的程序员认为任何 crash 都是有 bug
的证明。在一个鲁棒的系统中，期望的错误，比如输入不合法、配置不合法、或者失败的 IO，应该被温和对待，最好用错误值处理。</p>
<h2 id="510-recover">5.10 Recover<a class="headerlink" href="#510-recover" title="Permanent link">&para;</a></h2>
<p>panic 后我们可以选择不 crash，比如 http 服务器应该关闭连接而不是直接crash 让客户端等待。
如果内置的 recover 函数在一个 defer 函数中使用并且 defer 正在 panicking，recover 会结束当前 panic 的状态然后返回panic
值。其他情况调用 recover 直接返回 nil 并且无任何影响。</p>
<div class="codehilite"><pre><span></span><code><span class="err">func Parse(input string) (s *Syntax, err error) {</span>
<span class="err">    defer func() {</span>
<span class="err">        if p := recover(); p != nil {</span>
<span class="err">            err = fmt.Errorf(&quot;internal error: %v&quot;, p)</span>
<span class="err">        }</span>
<span class="err">    }()</span>
<span class="err">}</span>
<span class="err">// ...parser...</span>
</code></pre></div>


<p>应该有选择的使用，过度使用会导致问题被隐藏起来。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">soleTitle</span><span class="p">(</span><span class="n">doc</span> <span class="o">*</span><span class="n">html</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="p">(</span><span class="n">title</span> <span class="n">string</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">type</span> <span class="n">bailout</span> <span class="n">struct</span><span class="p">{}</span>
    <span class="n">defer</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">switch</span> <span class="n">p</span> <span class="p">:</span><span class="o">=</span> <span class="n">recover</span><span class="p">();</span> <span class="n">p</span> <span class="p">{</span>
        <span class="n">case</span> <span class="n">nil</span><span class="p">:</span>
            <span class="o">//</span> <span class="n">no</span> <span class="n">panic</span>
        <span class="n">case</span> <span class="n">bailout</span><span class="p">{}:</span>
            <span class="o">//</span> <span class="s2">&quot;expected&quot;</span> <span class="n">panic</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;multiple title elements&quot;</span><span class="p">)</span>
        <span class="n">default</span><span class="p">:</span>
            <span class="n">panic</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">//</span> <span class="n">unexpected</span> <span class="n">panic</span><span class="p">;</span> <span class="n">carry</span> <span class="n">on</span> <span class="n">panicking</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="o">//</span> <span class="n">Bail</span> <span class="n">out</span> <span class="n">of</span> <span class="n">recursion</span> <span class="k">if</span> <span class="n">we</span> <span class="n">find</span> <span class="n">more</span> <span class="n">than</span> <span class="n">one</span> <span class="n">non</span><span class="o">-</span><span class="n">empty</span> <span class="n">title</span><span class="o">.</span>
    <span class="n">forEachNode</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span><span class="n">html</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="n">html</span><span class="o">.</span><span class="n">ElementNode</span> <span class="o">&amp;&amp;</span> <span class="n">n</span><span class="o">.</span><span class="n">Data</span> <span class="o">==</span> <span class="s2">&quot;title&quot;</span> <span class="o">&amp;&amp;</span>
            <span class="n">n</span><span class="o">.</span><span class="n">FirstChild</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="p">{</span>
                <span class="n">panic</span><span class="p">(</span><span class="n">bailout</span><span class="p">{})</span> <span class="o">//</span> <span class="n">multiple</span> <span class="n">title</span> <span class="n">elements</span>
            <span class="p">}</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">FirstChild</span><span class="o">.</span><span class="n">Data</span>
        <span class="p">}</span>
    <span class="p">},</span> <span class="n">nil</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;no title element&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">title</span><span class="p">,</span> <span class="n">nil</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="6-methods">6. Methods<a class="headerlink" href="#6-methods" title="Permanent link">&para;</a></h1>
<p>1990年代以后，OOP 编程统治了工业和教育领域，几乎被所有所有广泛使用的编程语言支持。
关于面向对象编程实际并没有一个通用的被广泛接受的定义，我们这里简单地认为对象就是一个包含方法的值或者变量，方法是和特定类型绑定
在一起的函数。一个面向对象的程序使用方法来操作数据（客户端不用直接和对象的表示交互）。本章讨论方法和 OOP
的两大原则：封装和组合。</p>
<h2 id="61-method-declarations">6.1 Method Declarations<a class="headerlink" href="#61-method-declarations" title="Permanent link">&para;</a></h2>
<p>方法的声明就是在func 关键字后加上绑定的类型</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;math&quot;</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">Point</span> <span class="n">struct</span><span class="p">{</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="n">float64</span> <span class="p">}</span>

<span class="o">//</span> <span class="err">传统函数</span>
<span class="n">func</span> <span class="n">Distance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="n">Point</span><span class="p">)</span> <span class="n">float64</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">Hypot</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
<span class="p">}</span>

<span class="o">//</span> <span class="err">作为</span> <span class="n">Point</span> <span class="err">类型的方法，</span><span class="n">func</span> <span class="err">之后加了一个</span> <span class="p">(</span><span class="n">p</span> <span class="n">Point</span><span class="p">)</span> <span class="err">作为</span> <span class="n">receiver</span>
<span class="n">func</span> <span class="p">(</span><span class="n">p</span> <span class="n">Point</span><span class="p">)</span> <span class="n">Distance</span><span class="p">(</span><span class="n">q</span> <span class="n">Point</span><span class="p">)</span> <span class="n">float64</span> <span class="p">{</span> <span class="o">//</span> <span class="n">p</span> <span class="err">叫做方法的接受者</span> <span class="n">receiver</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">Hypot</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">X</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">Y</span><span class="o">-</span><span class="n">p</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">p</span> <span class="p">:</span><span class="o">=</span> <span class="n">Point</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
    <span class="n">q</span> <span class="p">:</span><span class="o">=</span> <span class="n">Point</span><span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">}</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">Distance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span> <span class="o">//</span> <span class="n">function</span> <span class="n">call</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">Distance</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>  <span class="o">//</span> <span class="n">method</span> <span class="n">call</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">Distance</span> <span class="err">叫做</span> <span class="n">selector</span>
<span class="p">}</span>
</code></pre></div>


<p>因为每种类型对于方法都有自己的名字空间，我们可以使用一样的名字，只要不是同一个类型就行。</p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span><span class="w"> </span><span class="k">Path</span><span class="w"> </span><span class="err">[]</span><span class="n">Point</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">slice</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">也可以定义</span><span class="w"> </span><span class="k">method</span><span class="w"></span>
<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="k">path</span><span class="w"> </span><span class="k">Path</span><span class="p">)</span><span class="w"> </span><span class="n">Distance</span><span class="p">()</span><span class="w"> </span><span class="n">float64</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="nf">sum</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="k">path</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">            </span><span class="nf">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">path</span><span class="o">[</span><span class="n">i-1</span><span class="o">]</span><span class="p">.</span><span class="n">Distance</span><span class="p">(</span><span class="k">path</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nf">sum</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<h2 id="62-methods-with-a-pointer-receiver">6.2 Methods with a Pointer Receiver<a class="headerlink" href="#62-methods-with-a-pointer-receiver" title="Permanent link">&para;</a></h2>
<p>当我们想避免值拷贝或者想修改参数内容的时候，可以传递类型指针</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span><span class="n">Point</span><span class="p">)</span> <span class="n">ScaleBy</span><span class="p">(</span><span class="n">factor</span> <span class="n">float64</span><span class="p">)</span> <span class="err">{</span> <span class="o">//</span> <span class="err">方法名是</span> <span class="p">(</span><span class="o">*</span><span class="n">Point</span><span class="p">).</span><span class="n">ScaleBy</span>
    <span class="n">p</span><span class="p">.</span><span class="n">X</span> <span class="o">*=</span> <span class="n">factor</span>
    <span class="n">p</span><span class="p">.</span><span class="n">Y</span> <span class="o">*=</span> <span class="n">factor</span>
<span class="err">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="err">{</span>
    <span class="o">//</span> <span class="err">三种调用方式</span>
    <span class="n">r</span> <span class="p">:</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">Point</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="err">}</span>
    <span class="n">r</span><span class="p">.</span><span class="n">ScaleBy</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="o">*</span><span class="n">r</span><span class="p">)</span> <span class="o">//</span> <span class="ss">&quot;{2, 4}&quot;</span>

    <span class="n">p</span> <span class="p">:</span><span class="o">=</span> <span class="n">Point</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="err">}</span>
    <span class="n">pptr</span> <span class="p">:</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">p</span>
    <span class="n">pptr</span><span class="p">.</span><span class="n">ScaleBy</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">//</span> <span class="ss">&quot;{2, 4}&quot;</span>

    <span class="n">p</span> <span class="p">:</span><span class="o">=</span> <span class="n">Point</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="err">}</span>
    <span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">).</span><span class="n">ScaleBy</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">//</span> <span class="ss">&quot;{2, 4}&quot;</span>

<span class="err">}</span>
</code></pre></div>


<h2 id="composing-types-by-struct-embedding">Composing Types by Struct Embedding<a class="headerlink" href="#composing-types-by-struct-embedding" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;image/color&quot;</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">Point</span> <span class="n">struct</span><span class="p">{</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="n">float64</span> <span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">p</span> <span class="n">Point</span><span class="p">)</span> <span class="n">ScaleBy</span><span class="p">(</span><span class="n">factor</span> <span class="n">float64</span><span class="p">)</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Point</span><span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">factor</span><span class="p">}</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">ColoredPoint</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">Point</span>    <span class="o">//</span> <span class="err">匿名嵌入结构体</span>
    <span class="n">Color</span> <span class="n">color</span><span class="o">.</span><span class="n">RGBA</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">red</span> <span class="p">:</span><span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">RGBA</span><span class="p">{</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">}</span>
    <span class="n">var</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ColoredPoint</span><span class="p">{</span><span class="n">Point</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="n">red</span><span class="p">}</span>
    <span class="n">p</span><span class="o">.</span><span class="n">ScaleBy</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="o">//</span> <span class="err">和访问匿名结构体的</span><span class="n">field</span> <span class="err">一样，同样可以访问匿名结构体的方法</span><span class="p">(</span><span class="err">匿名方法提升</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;%v&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">ScaleBy</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<p>通过使用匿名方法提升，和嵌入结构，可以实现一让匿名结构体也能拥有方法，看个例子：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;sync&quot;</span>

<span class="n">var</span> <span class="p">(</span>
    <span class="n">mu</span>      <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">string</span><span class="p">)</span>
<span class="p">)</span>

<span class="o">//</span> <span class="err">使用两个</span> <span class="n">package</span><span class="o">-</span><span class="n">level</span> <span class="err">变量实现</span> <span class="nb">map</span>
<span class="n">func</span> <span class="n">Lookup</span><span class="p">(</span><span class="n">key</span> <span class="n">string</span><span class="p">)</span> <span class="n">string</span> <span class="p">{</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    <span class="n">v</span> <span class="p">:</span><span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">mu</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">v</span>
<span class="p">}</span>
</code></pre></div>


<p>下边示例和上边功能上等价：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;sync&quot;</span>

<span class="n">var</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">struct</span> <span class="p">{</span> <span class="o">//</span> <span class="err">匿名的</span> <span class="n">struct</span>
    <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>
    <span class="n">mapping</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">string</span>
<span class="p">}{</span>
    <span class="n">mapping</span><span class="p">:</span> <span class="n">make</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">string</span><span class="p">),</span> <span class="o">//</span><span class="err">这个大括号里的是初始化语句</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">Lookup</span><span class="p">(</span><span class="n">key</span> <span class="n">string</span><span class="p">)</span> <span class="n">string</span> <span class="p">{</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span> <span class="o">//</span><span class="err">统一名字</span> <span class="n">cache</span><span class="err">。因为</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span> <span class="err">是匿名</span> <span class="n">field</span><span class="err">，</span><span class="n">Lock</span><span class="o">/</span><span class="n">UnLock</span> <span class="err">方法被提升到匿名</span> <span class="n">struct</span> <span class="err">类型</span>
    <span class="n">v</span> <span class="p">:</span><span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">mapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">cache</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">v</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="64-method-values-and-expressions">6.4 Method Values and Expressions<a class="headerlink" href="#64-method-values-and-expressions" title="Permanent link">&para;</a></h2>
<p>method value: p.Distance yields a method value。当一个包的 api 需要的是 function 参数的时候比较有用</p>
<div class="codehilite"><pre><span></span><code><span class="err">    p := Point{1, 2}</span>
<span class="err">    q := Point{4, 6}</span>
<span class="err">    distanceFromP := p.Distance</span>
<span class="err">    fmt.Println(distanceFromP(q))</span>
</code></pre></div>


<p>method expression: T.f or (*T).f yields a function value with a regular first parameter taking the place of the
receiver。</p>
<div class="codehilite"><pre><span></span><code><span class="err">    p := Point{1, 2}</span>
<span class="err">    q := Point{4, 6}</span>
<span class="err">    distance := Point.Distance</span>
<span class="err">    fmt.Println(distance(p, q))</span>
</code></pre></div>


<p>当想针对同类型的值执行不同的 method 的时候比较有用，举个例子：</p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="n">struct</span><span class="err">{</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="n">float64</span><span class="w"> </span><span class="err">}</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="n">Point</span><span class="p">)</span><span class="w"> </span><span class="k">Add</span><span class="p">(</span><span class="n">q</span><span class="w"> </span><span class="n">Point</span><span class="p">)</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Point</span><span class="err">{</span><span class="n">p</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">Y</span><span class="err">}</span><span class="w"> </span><span class="err">}</span><span class="w"></span>
<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="n">Point</span><span class="p">)</span><span class="w"> </span><span class="n">Sub</span><span class="p">(</span><span class="n">q</span><span class="w"> </span><span class="n">Point</span><span class="p">)</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Point</span><span class="err">{</span><span class="n">p</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">Y</span><span class="err">}</span><span class="w"> </span><span class="err">}</span><span class="w"></span>

<span class="n">type</span><span class="w"> </span><span class="k">Path</span><span class="w"> </span><span class="err">[]</span><span class="n">Point</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="k">path</span><span class="w"> </span><span class="k">Path</span><span class="p">)</span><span class="w"> </span><span class="n">TranslateBy</span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">bool</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="nf">var</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="n">Point</span><span class="p">)</span><span class="w"> </span><span class="n">Point</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">.</span><span class="k">Add</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">.</span><span class="n">Sub</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="k">path</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">Call</span><span class="w"> </span><span class="n">either</span><span class="w"> </span><span class="k">path</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="k">Add</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">path</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="n">Sub</span><span class="p">(</span><span class="n">offset</span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">path</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">op</span><span class="p">(</span><span class="k">path</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<h2 id="65-example-bit-vector-type">6.5 Example: Bit Vector Type<a class="headerlink" href="#65-example-bit-vector-type" title="Permanent link">&para;</a></h2>
<p>之前都是用 map[T]bool 来模拟 set 操作，对于整数集合可以用比特数组来模拟</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">main</span><span class="w"></span>

<span class="n">type</span><span class="w"> </span><span class="n">IntSet</span><span class="w"> </span><span class="n">struct</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="n">words</span><span class="w"> </span><span class="err">[]</span><span class="n">uint64</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="n">IntSet</span><span class="p">)</span><span class="w"> </span><span class="n">Has</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">/</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="n">uint</span><span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="mi">64</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="o">[</span><span class="n">word</span><span class="o">]&amp;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nc">bit</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="n">IntSet</span><span class="p">)</span><span class="w"> </span><span class="k">Add</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="n">word</span><span class="p">,</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">/</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="n">uint</span><span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="mi">64</span><span class="p">)</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="k">index</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="o">[</span><span class="n">word</span><span class="o">]</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nc">bit</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">*</span><span class="n">IntSet</span><span class="p">)</span><span class="w"> </span><span class="n">UnionWith</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="n">IntSet</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">tword</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">words</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">            </span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">tword</span><span class="w"></span>
<span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">            </span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">words</span><span class="p">,</span><span class="w"> </span><span class="n">tword</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<h2 id="66-encapsulation">6.6 Encapsulation<a class="headerlink" href="#66-encapsulation" title="Permanent link">&para;</a></h2>
<p>如果一个对象的变量或者方法无法被客户端代码访问就是被封装的（信息隐藏）。go 里为了封装一个对象，需要把它变成 struct。
封装有三个好处：</p>
<ul>
<li>阻止客户端直接修改对象变量；</li>
<li>防止客户端依赖将来可能会变动的内部细节；</li>
<li>阻止客户端代码随意设置对象的值</li>
</ul>
<p><code>type IntSet struct {   //  隐藏 words，防止客户端直接修改
    words []uint64
}</code></p>
<h1 id="7-interfaces">7 Interfaces<a class="headerlink" href="#7-interfaces" title="Permanent link">&para;</a></h1>
<p>接口类型表示其他类型的通用或者抽象，接口允许我们写出更灵活和适配的函数。go
里无需声明一个特定类型需要满足的所有接口，只提供必要的方法就足够了，这种方式允许我们在已有的具体类型上创建新的接口类型。</p>
<h2 id="71-interfaces-as-contracts">7.1 Interfaces as Contracts<a class="headerlink" href="#71-interfaces-as-contracts" title="Permanent link">&para;</a></h2>
<p>之前介绍的都是具体类型，指定了值的特定操作(what it is and what you can do with it)。go
里有另一种接口类型，一个接口是抽象类型，它不会暴露内部表示或是支持的操作，它只展现它的一些方法。一个接口类型的值，
我们只能知道它的方法提供了什么行为。（这有点像是鸭子类型，不管你啥类型，只在意你有啥方法）</p>
<div class="codehilite"><pre><span></span><code><span class="err">package fmt</span>
<span class="err">type Stringer interface {</span>
<span class="err">    String() string</span>
<span class="err">}</span>
<span class="err">// Fmt.Fprintf 只要是我们实现了 String() 接口，都可以作为 Fprintf 的参数</span>
</code></pre></div>


<h2 id="72-interface-types">7.2 InterFace Types<a class="headerlink" href="#72-interface-types" title="Permanent link">&para;</a></h2>
<p>接口类型指定了一系列方法，可以通过实现这些具体的方法来定义具体类型。(python里可以用 filelike object
理解，只要你实现了read/write/close 等方法我就可以认为你是一个 filelike object，不管你是文件还是 socket 等)
我们探索下 io package 定义的接口：</p>
<div class="codehilite"><pre><span></span><code><span class="err">package io</span>
<span class="err">type Reader interface {</span>
<span class="err">    Read(p []byte) (n int, err error)</span>
<span class="err">}</span>
<span class="err">type Closer interface {</span>
<span class="err">    Close() error</span>
<span class="err">}</span>
</code></pre></div>


<p>通过组合现有接口可以实现新的接口:</p>
<div class="codehilite"><pre><span></span><code><span class="err">type ReadWriter interface {</span>
<span class="err">    Reader    // embedding an interface</span>
<span class="err">    Writer</span>
<span class="err">}</span>
<span class="err">type ReadWriteCloser interface{</span>
<span class="err">    Reader</span>
<span class="err">    Writer</span>
<span class="err">    Closer</span>
<span class="err">}</span>
<span class="err">//甚至能混合用</span>
<span class="err">type ReadWriter interface {</span>
<span class="err">    Read(p []byte) (n int, err error)</span>
<span class="err">    Writer</span>
<span class="err">}</span>
</code></pre></div>


<h2 id="73-interface-satisfaction">7.3 InterFace Satisfaction<a class="headerlink" href="#73-interface-satisfaction" title="Permanent link">&para;</a></h2>
<p>一个类型只有在实现了<strong>所有</strong>接口声明的方法时才『满足』一个接口类型。go 程序员里如果说 &ldquo;a concrete type is a praticular
interface type&rdquo;, 意味着满足接口类型。接口赋值的规则很简单：一个表达式可以被赋值给接口仅当它的类型满足接口类型（实现所有方法）
。空接口类型 interface{} 可以被任何值赋值。</p>
<h2 id="74-parsing-flags-with-flagvalue">7.4 Parsing Flags with flag.Value<a class="headerlink" href="#74-parsing-flags-with-flagvalue" title="Permanent link">&para;</a></h2>
<p>flag.Value 标准接口，提供命令行标志注解</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;flag&quot;</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">var</span> <span class="n">period</span> <span class="o">=</span> <span class="n">flag</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">,</span> <span class="s2">&quot;sleep period&quot;</span><span class="p">)</span>

<span class="o">//</span> <span class="n">go</span> <span class="n">build</span> <span class="n">sleep</span><span class="o">.</span><span class="n">go</span>
<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">flag</span><span class="o">.</span><span class="n">Parse</span><span class="p">()</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;sleeping for %v...&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">period</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="o">*</span><span class="n">period</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">()</span>
<span class="p">}</span>
<span class="o">/*</span>
<span class="o">./</span><span class="n">sleep</span> <span class="o">-</span><span class="n">period</span> <span class="mi">50</span><span class="n">ms</span>
<span class="o">./</span><span class="n">sleep</span> <span class="o">-</span><span class="n">period</span> <span class="mi">2</span><span class="n">m30s</span>
<span class="o">./</span><span class="n">sleep</span> <span class="o">-</span><span class="n">period</span> <span class="mf">1.5</span><span class="n">h</span>
<span class="o">*/</span>

<span class="n">package</span> <span class="n">flag</span>
<span class="nb">type</span> <span class="n">Value</span> <span class="n">interface</span> <span class="p">{</span>
    <span class="n">String</span><span class="p">()</span> <span class="n">string</span>
    <span class="n">Set</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="n">error</span>    <span class="o">//</span> <span class="err">解析</span> <span class="n">string</span> <span class="err">参数更新</span> <span class="n">flag</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="75-interface-values">7.5 Interface Values<a class="headerlink" href="#75-interface-values" title="Permanent link">&para;</a></h2>
<p>概念上来着，接口值有两个组成部分，一个具体的类型和该类型的值，叫做接口的动态类型和动态值。
对于静态类型的 go，类型是个编译期概念，所以一个类型并不是一个值。类型描述符提供了每个类型的信息。
接口值是可以互相比较的，当动态类型和动态值(前提是动态值可比较，slices,maps,functions无法比较，会 panic）都相等就认为相等
使用 fmt.Printf(&ldquo;%T&rdquo;) 恩可以用来报告接口值的动态值。
需要注意的是空接口值（不包含值）和包含空指针的接口值不完全相同，后者和 nil 判断并不相等。(An Interface Containing a Nil Pointer Is Non-Nil)</p>
<h2 id="76-sorting-with-sortinterface">7.6 Sorting with sort.Interface<a class="headerlink" href="#76-sorting-with-sortinterface" title="Permanent link">&para;</a></h2>
<p>sort package 提供了任何序列的原地排序。</p>
<div class="codehilite"><pre><span></span><code><span class="n">type</span><span class="w"> </span><span class="n">StringSlice</span><span class="w"> </span><span class="err">[]</span><span class="n">string</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="n">StringSlice</span><span class="p">)</span><span class="w"> </span><span class="nf">Len</span><span class="p">()</span><span class="w"> </span><span class="nc">int</span><span class="w">           </span><span class="err">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="err">}</span><span class="w"></span>
<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="n">StringSlice</span><span class="p">)</span><span class="w"> </span><span class="k">Less</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="w"> </span><span class="err">}</span><span class="w"></span>
<span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="n">StringSlice</span><span class="p">)</span><span class="w"> </span><span class="n">Swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="nc">int</span><span class="p">)</span><span class="w">      </span><span class="err">{</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="err">}</span><span class="w"></span>
<span class="n">sort</span><span class="p">.</span><span class="n">Sort</span><span class="p">(</span><span class="n">StringSlice</span><span class="p">(</span><span class="k">names</span><span class="p">))</span><span class="w"></span>
<span class="o">//</span><span class="w"> </span><span class="n">当然排序字符串序列太常用了</span><span class="err">，</span><span class="n">sort</span><span class="w"> </span><span class="n">提供了</span><span class="w"> </span><span class="n">sort</span><span class="p">.</span><span class="n">Strings</span><span class="p">(</span><span class="k">names</span><span class="p">)</span><span class="w"></span>
</code></pre></div>


<p>定义结构体的排序</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;sort&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">Track</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">Title</span>  <span class="n">string</span>
    <span class="n">Artist</span> <span class="n">string</span>
    <span class="n">Album</span>  <span class="n">string</span>
    <span class="n">Year</span>   <span class="nb">int</span>
    <span class="n">Length</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span>
<span class="p">}</span>

<span class="n">var</span> <span class="n">tracks</span> <span class="o">=</span> <span class="p">[]</span><span class="o">*</span><span class="n">Track</span><span class="p">{</span>
    <span class="p">{</span><span class="s2">&quot;Go&quot;</span><span class="p">,</span> <span class="s2">&quot;Delilah&quot;</span><span class="p">,</span> <span class="s2">&quot;From the Roots Up&quot;</span><span class="p">,</span> <span class="mi">2012</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="s2">&quot;3m38s&quot;</span><span class="p">)},</span>
    <span class="p">{</span><span class="s2">&quot;Go&quot;</span><span class="p">,</span> <span class="s2">&quot;Moby&quot;</span><span class="p">,</span> <span class="s2">&quot;Moby&quot;</span><span class="p">,</span> <span class="mi">1992</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="s2">&quot;3m37s&quot;</span><span class="p">)},</span>
    <span class="p">{</span><span class="s2">&quot;Go Ahead&quot;</span><span class="p">,</span> <span class="s2">&quot;Alicia Keys&quot;</span><span class="p">,</span> <span class="s2">&quot;As I Am&quot;</span><span class="p">,</span> <span class="mi">2007</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="s2">&quot;4m36s&quot;</span><span class="p">)},</span>
    <span class="p">{</span><span class="s2">&quot;Ready 2 Go&quot;</span><span class="p">,</span> <span class="s2">&quot;Martin Solveig&quot;</span><span class="p">,</span> <span class="s2">&quot;Smash&quot;</span><span class="p">,</span> <span class="mi">2011</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="s2">&quot;4m24s&quot;</span><span class="p">)},</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">length</span><span class="p">(</span><span class="n">s</span> <span class="n">string</span><span class="p">)</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span> <span class="p">{</span>
    <span class="n">d</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ParseDuration</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">d</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">byArtist</span> <span class="p">[]</span><span class="o">*</span><span class="n">Track</span>

<span class="n">func</span> <span class="p">(</span><span class="n">x</span> <span class="n">byArtist</span><span class="p">)</span> <span class="n">Len</span><span class="p">()</span> <span class="nb">int</span>           <span class="p">{</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span>
<span class="n">func</span> <span class="p">(</span><span class="n">x</span> <span class="n">byArtist</span><span class="p">)</span> <span class="n">Less</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">bool</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">Artist</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">Artist</span> <span class="p">}</span>
<span class="n">func</span> <span class="p">(</span><span class="n">x</span> <span class="n">byArtist</span><span class="p">)</span> <span class="n">Swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="nb">int</span><span class="p">)</span>      <span class="p">{</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">}</span>
<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">sort</span><span class="o">.</span><span class="n">Sort</span><span class="p">(</span><span class="n">byArtist</span><span class="p">(</span><span class="n">tracks</span><span class="p">))</span>
    <span class="n">sort</span><span class="o">.</span><span class="n">Sort</span><span class="p">(</span><span class="n">sort</span><span class="o">.</span><span class="n">Reverse</span><span class="p">(</span><span class="n">byArtist</span><span class="p">(</span><span class="n">tracks</span><span class="p">)))</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="77-the-httphandler-interface">7.7 The http.Handler Interface<a class="headerlink" href="#77-the-httphandler-interface" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">http</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;log&quot;</span>
    <span class="s2">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="o">/*</span>
<span class="nb">type</span> <span class="n">Handler</span> <span class="n">interface</span> <span class="p">{</span>
    <span class="n">ServeHTTP</span><span class="p">(</span><span class="n">w</span> <span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">Request</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">ListenAndServe</span><span class="p">(</span><span class="n">address</span> <span class="n">string</span><span class="p">,</span> <span class="n">h</span> <span class="n">Handler</span><span class="p">)</span> <span class="n">error</span>
<span class="o">*/</span>
<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">db</span> <span class="p">:</span><span class="o">=</span> <span class="n">database</span><span class="p">{</span><span class="s2">&quot;shoes&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;socks&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
    <span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s2">&quot;localhost:8000&quot;</span><span class="p">,</span> <span class="n">db</span><span class="p">))</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">dollars</span> <span class="n">float32</span>

<span class="n">func</span> <span class="p">(</span><span class="n">d</span> <span class="n">dollars</span><span class="p">)</span> <span class="n">String</span><span class="p">()</span> <span class="n">string</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;$</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="p">}</span>

<span class="nb">type</span> <span class="n">database</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">dollars</span>

<span class="o">//</span> <span class="err">这里只能处理一个路由</span>
<span class="n">func</span> <span class="p">(</span><span class="n">db</span> <span class="n">database</span><span class="p">)</span> <span class="n">ServeHTTP</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">req</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">price</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">db</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> :</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span><span class="err">处理多个路由</span>
<span class="n">func</span> <span class="p">(</span><span class="n">db</span> <span class="n">database</span><span class="p">)</span> <span class="n">ServeHTTP</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">req</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">switch</span> <span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Path</span> <span class="p">{</span>
    <span class="n">case</span> <span class="s2">&quot;/list&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">price</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">db</span> <span class="p">{</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> :</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="n">case</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span>
        <span class="n">item</span> <span class="p">:</span><span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Query</span><span class="p">()</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">)</span>
        <span class="n">price</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">if</span> <span class="err">!</span><span class="n">ok</span> <span class="p">{</span>
            <span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusNotFound</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;no such item:%q</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
    <span class="n">default</span><span class="p">:</span>
        <span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusNotFound</span><span class="p">)</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;no such page:</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">URL</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>我们也可以使用 http.NewServeMux 实现一样的功能：</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">http</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;log&quot;</span>
    <span class="s2">&quot;net/http&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">db</span> <span class="p">:</span><span class="o">=</span> <span class="n">database</span><span class="p">{</span><span class="s2">&quot;shoes&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;socks&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
    <span class="n">mux</span> <span class="p">:</span><span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">NewServeMux</span><span class="p">()</span>
    <span class="n">mux</span><span class="o">.</span><span class="n">Handle</span><span class="p">(</span><span class="s2">&quot;/list&quot;</span><span class="p">,</span> <span class="n">http</span><span class="o">.</span><span class="n">HandlerFunc</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">list</span><span class="p">))</span>  <span class="o">//</span> <span class="err">注意最后不是</span> <span class="n">function</span> <span class="n">call</span><span class="err">，而是类型转换</span>
  <span class="o">//</span> <span class="n">mux</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s2">&quot;/list&quot;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">list</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s2">&quot;localhost:8000&quot;</span><span class="p">,</span> <span class="n">mux</span><span class="p">))</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">dollars</span> <span class="n">float64</span>
<span class="nb">type</span> <span class="n">database</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">dollars</span>

<span class="n">func</span> <span class="p">(</span><span class="n">db</span> <span class="n">database</span><span class="p">)</span> <span class="nb">list</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">req</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">price</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">db</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="78-the-error-interface">7.8 The error interface<a class="headerlink" href="#78-the-error-interface" title="Permanent link">&para;</a></h2>
<p>整个 errors pacakge 只有四行</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">errors</span>

<span class="n">func</span> <span class="k">New</span><span class="p">(</span><span class="nb">text</span> <span class="n">string</span><span class="p">)</span> <span class="n">error</span> <span class="err">{</span> <span class="k">return</span> <span class="o">&amp;</span><span class="n">errorString</span><span class="err">{</span><span class="nb">text</span><span class="err">}</span> <span class="err">}</span> <span class="o">//</span><span class="err">每次调用都会产生不同的实例</span>

<span class="k">type</span> <span class="n">errorString</span> <span class="n">struct</span><span class="err">{</span> <span class="nb">text</span> <span class="n">string</span> <span class="err">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span><span class="n">errorString</span><span class="p">)</span> <span class="n">Error</span><span class="p">()</span> <span class="n">string</span> <span class="err">{</span> <span class="k">return</span> <span class="n">e</span><span class="p">.</span><span class="nb">text</span> <span class="err">}</span>
</code></pre></div>


<h2 id="710-type-assertions">7.10 Type Assertions<a class="headerlink" href="#710-type-assertions" title="Permanent link">&para;</a></h2>
<p>类型断言是在接口值上的一种操作，x.(T)，x 是接口类型表达式，T 是类型。类型断言检查动态类型是否和断言类型匹配。
两种可能性：</p>
<ul>
<li>T is concrete type, 检查 x 的动态类型是否是 T，成功的话结构就是动态值，否则 panic</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;bytes&quot;</span>
    <span class="s2">&quot;io&quot;</span>
    <span class="s2">&quot;os&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">w</span> <span class="n">io</span><span class="o">.</span><span class="n">Writer</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">Stdout</span>
    <span class="n">f</span> <span class="p">:</span><span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">os</span><span class="o">.</span><span class="n">File</span><span class="p">)</span>      <span class="o">//</span> <span class="n">success</span><span class="p">:</span> <span class="n">f</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">Stdout</span>
    <span class="n">c</span> <span class="p">:</span><span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="nb">bytes</span><span class="o">.</span><span class="n">Buffer</span><span class="p">)</span> <span class="o">//</span> <span class="n">panic</span><span class="p">:</span> <span class="n">interface</span> <span class="n">holds</span> <span class="o">*</span><span class="n">os</span><span class="o">.</span><span class="n">File</span><span class="p">,</span> <span class="ow">not</span> <span class="o">*</span><span class="nb">bytes</span><span class="o">.</span><span class="n">Buffer</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>T is interface type: 检查 x 的动态值是否满足T，检查成功动态值不会被提取出来，结果仍然是接口值，但是具有接口类型 T。
    换言之，对于接口类型的类型断言表达式改变了表达式的类型，使得更多方法可以被访问，但是保留接口值里的接口类型和值组件。</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">var w io.Writer</span>
<span class="err">w = os.Stdout</span>
<span class="err">rw := w.(io.ReadWriter) // success: *os.File has both Read and Write</span>
<span class="err">w = new(ByteCounter)</span>
<span class="err">rw = w.(io.ReadWriter) // panic: *ByteCounter has no Read method</span>
</code></pre></div>


<p>如果我们期望两个返回结果，检查不成功也不会 panic，而是返回是否 ok</p>
<div class="codehilite"><pre><span></span><code><span class="err">var w io.Writer = os.Stdout</span>
<span class="err">f, ok := w.(*os.File)      // success:  ok, f == os.Stdout</span>
<span class="err">b, ok := w.(*bytes.Buffer) // failure: !ok, b == nil</span>
</code></pre></div>


<h2 id="711-discriminating-errors-with-type-assertions">7.11 Discriminating Errors with Type Assertions<a class="headerlink" href="#711-discriminating-errors-with-type-assertions" title="Permanent link">&para;</a></h2>
<p>os 包提供了不同的错误类型用来区分到底是哪种错误（权限问题、是否存在等）</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">os</span>
<span class="o">//</span> <span class="n">PathError</span> <span class="n">records</span> <span class="n">an</span> <span class="n">error</span> <span class="k">and</span> <span class="n">the</span> <span class="k">operation</span> <span class="k">and</span> <span class="n">file</span> <span class="n">path</span> <span class="n">that</span> <span class="n">caused</span> <span class="n">it</span><span class="p">.</span>
<span class="n">func</span> <span class="n">IsExist</span><span class="p">(</span><span class="n">err</span> <span class="n">error</span><span class="p">)</span> <span class="n">bool</span>
<span class="n">func</span> <span class="n">IsNotExist</span><span class="p">(</span><span class="n">err</span> <span class="n">error</span><span class="p">)</span> <span class="n">bool</span>
<span class="n">func</span> <span class="n">IsPermission</span><span class="p">(</span><span class="n">err</span> <span class="n">error</span><span class="p">)</span> <span class="n">bool</span>

<span class="k">type</span> <span class="n">PathError</span> <span class="n">struct</span> <span class="err">{</span>
    <span class="n">Op</span>   <span class="n">string</span>
    <span class="n">Path</span> <span class="n">string</span>
    <span class="n">Err</span>  <span class="n">error</span>
<span class="err">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span><span class="n">PathError</span><span class="p">)</span> <span class="n">Error</span><span class="p">()</span> <span class="n">string</span> <span class="err">{</span>
    <span class="k">return</span> <span class="n">e</span><span class="p">.</span><span class="n">Op</span> <span class="o">+</span> <span class="ss">&quot; &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">Path</span> <span class="o">+</span> <span class="ss">&quot;: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">Err</span><span class="p">.</span><span class="n">Error</span><span class="p">()</span>
<span class="err">}</span>
</code></pre></div>


<h2 id="712-querying-behaviors-with-inter-type-assertions">7.12 Querying Behaviors with Inter Type Assertions<a class="headerlink" href="#712-querying-behaviors-with-inter-type-assertions" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;io&quot;</span>

<span class="o">//</span> <span class="n">writeString</span> <span class="n">writes</span> <span class="n">s</span> <span class="n">to</span> <span class="n">w</span><span class="o">.</span>
<span class="o">//</span> <span class="n">If</span> <span class="n">w</span> <span class="n">has</span> <span class="n">a</span> <span class="n">WriteString</span> <span class="n">method</span><span class="p">,</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">invoked</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="o">.</span>
<span class="n">func</span> <span class="n">writeString</span><span class="p">(</span><span class="n">w</span> <span class="n">io</span><span class="o">.</span><span class="n">Writer</span><span class="p">,</span> <span class="n">s</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">type</span> <span class="n">stringWriter</span> <span class="n">interface</span> <span class="p">{</span>
        <span class="n">WriteString</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">sw</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="p">(</span><span class="n">stringWriter</span><span class="p">);</span> <span class="n">ok</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">sw</span><span class="o">.</span><span class="n">WriteString</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">//</span> <span class="n">avoid</span> <span class="n">a</span> <span class="n">copy</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="o">//</span> <span class="n">allocate</span> <span class="n">temporary</span> <span class="n">copy</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">writeHeader</span><span class="p">(</span><span class="n">w</span> <span class="n">io</span><span class="o">.</span><span class="n">Writer</span><span class="p">,</span> <span class="n">contentType</span> <span class="n">string</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">writeString</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s2">&quot;Content-Type: &quot;</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">writeString</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">contentType</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="o">//</span> <span class="o">...</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="713-type-switches">7.13 Type Switches<a class="headerlink" href="#713-type-switches" title="Permanent link">&para;</a></h2>
<p>接口有两种典型用途：</p>
<ul>
<li>一种是 io.Reader, io.Writer, fmt.Stringer, sort.Interface, http.Handler, error ，具体类型具有的相似行为，强调方法而不是具体类型。</li>
<li>另一种是接口值可以保存任何具体类型的值，可以认为是这些类型的合集。类型断言式用来根据不同的类型区分对待。
    这里强调的是满足接口的具体类型，而不是接口的方法。(discriminated unions)</li>
</ul>
<p>如果你熟悉 OOP，这两种风格的对应子类型多态(subtype polymorphism)和临时多态(ad hoc polymorphism)。后边讨论第二种形式。
type switch:</p>
<div class="codehilite"><pre><span></span><code><span class="err">switch x.(type) {</span>
<span class="err">case nil:       // ...</span>
<span class="err">case int, uint: // ...</span>
<span class="err">case bool: //</span>
<span class="err">case string: //</span>
<span class="c">default: //</span>
<span class="err">}</span>
<span class="err">switch x : x.(type) { /* ... */ }</span>
</code></pre></div>


<p>用 type switch 写一个转化 sql 变量的函数:</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">sqlQuote</span><span class="p">(</span><span class="n">x</span> <span class="n">interface</span><span class="p">{})</span> <span class="n">string</span> <span class="p">{</span>    <span class="o">//</span> <span class="n">interface</span><span class="p">{}</span> <span class="err">允许函数接受任何类型的值</span>
    <span class="n">switch</span> <span class="n">x</span> <span class="p">:</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">case</span> <span class="n">nil</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;NULL&quot;</span>
    <span class="n">case</span> <span class="nb">int</span><span class="p">,</span> <span class="n">uint</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="n">x</span> <span class="n">has</span> <span class="nb">type</span> <span class="n">interface</span><span class="p">{}</span> <span class="n">here</span><span class="o">.</span>
    <span class="n">case</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">&quot;TRUE&quot;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s2">&quot;FALSE&quot;</span>
    <span class="n">case</span> <span class="n">string</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sqlQuoteString</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="ow">not</span> <span class="n">shown</span><span class="p">)</span>
    <span class="n">default</span><span class="p">:</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;unexpected type %T: %v&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="715-a-few-words-of-advice">7.15 A Few Words of Advice<a class="headerlink" href="#715-a-few-words-of-advice" title="Permanent link">&para;</a></h2>
<p>什么时候需要接口：<strong>当两种以上的具体类型必须以一种统一 的方式处理的时候。</strong></p>
<p>有一种例外：当接口被一个具体类型满足但是这个类型却无法和接口保持在一个 package 里（因为依赖关系），这个时候接口是解耦两个 package 的好方式。</p>
<p>设计接口的原则：ask only for what you need</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../frontend/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3bootstrap/" title="深入理解bootstrap" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                深入理解bootstrap
              </div>
            </div>
          </a>
        
        
          <a href="../2_the_go_programming_lauguage/" title="2 The Go Programming Language" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                2 The Go Programming Language
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"search.result.none": "No matching documents", "clipboard.copy": "Copy to clipboard", "search.result.placeholder": "Type to start searching", "clipboard.copied": "Copied to clipboard", "search.result.one": "1 matching document", "search.config.separator": "[\\s\\-]+", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["instant"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>