


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.2">
    
    
      
        <title>Go101 - ZWiley的笔记</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a2408e81.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>body,input{font-family:"",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#21-channels-the-go-way-to-do-concurrency-synchronizations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="ZWiley的笔记" class="md-header-nav__button md-logo" aria-label="ZWiley的笔记">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ZWiley的笔记
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Go101
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/zwiley/mybook/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ZWiley的笔记" class="md-nav__button md-logo" aria-label="ZWiley的笔记">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ZWiley的笔记
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/zwiley/mybook/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="简介" class="md-nav__link">
      简介
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      C++
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="C++" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        C++
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E7%BC%96%E8%AF%91%E5%BA%95%E5%B1%82/" title="C++编译底层" class="md-nav__link">
      C++编译底层
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="C++基础知识" class="md-nav__link">
      C++基础知识
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88_%E5%BC%82%E5%B8%B8%E6%9C%BA%E5%88%B6_%E5%BC%BA%E5%88%B6%E8%BD%AC%E6%8D%A2_RTTI/" title="C++智能指针" class="md-nav__link">
      C++智能指针
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" title="C++面向对象" class="md-nav__link">
      C++面向对象
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/STL/" title="C++ STL" class="md-nav__link">
      C++ STL
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      计算机基础知识
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="计算机基础知识" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        计算机基础知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="操作系统" class="md-nav__link">
      操作系统
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络" class="md-nav__link">
      计算机网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="数据结构" class="md-nav__link">
      数据结构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" title="海量数据处理" class="md-nav__link">
      海量数据处理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      基本手写代码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="基本手写代码" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        基本手写代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%9F%BA%E6%9C%AC%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81/%E5%9F%BA%E6%9C%AC%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81%E9%A2%98%E7%9B%AE/" title="基本手写代码题目" class="md-nav__link">
      基本手写代码题目
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      项目基础知识
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="项目基础知识" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        项目基础知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E5%8F%8A%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/" title="Linux系统编程及基本命令" class="md-nav__link">
      Linux系统编程及基本命令
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Redis/" title="Redis" class="md-nav__link">
      Redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Socket%E7%BC%96%E7%A8%8B/" title="Socket编程" class="md-nav__link">
      Socket编程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      webserver项目
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="webserver项目" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        webserver项目
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/0%20%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0/" title="0 项目概述" class="md-nav__link">
      0 项目概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/1%20%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E5%B0%81%E8%A3%85%E7%B1%BB/" title="1 线程同步机制封装类" class="md-nav__link">
      1 线程同步机制封装类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/2%20%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%8D%8A%E5%8F%8D%E5%BA%94%E5%A0%86%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88%E4%B8%8A%EF%BC%89/" title="2 半同步半反应堆线程池（上）" class="md-nav__link">
      2 半同步半反应堆线程池（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/3%20%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%8D%8A%E5%8F%8D%E5%BA%94%E5%A0%86%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="3 半同步半反应堆线程池（下）" class="md-nav__link">
      3 半同步半反应堆线程池（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/4%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%8A%EF%BC%89/" title="4 http连接处理（上）" class="md-nav__link">
      4 http连接处理（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/5%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%AD%EF%BC%89/" title="5 http连接处理（中）" class="md-nav__link">
      5 http连接处理（中）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/6%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%8B%EF%BC%89/" title="6 http连接处理（下）" class="md-nav__link">
      6 http连接处理（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/7%20%E5%AE%9A%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86%E9%9D%9E%E6%B4%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%EF%BC%88%E4%B8%8A%EF%BC%89/" title="7 定时器处理非活动连接（上）" class="md-nav__link">
      7 定时器处理非活动连接（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/8%20%E5%AE%9A%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86%E9%9D%9E%E6%B4%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%EF%BC%88%E4%B8%8B%EF%BC%89/" title="8 定时器处理非活动连接（下）" class="md-nav__link">
      8 定时器处理非活动连接（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/9%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%8A%EF%BC%89/" title="9 日志系统（上）" class="md-nav__link">
      9 日志系统（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/10%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%8B%EF%BC%89/" title="10 日志系统（下）" class="md-nav__link">
      10 日志系统（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/11%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/" title="11 数据库连接池" class="md-nav__link">
      11 数据库连接池
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../webserver/12%20%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" title="12 常见问题" class="md-nav__link">
      12 常见问题
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      代码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="代码" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/work_with_legacy_code/" title="Work with legacy code" class="md-nav__link">
      Work with legacy code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8/" title="代码大全" class="md-nav__link">
      代码大全
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E4%BB%A3%E7%A0%81%E7%9A%84%E6%9C%AA%E6%9D%A5/" title="代码的未来" class="md-nav__link">
      代码的未来
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E5%9F%BA%E6%9C%AC%E5%8A%9F/" title="基本功" class="md-nav__link">
      基本功
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E6%95%8F%E6%8D%B7%E6%8A%80%E8%83%BD%E4%BF%AE%E7%82%BC/" title="敏捷技能修炼" class="md-nav__link">
      敏捷技能修炼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%8497%E4%BB%B6%E4%BA%8B/" title="程序员应该知道的97件事" class="md-nav__link">
      程序员应该知道的97件事
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E7%BC%96%E5%86%99%E5%8F%AF%E8%AF%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF/" title="编写可读代码的艺术" class="md-nav__link">
      编写可读代码的艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E7%BC%96%E7%A8%8B%E5%8C%A0%E8%89%BA/" title="编程匠艺" class="md-nav__link">
      编程匠艺
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" title="领域驱动设计" class="md-nav__link">
      领域驱动设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../code/codelife_%E4%B8%8D%E6%AD%A2%E4%BB%A3%E7%A0%81/" title="codelife_不止代码" class="md-nav__link">
      codelife_不止代码
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      调试技术
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="调试技术" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        调试技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../debug/%E8%BD%AF%E4%BB%B6%E8%B0%83%E8%AF%95%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93/book/" title="软件调试修炼之道" class="md-nav__link">
      软件调试修炼之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../debug/Effective_Debugging/" title="Effective Debugging" class="md-nav__link">
      Effective Debugging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      数据库
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="数据库" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        数据库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/getting_started_with_impala/" title="Getting started with impala" class="md-nav__link">
      Getting started with impala
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" title="mysql必知必会" class="md-nav__link">
      mysql必知必会
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/mysql%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%8E%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/" title="mysql性能调优与架构实践" class="md-nav__link">
      mysql性能调优与架构实践
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/Mysql%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" title="Mysql技术内幕InnoDB存储引擎" class="md-nav__link">
      Mysql技术内幕InnoDB存储引擎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/redis%E5%AE%9E%E6%88%98/" title="Redis实战" class="md-nav__link">
      Redis实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/redis%E6%B7%B1%E5%BA%A6%E5%8E%86%E9%99%A9%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%92%8C%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/book/" title="Redis深度历险核心原理和应用实践" class="md-nav__link">
      Redis深度历险核心原理和应用实践
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="redis设计与实现" class="md-nav__link">
      redis设计与实现
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93/" title="七周七数据库" class="md-nav__link">
      七周七数据库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAmysql/" title="深入浅出mysql" class="md-nav__link">
      深入浅出mysql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../database/%E9%AB%98%E6%80%A7%E8%83%BDmysql%E7%AC%AC%E4%B8%89%E7%89%88/" title="高性能mysql第三版" class="md-nav__link">
      高性能mysql第三版
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      前端
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="前端" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        前端
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/CSS_The_Missing_Manual/" title="CSS_The_Missing_Manual" class="md-nav__link">
      CSS_The_Missing_Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/reactjs_%E5%B0%8F%E4%B9%A6/" title="reactjs小书" class="md-nav__link">
      reactjs小书
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/es6%E6%A0%87%E5%87%86%E5%85%A5%E9%97%A8/" title="ES6标准入门" class="md-nav__link">
      ES6标准入门
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/jquery_pocket_reference/" title="jquery_pocket_reference" class="md-nav__link">
      jquery_pocket_reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../frontend/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3bootstrap/" title="深入理解bootstrap" class="md-nav__link">
      深入理解bootstrap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" checked>
    
    <label class="md-nav__link" for="nav-11">
      golang
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="golang" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        golang
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../1_the_go_programming_lauguage/" title="1 The Go Programming Language" class="md-nav__link">
      1 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2_the_go_programming_lauguage/" title="2 The Go Programming Language" class="md-nav__link">
      2 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../3_the_go_programming_lauguage/" title="3 The Go Programming Language" class="md-nav__link">
      3 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../build-web-application-with-golang/" title="Build Web Application With Golang" class="md-nav__link">
      Build Web Application With Golang
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Go101" class="md-nav__link md-nav__link--active">
      Go101
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../network-programming-with-go/book/" title="Network Programming with go" class="md-nav__link">
      Network Programming with go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building-microservices-with-go/book/" title="Building Microservices With Go" class="md-nav__link">
      Building Microservices With Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../building_restful_web_services_with_go/book/" title="Building Restful Web Services with Go" class="md-nav__link">
      Building Restful Web Services with Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../concurrency-in-go/concurrency_in_go/" title="Concurrency In Go" class="md-nav__link">
      Concurrency In Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go_in_action%28go%E8%AF%AD%E8%A8%80%E5%AE%9E%E6%88%98%29/" title="Go In Action(Go 实战)" class="md-nav__link">
      Go In Action(Go 实战)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E8%AF%AD%E8%A8%80%E8%AF%A6%E8%A7%A3/" title="Go学习笔记语言详解" class="md-nav__link">
      Go学习笔记语言详解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/" title="Go学习笔记源码剖析" class="md-nav__link">
      Go学习笔记源码剖析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B/" title="go语言编程" class="md-nav__link">
      go语言编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../the_way_to_go/book/" title="go book" class="md-nav__link">
      go book
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../advanced-go-programming-book/advanced-go-programming/" title="advanced-go-programming" class="md-nav__link">
      advanced-go-programming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../go-build-web-applications/module1/go-build-web-applications/go-build-web-applications/" title="go-build-web-applications" class="md-nav__link">
      go-build-web-applications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      java
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="java" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../java/java-basic-introduction/" title="java basic introduction" class="md-nav__link">
      java basic introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      网络
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="网络" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        网络
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../network/tcp_ip%E8%AF%A6%E8%A7%A3%E5%8D%B7%E4%B8%80/tcp_ip%E8%AF%A6%E8%A7%A3%E5%8D%B7%E4%B8%80/" title="TCP IP详解卷一" class="md-nav__link">
      TCP IP详解卷一
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      python
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="python" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/fluent_python/" title="Fluent Python" class="md-nav__link">
      Fluent Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/Python_Microservices_Development/" title="Python Microservices Development" class="md-nav__link">
      Python Microservices Development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/high_performance_python/" title="High Performance Python" class="md-nav__link">
      High Performance Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../python/python_%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="Python网络编程" class="md-nav__link">
      Python网络编程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      unix/linux
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="unix/linux" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        unix/linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix_linux/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/" title="Linux高性能服务器编程" class="md-nav__link">
      Linux高性能服务器编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix_linux/unix%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF/" title="unix编程艺术" class="md-nav__link">
      unix编程艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix_linux/unix%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%8D%B7%E4%B8%80/" title="unix网络编程卷一" class="md-nav__link">
      unix网络编程卷一
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../unix_linux/unix%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF/" title="unix编程艺术" class="md-nav__link">
      unix编程艺术
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      分布式
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="分布式" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        分布式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%88%86%E5%B8%83%E5%BC%8F/Kafka%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/" title="Kafka 权威指南" class="md-nav__link">
      Kafka 权威指南
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/" title="分布式框架原理与应用" class="md-nav__link">
      分布式框架原理与应用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%88%86%E5%B8%83%E5%BC%8F/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" title="大规模分布式存储系统" class="md-nav__link">
      大规模分布式存储系统
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%88%86%E5%B8%83%E5%BC%8F/%E6%B7%B1%E5%85%A5%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E4%BB%8E%E5%8E%9F%E7%90%86%E5%88%B0%E5%AE%9E%E8%B7%B5/" title="深入分布式缓存从原理到实践" class="md-nav__link">
      深入分布式缓存从原理到实践
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      搜索引擎
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="搜索引擎" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        搜索引擎
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/Elasticsearch%E5%AE%9E%E6%88%98/book/" title="Elasticsearch实战" class="md-nav__link">
      Elasticsearch实战
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-18" type="checkbox" id="nav-18">
    
    <label class="md-nav__link" for="nav-18">
      容器
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="容器" data-md-level="1">
      <label class="md-nav__title" for="nav-18">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        容器
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../devops/%E7%8E%A9%E8%BD%ACKubernets-CloudMan/" title="玩转Kubernets" class="md-nav__link">
      玩转Kubernets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../devops/%E7%AC%AC%E4%B8%80%E6%9C%ACdocker%E4%B9%A6/" title="第一本docker书" class="md-nav__link">
      第一本docker书
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-19" type="checkbox" id="nav-19">
    
    <label class="md-nav__link" for="nav-19">
      开发工具
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="开发工具" data-md-level="1">
      <label class="md-nav__title" for="nav-19">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        开发工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/practical_vim/practical_vim/" title="Practical Vim" class="md-nav__link">
      Practical Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/vim8%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98/vim8%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98/" title="Vim8文本处理实战" class="md-nav__link">
      Vim8文本处理实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/learn_vim_the_hard_way/" title="Learn vim scrpt the hard way" class="md-nav__link">
      Learn vim scrpt the hard way
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/pro_git/" title="Pro Git" class="md-nav__link">
      Pro Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Mastering_vim/" title="Mastering Vim" class="md-nav__link">
      Mastering Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/mastering_vim_quickly/" title="Mastering Vim Quickly" class="md-nav__link">
      Mastering Vim Quickly
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-20" type="checkbox" id="nav-20">
    
    <label class="md-nav__link" for="nav-20">
      思维
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="思维" data-md-level="1">
      <label class="md-nav__title" for="nav-20">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        思维
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E4%B8%93%E6%B3%A8%E5%8A%9B_%E5%8C%96%E7%B9%81%E4%B8%BA%E7%AE%80%E7%9A%84%E6%83%8A%E4%BA%BA%E5%8A%9B%E9%87%8F/" title="专注力" class="md-nav__link">
      专注力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E4%B8%BA%E4%BB%80%E4%B9%88%E7%B2%BE%E8%8B%B1%E8%BF%99%E6%A0%B7%E7%94%A8%E8%84%91%E4%B8%8D%E4%BC%9A%E7%B4%AF/" title="为什么精英这样用脑不会累" class="md-nav__link">
      为什么精英这样用脑不会累
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%88%BB%E6%84%8F%E7%BB%83%E4%B9%A0/" title="刻意练习" class="md-nav__link">
      刻意练习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%A6%82%E4%BD%95%E6%83%B3%E5%88%B0%E5%8F%88%E5%81%9A%E5%88%B0/" title="如何想到又做到" class="md-nav__link">
      如何想到又做到
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%AD%A6%E4%B9%A0%E4%B9%8B%E9%81%93/" title="学习之道" class="md-nav__link">
      学习之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%AD%A6%E4%B9%A0%E5%8A%9B/" title="学习力" class="md-nav__link">
      学习力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E6%89%B9%E5%88%A4%E6%80%A7%E6%80%9D%E7%BB%B4%E5%B7%A5%E5%85%B7/" title="批判性思维工具" class="md-nav__link">
      批判性思维工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%80%9D%E7%BB%B4%E4%BF%AE%E7%82%BC%28%E5%BC%80%E5%8F%91%E8%AE%A4%E7%9F%A5%E6%BD%9C%E8%83%BD%E7%9A%84%E4%B9%9D%E5%A0%82%E8%AF%BE%29/" title="程序员的思维修炼" class="md-nav__link">
      程序员的思维修炼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E8%AE%A4%E7%9F%A5%E5%A4%A9%E6%80%A7/" title="认知天性" class="md-nav__link">
      认知天性
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E8%B6%85%E6%95%88%E7%8E%87%E6%89%8B%E5%86%8C/" title="超效率手册" class="md-nav__link">
      超效率手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E8%AE%B0%E5%BF%86/" title="如何高效记忆" class="md-nav__link">
      如何高效记忆
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E7%A7%91%E5%AD%A6%E5%AD%A6%E4%B9%A0/" title="科学学习" class="md-nav__link">
      科学学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E9%AB%98%E6%95%88%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%8445%E4%B8%AA%E4%B9%A0%E6%83%AF/" title="高效程序员的45个习惯" class="md-nav__link">
      高效程序员的45个习惯
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-21" type="checkbox" id="nav-21">
    
    <label class="md-nav__link" for="nav-21">
      源码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="源码" data-md-level="1">
      <label class="md-nav__title" for="nav-21">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        源码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB_sourcecode/" title="源码阅读" class="md-nav__link">
      源码阅读
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-22" type="checkbox" id="nav-22">
    
    <label class="md-nav__link" for="nav-22">
      网站架构微服务
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="网站架构微服务" data-md-level="1">
      <label class="md-nav__title" for="nav-22">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        网站架构微服务
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/microservices_patterns_%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/book/" title="微服务架构设计模式" class="md-nav__link">
      微服务架构设计模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%9E%B6%E6%9E%84/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%9E%B6%E6%9E%84/" title="从0开始学架构" class="md-nav__link">
      从0开始学架构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/web_scalavility_for_startup_engineers/" title="web scalavility for startup engineers" class="md-nav__link">
      web scalavility for startup engineers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/design_data_instensive_application/" title="design_data_instensive_application" class="md-nav__link">
      design_data_instensive_application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/clean_architecture/" title="clean_architecture" class="md-nav__link">
      clean_architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/" title="微服务设计" class="md-nav__link">
      微服务设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/2_design_data_instensive_application/" title="2_design_data_instensive_application" class="md-nav__link">
      2_design_data_instensive_application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/3_design_data_instensive_application/" title="3_design_data_instensive_application" class="md-nav__link">
      3_design_data_instensive_application
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-23" type="checkbox" id="nav-23">
    
    <label class="md-nav__link" for="nav-23">
      软件工程/项目管理
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="软件工程/项目管理" data-md-level="1">
      <label class="md-nav__title" for="nav-23">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        软件工程/项目管理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/" title="人月神话" class="md-nav__link">
      人月神话
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BB%A3%E7%A0%81%E4%B9%8B%E6%AE%87/" title="代码之殇" class="md-nav__link">
      代码之殇
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E8%A7%A3%E6%9E%90%E6%9E%81%E9%99%90%E7%BC%96%E7%A8%8B-%E6%8B%A5%E6%8A%B1%E5%8F%98%E5%8C%96/" title="解析极限编程" class="md-nav__link">
      解析极限编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93/" title="项目管理修炼之道" class="md-nav__link">
      项目管理修炼之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BF%AE%E6%94%B9%E8%BD%AF%E4%BB%B6%E7%9A%84%E8%89%BA%E6%9C%AF/" title="修改软件的艺术" class="md-nav__link">
      修改软件的艺术
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-24" type="checkbox" id="nav-24">
    
    <label class="md-nav__link" for="nav-24">
      运维
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="运维" data-md-level="1">
      <label class="md-nav__title" for="nav-24">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        运维
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BF%90%E7%BB%B4/linux%E9%9B%86%E7%BE%A4%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" title="linux集群和自动化运维" class="md-nav__link">
      linux集群和自动化运维
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E8%BF%90%E7%BB%B4/python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" title="python自动化运维" class="md-nav__link">
      python自动化运维
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-25" type="checkbox" id="nav-25">
    
    <label class="md-nav__link" for="nav-25">
      金融理财
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="金融理财" data-md-level="1">
      <label class="md-nav__title" for="nav-25">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        金融理财
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%87%91%E8%9E%8D%E7%90%86%E8%B4%A2/%E5%AE%9A%E6%8A%95%E5%8D%81%E5%B9%B4/" title="定投十年" class="md-nav__link">
      定投十年
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%87%91%E8%9E%8D%E7%90%86%E8%B4%A2/%E7%A9%B7%E6%9F%A5%E7%90%86%E5%AE%9D%E5%85%B8/" title="穷查理宝典" class="md-nav__link">
      穷查理宝典
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-26" type="checkbox" id="nav-26">
    
    <label class="md-nav__link" for="nav-26">
      写作
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="写作" data-md-level="1">
      <label class="md-nav__title" for="nav-26">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        写作
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%86%99%E4%BD%9C/%E5%88%B7%E5%B1%8F%E6%96%87%E6%A1%88%E5%86%99%E4%BD%9C%E6%8A%80%E5%B7%A7/" title="刷屏文案写作技巧" class="md-nav__link">
      刷屏文案写作技巧
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-27" type="checkbox" id="nav-27">
    
    <label class="md-nav__link" for="nav-27">
      互联网
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="互联网" data-md-level="1">
      <label class="md-nav__title" for="nav-27">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        互联网
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E4%BA%92%E8%81%94%E7%BD%91/%E6%88%91%E7%9A%84%E4%BA%92%E8%81%94%E7%BD%91%E6%96%B9%E6%B3%95%E8%AE%BA-%E5%91%A8%E9%B8%BF%E7%A5%8E/" title="我的互联网方法论-周鸿祎" class="md-nav__link">
      我的互联网方法论-周鸿祎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E4%BA%92%E8%81%94%E7%BD%91/%E7%94%A8%E6%88%B7%E6%80%9D%E7%BB%B4/" title="用户思维" class="md-nav__link">
      用户思维
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-28" type="checkbox" id="nav-28">
    
    <label class="md-nav__link" for="nav-28">
      区块链
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="区块链" data-md-level="1">
      <label class="md-nav__title" for="nav-28">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        区块链
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E5%8C%BA%E5%9D%97%E9%93%BE/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E6%8C%87%E5%8D%97%28blockchain_guide%29/" title="区块链技术指南" class="md-nav__link">
      区块链技术指南
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-29" type="checkbox" id="nav-29">
    
    <label class="md-nav__link" for="nav-29">
      技术演讲
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="技术演讲" data-md-level="1">
      <label class="md-nav__title" for="nav-29">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        技术演讲
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lecture/Gopher/%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E7%9A%84go%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98/note/" title="哔哩哔哩的go微服务实战" class="md-nav__link">
      哔哩哔哩的go微服务实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lecture/Gopher/Go_Error/go%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E5%BA%93%E4%B9%8BError%26Context/" title="go业务基础库之Error&Context" class="md-nav__link">
      go业务基础库之Error&Context
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lecture/Gopher/Go%E5%90%8C%E6%AD%A5%E5%92%8C%E5%B9%B6%E5%8F%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/note/" title="Go同步和并发设计模式" class="md-nav__link">
      Go同步和并发设计模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../lecture/%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2/%E5%B7%A6%E8%80%B3%E6%9C%B5%E8%80%97%E5%AD%90-%E6%88%91%E8%BF%99%E6%8A%80%E6%9C%AF%E4%BA%8C%E5%8D%81%E5%B9%B4/" title="左耳朵耗子-我这技术二十年" class="md-nav__link">
      左耳朵耗子-我这技术二十年
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-30" type="checkbox" id="nav-30">
    
    <label class="md-nav__link" for="nav-30">
      职场
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="职场" data-md-level="1">
      <label class="md-nav__title" for="nav-30">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        职场
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/give_and_take/" title="give and take" class="md-nav__link">
      give and take
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/the_effective_engineer/" title="the_effective_engineer" class="md-nav__link">
      the_effective_engineer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E5%85%89%E9%80%9F%E6%88%90%E9%95%BF/" title="光速成长" class="md-nav__link">
      光速成长
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E5%90%91%E4%B8%8A%E7%AE%A1%E7%90%86/" title="向上管理" class="md-nav__link">
      向上管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E6%88%90%E5%8A%9F%E5%8A%A8%E6%9C%BA%E4%B8%8E%E7%9B%AE%E6%A0%87/" title="成功动机与目标" class="md-nav__link">
      成功动机与目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E7%95%AA%E8%8C%84%E5%B7%A5%E4%BD%9C%E6%B3%95/" title="番茄工作法" class="md-nav__link">
      番茄工作法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%81%86%E5%90%AC%E6%B2%9F%E9%80%9A%E5%AD%A6/" title="聆听沟通学" class="md-nav__link">
      聆听沟通学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E7%9F%A5%E4%B9%8E%E8%81%8C%E4%BA%BA%E8%A7%89%E9%86%92/" title="知乎职人觉醒" class="md-nav__link">
      知乎职人觉醒
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E7%9F%A5%E8%AF%86%E5%8F%98%E7%8E%B0/" title="知识变现" class="md-nav__link">
      知识变现
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%81%86%E5%90%AC%E6%B2%9F%E9%80%9A%E5%AD%A6/" title="聆听沟通学" class="md-nav__link">
      聆听沟通学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%81%8C%E5%9C%BA%E5%8A%A8%E7%89%A9%E8%BF%9B%E5%8C%96%E6%89%8B%E5%86%8C/" title="职场动物进化手册" class="md-nav__link">
      职场动物进化手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%81%8C%E5%9C%BA%E8%A7%A3%E9%87%8A%E7%B3%BB/" title="职场解释系" class="md-nav__link">
      职场解释系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%AF%B7%E5%81%9C%E6%AD%A2%E6%97%A0%E6%95%88%E5%8A%AA%E5%8A%9B/" title="请停止无效努力" class="md-nav__link">
      请停止无效努力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E8%BD%AF%E6%8A%80%E8%83%BD/" title="软技能" class="md-nav__link">
      软技能
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E9%AB%98%E6%95%8815%E6%B3%95%E5%88%99/" title="高效15法则" class="md-nav__link">
      高效15法则
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E9%AB%98%E6%95%88%E6%B8%85%E5%8D%95%E5%B7%A5%E4%BD%9C%E6%B3%95/" title="高效清单工作法" class="md-nav__link">
      高效清单工作法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../career/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/" title="程序员的自我修养" class="md-nav__link">
      程序员的自我修养
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-31" type="checkbox" id="nav-31">
    
    <label class="md-nav__link" for="nav-31">
      心理学
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="心理学" data-md-level="1">
      <label class="md-nav__title" for="nav-31">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        心理学
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E7%AB%A5%E5%B9%B4%E7%9A%84%E9%94%99%E5%90%97/" title="一切都是童年的错吗" class="md-nav__link">
      一切都是童年的错吗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E4%BA%B2%E5%AF%86%E5%85%B3%E7%B3%BB/" title="亲密关系" class="md-nav__link">
      亲密关系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E6%83%85%E5%95%86/" title="情商" class="md-nav__link">
      情商
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E9%80%86%E5%95%86/" title="逆商" class="md-nav__link">
      逆商
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E6%8B%96%E5%BB%B6%E5%BF%83%E7%90%86%E5%AD%A6/" title="拖延心理学" class="md-nav__link">
      拖延心理学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E7%A7%AF%E6%9E%81%E5%BF%83%E7%90%86%E5%AD%A6/" title="积极心理学" class="md-nav__link">
      积极心理学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B/" title="自控力" class="md-nav__link">
      自控力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B-%E5%AE%9E%E6%93%8D%E7%AF%87/" title="自控力-实操篇" class="md-nav__link">
      自控力-实操篇
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B-%E5%92%8C%E5%8E%8B%E5%8A%9B%E5%81%9A%E6%9C%8B%E5%8F%8B/" title="自控力:和压力做朋友" class="md-nav__link">
      自控力:和压力做朋友
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E6%B4%BB%E5%87%BA%E6%9C%80%E4%B9%90%E8%A7%82%E7%9A%84%E8%87%AA%E5%B7%B1/" title="活出最乐观的自己" class="md-nav__link">
      活出最乐观的自己
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E6%94%B9%E5%8F%98%E5%BF%83%E7%90%86%E5%AD%A6%E7%9A%8440%E9%A1%B9%E7%A0%94%E7%A9%B6/" title="改变心理学的40项研究" class="md-nav__link">
      改变心理学的40项研究
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E8%B6%85%E8%B6%8A%E8%87%AA%E5%8D%91/" title="超越自卑" class="md-nav__link">
      超越自卑
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../psychology/%E5%8F%8D%E8%84%86%E5%BC%B1/" title="反脆弱" class="md-nav__link">
      反脆弱
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-32" type="checkbox" id="nav-32">
    
    <label class="md-nav__link" for="nav-32">
      创业
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="创业" data-md-level="1">
      <label class="md-nav__title" for="nav-32">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        创业
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../startup/hello_startup/" title="Hello Startup" class="md-nav__link">
      Hello Startup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../startup/%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%85%AC%E5%BC%80%E8%AF%BE-%E5%A6%82%E4%BD%95%E5%88%9B%E4%B8%9A/" title="斯坦福公开课如何创业" class="md-nav__link">
      斯坦福公开课如何创业
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../startup/%E8%BF%90%E8%90%A5%E5%85%B6%E5%AE%9E%E5%BE%88%E7%AE%80%E5%8D%95/" title="运营其实很简单" class="md-nav__link">
      运营其实很简单
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/zwiley/mybook/edit/master/docs/golang/go101/book.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="21-channels-the-go-way-to-do-concurrency-synchronizations">21. Channels - The Go Way to do concurrency synchronizations<a class="headerlink" href="#21-channels-the-go-way-to-do-concurrency-synchronizations" title="Permanent link">&para;</a></h1>
<p>Don&rsquo;t (let computations) communicate by sharing memroy, (let them) share memory by communicating (through channels).</p>
<p>五种操作(all these operations are already synchronized)：</p>
<ul>
<li>close(ch), ch must not be a receive-only channel.</li>
<li><code>ch &lt;- v</code>, send a value</li>
<li><code>&lt;-ch</code>, receive a value from the channel</li>
<li>cap(ch), value buffer capacity, return int</li>
<li>len(ch), query current number of values in the value buffer</li>
</ul>
<p>We can think of each channel as maintaining 3 queues:
- the receiving goroutine queue
- the sending goroutine queue
- the value buffer queue</p>
<p><img alt="" src="../channel.png" /></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// unbufferd demo</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ch</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">x</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span> <span class="c1">//block until the result is received.</span>
    <span class="p">}(</span><span class="nx">c</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="nx">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">ch</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">n</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">ch</span> <span class="c1">//block until 9 is sent</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>

        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">done</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
    <span class="p">}(</span><span class="nx">c</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="nx">done</span> <span class="c1">//block until a value is sent to done</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;bye&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// buffered channel</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="c1">// A never ending football game</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ball</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span>
    <span class="nx">kickBall</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">playerName</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">ball</span><span class="p">,</span> <span class="s">&quot;kicked the ball.&quot;</span><span class="p">)</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
            <span class="nx">ball</span> <span class="o">&lt;-</span> <span class="nx">playerName</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">go</span> <span class="nx">kickBall</span><span class="p">(</span><span class="s">&quot;John&quot;</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">kickBall</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">kickBall</span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">kickBall</span><span class="p">(</span><span class="s">&quot;Emily&quot;</span><span class="p">)</span>
    <span class="nx">ball</span> <span class="o">&lt;-</span> <span class="s">&quot;referee&quot;</span> <span class="c1">//kick off 开球</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="kd">chan</span> <span class="kt">bool</span>   <span class="c1">//nil</span>
    <span class="o">&lt;-</span><span class="nx">c</span>               <span class="c1">// blocking here forever</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>Channel Element Values are Transferred by Copy。If the passed value size too large, use a pointer element type instead.</li>
<li>A goroutine can be garbage collected when it has already exited.</li>
<li>Channel send and receive operations are simple statements.</li>
</ul>
<p>empty select-case code block <code>select{}</code> will make current goroutine stay in blocking state forever.</p>
<h1 id="22-methods-in-go">22 Methods in Go<a class="headerlink" href="#22-methods-in-go" title="Permanent link">&para;</a></h1>
<p>Should a method be declared with pointer receiver or value receiver ?</p>
<ul>
<li>Too many pointer copies my cause heavier workload for garbage collector</li>
<li>if value receiver type is Large , should use pointer receiver.</li>
<li>declaring methods of both value receivers ans pointer receivers for the same base type is more
    likely to cause data races if the declared methods are called concurrently in multiple goroutines.</li>
<li>values of the types in sync standard package should not be copied.</li>
</ul>
<p>If it is hard to make a decision , just choose the pointer receiver way.</p>
<h1 id="23-interfaces-in-go">23 Interfaces in Go<a class="headerlink" href="#23-interfaces-in-go" title="Permanent link">&para;</a></h1>
<p>type assert and type switch</p>
<ul>
<li>Values of []t can&rsquo;t be directly converted to []I, even if type T implements interface type I.</li>
<li>Each method specified in a interface type corresponds to an implicit function.</li>
</ul>
<h1 id="37-channel-use-cases">37 Channel Use Cases<a class="headerlink" href="#37-channel-use-cases" title="Permanent link">&para;</a></h1>
<h2 id="use-channels-as-futurespromises">Use channels as Futures/Promises<a class="headerlink" href="#use-channels-as-futurespromises" title="Permanent link">&para;</a></h2>
<h4 id="return-receive-only-channels-as-results">Return receive-only channels as results<a class="headerlink" href="#return-receive-only-channels-as-results" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">longTimeRequest</span><span class="p">()</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">int32</span> <span class="p">{</span>
    <span class="nx">r</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int32</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// simulate a workload</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nx">r</span> <span class="o">&lt;-</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Int31n</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">r</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">sumSquares</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int32</span><span class="p">)</span> <span class="kt">int32</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span><span class="o">*</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="o">*</span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>
    <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="o">:=</span> <span class="nx">longTimeRequest</span><span class="p">(),</span> <span class="nx">longTimeRequest</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">sumSquares</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">a</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nx">b</span><span class="p">))</span> <span class="c1">// 3s 返回, a,b 并发执行的</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="pass-send-only-channels-as-arguments">Pass send-only channels as arguments<a class="headerlink" href="#pass-send-only-channels-as-arguments" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">longTiemRequest</span><span class="p">(</span><span class="nx">r</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kt">int32</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// simulate a worklaod</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
    <span class="nx">r</span> <span class="o">&lt;-</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Int31n</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">sumSquares</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int32</span><span class="p">)</span> <span class="kt">int32</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">a</span><span class="o">*</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="o">*</span><span class="nx">b</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>
    <span class="nx">ra</span><span class="p">,</span> <span class="nx">rb</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int32</span><span class="p">),</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int32</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">longTiemRequest</span><span class="p">(</span><span class="nx">ra</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">longTiemRequest</span><span class="p">(</span><span class="nx">rb</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">sumSquares</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">ra</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nx">rb</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="the-first-response-wins">The first response wins<a class="headerlink" href="#the-first-response-wins" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">source</span><span class="p">(</span><span class="nx">c</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kt">int32</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ra</span><span class="p">,</span> <span class="nx">rb</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Int31</span><span class="p">(),</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="nx">rb</span><span class="p">)</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="nx">c</span> <span class="o">&lt;-</span> <span class="nx">ra</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>
    <span class="nx">beg</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int32</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="c1">// must bufferd channel</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="nx">source</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// only frist resposne will be used</span>
    <span class="nx">rnd</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">beg</span><span class="p">))</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">rnd</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="use-channels-for-notifications">Use Channels for Notifications<a class="headerlink" href="#use-channels-for-notifications" title="Permanent link">&para;</a></h2>
<p>Use blank struct{} as element types of the notification channels, size of type struct{} is zero, doesn&rsquo;t consume memory.</p>
<h4 id="1-to-1-notification-by-sending-a-value-to-a-channel">1-To-1 notification by sending a value to a channel<a class="headerlink" href="#1-to-1-notification-by-sending-a-value-to-a-channel" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;sort&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">values</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">32</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">values</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">sort</span><span class="p">.</span><span class="nx">Slice</span><span class="p">(</span><span class="nx">values</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">&lt;</span> <span class="nx">values</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>
        <span class="p">})</span>
        <span class="c1">// notify sorting is done</span>
        <span class="nx">done</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
    <span class="p">}()</span>

    <span class="c1">// do some other things</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;other thing&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">values</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="1-to-1-notification-by-receiving-a-value-from-a-channel">1-To-1 notification by receiving a value from a channel<a class="headerlink" href="#1-to-1-notification-by-receiving-a-value-from-a-channel" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="o">&lt;-</span><span class="nx">done</span>
    <span class="p">}()</span>
    <span class="c1">// blocked here, wait for a notification</span>
    <span class="nx">done</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot; world&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>slowers notify the faster waiting for notifications.</p>
<h4 id="n-to-1-and-1-to-n-notifications">N-to-1 and 1-to-N notifications<a class="headerlink" href="#n-to-1-and-1-to-n-notifications" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="c1">// T type</span>
<span class="kd">type</span> <span class="nx">T</span> <span class="p">=</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="nx">worker</span><span class="p">(</span><span class="nx">id</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">ready</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">done</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">&lt;-</span><span class="nx">ready</span> <span class="c1">// block here and wait a notification</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;Worker#&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="s">&quot; starts.&quot;</span><span class="p">)</span>
    <span class="c1">// simulate a workload</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="nx">id</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;Worker#&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="s">&quot; job done.&quot;</span><span class="p">)</span>
    <span class="c1">// notify main goroutine (n-to-1)</span>
    <span class="nx">done</span> <span class="o">&lt;-</span> <span class="nx">T</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">SetFlags</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="nx">ready</span><span class="p">,</span> <span class="nx">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">T</span><span class="p">),</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">T</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">worker</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">ready</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">worker</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">ready</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">worker</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">ready</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span>

    <span class="c1">// simulate an initialization phase</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1">// 1-to-n notifications</span>
    <span class="nx">ready</span> <span class="o">&lt;-</span> <span class="nx">T</span><span class="p">{}</span>
    <span class="nx">ready</span> <span class="o">&lt;-</span> <span class="nx">T</span><span class="p">{}</span>
    <span class="nx">ready</span> <span class="o">&lt;-</span> <span class="nx">T</span><span class="p">{}</span>
    <span class="c1">// Being N-to-1 notified</span>
    <span class="o">&lt;-</span><span class="nx">done</span>
    <span class="o">&lt;-</span><span class="nx">done</span>
    <span class="o">&lt;-</span><span class="nx">done</span>
<span class="p">}</span>
</code></pre></div>


<p>更常见的使用 sync.WaitGroup 做 N-to-1，通过 close channels 实现 1-to-N.</p>
<h4 id="broadcast-1-to-n-notifications-by-closing-a-channel">Broadcast (1-To-N) notifications by closing a channel<a class="headerlink" href="#broadcast-1-to-n-notifications-by-closing-a-channel" title="Permanent link">&para;</a></h4>
<p>上例中的三个发送 ready 可以直接换成一个 close(ready)</p>
<h4 id="timer-scheduled-notification">Timer: scheduled notification<a class="headerlink" href="#timer-scheduled-notification" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">AfterDuration</span><span class="p">(</span><span class="nx">d</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{}</span> <span class="p">{</span>
    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{},</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
        <span class="nx">c</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">c</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;hi&quot;</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="nx">AfterDuration</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello!&quot;</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="nx">AfterDuration</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;bye&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>实际中使用 time.After</p>
<h2 id="use-channels-as-mutex-locks">Use Channels as Mutex Locks<a class="headerlink" href="#use-channels-as-mutex-locks" title="Permanent link">&para;</a></h2>
<p>two manners to use one-capacity bufferd channels as mutex locks.</p>
<ul>
<li>Lock through a send, unlock through a receive</li>
<li>Lock through a receive, unlock through a send</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1">// lock through send</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">mutex</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{},</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// capacity must be one</span>
    <span class="nx">counter</span> <span class="o">:=</span> <span class="mi">0</span>

    <span class="nx">increase</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">mutex</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span> <span class="c1">// lock</span>
        <span class="nx">counter</span><span class="o">++</span>
        <span class="o">&lt;-</span><span class="nx">mutex</span> <span class="c1">// unlock</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">n</span> <span class="p">=</span> <span class="mi">1000</span>
    <span class="nx">increase1000</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">done</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{})</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="nx">increase</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nx">done</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
    <span class="p">}</span>

    <span class="nx">done</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
    <span class="k">go</span> <span class="nx">increase1000</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">increase1000</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="nx">done</span>
    <span class="o">&lt;-</span><span class="nx">done</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">counter</span><span class="p">)</span> <span class="c1">//2000</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="use-channels-as-counting-semaphores">Use Channels as Counting Semaphores<a class="headerlink" href="#use-channels-as-counting-semaphores" title="Permanent link">&para;</a></h2>
<p>Buffered channels can be used as counting semaphores.
Counting semaphores can be viewed a multi-owner locks, can have most N owners at any time.</p>
<ul>
<li>Acquire ownership through a send, release through a receive</li>
<li>Acquire ownership through a receive, release through a send</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1">// acquire-through-receiving.go</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Seat</span> <span class="kt">int</span>
<span class="kd">type</span> <span class="nx">Bar</span> <span class="kd">chan</span> <span class="nx">Seat</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">bar</span> <span class="nx">Bar</span><span class="p">)</span> <span class="nx">ServeCustomer</span><span class="p">(</span><span class="nx">c</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;costomer#&quot;</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="s">&quot; enters the bar&quot;</span><span class="p">)</span>
    <span class="nx">seat</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">bar</span> <span class="c1">// need a seat to drink</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;++ customer#&quot;</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="s">&quot; drinks at seat#&quot;</span><span class="p">,</span> <span class="nx">seat</span><span class="p">)</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="mi">6</span><span class="p">)))</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;-- customer#&quot;</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="s">&quot; free seat#&quot;</span><span class="p">,</span> <span class="nx">seat</span><span class="p">)</span>
    <span class="nx">bar</span> <span class="o">&lt;-</span> <span class="nx">seat</span> <span class="c1">// free seat and leave the bar</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>

    <span class="nx">bar24x7</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="nx">Bar</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">// bar24x7 has 10 seat</span>
    <span class="k">for</span> <span class="nx">seatId</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">seatId</span> <span class="p">&lt;</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">bar24x7</span><span class="p">);</span> <span class="nx">seatId</span><span class="o">++</span> <span class="p">{</span>
        <span class="c1">// None of the sends will blocks</span>
        <span class="nx">bar24x7</span> <span class="o">&lt;-</span> <span class="nx">Seat</span><span class="p">(</span><span class="nx">seatId</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">customerId</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="nx">customerId</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="k">go</span> <span class="nx">bar24x7</span><span class="p">.</span><span class="nx">ServeCustomer</span><span class="p">(</span><span class="nx">customerId</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// sleeping != blocking</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="c1">// channeltest/go101/acquire-through-sending.go</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Customer</span> <span class="kd">struct</span><span class="p">{</span> <span class="nx">id</span> <span class="kt">int</span> <span class="p">}</span>
<span class="kd">type</span> <span class="nx">Bar</span> <span class="kd">chan</span> <span class="nx">Customer</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">bar</span> <span class="nx">Bar</span><span class="p">)</span> <span class="nx">ServeCustomer</span><span class="p">(</span><span class="nx">c</span> <span class="nx">Customer</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;++ customer#&quot;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s">&quot; staring drinking&quot;</span><span class="p">)</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="mi">16</span><span class="p">)))</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;-- customer#&quot;</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="s">&quot; leaves the bar&quot;</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="nx">bar</span> <span class="c1">// leaves the bar and save a space</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>

    <span class="nx">bar24x7</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="nx">Bar</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">// bar24x7 has 10 seat</span>
    <span class="k">for</span> <span class="nx">customerId</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="nx">customerId</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="nx">customer</span> <span class="o">:=</span> <span class="nx">Customer</span><span class="p">{</span><span class="nx">customerId</span><span class="p">}</span>
        <span class="nx">bar24x7</span> <span class="o">&lt;-</span> <span class="nx">customer</span>
        <span class="k">go</span> <span class="nx">bar24x7</span><span class="p">.</span><span class="nx">ServeCustomer</span><span class="p">(</span><span class="nx">customer</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>


<h2 id="dialogueping-pong">Dialogue(Ping-Pong)<a class="headerlink" href="#dialogueping-pong" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="c1">// channeltest/go101/two-goroutines-dialogue-through-channel.go</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Ball</span> <span class="kt">uint64</span>

<span class="kd">func</span> <span class="nx">Play</span><span class="p">(</span><span class="nx">playerName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">table</span> <span class="kd">chan</span> <span class="nx">Ball</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lastValue</span> <span class="nx">Ball</span> <span class="p">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">ball</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">table</span> <span class="c1">//get the ball</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">playerName</span><span class="p">,</span> <span class="nx">ball</span><span class="p">)</span>
        <span class="nx">ball</span> <span class="o">+=</span> <span class="nx">lastValue</span>
        <span class="k">if</span> <span class="nx">ball</span> <span class="p">&lt;</span> <span class="nx">lastValue</span> <span class="p">{</span> <span class="c1">// overflow</span>
            <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">lastValue</span> <span class="p">=</span> <span class="nx">ball</span>
        <span class="nx">table</span> <span class="o">&lt;-</span> <span class="nx">ball</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">table</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">Ball</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">table</span> <span class="o">&lt;-</span> <span class="mi">1</span> <span class="c1">// throw ball on table,开球</span>
    <span class="p">}()</span>
    <span class="k">go</span> <span class="nx">Play</span><span class="p">(</span><span class="s">&quot;A:&quot;</span><span class="p">,</span> <span class="nx">table</span><span class="p">)</span>
    <span class="nx">Play</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="nx">table</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="channel-encapsulated-in-channel">Channel Encapsulated in Channel<a class="headerlink" href="#channel-encapsulated-in-channel" title="Permanent link">&para;</a></h2>
<p>We can use a channel type as the element of another channel type.</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="o">//</span> <span class="err">元素类型是一个</span> <span class="n">send</span> <span class="n">only</span> <span class="n">channel</span> <span class="nb">type</span> <span class="n">chan</span> <span class="o">&lt;-</span> <span class="nb">int</span>
<span class="n">var</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">)</span> <span class="n">chan</span><span class="o">&lt;-</span> <span class="n">chan</span><span class="o">&lt;-</span> <span class="nb">int</span> <span class="p">{</span>
    <span class="n">requests</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">chan</span><span class="o">&lt;-</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">request</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">requests</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">request</span> <span class="o">==</span> <span class="n">nil</span> <span class="p">{</span>
                <span class="n">n</span><span class="o">++</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">request</span> <span class="o">&lt;-</span> <span class="n">n</span> <span class="o">//</span> <span class="n">take</span> <span class="n">out</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="n">requests</span> <span class="o">//</span> <span class="n">implicitly</span> <span class="n">converted</span> <span class="n">to</span> <span class="n">chan</span><span class="o">&lt;-</span> <span class="p">(</span><span class="n">chan</span><span class="o">&lt;-</span> <span class="nb">int</span><span class="p">)</span>
<span class="p">}(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">increase1000</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">done</span> <span class="n">chan</span><span class="o">&lt;-</span> <span class="n">struct</span><span class="p">{})</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="n">counter</span> <span class="o">&lt;-</span> <span class="n">nil</span>
        <span class="p">}</span>
        <span class="n">done</span> <span class="o">&lt;-</span> <span class="n">struct</span><span class="p">{}{}</span>
    <span class="p">}</span>

    <span class="n">done</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">struct</span><span class="p">{})</span>
    <span class="n">go</span> <span class="n">increase1000</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
    <span class="n">go</span> <span class="n">increase1000</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="n">done</span>
    <span class="o">&lt;-</span><span class="n">done</span>

    <span class="n">request</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">&lt;-</span> <span class="n">request</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="n">request</span><span class="p">)</span> <span class="o">//</span><span class="mi">2000</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="check-lengths-and-capacities-of-channels">Check Lengths and Capacities of Channels<a class="headerlink" href="#check-lengths-and-capacities-of-channels" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code><span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nx">value</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c</span>
    <span class="c1">// use value</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">&lt;</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span> <span class="o">&lt;-</span> <span class="nx">aValue</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="block-the-current-goroutine-forever">Block the Current Goroutine Forever<a class="headerlink" href="#block-the-current-goroutine-forever" title="Permanent link">&para;</a></h2>
<p>We can use a blank select block <code>select{}</code> to block the current goroutine for ever.
Generally, <code>select{}</code> is used to prevent the main goroutine from exiting, for if the main goroutine exits, the whole
program will also exit.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;runtime&quot;</span>

<span class="kd">func</span> <span class="nx">DoSomething</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="c1">// do something</span>
        <span class="nx">runtime</span><span class="p">.</span><span class="nx">Gosched</span><span class="p">()</span> <span class="c1">// avoid being greddy</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">go</span> <span class="nx">DoSomething</span><span class="p">()</span>
    <span class="k">go</span> <span class="nx">DoSomething</span><span class="p">()</span>
    <span class="k">select</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>


<h2 id="try-send-and-try-receive">Try-Send and Try-Receive<a class="headerlink" href="#try-send-and-try-receive" title="Permanent link">&para;</a></h2>
<p>A select block with one &ldquo;default&rdquo; branch and only one case branch is called a try-send or try-receive channel operation.
Try-Send and Try-Receive operations never block.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">type</span> <span class="nx">Book</span> <span class="kd">struct</span><span class="p">{</span> <span class="nx">id</span> <span class="kt">int</span> <span class="p">}</span>
    <span class="nx">bookshelf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">Book</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">bookshelf</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">bookshelf</span> <span class="o">&lt;-</span> <span class="nx">Book</span><span class="p">{</span><span class="nx">id</span><span class="p">:</span> <span class="nx">i</span><span class="p">}:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;succeed to put book&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;failed to put book&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">bookshelf</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">book</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">bookshelf</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;failed to get book&quot;</span><span class="p">,</span> <span class="nx">book</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;failed go get book&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="check-if-a-channel-is-closed-without-blocking-the-current-goroutine">Check if a channel is closed without blocking the current goroutine<a class="headerlink" href="#check-if-a-channel-is-closed-without-blocking-the-current-goroutine" title="Permanent link">&para;</a></h4>
<p>no values were ever(and will be) send to a channel, we can use the following code to
(concurrency and safetly) check whether or not the channel is already closed without blocking the current goroutine.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// T is the element type of the corresponding channel type</span>
<span class="kd">func</span> <span class="nx">IsClosed</span><span class="p">(</span><span class="nx">c</span> <span class="kd">chan</span> <span class="nx">T</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">c</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">default</span><span class="p">:</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="peakburst-limiting">Peak/burst limiting<a class="headerlink" href="#peakburst-limiting" title="Permanent link">&para;</a></h4>
<p>limit number of concurrent request without blocking any requests</p>
<h4 id="another-way-to-implement-the-first-response-wins-use-case">Another way to implement the first-response-wins use case<a class="headerlink" href="#another-way-to-implement-the-first-response-wins-use-case" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">source</span><span class="p">(</span><span class="nx">c</span> <span class="kd">chan</span><span class="o">&lt;-</span> <span class="kt">int32</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ra</span><span class="p">,</span> <span class="nx">rb</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Int31</span><span class="p">(),</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="nx">rb</span><span class="p">)</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">c</span> <span class="o">&lt;-</span> <span class="nx">ra</span><span class="p">:</span>
    <span class="k">default</span><span class="p">:</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>
    <span class="c1">// capacity should at least 1</span>
    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int32</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="nx">source</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">rnd</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c</span> <span class="c1">//only the first response is used</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">rnd</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="timeout">Timeout<a class="headerlink" href="#timeout" title="Permanent link">&para;</a></h4>
<p>请求超时返回 error</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">requestWithTimeout</span><span class="p">(</span><span class="nx">timeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">)</span>
    <span class="c1">// may need a long time to get the response.</span>
    <span class="k">go</span> <span class="nx">doRequest</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>

    <span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">data</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">c</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">data</span><span class="p">,</span> <span class="kc">nil</span>
    <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="nx">timeout</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;timeout&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="ticker">Ticker<a class="headerlink" href="#ticker" title="Permanent link">&para;</a></h4>
<p>We can use the try-send mechanism to implement a ticker.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="c1">// Tick implement, use time.Tick in practice, just show how to implement</span>
<span class="kd">func</span> <span class="nx">Tick</span><span class="p">(</span><span class="nx">d</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{}</span> <span class="p">{</span>
    <span class="c1">// capacity of c is best set as one</span>
    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{},</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="c1">// 一秒向 c send 一个值</span>
            <span class="k">select</span> <span class="p">{</span>
            <span class="k">case</span> <span class="nx">c</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}:</span>
            <span class="k">default</span><span class="p">:</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">c</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">t</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="c1">// 一秒输出一次</span>
    <span class="k">for</span> <span class="k">range</span> <span class="nx">Tick</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="rate-limiting">Rate Limiting<a class="headerlink" href="#rate-limiting" title="Permanent link">&para;</a></h4>
<p>use try-send to do rate limiting(with the help of a ticker).</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="c1">// https://github.com/golang/go/wiki/RateLimiting</span>

<span class="kd">type</span> <span class="nx">Request</span> <span class="kd">interface</span><span class="p">{}</span>

<span class="kd">func</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">r</span> <span class="nx">Request</span><span class="p">)</span> <span class="p">{</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">r</span><span class="p">.(</span><span class="kt">int</span><span class="p">))</span> <span class="p">}</span>

<span class="kd">const</span> <span class="nx">RateLimitPeriod</span> <span class="p">=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span>
<span class="kd">const</span> <span class="nx">RateLimit</span> <span class="p">=</span> <span class="mi">200</span> <span class="c1">// 一分钟最多200个请求</span>

<span class="kd">func</span> <span class="nx">handleRequests</span><span class="p">(</span><span class="nx">requests</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">quotas</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">,</span> <span class="nx">RateLimit</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">tick</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">NewTicker</span><span class="p">(</span><span class="nx">RateLimitPeriod</span> <span class="o">/</span> <span class="nx">RateLimit</span><span class="p">)</span>
        <span class="k">defer</span> <span class="nx">tick</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>
        <span class="k">for</span> <span class="nx">t</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">tick</span><span class="p">.</span><span class="nx">C</span> <span class="p">{</span>
            <span class="k">select</span> <span class="p">{</span>
            <span class="k">case</span> <span class="nx">quotas</span> <span class="o">&lt;-</span> <span class="nx">t</span><span class="p">:</span>
            <span class="k">default</span><span class="p">:</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">for</span> <span class="nx">r</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">requests</span> <span class="p">{</span>
        <span class="o">&lt;-</span><span class="nx">quotas</span>
        <span class="k">go</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">requests</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">Request</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">handleRequests</span><span class="p">(</span><span class="nx">requests</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">requests</span> <span class="o">&lt;-</span> <span class="nx">i</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="switches">Switches<a class="headerlink" href="#switches" title="Permanent link">&para;</a></h4>
<p>sending a value to or receiving a value from a nil channel are both blocking operations.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Ball</span> <span class="kt">uint8</span>

<span class="kd">func</span> <span class="nx">Play</span><span class="p">(</span><span class="nx">playerName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">table</span> <span class="kd">chan</span> <span class="nx">Ball</span><span class="p">,</span> <span class="nx">serve</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">receive</span><span class="p">,</span> <span class="nx">send</span> <span class="kd">chan</span> <span class="nx">Ball</span>
    <span class="k">if</span> <span class="nx">serve</span> <span class="p">{</span>
        <span class="nx">receive</span><span class="p">,</span> <span class="nx">send</span> <span class="p">=</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">table</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">receive</span><span class="p">,</span> <span class="nx">send</span> <span class="p">=</span> <span class="nx">table</span><span class="p">,</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">lastValue</span> <span class="nx">Ball</span> <span class="p">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">send</span> <span class="o">&lt;-</span> <span class="nx">lastValue</span><span class="p">:</span>
        <span class="k">case</span> <span class="nx">value</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">receive</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">playerName</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
            <span class="nx">value</span> <span class="o">+=</span> <span class="nx">lastValue</span>
            <span class="k">if</span> <span class="nx">value</span> <span class="p">&lt;</span> <span class="nx">lastValue</span> <span class="p">{</span>
                <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nx">lastValue</span> <span class="p">=</span> <span class="nx">value</span>
        <span class="p">}</span>
        <span class="c1">// switch on/off</span>
        <span class="nx">receive</span><span class="p">,</span> <span class="nx">send</span> <span class="p">=</span> <span class="nx">send</span><span class="p">,</span> <span class="nx">receive</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">table</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">Ball</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">Play</span><span class="p">(</span><span class="s">&quot;A:&quot;</span><span class="p">,</span> <span class="nx">table</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="nx">Play</span><span class="p">(</span><span class="s">&quot;B:&quot;</span><span class="p">,</span> <span class="nx">table</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="control-code-execution-possibility-weights">Control code execution possibility weights<a class="headerlink" href="#control-code-execution-possibility-weights" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">foo</span><span class="p">,</span> <span class="nx">bar</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{}),</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
    <span class="nb">close</span><span class="p">(</span><span class="nx">foo</span><span class="p">)</span>
    <span class="nb">close</span><span class="p">(</span><span class="nx">bar</span><span class="p">)</span>
    <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
    <span class="nx">f</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="nx">x</span><span class="o">++</span> <span class="p">}</span>
    <span class="nx">g</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="nx">y</span><span class="o">++</span> <span class="p">}</span>

    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">foo</span><span class="p">:</span> <span class="c1">// foo 这里大概调用次数是 bar 的两倍</span>
            <span class="nx">f</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">foo</span><span class="p">:</span>
            <span class="nx">f</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">bar</span><span class="p">:</span>
            <span class="nx">g</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">y</span><span class="p">)</span> <span class="c1">// 大概是 2</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="select-from-dynamic-number-cases">Select from dynamic number cases<a class="headerlink" href="#select-from-dynamic-number-cases" title="Permanent link">&para;</a></h4>
<p>reflect also provides TrySend and TryRecv functions to implement one-case-plus-default select blocks.</p>
<h2 id="data-flow-manipulations">Data Flow Manipulations<a class="headerlink" href="#data-flow-manipulations" title="Permanent link">&para;</a></h2>
<h4 id="data-generationcollectionloading">Data generation/collection/loading<a class="headerlink" href="#data-generationcollectionloading" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;encoding/binary&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">RandomGenerator</span><span class="p">()</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span> <span class="p">{</span>
    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">rnds</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">rnds</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nb">close</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nx">c</span> <span class="o">&lt;-</span> <span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">.</span><span class="nx">Uint64</span><span class="p">(</span><span class="nx">rnds</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">c</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">RandomGenerator</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="data-aggregation">Data aggregation<a class="headerlink" href="#data-aggregation" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="c1">// aggregates serveral data streams of the same data tyep into one stream</span>
<span class="kd">func</span> <span class="nx">Aggregator</span><span class="p">(</span><span class="nx">inputs</span> <span class="o">...&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">in</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">intputs</span> <span class="p">{</span>
        <span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nx">in</span> <span class="o">:=</span> <span class="nx">in</span> <span class="c1">// essential</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">{</span>
                <span class="nx">x</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">in</span>
                <span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
                    <span class="nx">output</span> <span class="o">&lt;-</span> <span class="nx">x</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}()</span>
    <span class="p">}</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
        <span class="nb">close</span><span class="p">(</span><span class="nx">output</span><span class="p">)</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">output</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;hehe&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="data-composition">Data composition<a class="headerlink" href="#data-composition" title="Permanent link">&para;</a></h4>
<p>A data composition worker merges several pieces of data from different input data streams into one piece of data.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Composor</span><span class="p">(</span><span class="nx">intA</span><span class="p">,</span> <span class="nx">intB</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="nx">a1</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a2</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">inA</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nx">inB</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nx">inA</span>
            <span class="nx">output</span> <span class="o">&lt;-</span> <span class="nx">a1</span> <span class="p">^</span> <span class="nx">b</span><span class="o">&amp;</span><span class="nx">a2</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">output</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="data-duplicationproliferation">Data duplication/proliferation<a class="headerlink" href="#data-duplicationproliferation" title="Permanent link">&para;</a></h4>
<p>One piece of data will be duplicated and each of the duplicated data will be sent to different output data streams.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Duplicator</span><span class="p">(</span><span class="nx">in</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span> <span class="p">(</span><span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">,</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">outA</span><span class="p">,</span> <span class="nx">outB</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">),</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="nx">x</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">in</span>
            <span class="nx">outA</span> <span class="o">&lt;-</span> <span class="nx">x</span>
            <span class="nx">outB</span> <span class="o">&lt;-</span> <span class="nx">x</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">outA</span><span class="p">,</span> <span class="nx">outB</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="data-calculationanalysis">Data calculation/analysis<a class="headerlink" href="#data-calculationanalysis" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Calculator</span><span class="p">(</span><span class="nx">in</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">,</span> <span class="nx">out</span> <span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">out</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">in</span>
        <span class="nx">out</span> <span class="o">&lt;-</span> <span class="p">^</span><span class="nx">x</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">out</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="data-validationfiltering">Data validation/filtering<a class="headerlink" href="#data-validationfiltering" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Filter</span><span class="p">(</span><span class="nx">input</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">,</span> <span class="nx">output</span> <span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">output</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">output</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">bigInt</span> <span class="o">:=</span> <span class="nx">big</span><span class="p">.</span><span class="nx">NewInt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="nx">x</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">input</span>
            <span class="nx">bigInt</span><span class="p">.</span><span class="nx">SetUint64</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">bigInt</span><span class="p">.</span><span class="nx">ProbablyPrime</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">output</span> <span class="o">&lt;-</span> <span class="nx">x</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">return</span> <span class="nx">output</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="data-servingsaving">Data serving/saving<a class="headerlink" href="#data-servingsaving" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">Printer</span><span class="p">(</span><span class="nx">input</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">uint64</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">x</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">input</span>
        <span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="data-flow-system-assembling">Data flow system assembling<a class="headerlink" href="#data-flow-system-assembling" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Printer</span><span class="p">(</span>
        <span class="nx">Filter</span><span class="p">(</span>
            <span class="nx">Calculator</span><span class="p">(</span>
                <span class="nx">RandomGenerator</span><span class="p">(),</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="how-to-gracefully-close-channels">How to Gracefully Close Channels<a class="headerlink" href="#how-to-gracefully-close-channels" title="Permanent link">&para;</a></h1>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>

<span class="kd">type</span> <span class="nx">T</span> <span class="kt">int</span>

<span class="kd">func</span> <span class="nx">IsClosed</span><span class="p">(</span><span class="nx">ch</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="nx">T</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">ch</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">default</span><span class="p">:</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">T</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">IsClosed</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
    <span class="nb">close</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">IsClosed</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="channel-closing-principle">Channel Closing Principle<a class="headerlink" href="#channel-closing-principle" title="Permanent link">&para;</a></h4>
<ul>
<li>don&rsquo;t close a channel from the receiver side and don&rsquo;t close a channel if the channel has multiple concurrent senders.</li>
<li>don&rsquo;t close (or send values to) closed channels</li>
</ul>
<h4 id="solutions-which-close-channels-rudely">Solutions which Close Channels Rudely<a class="headerlink" href="#solutions-which-close-channels-rudely" title="Permanent link">&para;</a></h4>
<p>use recover prevent possible panic.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kd">type</span> <span class="nx">T</span> <span class="kt">int</span>

<span class="c1">// breaking the channel closing principle</span>
<span class="kd">func</span> <span class="nx">SafeClose</span><span class="p">(</span><span class="nx">ch</span> <span class="kd">chan</span> <span class="nx">T</span><span class="p">)</span> <span class="p">(</span><span class="nx">justClosed</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nb">recover</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">justClosed</span> <span class="p">=</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="nb">close</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">SafeSend</span><span class="p">(</span><span class="nx">ch</span> <span class="kd">chan</span> <span class="nx">T</span><span class="p">,</span> <span class="nx">vlue</span> <span class="nx">T</span><span class="p">)</span> <span class="p">(</span><span class="nx">closed</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nb">recover</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">closed</span> <span class="p">=</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="nx">ch</span> <span class="o">&lt;-</span> <span class="nx">value</span>
    <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="solutions-which-close-channels-politely">Solutions Which Close Channels Politely<a class="headerlink" href="#solutions-which-close-channels-politely" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;sync&quot;</span>

<span class="kd">type</span> <span class="nx">T</span> <span class="kt">int</span>

<span class="c1">// use sync.Once to close channels</span>
<span class="kd">type</span> <span class="nx">MyChannelOnce</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">C</span>    <span class="kd">chan</span> <span class="nx">T</span>
    <span class="nx">once</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Once</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">NewMyChannelOnce</span><span class="p">()</span> <span class="o">*</span><span class="nx">MyChannelOnce</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">MyChannelOnce</span><span class="p">{</span><span class="nx">C</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">T</span><span class="p">)}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">mc</span> <span class="o">*</span><span class="nx">MyChannelOnce</span><span class="p">)</span> <span class="nx">SafeClose</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">mc</span><span class="p">.</span><span class="nx">once</span><span class="p">.</span><span class="nx">Do</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">close</span><span class="p">(</span><span class="nx">mc</span><span class="p">.</span><span class="nx">c</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>

<span class="c1">// We can also use sync.Mutex to avoid closing a channel multiple times</span>

<span class="kd">type</span> <span class="nx">MyChannel</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">C</span>      <span class="kd">chan</span> <span class="nx">T</span>
    <span class="nx">closed</span> <span class="kt">bool</span>
    <span class="nx">mutex</span>  <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">NewMyChannel</span><span class="p">()</span> <span class="o">*</span><span class="nx">MyChannel</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">MyChannel</span><span class="p">{</span><span class="nx">C</span><span class="p">:</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">T</span><span class="p">)}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">mc</span> <span class="o">*</span><span class="nx">MyChannel</span><span class="p">)</span> <span class="nx">SafeClose</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">mc</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">mc</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">!</span><span class="nx">mc</span><span class="p">.</span><span class="nx">closed</span> <span class="p">{</span>
        <span class="nb">close</span><span class="p">(</span><span class="nx">mc</span><span class="p">.</span><span class="nx">C</span><span class="p">)</span>
        <span class="nx">mc</span><span class="p">.</span><span class="nx">closed</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">mc</span> <span class="o">*</span><span class="nx">MyChannel</span><span class="p">)</span> <span class="nx">IsClosed</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">mc</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">mc</span><span class="p">.</span><span class="nx">mutex</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">mc</span><span class="p">.</span><span class="nx">closed</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="solutions-which-close-channels-gracefully">Solutions Which Close Channels Gracefully<a class="headerlink" href="#solutions-which-close-channels-gracefully" title="Permanent link">&para;</a></h4>
<h6 id="m-receivers-one-sender-the-sender-says-no-more-sends-by-closing-the-data-channel">M receivers, one sender, the sender says &ldquo;no more sends&rdquo; by closing the data channel<a class="headerlink" href="#m-receivers-one-sender-the-sender-says-no-more-sends-by-closing-the-data-channel" title="Permanent link">&para;</a></h6>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;sync&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">SetFlags</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">//...</span>
    <span class="kd">const</span> <span class="nx">Max</span> <span class="p">=</span> <span class="mi">100000</span>
    <span class="kd">const</span> <span class="nx">NumReceivers</span> <span class="p">=</span> <span class="mi">100</span>
    <span class="nx">wgReceivers</span> <span class="o">:=</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="p">{}</span>
    <span class="nx">wgReceivers</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">NumReceivers</span><span class="p">)</span>

    <span class="c1">//...</span>
    <span class="nx">dataCh</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="c1">// the sender</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nx">value</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="nx">Max</span><span class="p">);</span> <span class="nx">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="c1">// the only sender can close the channel safely</span>
                <span class="nb">close</span><span class="p">(</span><span class="nx">dataCh</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">dataCh</span> <span class="o">&lt;-</span> <span class="nx">value</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}()</span>

    <span class="c1">// receivers</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">NumReceivers</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">defer</span> <span class="nx">wgReceivers</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
            <span class="c1">// receive until closed</span>
            <span class="k">for</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">dataCh</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}()</span>
    <span class="p">}</span>
    <span class="nx">wgReceivers</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="one-receiver-n-senders-the-only-receiver-says-please-stop-sending-more-by-closing-an-additional-signal-channel">One receiver, N senders, the only receiver says &ldquo;please stop sending more&rdquo; by closing an additional signal channel<a class="headerlink" href="#one-receiver-n-senders-the-only-receiver-says-please-stop-sending-more-by-closing-an-additional-signal-channel" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;sync&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">SetFlags</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">//...</span>
    <span class="kd">const</span> <span class="nx">Max</span> <span class="p">=</span> <span class="mi">100000</span>
    <span class="kd">const</span> <span class="nx">NumSenders</span> <span class="p">=</span> <span class="mi">1000</span>

    <span class="nx">wgReceivers</span> <span class="o">:=</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="p">{}</span>
    <span class="nx">wgReceivers</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nx">dataCh</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nx">stopCh</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>

    <span class="c1">//senders</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">NumSenders</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">{</span>
                <span class="k">select</span> <span class="p">{</span> <span class="c1">// try-receive, try to exit the goroutine as early as possible</span>
                <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">stopCh</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">default</span><span class="p">:</span>
                <span class="p">}</span>

            <span class="p">}</span>

            <span class="k">select</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">stopCh</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">case</span> <span class="nx">dataCh</span> <span class="o">&lt;-</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="nx">Max</span><span class="p">):</span>
            <span class="p">}</span>
        <span class="p">}()</span>
    <span class="p">}</span>

    <span class="c1">// the receiver</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">defer</span> <span class="nx">wgReceivers</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
        <span class="k">for</span> <span class="nx">value</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">dataCh</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nx">value</span> <span class="o">==</span> <span class="nx">Max</span><span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
                <span class="nb">close</span><span class="p">(</span><span class="nx">stopCh</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="nx">wgReceivers</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// this example dataCh is never closed. A channel will eventually garbage collected if no goroutines reference it any</span>
<span class="c1">// more, whether it is closed or not.</span>
</code></pre></div>


<h4 id="m-receivers-n-senders-any-one-of-them-says-lets-end-the-game-by-notifying-a-moderator-to-close-an-additional-signal-channel">M receivers, N senders, any one of them says &ldquo;let&rsquo;s end the game&rdquo; by notifying a moderator to close an additional signal channel<a class="headerlink" href="#m-receivers-n-senders-any-one-of-them-says-lets-end-the-game-by-notifying-a-moderator-to-close-an-additional-signal-channel" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;strconv&quot;</span>
    <span class="s">&quot;sync&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">SetFlags</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="kd">const</span> <span class="nx">Max</span> <span class="p">=</span> <span class="mi">100000</span>
    <span class="kd">const</span> <span class="nx">NumReceivers</span> <span class="p">=</span> <span class="mi">10</span>
    <span class="kd">const</span> <span class="nx">NumSenders</span> <span class="p">=</span> <span class="mi">1000</span>

    <span class="nx">wgReceivers</span> <span class="o">:=</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="p">{}</span>
    <span class="nx">wgReceivers</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">NumReceivers</span><span class="p">)</span>

    <span class="nx">dataCh</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="nx">stopCh</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
    <span class="c1">// toStop is used to notify the moderator to close the additional signal channel(stopCh)</span>
    <span class="c1">// cap is 1, avoid the first notification is missed when it is sent before the moderator goroutine gets ready to</span>
    <span class="c1">// receive notification from toStop</span>
    <span class="nx">toStop</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">stoppedBy</span> <span class="kt">string</span>

    <span class="c1">// moderator</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">stoppedBy</span> <span class="p">=</span> <span class="o">&lt;-</span><span class="nx">toStop</span>
        <span class="nb">close</span><span class="p">(</span><span class="nx">stopCh</span><span class="p">)</span>
    <span class="p">}()</span>
    <span class="c1">//senders</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">NumSenders</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">id</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">{</span>
                <span class="nx">value</span> <span class="o">:=</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="nx">Max</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                    <span class="c1">// try-send operation is to notify the moderator to clsoe signal channel</span>
                    <span class="k">select</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="nx">toStop</span> <span class="o">&lt;-</span> <span class="s">&quot;sender#&quot;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">:</span>
                    <span class="k">default</span><span class="p">:</span>
                    <span class="p">}</span>
                    <span class="k">return</span>
                <span class="p">}</span>
                <span class="c1">//try-receive here is to try to exit sender goroutine as early as possible.(optimized by go standard cimpiler)</span>
                <span class="k">select</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">stopCh</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">default</span><span class="p">:</span>
                <span class="p">}</span>

                <span class="c1">// even if stopCh is closed, the first branch in this select block might be still not selected for some</span>
                <span class="c1">// loops(and for ever in theory) if the send to dataCh is also non-blocking. If this is unacceptable,</span>
                <span class="c1">// then the above try-receive operation is essential.</span>
                <span class="k">select</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">stopCh</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">case</span> <span class="nx">dataCh</span> <span class="o">&lt;-</span> <span class="nx">value</span><span class="p">:</span>
                <span class="p">}</span>

            <span class="p">}</span>
        <span class="p">}(</span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="c1">// receivers</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">NumReceivers</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">id</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">defer</span> <span class="nx">wgReceivers</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
            <span class="k">for</span> <span class="p">{</span>
                <span class="c1">// try-receive try to exit early</span>
                <span class="k">select</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">stopCh</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">default</span><span class="p">:</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">select</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">stopCh</span><span class="p">:</span>
                <span class="nx">retrurn</span>
            <span class="k">case</span> <span class="nx">value</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">dataCh</span><span class="p">:</span>
                <span class="k">if</span> <span class="nx">value</span> <span class="o">==</span> <span class="nx">Max</span><span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
                    <span class="c1">//notify moderator to close the additional signal channel</span>
                    <span class="k">select</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="nx">toStop</span> <span class="o">&lt;=</span> <span class="s">&quot;receiver#&quot;</span><span class="o">+</span><span class="nx">id</span><span class="p">:</span>
                    <span class="k">default</span><span class="p">:</span>
                    <span class="p">}</span>
                    <span class="k">return</span>
                <span class="p">}</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">Pritln</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}(</span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="c1">//....</span>
    <span class="nx">wgReceivers</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;stopped by&quot;</span><span class="p">,</span> <span class="nx">stoppedBy</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="concurrency-synchronization-techniques-provided-in-the-sync-standard-package">Concurrency Synchronization Techniques Provided in the sync Standard Package<a class="headerlink" href="#concurrency-synchronization-techniques-provided-in-the-sync-standard-package" title="Permanent link">&para;</a></h1>
<p>For the specialized circumstances, sync are more efficient and more readable.</p>
<p>NOTE: To avoid abnormal behaviors, it is best not to copy the values of the types int the sync standard package.</p>
<h3 id="the-syncwaitgroup-type">The sync.WaitGroup Type<a class="headerlink" href="#the-syncwaitgroup-type" title="Permanent link">&para;</a></h3>
<p>Each sync.WaitGroup value maintains a counter(init 0) internally.</p>
<p>Used for one goroutine waits until all of several other goroutines finish their respective jobs.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;sync&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>

    <span class="kd">const</span> <span class="nx">N</span> <span class="p">=</span> <span class="mi">5</span>
    <span class="kd">var</span> <span class="nx">values</span> <span class="p">[</span><span class="nx">N</span><span class="p">]</span><span class="kt">int32</span>
    <span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
    <span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">N</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">i</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="mi">50</span> <span class="o">+</span> <span class="nx">rand</span><span class="p">.</span><span class="nx">Int31n</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Done:&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
            <span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span> <span class="c1">// &lt;==&gt; wg.Add(-1)</span>
        <span class="p">}()</span>
    <span class="p">}</span>
    <span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
    <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;values:&quot;</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="the-synconce-type">The sync.Once Type<a class="headerlink" href="#the-synconce-type" title="Permanent link">&para;</a></h3>
<p>The code in the invoked argument function is guaranteed to be executed before any o.Do method call returns.</p>
<h3 id="the-syncmutex-and-syncrwmutex-types">The sync.Mutex and sync.RWMutex Types<a class="headerlink" href="#the-syncmutex-and-syncrwmutex-types" title="Permanent link">&para;</a></h3>
<p>Both implements sync.Locker (Lock/Unlock). m.Lock/m.UnLock() are shortands of (&amp;m).Lock() and (&amp;m).Unlock()</p>
<p>A lock doesn&rsquo;t know which goroutine acquired it, and any goroutine can release a lock which in acquired status.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;runtime&quot;</span>
    <span class="s">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Counter</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">m</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
    <span class="nx">n</span> <span class="kt">uint64</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Counter</span><span class="p">)</span> <span class="nx">Value</span><span class="p">()</span> <span class="kt">uint64</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">m</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">c</span><span class="p">.</span><span class="nx">m</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">n</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Counter</span><span class="p">)</span> <span class="nx">Increase</span><span class="p">(</span><span class="nx">delta</span> <span class="kt">uint64</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">m</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="nx">delta</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">m</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="nx">Counter</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">for</span> <span class="nx">k</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="p">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span> <span class="p">{</span>
                <span class="nx">c</span><span class="p">.</span><span class="nx">Increase</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}()</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">c</span><span class="p">.</span><span class="nx">Value</span><span class="p">()</span> <span class="p">&lt;</span> <span class="mi">10000</span> <span class="p">{</span>
        <span class="nx">runtime</span><span class="p">.</span><span class="nx">Gosched</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">Value</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// use rwmutex for better performance</span>
<span class="kd">type</span> <span class="nx">Counter</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="c1">// m sync.Mutex</span>
    <span class="nx">m</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
    <span class="nx">n</span> <span class="kt">uint64</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Counter</span><span class="p">)</span> <span class="nx">Value</span><span class="p">()</span> <span class="kt">uint64</span> <span class="p">{</span>
    <span class="c1">// c.m.Lock()</span>
    <span class="c1">// defer c.m.Unlock()</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">m</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">c</span><span class="p">.</span><span class="nx">m</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">n</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="type-synccond-type">Type sync.Cond Type<a class="headerlink" href="#type-synccond-type" title="Permanent link">&para;</a></h3>
<p>Notifications among goroutines. Wait(), Signal(), Broadcast()</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;math/rand&quot;</span>
    <span class="s">&quot;sync&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">rand</span><span class="p">.</span><span class="nx">Seed</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">UnixNano</span><span class="p">())</span>
    <span class="kd">const</span> <span class="nx">N</span> <span class="p">=</span> <span class="mi">10</span>
    <span class="kd">var</span> <span class="nx">values</span> <span class="p">[</span><span class="nx">N</span><span class="p">]</span><span class="kt">string</span>
    <span class="nx">cond</span> <span class="o">:=</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">NewCond</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span><span class="p">{})</span>
    <span class="nx">cond</span><span class="p">.</span><span class="nx">L</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">d</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">(</span><span class="nx">rand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">(</span><span class="nx">i</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span>
            <span class="nx">cond</span><span class="p">.</span><span class="nx">L</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
            <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">=</span> <span class="nb">string</span><span class="p">(</span><span class="sc">&#39;a&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">)</span>
            <span class="c1">// notify when cond.L lock is released</span>
            <span class="nx">cond</span><span class="p">.</span><span class="nx">Broadcast</span><span class="p">()</span>
            <span class="nx">cond</span><span class="p">.</span><span class="nx">L</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
        <span class="p">}(</span><span class="nx">i</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// must be called when cond.L is locked</span>
    <span class="nx">checkCondition</span> <span class="o">:=</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">values</span><span class="p">)</span>
        <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">!</span><span class="nx">checkCondition</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// must be called wen cond.L is locked</span>
        <span class="nx">cond</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">cond</span><span class="p">.</span><span class="nx">L</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="atomic-operations-provided-in-the-syncatomic-standard-package">Atomic Operations Provided in The sync/atomic Standard Package<a class="headerlink" href="#atomic-operations-provided-in-the-syncatomic-standard-package" title="Permanent link">&para;</a></h1>
<h3 id="overview-of-atomic-operations-provided-in-go">Overview of Atomic Operations Provided in Go<a class="headerlink" href="#overview-of-atomic-operations-provided-in-go" title="Permanent link">&para;</a></h3>
<p>AddT/LoadT/StoreT/SwapT/CompareAndSwapT, T must be any of int32,int64,uin32,uint64 and uintptr.</p>
<p>Value.Load, Value.Store.</p>
<h3 id="atomic-operations-for-integers">Atomic Operations for Integers<a class="headerlink" href="#atomic-operations-for-integers" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;sync&quot;</span>
    <span class="s">&quot;sync/atomic&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">n</span> <span class="kt">int32</span>
    <span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
    <span class="c1">// 1000 个 gouroutine 同时进行 +1 操作</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">atomic</span><span class="p">.</span><span class="nx">AddInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
        <span class="p">}()</span>
    <span class="p">}</span>
    <span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">atomic</span><span class="p">.</span><span class="nx">LoadInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">n</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<p>StoreT and LoadT atomic functions are often used to implement the setter/getter methods of a type if the values of the
type need to be used concurrently.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">type</span> <span class="nx">Page</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">views</span> <span class="kt">uint32</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">page</span> <span class="o">*</span><span class="nx">Page</span><span class="p">)</span> <span class="nx">SetViews</span><span class="p">(</span><span class="nx">n</span> <span class="kt">uint32</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">atomic</span><span class="p">.</span><span class="nx">StoreUint32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">page</span><span class="p">.</span><span class="nx">views</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">page</span> <span class="o">*</span><span class="nx">Page</span><span class="p">)</span> <span class="nx">Views</span><span class="p">()</span> <span class="kt">uint32</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">atomic</span><span class="p">.</span><span class="nx">LoadUint32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">page</span><span class="p">.</span><span class="nx">views</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="atomic-operations-for-pointers">Atomic Operations for Pointers<a class="headerlink" href="#atomic-operations-for-pointers" title="Permanent link">&para;</a></h3>
<h3 id="atomic-operations-for-values-of-arbitrary-types">Atomic Operations for Values of Arbitrary Types<a class="headerlink" href="#atomic-operations-for-values-of-arbitrary-types" title="Permanent link">&para;</a></h3>
<p>The Value type provided in the sync/atomic standard pacakge can be used to atomically load and store values of any type.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;sync/atomic&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">type</span> <span class="nx">T</span> <span class="kd">struct</span><span class="p">{</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span> <span class="kt">int</span> <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">ta</span> <span class="p">=</span> <span class="nx">T</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
    <span class="kd">var</span> <span class="nx">v</span> <span class="nx">atomic</span><span class="p">.</span><span class="nx">Value</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">Store</span><span class="p">(</span><span class="nx">ta</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">tb</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Load</span><span class="p">().(</span><span class="nx">T</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">tb</span><span class="p">)</span>       <span class="c1">//{1,2,3}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">ta</span> <span class="o">==</span> <span class="nx">tb</span><span class="p">)</span> <span class="c1">//true</span>

    <span class="c1">// panic, store的后续调用需要和之前类型保持一致</span>
    <span class="c1">// v.Store(&quot;hello&quot;)</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="memory-order-guarantees-in-go">Memory Order Guarantees in Go<a class="headerlink" href="#memory-order-guarantees-in-go" title="Permanent link">&para;</a></h1>
<p>很多编译器和 cpu 经常会对指令顺序做一些优化，导致和原始的代码可能不同。Instruction ordering is also often called memory
ordering.</p>
<p><code>go build -race</code> to check data races in the program.</p>
<h3 id="go-memory-model">Go Memory Model<a class="headerlink" href="#go-memory-model" title="Permanent link">&para;</a></h3>
<h4 id="the-creation-of-a-gouroutine-happens-before-the-execution-of-the-goroutine">The creation of a gouroutine happens before the execution of the goroutine<a class="headerlink" href="#the-creation-of-a-gouroutine-happens-before-the-execution-of-the-goroutine" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;fmt&quot;</span>

<span class="kd">var</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="kt">int</span>

<span class="kd">func</span> <span class="nx">f1</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="p">=</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">789</span> <span class="c1">// 先于 fmt.Println(x) 执行</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="c1">// 先于 fmt.Println(y) 执行</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
        <span class="p">}()</span>
    <span class="p">}()</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="channel-operations-related-order-guarantees">Channel operations related order guarantees<a class="headerlink" href="#channel-operations-related-order-guarantees" title="Permanent link">&para;</a></h4>
<ul>
<li>The nth successful send to a channel happens before the nth successful receive from that channel completes(no matter
    buffered or not)</li>
<li>The nth successful receive from a channel with capacity m happens before the (n+m)th successful send to that channel
    completes.</li>
<li>The closing of a channel happens before a receive completes if the receive returns a zero value because the channel is
    closed.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">f3</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">bool</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="p">=</span> <span class="mi">1</span>
        <span class="nx">c</span> <span class="o">&lt;-</span> <span class="kc">true</span>
        <span class="k">if</span> <span class="nx">b</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;b!=1&quot;</span><span class="p">)</span> <span class="c1">// will never happen</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">b</span> <span class="p">=</span> <span class="mi">1</span>
        <span class="o">&lt;-</span><span class="nx">c</span>
        <span class="k">if</span> <span class="nx">a</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;a!=1&quot;</span><span class="p">)</span> <span class="c1">// will never happen</span>
        <span class="p">}</span>
    <span class="p">}()</span>
<span class="p">}</span>
</code></pre></div>


<h4 id="mutex-related-order-guarantees">Mutex related order guarantees<a class="headerlink" href="#mutex-related-order-guarantees" title="Permanent link">&para;</a></h4>
<ul>
<li>For an addressable value m of type Mutex/RWMutex in the sync, the nth successful m.Unlock() call happens before n+1th m.Lock() returns</li>
<li>For an addressable value m of type RWMutex, if its nth rw.Lock() method call has returned, the its successful nth
    rw.Unlock() method call happens before the return of any rw.RLock() method call which is guaranteed to happen after
    the nth rw.Lock() method call returns.</li>
<li>For an addressable value m of type RWMutex, if its rw.RLock() method call has returned, then its mth successful
    rw.RUnlock() method call, where <code>m&lt;=n</code>, happens before the return of any rw.Lock() method call which is guaranteed to
    happen after the nth rw.RLock() method call returns.</li>
</ul>
<h4 id="order-guarantees-made-by-syncwaitgroup-values">Order guarantees made by sync.WaitGroup values<a class="headerlink" href="#order-guarantees-made-by-syncwaitgroup-values" title="Permanent link">&para;</a></h4>
<p>before wg.Wait method call returns</p>
<h4 id="order-guarantees-made-by-synconce-values">Order guarantees made by sync.Once values<a class="headerlink" href="#order-guarantees-made-by-synconce-values" title="Permanent link">&para;</a></h4>
<h4 id="atomic-opeartions-related-order-guarantees">Atomic opeartions related order guarantees<a class="headerlink" href="#atomic-opeartions-related-order-guarantees" title="Permanent link">&para;</a></h4>
<p>Don&rsquo;t rely on atomic to guarantee ordering in general Go programming.</p>
<h1 id="common-concurrent-programming-mistakes">Common Concurrent Programming Mistakes<a class="headerlink" href="#common-concurrent-programming-mistakes" title="Permanent link">&para;</a></h1>
<h3 id="no-synchronizations-when-synchronizations-are-needed">No Synchronizations When Synchronizations Are Needed<a class="headerlink" href="#no-synchronizations-when-synchronizations-are-needed" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;runtime&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">testMightPanic</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="p">[]</span><span class="kt">int</span> <span class="c1">// nil</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="kt">bool</span>  <span class="c1">//false</span>

    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nx">b</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="p">}()</span>

    <span class="k">for</span> <span class="p">!</span><span class="nx">b</span> <span class="p">{</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">runtime</span><span class="p">.</span><span class="nx">Gosched</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="c1">// might panic</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="p">[]</span><span class="kt">int</span> <span class="p">=</span> <span class="kc">nil</span>
    <span class="nx">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kd">struct</span><span class="p">{})</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="nx">c</span> <span class="o">&lt;-</span> <span class="kd">struct</span><span class="p">{}{}</span>
    <span class="p">}()</span>
    <span class="o">&lt;-</span><span class="nx">c</span>
    <span class="c1">// will not panic for sure</span>
    <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="use-timesleep-calls-to-do-synchronizations">Use time.Sleep Calls to Do Synchronizations<a class="headerlink" href="#use-timesleep-calls-to-do-synchronizations" title="Permanent link">&para;</a></h3>
<p>We should never use time.Sleep calls to do synchronizations in formal projects.</p>
<h3 id="leave-goroutines-hanging">Leave Goroutines Hanging<a class="headerlink" href="#leave-goroutines-hanging" title="Permanent link">&para;</a></h3>
<p>Hanging goroutines are the goroutines staying in blocking state for ever.
Go runtime will never release the resources consumed by a hanging goroutine.</p>
<p>比如：永远接收不到值;值永远不会被接收;自己死锁;一组goroutines互相死锁;没有 default 的 select 并且所有 case
语句永远阻塞。</p>
<h3 id="copy-values-of-the-types-in-the-sync-standard-package">Copy Values of the Types in the sync Standard Package<a class="headerlink" href="#copy-values-of-the-types-in-the-sync-standard-package" title="Permanent link">&para;</a></h3>
<p>Values of types(except the Locker interface values) in the sync standard package should never be copied.
We should only copy pointers of such values.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;sync&quot;</span>

<span class="kd">type</span> <span class="nx">Counter</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
    <span class="nx">n</span> <span class="kt">int64</span>
<span class="p">}</span>

<span class="c1">// this method is okay</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Counter</span><span class="p">)</span> <span class="nx">Increase</span><span class="p">(</span><span class="nx">d</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">(</span><span class="nx">r</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">n</span> <span class="o">+=</span> <span class="nx">d</span>
    <span class="nx">r</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">n</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
    <span class="k">return</span>
<span class="p">}</span>

<span class="c1">// bad, counter receiver value will be copied</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="nx">Counter</span><span class="p">)</span> <span class="nx">Value</span><span class="p">()</span> <span class="p">(</span><span class="nx">r</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
    <span class="nx">r</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">n</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
    <span class="k">return</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="call-the-syncwaitgroupadd-method-at-wrong-places">Call the sync.WaitGroup.Add Method at Wrong Places<a class="headerlink" href="#call-the-syncwaitgroupadd-method-at-wrong-places" title="Permanent link">&para;</a></h3>
<p>Each sync.WaitGroup value maintains a counter internally, a call to wait blocks until counter value becomes 0.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;sync&quot;</span>
    <span class="s">&quot;sync/atomic&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="kt">int32</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="c1">// wg.Add(1) // 正确的方式</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// none of Add calls are guaranteeed to happend before Wait()</span>
            <span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// ERROR: 错误的调用地点</span>
            <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
            <span class="nx">atomic</span><span class="p">.</span><span class="nx">AddInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
        <span class="p">}()</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Wait ....&quot;</span><span class="p">)</span>
    <span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">atomic</span><span class="p">.</span><span class="nx">LoadInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">x</span><span class="p">))</span> <span class="c1">// not always 100</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="use-channels-as-futurespromises-improperly">Use Channels as Futures/Promises Improperly<a class="headerlink" href="#use-channels-as-futurespromises-improperly" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="c1">// ERROR: two channel receive are processed sequentially, instead of concurrently</span>
<span class="nx">DoSomethingWithFutureArguments</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">fa</span><span class="p">(),</span> <span class="o">&lt;-</span><span class="nx">fb</span><span class="p">())</span>

<span class="c1">// concurrently</span>
<span class="nx">ca</span><span class="p">,</span> <span class="nx">cb</span> <span class="o">:=</span> <span class="nx">fa</span><span class="p">(),</span> <span class="nx">fb</span><span class="p">()</span>
<span class="nx">DoSomethingWithFutureArguments</span><span class="p">(</span><span class="o">&lt;-</span><span class="nx">ca</span><span class="p">,</span> <span class="o">&lt;-</span><span class="nx">cb</span><span class="p">)</span>
</code></pre></div>


<h3 id="close-channels-not-from-the-last-active-sender-goroutine">Close Channels Not From the Last Active Sender Goroutine<a class="headerlink" href="#close-channels-not-from-the-last-active-sender-goroutine" title="Permanent link">&para;</a></h3>
<h3 id="do-64-bit-atomic-operations-on-values-which-are-not-guaranteed-to-be-8-byte-aligned">Do 64-bit Atomic Operations on Values Which are Not Guaranteed to Be 8-byte Aligned<a class="headerlink" href="#do-64-bit-atomic-operations-on-values-which-are-not-guaranteed-to-be-8-byte-aligned" title="Permanent link">&para;</a></h3>
<h3 id="not-pay-attention-to-too-many-resources-are-consumed-by-calls-to-the-timeafter-function">Not Pay Attention to Too Many Resources Are Consumed by Calls to the time.After Function<a class="headerlink" href="#not-pay-attention-to-too-many-resources-are-consumed-by-calls-to-the-timeafter-function" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">longRunning</span><span class="p">(</span><span class="nx">messages</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="c1">//bad way: each call will creat a new value of the time.Timer</span>
        <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">After</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">case</span> <span class="nx">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">messages</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">LongRunning</span><span class="p">(</span><span class="nx">messages</span> <span class="o">&lt;-</span><span class="kd">chan</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// reuse a single timer value to the same job</span>
    <span class="nx">timer</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">NewTimer</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="k">select</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">time</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span> <span class="c1">// expires(timeout)</span>
            <span class="k">return</span>
        <span class="k">case</span> <span class="nx">msg</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">messages</span><span class="p">:</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span>
            <span class="c1">// discard/drain a possible timer notification which is sent in the small period when executing the second</span>
            <span class="c1">// branch code block</span>
            <span class="k">if</span> <span class="p">!</span><span class="nx">timer</span><span class="p">.</span><span class="nx">Stop</span><span class="p">()</span> <span class="p">{</span>
                <span class="o">&lt;-</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1">// reset to reuse</span>
        <span class="nx">timer</span><span class="p">.</span><span class="nx">Reset</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="use-timetimer-values-incorrectly">Use time.Timer Values Incorrectly<a class="headerlink" href="#use-timetimer-values-incorrectly" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="nx">timer</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">NewTimer</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">select</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">&lt;-</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="c1">// most likely go here</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// Potential dat race in the next line</span>
    <span class="nx">timer</span><span class="p">.</span><span class="nx">Reset</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="nx">timer</span><span class="p">.</span><span class="nx">C</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">))</span> <span class="c1">//about 1 s</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="memory-blocks">Memory Blocks<a class="headerlink" href="#memory-blocks" title="Permanent link">&para;</a></h1>
<h3 id="memory-blocks_1">Memory Blocks<a class="headerlink" href="#memory-blocks_1" title="Permanent link">&para;</a></h3>
<p>A meomory block is a continuous memory segment to host value parts at run time..
For any value part, it never crosses memory blocks.</p>
<p>Why One memory block may host host multiple value parts.</p>
<ul>
<li>a struct value often have several fields.</li>
<li>an array values often have many elements</li>
<li>the underlying element sequences of two slices may be hosted on the same memory block</li>
</ul>
<h3 id="a-value-references-the-memory-blocks-which-host-its-value-parts">A Value References the Memory Blocks Which Host Its Value Parts<a class="headerlink" href="#a-value-references-the-memory-blocks-which-host-its-value-parts" title="Permanent link">&para;</a></h3>
<h3 id="when-will-memory-blocks-be-allocated">When will Memory Blocks Be Allocated ?<a class="headerlink" href="#when-will-memory-blocks-be-allocated" title="Permanent link">&para;</a></h3>
<h3 id="where-will-memory-blocks-be-allocated-on">Where Will Memory Blocks Be Allocated On?<a class="headerlink" href="#where-will-memory-blocks-be-allocated-on" title="Permanent link">&para;</a></h3>
<h3 id="where-will-memory-blocks-be-allocated-on_1">Where Will Memory Blocks Be Allocated On?<a class="headerlink" href="#where-will-memory-blocks-be-allocated-on_1" title="Permanent link">&para;</a></h3>
<ul>
<li>allocating memory blocks on stacks is much faster than on heap</li>
<li>memory blocks allocated on a stack don&rsquo;t need to be garbage collected</li>
<li>stack memory blocks are more CPU cache friendly than heap ones.</li>
</ul>
<p>If some value parts of a local variable declared in a function is allocated on heap, we can say the value parts(and the
variable) escape(逃逸) to heap.
We can use <code>go build -gcflags -m</code> to check which local values will escape to heap at run time.(不是完全精确)</p>
<p>A memory block created by calling <code>new</code> function may be allocated on heap or stacks, different to cpp.</p>
<h3 id="when-can-a-memory-block-be-collected">When Can a Memory Block Be Collected?<a class="headerlink" href="#when-can-a-memory-block-be-collected" title="Permanent link">&para;</a></h3>
<p>Memory blocks allocated for direct parts of package-level variables will never be collected.
The stack of a goroutine will be collected as a whole when the goroutine exits.
So there is no need to collect the memory blocks allocated on stacks one by one, stacks are not collected by gc.</p>
<p>Unused memory blocks on heap will be collected by the garbage collector.</p>
<h3 id="how-are-unused-memory-blocks-detected">How are Unused Memory Blocks Detected?<a class="headerlink" href="#how-are-unused-memory-blocks-detected" title="Permanent link">&para;</a></h3>
<p>The current Go compiler(1.12) uses a concurrent, tri-color, mark-sweep garbage collector.</p>
<h3 id="when-will-an-unused-memory-block-be-collected">When Will an Unused Memory Block Be Collected?<a class="headerlink" href="#when-will-an-unused-memory-block-be-collected" title="Permanent link">&para;</a></h3>
<p>Unused heap memory. Concurrently(go1.12), the threshold is controlled by GOGC environment variable.
Default GOGC=100, set GOGC=off disable the garbage collector entirely.</p>
<p>runtime.SetGCPercent.</p>
<p>A garbage collection can also be started manually by calling the runtime.GC function.</p>
<h1 id="memory-layouts">Memory Layouts<a class="headerlink" href="#memory-layouts" title="Permanent link">&para;</a></h1>
<h3 id="type-alignment-guarantees-in-govalue-address-alignment-guarantees">Type Alignment Guarantees in GO(value address alignment guarantees)<a class="headerlink" href="#type-alignment-guarantees-in-govalue-address-alignment-guarantees" title="Permanent link">&para;</a></h3>
<p>The address of addressable values of type T are guaranteed to be N-byte aligned.</p>
<ul>
<li>unsafe.Alignof(t): get its general alignment guarantee</li>
<li>unsafe.Alignof(x.t): get field alignment guarantee</li>
</ul>
<p>unsafe are always evaluated at compile time. At runtime call reflect.TypeOf(t).Align() and
reflect.TypeOf(t).FieldAlign()。</p>
<p>一般只有为了优化或者编写一些可移植代码(使用了sync/atomic 64-bit functions) 才会在意地址对齐。</p>
<h3 id="type-sizes-and-structure-padding">Type Sizes and Structure Padding<a class="headerlink" href="#type-sizes-and-structure-padding" title="Permanent link">&para;</a></h3>
<p>内存对齐，对于 struct 一些位数小的会进行填充操作。(类似 c 的)</p>
<h3 id="the-alignment-requirement-for-64-bit-word-atomic-operations">The Alignment Requirement for 64-bit Word Atomic Operations<a class="headerlink" href="#the-alignment-requirement-for-64-bit-word-atomic-operations" title="Permanent link">&para;</a></h3>
<p>64-bit int64 or uint64. On very old cpu architecture, 64-bit atomic functions are not supported.</p>
<h1 id="go-memory-leaking-scenarios">Go Memory Leaking Scenarios<a class="headerlink" href="#go-memory-leaking-scenarios" title="Permanent link">&para;</a></h1>
<h3 id="kind-of-memory-leaking-caused-by-substrings">Kind-of Memory Leaking Caused by Substrings<a class="headerlink" href="#kind-of-memory-leaking-caused-by-substrings" title="Permanent link">&para;</a></h3>
<p>Go substring expression result string and base string share same underlying memory block.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kd">var</span> <span class="nx">s0</span> <span class="kt">string</span> <span class="c1">//package level variable</span>

<span class="kd">func</span> <span class="nx">f</span><span class="p">(</span><span class="nx">s1</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">s0</span> <span class="p">=</span> <span class="nx">s1</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>
    <span class="c1">//s0 share same memory block with s1</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="o">:=</span> <span class="nx">createStringWithLengthOnHeap</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">)</span> <span class="c1">// 1Mbytes</span>
    <span class="nx">f</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>解决方式：</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">f</span><span class="p">(</span><span class="nx">s1</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">s0</span> <span class="p">=</span> <span class="nb">string</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">s1</span><span class="p">[:</span><span class="mi">50</span><span class="p">]))</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">f</span><span class="p">(</span><span class="nx">s1</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">s0</span> <span class="p">=</span> <span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nx">s1</span><span class="p">[:</span><span class="mi">50</span><span class="p">])[</span><span class="mi">1</span><span class="p">:]</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">f</span><span class="p">(</span><span class="nx">s1</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">b</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Builder</span>
    <span class="nx">b</span><span class="p">.</span><span class="nx">Grow</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
    <span class="nx">b</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">s1</span><span class="p">[:</span><span class="mi">50</span><span class="p">])</span>
    <span class="nx">s0</span> <span class="p">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
    <span class="c1">// or call strings.Repeat</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="kind-of-memory-leaking-caused-by-subslices">Kind-of Memory Leaking Caused by subslices<a class="headerlink" href="#kind-of-memory-leaking-caused-by-subslices" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">s0</span> <span class="p">[]</span><span class="kt">int</span>
<span class="kd">func</span> <span class="nx">g</span><span class="p">(</span><span class="nx">s1</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// assume length of s1 is much larger than 30</span>
    <span class="nx">s0</span><span class="p">=</span><span class="nx">s1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">s1</span><span class="p">)</span><span class="o">-</span><span class="mi">30</span><span class="p">:]</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">g</span><span class="p">(</span><span class="nx">s1</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">s0</span> <span class="p">=</span> <span class="nb">append</span><span class="p">([]</span><span class="nb">int</span><span class="p">(</span><span class="kc">nil</span><span class="p">),</span> <span class="nx">s1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">s1</span><span class="o">-</span><span class="mi">30</span><span class="p">:]</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="kind-of-memory-leaking-caused-by-not-resetting-pointers-in-lost-slice-elements">Kind-of Memory Leaking Caused by Not resetting Pointers in Lost Slice Elements<a class="headerlink" href="#kind-of-memory-leaking-caused-by-not-resetting-pointers-in-lost-slice-elements" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">h</span><span class="p">()</span> <span class="p">[]</span><span class="o">*</span><span class="kt">int</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="o">:=</span> <span class="p">[]</span><span class="o">*</span><span class="kt">int</span><span class="p">{</span><span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">)}</span>
    <span class="c1">// do with s</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">h</span><span class="p">()</span> <span class="p">[]</span><span class="o">*</span><span class="kt">int</span> <span class="p">{</span>
    <span class="nx">s</span> <span class="o">:=</span> <span class="p">[]</span><span class="o">*</span><span class="kt">int</span><span class="p">{</span><span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">)}</span>
    <span class="c1">// do with s</span>

    <span class="c1">// reset pointer values</span>
    <span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">=</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="kind-of-memory-leaking-caused-by-hanging-goroutines">Kind-of Memory Leaking Caused by Hanging Goroutines<a class="headerlink" href="#kind-of-memory-leaking-caused-by-hanging-goroutines" title="Permanent link">&para;</a></h3>
<h3 id="real-memory-leaking-caused-by-not-stopping-timeticker-values-which-are-not-used-anymore">Real Memory Leaking Caused by Not Stopping time.Ticker Values Which Are Not Used Anymore<a class="headerlink" href="#real-memory-leaking-caused-by-not-stopping-timeticker-values-which-are-not-used-anymore" title="Permanent link">&para;</a></h3>
<h3 id="real-memory-leaking-caused-by-using-finalizers-improperly">Real Memory Leaking Caused by Using Finalizers Improperly<a class="headerlink" href="#real-memory-leaking-caused-by-using-finalizers-improperly" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">memoryLeaking</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">type</span> <span class="nx">T</span> <span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">v</span> <span class="p">[</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">20</span><span class="p">]</span><span class="kt">int</span>
        <span class="nx">t</span> <span class="o">*</span> <span class="nx">T</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">finalizer</span>  <span class="p">=</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;finalizer called&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span><span class="nx">y</span> <span class="nx">T</span>
    <span class="c1">// the setfinalizer call makes x escape to heap</span>
    <span class="nx">runtime</span><span class="p">.</span><span class="nx">SetFinalizer</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">x</span><span class="p">,</span> <span class="nx">finalizer</span><span class="p">)</span>
    <span class="c1">//cyclic reference, x and y are not collectable</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="p">,</span> <span class="nx">y</span><span class="p">.</span><span class="nx">t</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">x</span>  <span class="c1">// y also escape to heap</span>
<span class="p">}</span>
</code></pre></div>


<h3 id="kind-of-resources-leaking-by-deferring-function-calls">Kind-of Resources Leaking by Deferring Function Calls<a class="headerlink" href="#kind-of-resources-leaking-by-deferring-function-calls" title="Permanent link">&para;</a></h3>
<h1 id="nils-in-go">nils in Go<a class="headerlink" href="#nils-in-go" title="Permanent link">&para;</a></h1>
<p>nil can Represent Zero Values of Many Types:</p>
<ul>
<li>pointer types ( including type-unsafe ones)</li>
<li>map types</li>
<li>slice types</li>
<li>function types</li>
<li>channel types</li>
<li>interface types</li>
</ul>
<h3 id="two-nil-values-may-be-not-equal">Two nil Values May Be Not Equal<a class="headerlink" href="#two-nil-values-may-be-not-equal" title="Permanent link">&para;</a></h3>
<p><code>fmt.Println( (interface{})(nil) == (*int)(nil))  // false</code></p>
<h3 id="retrieving-elements-from-nil-maps-will-not-panic">Retrieving Elements From Nil Maps Will Not Panic<a class="headerlink" href="#retrieving-elements-from-nil-maps-will-not-panic" title="Permanent link">&para;</a></h3>
<p>will always return zero value.</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)[</span><span class="s">&quot;key&quot;</span><span class="p">]</span>  <span class="c1">// 0</span>
<span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">bool</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)[</span><span class="mi">123</span><span class="p">]</span>  <span class="c1">// false</span>
<span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="kt">int64</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)[</span><span class="mi">123</span><span class="p">]</span>  <span class="c1">// nil</span>
</code></pre></div>


<h3 id="it-is-legal-to-range-over-nil-channels-maps-slices-and-array-pointers">It is Legal to Range Over Nil Channels, Maps, Slices and Array Pointers<a class="headerlink" href="#it-is-legal-to-range-over-nil-channels-maps-slices-and-array-pointers" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// following code will print 0,1,2,3 and 4, then block for ever</span>
    <span class="k">for</span> <span class="k">range</span> <span class="p">[]</span><span class="nb">int</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">)</span> <span class="c1">// never print</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="k">range</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nb">string</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">)</span> <span class="c1">// never print</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span><span class="p">)(</span><span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="c1">// never print</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="k">range</span> <span class="kd">chan</span> <span class="nb">bool</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// block here</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Bye&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="value-conversion-assignment-and-comparison-rules-in-go">Value Conversion, Assignment and Comparison Rules In Go<a class="headerlink" href="#value-conversion-assignment-and-comparison-rules-in-go" title="Permanent link">&para;</a></h1>
<h3 id="value-conversion-rules">Value Conversion Rules<a class="headerlink" href="#value-conversion-rules" title="Permanent link">&para;</a></h3>
<ol>
<li>the apparent conversion rule:</li>
</ol>
<p>values of type byte/uint8, rune/int32, []byte/[]uint8 can be converted to each other</p>
<ol start="2">
<li>underlying type related conversion rules</li>
</ol>
<p>Giving a non-interface value x and a non-interface type T, assume the type of x is Tx</p>
<ul>
<li>if Tx and T share the same underlying type (ignoring struct tags), the x can be explicitly converted to T.</li>
<li>if either Tx or T is a non-defined type and their underlying types are identical(considering struct tags), then x can be implicitly converted to T.</li>
<li>if Tx and T have different underlying types, but both Tx and T are non-defined pointer types and there base types
    share the same underlying type(ignoring struct tags), then x can (and must) be explicitly converted to T.</li>
</ul>
<p>啥子是 non-defined type: https://keyla.vip/golang/type/introduction/</p>
<p>类型分为已定义类型（defined type）和未定义类型（non-defined type）。 类型定义的规则如下：</p>
<ul>
<li>A defined type is a type defined in a type declaration or an alias of another defined type.</li>
<li>All basic types are defined.</li>
<li>A non-defined type must be a composite type.</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">type</span> <span class="nx">A</span> <span class="p">[]</span><span class="kt">string</span>     <span class="err">#</span> <span class="nx">依据规则1</span><span class="err">，</span><span class="nx">A是defined</span> <span class="kd">type</span>
<span class="kd">type</span> <span class="nx">B</span> <span class="p">=</span> <span class="nx">A</span>          <span class="err">#</span> <span class="nx">依据规则1</span><span class="err">，</span><span class="nx">B是defined</span> <span class="kd">type</span>
<span class="kd">type</span> <span class="nx">C</span> <span class="p">=</span> <span class="p">[]</span><span class="kt">string</span>   <span class="err">#</span> <span class="nx">依据规则2</span><span class="err">，</span><span class="p">[]</span><span class="nx">string是non</span><span class="o">-</span><span class="nx">defined</span> <span class="nx">types</span><span class="err">，</span><span class="nx">所以C是non</span><span class="o">-</span><span class="nx">defined</span> <span class="nx">types</span>
<span class="nx">你可以使用类型声明的语法</span><span class="err">，</span><span class="nx">定义一个新的类型</span><span class="err">（</span><span class="nx">也属于defined</span> <span class="kd">type</span><span class="err">）；</span><span class="nx">当你使用类型别名声明时</span><span class="err">，</span><span class="nx">未必会定义一个新的类型</span><span class="err">。</span>
</code></pre></div>


<ol start="3">
<li>channel specific conversion rule</li>
</ol>
<p>Assume Tx is a bidirectional channel type, T is also a channel type(bidirectional or not), if Tx and T have the
identical element type, and either Tx or T is a non-defined type, then x can be implicitly converted to T.</p>
<ol start="4">
<li>interface implementation related conversion rules</li>
</ol>
<p>x can be implicitly converted to type T if type(or default type) of x is Tx and Tx implements T.</p>
<ol start="5">
<li>untyped value conversion rule</li>
</ol>
<p>An untyped value can be implicitly converted to type T, if the untyped value can represent as values of type T.</p>
<ol start="6">
<li>constants conversion rule</li>
</ol>
<p>Given a constant value x and a type T, if x is represent as a value of type T, then x can be explicitly converted to T.
In particular if x is an untyped value, then x can be implicitly converted to T.</p>
<ol start="7">
<li>non-constant number conversion rules
Non-constant floating-point and integer values can be explicitly converted to any floating-point and integer types.
Non-constant complex values can be explicitly converted to any complex types.</li>
</ol>
<p>注意浮点数到整数的截断问题(the fraction is discarded, truncation towards zero)。</p>
<ol start="8">
<li>string related conversion rules</li>
</ol>
<p>If the type(or default type) of a value is an integer type, then the value can be explicitly converted to string types.</p>
<ol start="9">
<li>unsafe pointers related conversion rules
A pointer value of any type can be explicitly converted to a type whose underlying type is unsafe.Pointer, and vice versa.</li>
</ol>
<p>An uintptr value can be explicitly converted to a type whose underlying type is unsafe.Pointer, and vice versa.</p>
<h3 id="value-assignment-rules">Value Assignment Rules<a class="headerlink" href="#value-assignment-rules" title="Permanent link">&para;</a></h3>
<p>Assignments can be views as implicit conversions. The destination values in assignment must be addressable values,
map index expressions , or the blank identifier.</p>
<p>In an assignment, the source value is <em>copied</em> to the destination value. Precisely speaking, the direct part of the
source value is copied to the destination value.</p>
<p>Note, parameter passing and result returning are both value assignments actually.</p>
<h3 id="value-comparison-rules">Value Comparison Rules<a class="headerlink" href="#value-comparison-rules" title="Permanent link">&para;</a></h3>
<p>In any comparison, the first operand must be assignable to the type of the second operand, or vice versa.</p>
<p>Note, although value of slice/map/function types don&rsquo;t support comparisons, they can be compared with untyped nil values.</p>
<p>Note, an untyped nil value can&rsquo;t be compared with another untyped nil value.</p>
<p>Any comparison results an untyped boolean value.</p>
<h1 id="syntaxsemantics-exception-in-go">Syntax/Semantics Exception in Go<a class="headerlink" href="#syntaxsemantics-exception-in-go" title="Permanent link">&para;</a></h1>
<h3 id="nested-function-calls">Nested function calls<a class="headerlink" href="#nested-function-calls" title="Permanent link">&para;</a></h3>
<p>return results can be used as the whole arguments of another function call</p>
<h3 id="select-struct-fields">Select struct fields<a class="headerlink" href="#select-struct-fields" title="Permanent link">&para;</a></h3>
<ul>
<li>basic: Pointer values have no fields</li>
<li>sugar: we can select the fields of a struct through pointers of the struct value</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span> <span class="nx">t</span> <span class="nx">T</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">t</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">x</span> <span class="o">*=</span> <span class="mi">2</span> <span class="c1">// sugar of the following code: (*p).x *= 2</span>
</code></pre></div>


<h3 id="receiver-arguments-of-method-calls">Receiver arguments of method calls<a class="headerlink" href="#receiver-arguments-of-method-calls" title="Permanent link">&para;</a></h3>
<p>Although the methods explicitly defined on type <code>*T</code> are not methods of type T, addressable values of type T can be
used as the receiver arguments of calls to these methods.</p>
<h3 id="take-address-of-composite-literal-values">Take address of composite literal values<a class="headerlink" href="#take-address-of-composite-literal-values" title="Permanent link">&para;</a></h3>
<h3 id="selectors-on-defined-one-level-pointers">Selectors on defined one-Level pointers<a class="headerlink" href="#selectors-on-defined-one-level-pointers" title="Permanent link">&para;</a></h3>
<h3 id="the-addressability-of-a-container-and-its-elements">The addressability of a container and its elements<a class="headerlink" href="#the-addressability-of-a-container-and-its-elements" title="Permanent link">&para;</a></h3>
<ul>
<li>basic rule: If a container is addressable, then its elements are also addressable.</li>
<li>exception: Elements of a map are always unaddressable, even if the map itself is addressable.</li>
<li>sugar: Elements of a slice are always addressable, even if the slice itself is not addressable.</li>
</ul>
<h3 id="modify-unaddressable-values">Modify unaddressable values<a class="headerlink" href="#modify-unaddressable-values" title="Permanent link">&para;</a></h3>
<p>如果一个 map 的值是结构体，你可以整个替换这个值，但是无法直接修改值里的 field。</p>
<h3 id="generic">Generic<a class="headerlink" href="#generic" title="Permanent link">&para;</a></h3>
<p>Go doesn&rsquo;t support generic. Most built-in and unsafe packages support generic.
Any type compositions with all kinds of composite types in Go is kinda of generic.</p>
<h3 id="function-names-in-one-package">Function names in one package<a class="headerlink" href="#function-names-in-one-package" title="Permanent link">&para;</a></h3>
<ul>
<li>basic rule: names of declared functions can&rsquo;t be duplicated in one package</li>
<li>Excpetion: there can be multiple functions declared with names as init( with prototype func())</li>
</ul>
<h3 id="function-calls">Function calls<a class="headerlink" href="#function-calls" title="Permanent link">&para;</a></h3>
<ul>
<li>Function whose name are not blank identifier can be called in user code</li>
<li>init functions can&rsquo;t be called in user code</li>
</ul>
<h3 id="functions-being-used-as-values">Functions being used as values<a class="headerlink" href="#functions-being-used-as-values" title="Permanent link">&para;</a></h3>
<ul>
<li>Declared functions can be used as function values</li>
<li>build-in, unsafe, init can not be used as function values</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">panic</span>
<span class="kd">var</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nx">Sizeof</span>
<span class="kd">var</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">init</span>
</code></pre></div>


<h3 id="discard-return-values-of-function-calls">Discard return values of function calls<a class="headerlink" href="#discard-return-values-of-function-calls" title="Permanent link">&para;</a></h3>
<ul>
<li>basic rule: return values of a function call can be discarded all together</li>
<li>builtin, unsafe (except copy and recover) can&rsquo;t be discarded</li>
</ul>
<h3 id="declared-variables">Declared variables<a class="headerlink" href="#declared-variables" title="Permanent link">&para;</a></h3>
<ul>
<li>basic rule: Declared variable are always addressable</li>
<li>predeclared nil variable is not addressable(so nil is immutable variable)</li>
</ul>
<h3 id="argument-passing">Argument passing<a class="headerlink" href="#argument-passing" title="Permanent link">&para;</a></h3>
<ul>
<li>can pass only if assignable to the corresponding function parameter type</li>
<li>sugar: copy and append if first is a byte slice, second argument can be a string</li>
</ul>
<h3 id="comparisons">Comparisons<a class="headerlink" href="#comparisons" title="Permanent link">&para;</a></h3>
<ul>
<li>basic: Map/slice/function types don&rsquo;t support comparison</li>
<li>can be compared to the predeclared untyped nil identifier</li>
</ul>
<h3 id="blank-composite-literals">Blank composite literals<a class="headerlink" href="#blank-composite-literals" title="Permanent link">&para;</a></h3>
<ul>
<li>basic: if the values of a type T can be represented with composite literal, the <code>t{}</code> is its zero value.</li>
<li>exception: for a map or a slice type T, <code>T{}</code> isn&rsquo;t its zero value. Its zero value is represented with nil.</li>
</ul>
<div class="codehilite"><pre><span></span><code>    <span class="kd">type</span> <span class="nx">T0</span> <span class="kd">struct</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="kt">int</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">T0</span><span class="p">{}</span> <span class="o">==</span> <span class="o">*</span><span class="nb">new</span><span class="p">(</span><span class="nx">T0</span><span class="p">))</span> <span class="c1">//true</span>
    <span class="kd">type</span> <span class="nx">T1</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="kt">int</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">T1</span><span class="p">{}</span> <span class="o">==</span> <span class="o">*</span><span class="nb">new</span><span class="p">(</span><span class="nx">T1</span><span class="p">))</span> <span class="c1">//true</span>

    <span class="kd">type</span> <span class="nx">T2</span> <span class="p">[]</span><span class="kt">int</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">T2</span><span class="p">{}</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="c1">//false</span>
    <span class="kd">type</span> <span class="nx">T3</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">T3</span><span class="p">{}</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="c1">// false</span>
</code></pre></div>


<h3 id="container-element-iterations">Container element iterations<a class="headerlink" href="#container-element-iterations" title="Permanent link">&para;</a></h3>
<ul>
<li>the iterated values are runes if the ranged containers are strings, instead of the byte elements of strings</li>
<li>the element index(order) will not be returned alongside of each iterated element when iterating channels</li>
<li>array pointers can also be ranged to iterate array elements, though pointers are not containers</li>
</ul>
<h3 id="methods-of-built-in-types">Methods of built-in types<a class="headerlink" href="#methods-of-built-in-types" title="Permanent link">&para;</a></h3>
<ul>
<li>built-in types have no methods</li>
<li>exception: error type has a Errro() string method</li>
</ul>
<h3 id="types-of-values">Types of values<a class="headerlink" href="#types-of-values" title="Permanent link">&para;</a></h3>
<ul>
<li>Each value has either a type or a default type</li>
<li>exception: untyped nil has neither a type nor a default type</li>
</ul>
<h3 id="constant-values">Constant values<a class="headerlink" href="#constant-values" title="Permanent link">&para;</a></h3>
<ul>
<li>Constant values never change, can be assigned to variables</li>
<li>exception: iota is a built-in constant which is bound with 0, but its value is not constant</li>
</ul>
<h3 id="behavior-change-caused-by-discarding-the-optional-evaluation-results-of-expressions">Behavior change caused by discarding the optional evaluation results of expressions.<a class="headerlink" href="#behavior-change-caused-by-discarding-the-optional-evaluation-results-of-expressions" title="Permanent link">&para;</a></h3>
<ul>
<li>whether or not the optional evaluation result of an expression is present will not affect program behavior.</li>
<li>exception: missing the optional result value in a type assertion will make current goroutine panic if type assertion fails</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kd">var</span> <span class="nx">v</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">=</span> <span class="s">&quot;abc&quot;</span>
<span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span> <span class="c1">// will not panic</span>
<span class="nx">_</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.(</span><span class="kt">int</span><span class="p">)</span> <span class="c1">// will panic!!!</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../build-web-application-with-golang/" title="Build Web Application With Golang" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Build Web Application With Golang
              </div>
            </div>
          </a>
        
        
          <a href="../../network-programming-with-go/book/" title="Network Programming with go" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Network Programming with go
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "search.result.none": "No matching documents", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "clipboard.copied": "Copied to clipboard", "search.result.other": "# matching documents", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.lang": "en", "search.result.one": "1 matching document"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: ["instant"],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>