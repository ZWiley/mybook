


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.2">
    
    
      
        <title>Go学习笔记语言详解 - ZWiley的笔记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a2408e81.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7CUbuntu+Mono&display=fallback">
        <style>body,input{font-family:"",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#4" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="ZWiley的笔记" class="md-header-nav__button md-logo" aria-label="ZWiley的笔记">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ZWiley的笔记
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Go学习笔记语言详解
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/zwiley/mybook/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ZWiley的笔记" class="md-nav__button md-logo" aria-label="ZWiley的笔记">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    ZWiley的笔记
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/zwiley/mybook/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="简介" class="md-nav__link">
      简介
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      C++
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="C++" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        C++
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E7%BC%96%E8%AF%91%E5%BA%95%E5%B1%82/" title="C++编译底层" class="md-nav__link">
      C++编译底层
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="C++基础知识" class="md-nav__link">
      C++基础知识
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88_%E5%BC%82%E5%B8%B8%E6%9C%BA%E5%88%B6_%E5%BC%BA%E5%88%B6%E8%BD%AC%E6%8D%A2_RTTI/" title="C++智能指针" class="md-nav__link">
      C++智能指针
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/C%2B%2B%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" title="C++面向对象" class="md-nav__link">
      C++面向对象
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/STL/" title="C++ STL" class="md-nav__link">
      C++ STL
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      计算机基础知识
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="计算机基础知识" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        计算机基础知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="操作系统" class="md-nav__link">
      操作系统
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="计算机网络" class="md-nav__link">
      计算机网络
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="数据结构" class="md-nav__link">
      数据结构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" title="海量数据处理" class="md-nav__link">
      海量数据处理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      基本手写代码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="基本手写代码" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        基本手写代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%9F%BA%E6%9C%AC%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81/%E5%9F%BA%E6%9C%AC%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81%E9%A2%98%E7%9B%AE/" title="基本手写代码题目" class="md-nav__link">
      基本手写代码题目
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      项目基础知识
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="项目基础知识" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        项目基础知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E5%8F%8A%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/" title="Linux系统编程及基本命令" class="md-nav__link">
      Linux系统编程及基本命令
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Redis/" title="Redis" class="md-nav__link">
      Redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%A1%B9%E7%9B%AE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/Socket%E7%BC%96%E7%A8%8B/" title="Socket编程" class="md-nav__link">
      Socket编程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      webserver项目
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="webserver项目" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        webserver项目
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/0%20%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0/" title="0 项目概述" class="md-nav__link">
      0 项目概述
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/1%20%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6%E5%B0%81%E8%A3%85%E7%B1%BB/" title="1 线程同步机制封装类" class="md-nav__link">
      1 线程同步机制封装类
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/2%20%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%8D%8A%E5%8F%8D%E5%BA%94%E5%A0%86%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88%E4%B8%8A%EF%BC%89/" title="2 半同步半反应堆线程池（上）" class="md-nav__link">
      2 半同步半反应堆线程池（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/3%20%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%8D%8A%E5%8F%8D%E5%BA%94%E5%A0%86%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%88%E4%B8%8B%EF%BC%89/" title="3 半同步半反应堆线程池（下）" class="md-nav__link">
      3 半同步半反应堆线程池（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/4%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%8A%EF%BC%89/" title="4 http连接处理（上）" class="md-nav__link">
      4 http连接处理（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/5%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%AD%EF%BC%89/" title="5 http连接处理（中）" class="md-nav__link">
      5 http连接处理（中）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/6%20http%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%8B%EF%BC%89/" title="6 http连接处理（下）" class="md-nav__link">
      6 http连接处理（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/7%20%E5%AE%9A%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86%E9%9D%9E%E6%B4%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%EF%BC%88%E4%B8%8A%EF%BC%89/" title="7 定时器处理非活动连接（上）" class="md-nav__link">
      7 定时器处理非活动连接（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/8%20%E5%AE%9A%E6%97%B6%E5%99%A8%E5%A4%84%E7%90%86%E9%9D%9E%E6%B4%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%EF%BC%88%E4%B8%8B%EF%BC%89/" title="8 定时器处理非活动连接（下）" class="md-nav__link">
      8 定时器处理非活动连接（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/9%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%8A%EF%BC%89/" title="9 日志系统（上）" class="md-nav__link">
      9 日志系统（上）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/10%20%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F%EF%BC%88%E4%B8%8B%EF%BC%89/" title="10 日志系统（下）" class="md-nav__link">
      10 日志系统（下）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/11%20%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0/" title="11 数据库连接池" class="md-nav__link">
      11 数据库连接池
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../webserver/12%20%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" title="12 常见问题" class="md-nav__link">
      12 常见问题
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      代码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="代码" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/work_with_legacy_code/" title="Work with legacy code" class="md-nav__link">
      Work with legacy code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E4%BB%A3%E7%A0%81%E5%A4%A7%E5%85%A8/" title="代码大全" class="md-nav__link">
      代码大全
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E4%BB%A3%E7%A0%81%E7%9A%84%E6%9C%AA%E6%9D%A5/" title="代码的未来" class="md-nav__link">
      代码的未来
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E5%9F%BA%E6%9C%AC%E5%8A%9F/" title="基本功" class="md-nav__link">
      基本功
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E6%95%8F%E6%8D%B7%E6%8A%80%E8%83%BD%E4%BF%AE%E7%82%BC/" title="敏捷技能修炼" class="md-nav__link">
      敏捷技能修炼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%8497%E4%BB%B6%E4%BA%8B/" title="程序员应该知道的97件事" class="md-nav__link">
      程序员应该知道的97件事
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E7%BC%96%E5%86%99%E5%8F%AF%E8%AF%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF/" title="编写可读代码的艺术" class="md-nav__link">
      编写可读代码的艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E7%BC%96%E7%A8%8B%E5%8C%A0%E8%89%BA/" title="编程匠艺" class="md-nav__link">
      编程匠艺
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" title="领域驱动设计" class="md-nav__link">
      领域驱动设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../code/codelife_%E4%B8%8D%E6%AD%A2%E4%BB%A3%E7%A0%81/" title="codelife_不止代码" class="md-nav__link">
      codelife_不止代码
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      调试技术
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="调试技术" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        调试技术
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../debug/%E8%BD%AF%E4%BB%B6%E8%B0%83%E8%AF%95%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93/book/" title="软件调试修炼之道" class="md-nav__link">
      软件调试修炼之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../debug/Effective_Debugging/" title="Effective Debugging" class="md-nav__link">
      Effective Debugging
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      数据库
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="数据库" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        数据库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/getting_started_with_impala/" title="Getting started with impala" class="md-nav__link">
      Getting started with impala
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/mysql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A/" title="mysql必知必会" class="md-nav__link">
      mysql必知必会
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/mysql%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%8E%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5/" title="mysql性能调优与架构实践" class="md-nav__link">
      mysql性能调优与架构实践
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/Mysql%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" title="Mysql技术内幕InnoDB存储引擎" class="md-nav__link">
      Mysql技术内幕InnoDB存储引擎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/redis%E5%AE%9E%E6%88%98/" title="Redis实战" class="md-nav__link">
      Redis实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/redis%E6%B7%B1%E5%BA%A6%E5%8E%86%E9%99%A9%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%92%8C%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5/book/" title="Redis深度历险核心原理和应用实践" class="md-nav__link">
      Redis深度历险核心原理和应用实践
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="redis设计与实现" class="md-nav__link">
      redis设计与实现
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93/" title="七周七数据库" class="md-nav__link">
      七周七数据库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAmysql/" title="深入浅出mysql" class="md-nav__link">
      深入浅出mysql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database/%E9%AB%98%E6%80%A7%E8%83%BDmysql%E7%AC%AC%E4%B8%89%E7%89%88/" title="高性能mysql第三版" class="md-nav__link">
      高性能mysql第三版
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      前端
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="前端" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        前端
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/CSS_The_Missing_Manual/" title="CSS_The_Missing_Manual" class="md-nav__link">
      CSS_The_Missing_Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/reactjs_%E5%B0%8F%E4%B9%A6/" title="reactjs小书" class="md-nav__link">
      reactjs小书
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/es6%E6%A0%87%E5%87%86%E5%85%A5%E9%97%A8/" title="ES6标准入门" class="md-nav__link">
      ES6标准入门
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/jquery_pocket_reference/" title="jquery_pocket_reference" class="md-nav__link">
      jquery_pocket_reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../frontend/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3bootstrap/" title="深入理解bootstrap" class="md-nav__link">
      深入理解bootstrap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" checked>
    
    <label class="md-nav__link" for="nav-11">
      golang
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="golang" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        golang
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../1_the_go_programming_lauguage/" title="1 The Go Programming Language" class="md-nav__link">
      1 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2_the_go_programming_lauguage/" title="2 The Go Programming Language" class="md-nav__link">
      2 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3_the_go_programming_lauguage/" title="3 The Go Programming Language" class="md-nav__link">
      3 The Go Programming Language
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../build-web-application-with-golang/" title="Build Web Application With Golang" class="md-nav__link">
      Build Web Application With Golang
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go101/book/" title="Go101" class="md-nav__link">
      Go101
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../network-programming-with-go/book/" title="Network Programming with go" class="md-nav__link">
      Network Programming with go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../building-microservices-with-go/book/" title="Building Microservices With Go" class="md-nav__link">
      Building Microservices With Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../building_restful_web_services_with_go/book/" title="Building Restful Web Services with Go" class="md-nav__link">
      Building Restful Web Services with Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../concurrency-in-go/concurrency_in_go/" title="Concurrency In Go" class="md-nav__link">
      Concurrency In Go
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go_in_action%28go%E8%AF%AD%E8%A8%80%E5%AE%9E%E6%88%98%29/" title="Go In Action(Go 实战)" class="md-nav__link">
      Go In Action(Go 实战)
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Go学习笔记语言详解" class="md-nav__link md-nav__link--active">
      Go学习笔记语言详解
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/" title="Go学习笔记源码剖析" class="md-nav__link">
      Go学习笔记源码剖析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B/" title="go语言编程" class="md-nav__link">
      go语言编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../the_way_to_go/book/" title="go book" class="md-nav__link">
      go book
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../advanced-go-programming-book/advanced-go-programming/" title="advanced-go-programming" class="md-nav__link">
      advanced-go-programming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../go-build-web-applications/module1/go-build-web-applications/go-build-web-applications/" title="go-build-web-applications" class="md-nav__link">
      go-build-web-applications
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      java
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="java" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../java/java-basic-introduction/" title="java basic introduction" class="md-nav__link">
      java basic introduction
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      网络
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="网络" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        网络
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../network/tcp_ip%E8%AF%A6%E8%A7%A3%E5%8D%B7%E4%B8%80/tcp_ip%E8%AF%A6%E8%A7%A3%E5%8D%B7%E4%B8%80/" title="TCP IP详解卷一" class="md-nav__link">
      TCP IP详解卷一
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      python
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="python" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/fluent_python/" title="Fluent Python" class="md-nav__link">
      Fluent Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/Python_Microservices_Development/" title="Python Microservices Development" class="md-nav__link">
      Python Microservices Development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/high_performance_python/" title="High Performance Python" class="md-nav__link">
      High Performance Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/python_%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="Python网络编程" class="md-nav__link">
      Python网络编程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      unix/linux
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="unix/linux" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        unix/linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix_linux/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/" title="Linux高性能服务器编程" class="md-nav__link">
      Linux高性能服务器编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix_linux/unix%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF/" title="unix编程艺术" class="md-nav__link">
      unix编程艺术
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix_linux/unix%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%8D%B7%E4%B8%80/" title="unix网络编程卷一" class="md-nav__link">
      unix网络编程卷一
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../unix_linux/unix%E7%BC%96%E7%A8%8B%E8%89%BA%E6%9C%AF/" title="unix编程艺术" class="md-nav__link">
      unix编程艺术
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-16" type="checkbox" id="nav-16">
    
    <label class="md-nav__link" for="nav-16">
      分布式
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="分布式" data-md-level="1">
      <label class="md-nav__title" for="nav-16">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        分布式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%88%86%E5%B8%83%E5%BC%8F/Kafka%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/" title="Kafka 权威指南" class="md-nav__link">
      Kafka 权威指南
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%88%86%E5%B8%83%E5%BC%8F/%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/" title="分布式框架原理与应用" class="md-nav__link">
      分布式框架原理与应用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%88%86%E5%B8%83%E5%BC%8F/%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%B3%BB%E7%BB%9F/" title="大规模分布式存储系统" class="md-nav__link">
      大规模分布式存储系统
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%88%86%E5%B8%83%E5%BC%8F/%E6%B7%B1%E5%85%A5%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98%E4%BB%8E%E5%8E%9F%E7%90%86%E5%88%B0%E5%AE%9E%E8%B7%B5/" title="深入分布式缓存从原理到实践" class="md-nav__link">
      深入分布式缓存从原理到实践
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-17" type="checkbox" id="nav-17">
    
    <label class="md-nav__link" for="nav-17">
      搜索引擎
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="搜索引擎" data-md-level="1">
      <label class="md-nav__title" for="nav-17">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        搜索引擎
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/Elasticsearch%E5%AE%9E%E6%88%98/book/" title="Elasticsearch实战" class="md-nav__link">
      Elasticsearch实战
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-18" type="checkbox" id="nav-18">
    
    <label class="md-nav__link" for="nav-18">
      容器
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="容器" data-md-level="1">
      <label class="md-nav__title" for="nav-18">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        容器
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/%E7%8E%A9%E8%BD%ACKubernets-CloudMan/" title="玩转Kubernets" class="md-nav__link">
      玩转Kubernets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/%E7%AC%AC%E4%B8%80%E6%9C%ACdocker%E4%B9%A6/" title="第一本docker书" class="md-nav__link">
      第一本docker书
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-19" type="checkbox" id="nav-19">
    
    <label class="md-nav__link" for="nav-19">
      开发工具
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="开发工具" data-md-level="1">
      <label class="md-nav__title" for="nav-19">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        开发工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/practical_vim/practical_vim/" title="Practical Vim" class="md-nav__link">
      Practical Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/vim8%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98/vim8%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98/" title="Vim8文本处理实战" class="md-nav__link">
      Vim8文本处理实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/learn_vim_the_hard_way/" title="Learn vim scrpt the hard way" class="md-nav__link">
      Learn vim scrpt the hard way
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/pro_git/" title="Pro Git" class="md-nav__link">
      Pro Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Mastering_vim/" title="Mastering Vim" class="md-nav__link">
      Mastering Vim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/mastering_vim_quickly/" title="Mastering Vim Quickly" class="md-nav__link">
      Mastering Vim Quickly
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-20" type="checkbox" id="nav-20">
    
    <label class="md-nav__link" for="nav-20">
      思维
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="思维" data-md-level="1">
      <label class="md-nav__title" for="nav-20">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        思维
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E4%B8%93%E6%B3%A8%E5%8A%9B_%E5%8C%96%E7%B9%81%E4%B8%BA%E7%AE%80%E7%9A%84%E6%83%8A%E4%BA%BA%E5%8A%9B%E9%87%8F/" title="专注力" class="md-nav__link">
      专注力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E4%B8%BA%E4%BB%80%E4%B9%88%E7%B2%BE%E8%8B%B1%E8%BF%99%E6%A0%B7%E7%94%A8%E8%84%91%E4%B8%8D%E4%BC%9A%E7%B4%AF/" title="为什么精英这样用脑不会累" class="md-nav__link">
      为什么精英这样用脑不会累
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%88%BB%E6%84%8F%E7%BB%83%E4%B9%A0/" title="刻意练习" class="md-nav__link">
      刻意练习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%A6%82%E4%BD%95%E6%83%B3%E5%88%B0%E5%8F%88%E5%81%9A%E5%88%B0/" title="如何想到又做到" class="md-nav__link">
      如何想到又做到
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%AD%A6%E4%B9%A0%E4%B9%8B%E9%81%93/" title="学习之道" class="md-nav__link">
      学习之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%AD%A6%E4%B9%A0%E5%8A%9B/" title="学习力" class="md-nav__link">
      学习力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E6%89%B9%E5%88%A4%E6%80%A7%E6%80%9D%E7%BB%B4%E5%B7%A5%E5%85%B7/" title="批判性思维工具" class="md-nav__link">
      批判性思维工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%80%9D%E7%BB%B4%E4%BF%AE%E7%82%BC%28%E5%BC%80%E5%8F%91%E8%AE%A4%E7%9F%A5%E6%BD%9C%E8%83%BD%E7%9A%84%E4%B9%9D%E5%A0%82%E8%AF%BE%29/" title="程序员的思维修炼" class="md-nav__link">
      程序员的思维修炼
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E8%AE%A4%E7%9F%A5%E5%A4%A9%E6%80%A7/" title="认知天性" class="md-nav__link">
      认知天性
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E8%B6%85%E6%95%88%E7%8E%87%E6%89%8B%E5%86%8C/" title="超效率手册" class="md-nav__link">
      超效率手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E8%AE%B0%E5%BF%86/" title="如何高效记忆" class="md-nav__link">
      如何高效记忆
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E7%A7%91%E5%AD%A6%E5%AD%A6%E4%B9%A0/" title="科学学习" class="md-nav__link">
      科学学习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%80%9D%E7%BB%B4%E8%AE%A4%E7%9F%A5/%E9%AB%98%E6%95%88%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%8445%E4%B8%AA%E4%B9%A0%E6%83%AF/" title="高效程序员的45个习惯" class="md-nav__link">
      高效程序员的45个习惯
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-21" type="checkbox" id="nav-21">
    
    <label class="md-nav__link" for="nav-21">
      源码
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="源码" data-md-level="1">
      <label class="md-nav__title" for="nav-21">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        源码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB_sourcecode/" title="源码阅读" class="md-nav__link">
      源码阅读
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-22" type="checkbox" id="nav-22">
    
    <label class="md-nav__link" for="nav-22">
      网站架构微服务
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="网站架构微服务" data-md-level="1">
      <label class="md-nav__title" for="nav-22">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        网站架构微服务
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/microservices_patterns_%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/book/" title="微服务架构设计模式" class="md-nav__link">
      微服务架构设计模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%9E%B6%E6%9E%84/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6%E6%9E%B6%E6%9E%84/" title="从0开始学架构" class="md-nav__link">
      从0开始学架构
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/web_scalavility_for_startup_engineers/" title="web scalavility for startup engineers" class="md-nav__link">
      web scalavility for startup engineers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/design_data_instensive_application/" title="design_data_instensive_application" class="md-nav__link">
      design_data_instensive_application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/clean_architecture/" title="clean_architecture" class="md-nav__link">
      clean_architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1/" title="微服务设计" class="md-nav__link">
      微服务设计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/2_design_data_instensive_application/" title="2_design_data_instensive_application" class="md-nav__link">
      2_design_data_instensive_application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1/3_design_data_instensive_application/" title="3_design_data_instensive_application" class="md-nav__link">
      3_design_data_instensive_application
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-23" type="checkbox" id="nav-23">
    
    <label class="md-nav__link" for="nav-23">
      软件工程/项目管理
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="软件工程/项目管理" data-md-level="1">
      <label class="md-nav__title" for="nav-23">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        软件工程/项目管理
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/" title="人月神话" class="md-nav__link">
      人月神话
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BB%A3%E7%A0%81%E4%B9%8B%E6%AE%87/" title="代码之殇" class="md-nav__link">
      代码之殇
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E8%A7%A3%E6%9E%90%E6%9E%81%E9%99%90%E7%BC%96%E7%A8%8B-%E6%8B%A5%E6%8A%B1%E5%8F%98%E5%8C%96/" title="解析极限编程" class="md-nav__link">
      解析极限编程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93/" title="项目管理修炼之道" class="md-nav__link">
      项目管理修炼之道
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B_%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/%E4%BF%AE%E6%94%B9%E8%BD%AF%E4%BB%B6%E7%9A%84%E8%89%BA%E6%9C%AF/" title="修改软件的艺术" class="md-nav__link">
      修改软件的艺术
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-24" type="checkbox" id="nav-24">
    
    <label class="md-nav__link" for="nav-24">
      运维
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="运维" data-md-level="1">
      <label class="md-nav__title" for="nav-24">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        运维
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BF%90%E7%BB%B4/linux%E9%9B%86%E7%BE%A4%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" title="linux集群和自动化运维" class="md-nav__link">
      linux集群和自动化运维
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%BF%90%E7%BB%B4/python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" title="python自动化运维" class="md-nav__link">
      python自动化运维
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-25" type="checkbox" id="nav-25">
    
    <label class="md-nav__link" for="nav-25">
      金融理财
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="金融理财" data-md-level="1">
      <label class="md-nav__title" for="nav-25">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        金融理财
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%87%91%E8%9E%8D%E7%90%86%E8%B4%A2/%E5%AE%9A%E6%8A%95%E5%8D%81%E5%B9%B4/" title="定投十年" class="md-nav__link">
      定投十年
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E9%87%91%E8%9E%8D%E7%90%86%E8%B4%A2/%E7%A9%B7%E6%9F%A5%E7%90%86%E5%AE%9D%E5%85%B8/" title="穷查理宝典" class="md-nav__link">
      穷查理宝典
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-26" type="checkbox" id="nav-26">
    
    <label class="md-nav__link" for="nav-26">
      写作
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="写作" data-md-level="1">
      <label class="md-nav__title" for="nav-26">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        写作
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%86%99%E4%BD%9C/%E5%88%B7%E5%B1%8F%E6%96%87%E6%A1%88%E5%86%99%E4%BD%9C%E6%8A%80%E5%B7%A7/" title="刷屏文案写作技巧" class="md-nav__link">
      刷屏文案写作技巧
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-27" type="checkbox" id="nav-27">
    
    <label class="md-nav__link" for="nav-27">
      互联网
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="互联网" data-md-level="1">
      <label class="md-nav__title" for="nav-27">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        互联网
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E4%BA%92%E8%81%94%E7%BD%91/%E6%88%91%E7%9A%84%E4%BA%92%E8%81%94%E7%BD%91%E6%96%B9%E6%B3%95%E8%AE%BA-%E5%91%A8%E9%B8%BF%E7%A5%8E/" title="我的互联网方法论-周鸿祎" class="md-nav__link">
      我的互联网方法论-周鸿祎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E4%BA%92%E8%81%94%E7%BD%91/%E7%94%A8%E6%88%B7%E6%80%9D%E7%BB%B4/" title="用户思维" class="md-nav__link">
      用户思维
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-28" type="checkbox" id="nav-28">
    
    <label class="md-nav__link" for="nav-28">
      区块链
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="区块链" data-md-level="1">
      <label class="md-nav__title" for="nav-28">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        区块链
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%8C%BA%E5%9D%97%E9%93%BE/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E6%8C%87%E5%8D%97%28blockchain_guide%29/" title="区块链技术指南" class="md-nav__link">
      区块链技术指南
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-29" type="checkbox" id="nav-29">
    
    <label class="md-nav__link" for="nav-29">
      技术演讲
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="技术演讲" data-md-level="1">
      <label class="md-nav__title" for="nav-29">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        技术演讲
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lecture/Gopher/%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E7%9A%84go%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98/note/" title="哔哩哔哩的go微服务实战" class="md-nav__link">
      哔哩哔哩的go微服务实战
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lecture/Gopher/Go_Error/go%E4%B8%9A%E5%8A%A1%E5%9F%BA%E7%A1%80%E5%BA%93%E4%B9%8BError%26Context/" title="go业务基础库之Error&Context" class="md-nav__link">
      go业务基础库之Error&Context
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lecture/Gopher/Go%E5%90%8C%E6%AD%A5%E5%92%8C%E5%B9%B6%E5%8F%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/note/" title="Go同步和并发设计模式" class="md-nav__link">
      Go同步和并发设计模式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lecture/%E6%8A%80%E6%9C%AF%E6%BC%94%E8%AE%B2/%E5%B7%A6%E8%80%B3%E6%9C%B5%E8%80%97%E5%AD%90-%E6%88%91%E8%BF%99%E6%8A%80%E6%9C%AF%E4%BA%8C%E5%8D%81%E5%B9%B4/" title="左耳朵耗子-我这技术二十年" class="md-nav__link">
      左耳朵耗子-我这技术二十年
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-30" type="checkbox" id="nav-30">
    
    <label class="md-nav__link" for="nav-30">
      职场
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="职场" data-md-level="1">
      <label class="md-nav__title" for="nav-30">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        职场
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/give_and_take/" title="give and take" class="md-nav__link">
      give and take
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/the_effective_engineer/" title="the_effective_engineer" class="md-nav__link">
      the_effective_engineer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E5%85%89%E9%80%9F%E6%88%90%E9%95%BF/" title="光速成长" class="md-nav__link">
      光速成长
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E5%90%91%E4%B8%8A%E7%AE%A1%E7%90%86/" title="向上管理" class="md-nav__link">
      向上管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E6%88%90%E5%8A%9F%E5%8A%A8%E6%9C%BA%E4%B8%8E%E7%9B%AE%E6%A0%87/" title="成功动机与目标" class="md-nav__link">
      成功动机与目标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E7%95%AA%E8%8C%84%E5%B7%A5%E4%BD%9C%E6%B3%95/" title="番茄工作法" class="md-nav__link">
      番茄工作法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%81%86%E5%90%AC%E6%B2%9F%E9%80%9A%E5%AD%A6/" title="聆听沟通学" class="md-nav__link">
      聆听沟通学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E7%9F%A5%E4%B9%8E%E8%81%8C%E4%BA%BA%E8%A7%89%E9%86%92/" title="知乎职人觉醒" class="md-nav__link">
      知乎职人觉醒
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E7%9F%A5%E8%AF%86%E5%8F%98%E7%8E%B0/" title="知识变现" class="md-nav__link">
      知识变现
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%81%86%E5%90%AC%E6%B2%9F%E9%80%9A%E5%AD%A6/" title="聆听沟通学" class="md-nav__link">
      聆听沟通学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%81%8C%E5%9C%BA%E5%8A%A8%E7%89%A9%E8%BF%9B%E5%8C%96%E6%89%8B%E5%86%8C/" title="职场动物进化手册" class="md-nav__link">
      职场动物进化手册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%81%8C%E5%9C%BA%E8%A7%A3%E9%87%8A%E7%B3%BB/" title="职场解释系" class="md-nav__link">
      职场解释系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%AF%B7%E5%81%9C%E6%AD%A2%E6%97%A0%E6%95%88%E5%8A%AA%E5%8A%9B/" title="请停止无效努力" class="md-nav__link">
      请停止无效努力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E8%BD%AF%E6%8A%80%E8%83%BD/" title="软技能" class="md-nav__link">
      软技能
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E9%AB%98%E6%95%8815%E6%B3%95%E5%88%99/" title="高效15法则" class="md-nav__link">
      高效15法则
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E9%AB%98%E6%95%88%E6%B8%85%E5%8D%95%E5%B7%A5%E4%BD%9C%E6%B3%95/" title="高效清单工作法" class="md-nav__link">
      高效清单工作法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../career/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/" title="程序员的自我修养" class="md-nav__link">
      程序员的自我修养
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-31" type="checkbox" id="nav-31">
    
    <label class="md-nav__link" for="nav-31">
      心理学
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="心理学" data-md-level="1">
      <label class="md-nav__title" for="nav-31">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        心理学
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E7%AB%A5%E5%B9%B4%E7%9A%84%E9%94%99%E5%90%97/" title="一切都是童年的错吗" class="md-nav__link">
      一切都是童年的错吗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E4%BA%B2%E5%AF%86%E5%85%B3%E7%B3%BB/" title="亲密关系" class="md-nav__link">
      亲密关系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E6%83%85%E5%95%86/" title="情商" class="md-nav__link">
      情商
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E9%80%86%E5%95%86/" title="逆商" class="md-nav__link">
      逆商
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E6%8B%96%E5%BB%B6%E5%BF%83%E7%90%86%E5%AD%A6/" title="拖延心理学" class="md-nav__link">
      拖延心理学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E7%A7%AF%E6%9E%81%E5%BF%83%E7%90%86%E5%AD%A6/" title="积极心理学" class="md-nav__link">
      积极心理学
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B/" title="自控力" class="md-nav__link">
      自控力
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B-%E5%AE%9E%E6%93%8D%E7%AF%87/" title="自控力-实操篇" class="md-nav__link">
      自控力-实操篇
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E8%87%AA%E6%8E%A7%E5%8A%9B-%E5%92%8C%E5%8E%8B%E5%8A%9B%E5%81%9A%E6%9C%8B%E5%8F%8B/" title="自控力:和压力做朋友" class="md-nav__link">
      自控力:和压力做朋友
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E6%B4%BB%E5%87%BA%E6%9C%80%E4%B9%90%E8%A7%82%E7%9A%84%E8%87%AA%E5%B7%B1/" title="活出最乐观的自己" class="md-nav__link">
      活出最乐观的自己
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E6%94%B9%E5%8F%98%E5%BF%83%E7%90%86%E5%AD%A6%E7%9A%8440%E9%A1%B9%E7%A0%94%E7%A9%B6/" title="改变心理学的40项研究" class="md-nav__link">
      改变心理学的40项研究
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E8%B6%85%E8%B6%8A%E8%87%AA%E5%8D%91/" title="超越自卑" class="md-nav__link">
      超越自卑
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../psychology/%E5%8F%8D%E8%84%86%E5%BC%B1/" title="反脆弱" class="md-nav__link">
      反脆弱
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-32" type="checkbox" id="nav-32">
    
    <label class="md-nav__link" for="nav-32">
      创业
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="创业" data-md-level="1">
      <label class="md-nav__title" for="nav-32">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        创业
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../startup/hello_startup/" title="Hello Startup" class="md-nav__link">
      Hello Startup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../startup/%E6%96%AF%E5%9D%A6%E7%A6%8F%E5%85%AC%E5%BC%80%E8%AF%BE-%E5%A6%82%E4%BD%95%E5%88%9B%E4%B8%9A/" title="斯坦福公开课如何创业" class="md-nav__link">
      斯坦福公开课如何创业
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../startup/%E8%BF%90%E8%90%A5%E5%85%B6%E5%AE%9E%E5%BE%88%E7%AE%80%E5%8D%95/" title="运营其实很简单" class="md-nav__link">
      运营其实很简单
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/zwiley/mybook/edit/master/docs/golang/go语言学习笔记语言详解.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="4">4 函数<a class="headerlink" href="#4" title="Permanent link">&para;</a></h1>
<p>函数参数过多可以重构为一个符合类型结构，也算是变相实现可选参数和命名实参功能。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Package main  provides ...</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">serverOption</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">address</span> <span class="kt">string</span>
    <span class="nx">port</span>    <span class="kt">int</span>
    <span class="nx">path</span>    <span class="kt">string</span>
    <span class="nx">timeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
    <span class="nx">log</span>     <span class="o">*</span><span class="nx">log</span><span class="p">.</span><span class="nx">Logger</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">newOption</span><span class="p">()</span> <span class="o">*</span><span class="nx">serverOption</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">serverOption</span><span class="p">{</span>
        <span class="nx">address</span><span class="p">:</span> <span class="s">&quot;0.0.0.0&quot;</span><span class="p">,</span>
        <span class="nx">port</span><span class="p">:</span>    <span class="mi">8080</span><span class="p">,</span>
        <span class="nx">path</span><span class="p">:</span>    <span class="s">&quot;/var/test&quot;</span><span class="p">,</span>
        <span class="nx">timeout</span><span class="p">:</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span>
        <span class="nx">log</span><span class="p">:</span>     <span class="kc">nil</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">server</span><span class="p">(</span><span class="nx">option</span> <span class="o">*</span><span class="nx">serverOption</span><span class="p">)</span> <span class="p">{}</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">opt</span> <span class="o">:=</span> <span class="nx">newOption</span><span class="p">()</span>
    <span class="nx">opt</span><span class="p">.</span><span class="nx">port</span> <span class="p">=</span> <span class="mi">8085</span>
    <span class="nx">server</span><span class="p">(</span><span class="nx">opt</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>闭包(closure)：是在其此法上下文中引用了自由变量的函数。或者说是函数和其引用的环境的组合体。
本质上返回的是一个funcval 结构，可在 runtime/runtime2.go 找到定义。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kd">func</span> <span class="nx">test</span><span class="p">(</span><span class="nx">x</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">println</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="c1">//匿名函数引用了x</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">:=</span> <span class="nx">test</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
    <span class="nx">f</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<p>闭包通过指针引用环境变量，可能导致其生命周期延长，甚至被分配到堆内存。
延迟求值特性。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">package</span> <span class="nx">main</span>

<span class="kd">func</span> <span class="nx">test</span><span class="p">()</span> <span class="p">[]</span><span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="p">[]</span><span class="kd">func</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nb">println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">i</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">s</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">f</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">test</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">f</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>输出格式:for循环复用局部变量i，每次添加的匿名函数引用的自然是同一变量。添加操作仅仅是把匿名函数放入列表，并未执行。
当 main 执行这些函数时，读取的是环境变量 i 最后一次循环的值。</p>
<div class="codehilite"><pre><span></span><code><span class="err">0xc00001a088 2</span>
<span class="err">0xc00001a088 2</span>
</code></pre></div>


<p>解决方式是每次用不同的环境变量或者传参复制，让各自的闭包环境各部相同。</p>
<div class="codehilite"><pre><span></span><code><span class="kd">func</span> <span class="nx">test</span><span class="p">()</span> <span class="p">[]</span><span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="p">[]</span><span class="kd">func</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nx">i</span>
        <span class="nx">s</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nb">println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">s</span>
<span class="p">}</span>
</code></pre></div>


<p>go 复古地使用了返回错误值（通常是最后一个值），大量函数和方法返回 error，会使得调用方比较难看，
处理方式有：</p>
<ul>
<li>使用专门的检查函数处理错误逻辑（比如记录日志），简化检查代码</li>
<li>在不影响逻辑的情况下，使用 defer 延后处理错误状态(err退化赋值)</li>
<li>在不中断逻辑的情况下，将错误作为内部状态保存，等最终提交时再处理。</li>
</ul>
<p>panic, recover: 内置函数而非语句。panic 会立即中断当前函数流程，执行延迟调用。
而在延迟调用函数中，recover 可捕获并返回 panic 提交的错误对象。
连续调用 panic，仅最后一个会被 recover 捕获。
在defer 函数中 panic，不会影响后续延迟调用的执行。而recover之后 panic，可被再次捕获。
recover必须在延迟调用函数中执行才能正常工作。</p>
<p>建议：除非是不可恢复性、导致系统无法正常工作的错误，否则不建议使用
panic。比如文件系统无权限、端口被占用、数据库未启动等。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// func panic(v interface{})</span>
<span class="c1">// func recover() interface{}</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;log&quot;</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span> <span class="c1">//捕获错误</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;I am dead&quot;</span><span class="p">)</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;exit.&quot;</span><span class="p">)</span> <span class="c1">// 永不会执行</span>
<span class="p">}</span>



<span class="c1">// Package main  provides ...</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kd">func</span> <span class="nx">test</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">z</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="kd">func</span><span class="p">()</span> <span class="p">{</span> <span class="c1">//如果要保护代码片段，只能将其重构为函数调用。利用匿名函数保护&quot;z=x/y&quot;</span>
        <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nb">recover</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">z</span> <span class="p">=</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">}()</span>
        <span class="nx">z</span> <span class="p">=</span> <span class="nx">x</span> <span class="o">/</span> <span class="nx">y</span>
    <span class="p">}()</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;x/y=&quot;</span><span class="p">,</span> <span class="nx">z</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">test</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>



<span class="c1">//调试阶段可以用 runtime.debug.PrintStack 输出堆栈信息</span>
<span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&quot;runtime/debug&quot;</span>

<span class="kd">func</span> <span class="nx">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">&quot;i am dead&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">debug</span><span class="p">.</span><span class="nx">PrintStack</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="nx">test</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="5">5 数据<a class="headerlink" href="#5" title="Permanent link">&para;</a></h1>
<h3 id="_1">字符串<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>字符串操作通常在堆上分配内存，会对 web 等高并发场景造成交大影响，会有大量字符串对象要做垃圾回收。
建议使用[]byte 缓存池活在栈上自行拼装实现 zero-garbage.</p>
<p>rune 用来存储unicode 码点(code point)，int32别名。单引号字面量默认类型就是rune.</p>
<h3 id="_2">数组<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>数组类型包含长度，元素类型相同但是长度不同也不是同一类型，无法比较。
如果元素类型支持比较，数组也支持。
数组是值类型，赋值或者传参都会复制整个数组数据。可以用指针或者切片。</p>
<h3 id="slice">切片 slice<a class="headerlink" href="#slice" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="err">type slice struct {</span>
<span class="err">    array unsafe.Pointer</span>
<span class="err">    len   int</span>
<span class="err">    cap   int</span>
<span class="err">}</span>
</code></pre></div>


<p>slice 无法比较，只能判断是否为nil。可以用 slice 很容易实现栈</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;errors&quot;</span>
    <span class="s2">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">cap</span> <span class="ow">is</span> <span class="mi">5</span>
    <span class="n">stack</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">([]</span><span class="nb">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

    <span class="o">//</span> <span class="err">入栈</span>
    <span class="n">push</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">)</span> <span class="n">error</span> <span class="p">{</span>
        <span class="n">n</span> <span class="p">:</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">cap</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s2">&quot;stack full&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[:</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">stack</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">nil</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="err">出栈</span>
    <span class="n">pop</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">()</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">n</span> <span class="p">:</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s2">&quot;stack is empty&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">x</span> <span class="p">:</span><span class="o">=</span> <span class="n">stack</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span><span class="p">[:</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">nil</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;push </span><span class="si">%d</span><span class="s2">: %v, %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">stack</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">pop</span><span class="p">()</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;pop :</span><span class="si">%d</span><span class="s2">, %v, %v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>


<p>append: append操作向切片尾部追加元素，返回新的切片对象。如果超出 cap限制， 为新切片对象重新分配数组。
向 nil 切片追加数据时，会为其分配底层数组。某些场合建议预留空间，防止重新分配。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">s</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">([]</span><span class="nb">int</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">s1</span> <span class="p">:</span><span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">s2</span> <span class="p">:</span><span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="o">//</span><span class="err">不会修改原</span><span class="n">slice属性</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="n">s1</span><span class="p">))</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span>

<span class="p">}</span>
</code></pre></div>


<p>copy: 在两个切片对象之间复制数据，允许指向同一个底层数组，允许目标区间重叠。最终复制长度一较短的 slice 长度为准。</p>
<h3 id="_3">字典<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>key必须是支持相等运算符(==/!=) 的数据类型，比如数字、字符串、指针、数组、结构体以及对应的接口类型。
字典是引用类型，使用 make函数或者初始化表达语句创建。
对字典进行迭代，每次返回的键值对次序都不同。
字典被设计成 &ldquo;not addressable&rdquo;，不能直接修改 value 成员（结构或数组）。
正确的方式是返回 整个 value，待修改后再设置字典键值或直接用指针类型。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">main</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="n">type</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">struct</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="n">string</span><span class="w"></span>
<span class="w">        </span><span class="n">age</span><span class="w">  </span><span class="n">byte</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">map</span><span class="o">[</span><span class="n">int</span><span class="o">]</span><span class="k">user</span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="err">}</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="o">//</span><span class="n">m</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">.</span><span class="n">age</span><span class="o">++</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">wrong</span><span class="err">!!!</span><span class="w"></span>

<span class="w">    </span><span class="n">u</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"></span>
<span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">age</span><span class="o">++</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="w"></span>

<span class="w">    </span><span class="n">m2</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">map</span><span class="o">[</span><span class="n">int</span><span class="o">]*</span><span class="k">user</span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="o">&amp;</span><span class="k">user</span><span class="err">{</span><span class="ss">&quot;jack&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="err">}</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>

<span class="w">    </span><span class="n">m2</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">.</span><span class="n">age</span><span class="o">++</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<p>在迭代期间删除或者新增键值是安全的。
运行时会对字典并发操作做出检测，如果某个任务在对字典进行写操作，其他任务不能对其执行并发操作(读/写/删除)，
否则会导致进程崩溃。可以用 sync.RWMutex 实现同步，避免读写同时进行。</p>
<h2 id="struct">结构 struct<a class="headerlink" href="#struct" title="Permanent link">&para;</a></h2>
<p>struct 将多个不同类型的命名字段(field)序列打包成一个符合类型。
字段名必须唯一，可以用 _ 补齐，支持使用自身指针类型的成员。</p>
<p>空结构可作为通道元素类型，用于事件通知。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">exit</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">struct</span><span class="p">{})</span>

    <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
        <span class="n">exit</span> <span class="o">&lt;-</span> <span class="n">struct</span><span class="p">{}{}</span>
    <span class="p">}()</span>

    <span class="o">&lt;-</span><span class="n">exit</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">&quot;end.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>字段标签：对字段进行描述的元数据。不属于数据成员，但却是类型的组成部分。运行期间可以用反射获取类型信息。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;reflect&quot;</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">user</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">name</span> <span class="n">string</span> <span class="sb">`昵称`</span>
    <span class="n">sex</span>  <span class="n">byte</span>   <span class="sb">`性别`</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">u</span> <span class="p">:</span><span class="o">=</span> <span class="n">user</span><span class="p">{</span><span class="s2">&quot;Tom&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">v</span> <span class="p">:</span><span class="o">=</span> <span class="n">reflect</span><span class="o">.</span><span class="n">ValueOf</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">t</span> <span class="p">:</span><span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">Type</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">NumField</span><span class="p">();</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:%v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">Tag</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>结构体分配内存时字段须做对齐处理。通常以所有字段中最长的基础类型宽度为准。</p>
<h1 id="_4">方法<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h1>
<p>方法是与对象实例绑定的特殊函数。可以为当前包，以及除了接口以外的任何类型定义方法。
方法不支持重载。receiver 参数名没有限制，按惯例会选用简短有意义的名称，但不推荐用this/self。
如果方法内部并不引用实例，可省略只保留类型。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="nb">type</span> <span class="n">N</span> <span class="nb">int</span>

<span class="n">func</span> <span class="p">(</span><span class="n">n</span> <span class="n">N</span><span class="p">)</span> <span class="n">toString</span><span class="p">()</span> <span class="n">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%#x</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">a</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">println</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div>


<p>类型有一个与之相关的方法集(method set)，决定了它是否实现某个接口。</p>
<p>方法和函数一样出了直接调用还可以赋值给变量、或者作为参数传递。按照具体引用方式不同，
分为 expression/value 两种状态。</p>
<ul>
<li>
<p>method expression: 通过类型引用的 method expression会被还原为普通函数样式，receiver是第一参数，调用时需要显示传参。</p>
</li>
<li>
<p>method value:基于实例或者指针引用的method value，参数签名不会改变，按照正常方式调用。
但当method value被赋值给变量或者作为参数传递，会立即计算并复制该方法执行所需的receiver对象，与其绑定，
以便稍后执行时，能隐式传入 receiver 参数。</p>
</li>
</ul>
<h1 id="7">7 接口<a class="headerlink" href="#7" title="Permanent link">&para;</a></h1>
<p>接口代表一种调用契约，是多个方法声明的集合。
在某些动态语言里，接口（interface）也被称作协议（protocol）。准备交互的双方，共同遵守事先约定的规则，使得在无须知道对方身份的情况下进行协作。接口要实现的是做什么，而不关心怎么做，谁来做。
接口最常见的使用场景，是对包外提供访问，或预留扩展空间。
Go接口实现机制很简洁，只要目标类型方法集内包含接口声明的全部方法，就被视为实现了该接口，无须做显示声明。当然，目标类型可实现多个接口。
从内部实现来看，接口自身也是一种结构类型，只是编译器会对其做出很多限制。
不能有字段;不能定义自己的方法;只能声明方法不能实现；可嵌入其他接口类型。</p>
<div class="codehilite"><pre><span></span><code><span class="err">type iface struct {</span>
<span class="err">    tab  *itab // 类型信息</span>
<span class="err">    data unsafe.Pointer //实际对象指针</span>
<span class="err">}</span>
</code></pre></div>


<p>空接口类似于面向对象里的根类型Object，可被赋值为任何类型的对象。接口变量默认值是 nil。如果实现接口的类型支持，可做相等运算。
超集接口变量可以隐式转换为子集，反过来不行。
将对象赋值给接口变量时，会复制该对象
注意只有当接口变量内部两个指针（itab，data） 都为 nil时，接口才等于 nil。这个地方容易出 bug。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;log&quot;</span>

<span class="nb">type</span> <span class="n">TestError</span> <span class="n">struct</span><span class="p">{}</span>

<span class="n">func</span> <span class="p">(</span><span class="o">*</span><span class="n">TestError</span><span class="p">)</span> <span class="n">Error</span><span class="p">()</span> <span class="n">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;error&quot;</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">test</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">)</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">err</span> <span class="o">*</span><span class="n">TestError</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">new</span><span class="p">(</span><span class="n">TestError</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="mi">100</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">err</span> <span class="o">//</span> <span class="n">NOTE</span><span class="err">：这个</span> <span class="n">err</span> <span class="err">有类型的</span>  <span class="err">，应该明确返回</span> <span class="n">nil</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">err</span> <span class="p">:</span><span class="o">=</span> <span class="n">test</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">log</span><span class="o">.</span><span class="n">Fatalln</span><span class="p">(</span><span class="s2">&quot;err!=nil&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>类型转换：类型推断（type assertiong） 可以把接口变量转换为 原始类型，或者用来判断是否实现了某个更具体的接口类型。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">data</span> <span class="nb">int</span>

<span class="n">func</span> <span class="p">(</span><span class="n">d</span> <span class="n">data</span><span class="p">)</span> <span class="n">String</span><span class="p">()</span> <span class="n">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;data:</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">d</span> <span class="n">data</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">var</span> <span class="n">x</span> <span class="n">interface</span><span class="p">{}</span> <span class="o">=</span> <span class="n">d</span>

    <span class="k">if</span> <span class="n">n</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Stringer</span><span class="p">);</span> <span class="n">ok</span> <span class="p">{</span> <span class="o">//</span> <span class="err">转换为更具体的接口类型</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">d2</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="n">ok</span> <span class="p">{</span> <span class="o">//</span> <span class="err">转换回原始类型</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">e</span> <span class="p">:</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">//</span> <span class="err">错误</span><span class="p">:</span><span class="n">main</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">error</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<h1 id="8">8 并发<a class="headerlink" href="#8" title="Permanent link">&para;</a></h1>
<ul>
<li>并发：逻辑上具备同时处理多个任务的能力</li>
<li>并行：物理上在同一时刻执行多个 并发任务</li>
</ul>
<p>使用 go 关键字就可以创建并发任务。go 并发执行并发操作，而是创建一个并发任务单元。
新建任务被放置在系统队列中，等待调度器安排合适系统线程去获取执行权。
goroutine自定义栈仅需要2KB，自定义栈采用按需分配策略，需要时进行扩容。</p>
<p>和 defer 一样，goroutine也会因『延迟执行』而立即计算并复制执行参数。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;time&quot;</span>

<span class="n">var</span> <span class="n">c</span> <span class="nb">int</span>

<span class="n">func</span> <span class="n">counter</span><span class="p">()</span> <span class="nb">int</span> <span class="p">{</span>
    <span class="n">c</span><span class="o">++</span>
    <span class="k">return</span> <span class="n">c</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">a</span> <span class="p">:</span><span class="o">=</span> <span class="mi">100</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span> <span class="o">//</span><span class="err">让</span><span class="n">gortouine在</span> <span class="n">main</span> <span class="err">逻辑之后执行</span>
        <span class="n">println</span><span class="p">(</span><span class="s2">&quot;go:&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">}(</span><span class="n">a</span><span class="p">,</span> <span class="n">counter</span><span class="p">())</span> <span class="o">//</span><span class="err">立即计算并且复制参数</span>
    <span class="n">a</span> <span class="o">+=</span> <span class="mi">100</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;main:&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">counter</span><span class="p">())</span>

    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">//</span><span class="err">等待</span><span class="n">goroutine</span> <span class="err">结束</span>
<span class="p">}</span>
<span class="o">//</span> <span class="err">注意输出：</span><span class="n">func</span><span class="p">()</span><span class="err">参数里的</span><span class="n">couter</span><span class="p">()</span><span class="err">会先计算</span>
<span class="o">//</span> <span class="n">main</span><span class="p">:</span> <span class="mi">200</span> <span class="mi">2</span>
<span class="o">//</span> <span class="n">go</span><span class="p">:</span> <span class="mi">100</span> <span class="mi">1</span>
</code></pre></div>


<p>Wait:进程退出时不会等待并发任务结束，可用通道(channel)阻塞，然后发出退出信号。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;time&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">exit</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">struct</span><span class="p">{})</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
        <span class="n">println</span><span class="p">(</span><span class="s2">&quot;goroutine done.&quot;</span><span class="p">)</span>
        <span class="n">close</span><span class="p">(</span><span class="nb">exit</span><span class="p">)</span> <span class="o">//</span><span class="err">关闭通道，发出信号</span>
    <span class="p">}()</span>

    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;main...&quot;</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="nb">exit</span> <span class="o">//</span><span class="err">如果通道关闭，立即解除阻塞</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;main exit&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>如果等待多个任务结束，推荐使用 sync.WaitGroup。通过设定计数器让每个goroutine 在退出之前递减，直到归零解除阻塞。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;sync&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">go</span> <span class="n">func</span><span class="p">(</span><span class="nb">id</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
            <span class="o">//</span><span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="err">这里设置可能会来不及执行</span>
            <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
            <span class="n">println</span><span class="p">(</span><span class="s2">&quot;goroutine&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;done.&quot;</span><span class="p">)</span>
        <span class="p">}(</span><span class="n">i</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;main...&quot;</span><span class="p">)</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;main exit.&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>GOMAXPROCS: 运行时可能会创建很多线程，但是任何时候仅有限的几个线程参与并发任务执行。
该数量默认和处理器核数相等，可用 runtime.GOMAXPROCS 函数或者环境变量修改。
参数小于1仅返回当前设置值，不做任何调整。</p>
<p>LocalStorage: 与线程不同，goroutine任务无法设置优先级，无法获取编号，没有局部存储（TLS），
甚至连返回值都会被抛弃。但除优先级外，其他功能都很容易实现。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;sync&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
    <span class="n">var</span> <span class="n">gs</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="n">struct</span> <span class="p">{</span>
        <span class="nb">id</span>     <span class="nb">int</span>
        <span class="n">result</span> <span class="nb">int</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">gs</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">(</span><span class="nb">id</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span> <span class="o">//</span><span class="err">使用参数避免闭包延迟求值</span>
            <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
            <span class="n">gs</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="n">gs</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="nb">id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="p">}(</span><span class="n">i</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;%+v</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">gs</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>Goshed: 暂停，释放线程去执行其他任务，当前任务被放回队列，等待下次调度时恢复执行。
该函数很少被使用，因为运行时会主动向长时间运行（10 ms）的任务发出抢占调度。只是当前版本实现的算法稍显粗糙，不能保证调度总能成功，所以主动切换还有适用场合。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;runtime&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">runtime</span><span class="o">.</span><span class="n">GOMAXPROCS</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">exit</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">struct</span><span class="p">{})</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="o">//</span><span class="err">任务</span> <span class="n">a</span>
        <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="nb">exit</span><span class="p">)</span>

        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="o">//</span><span class="err">任务</span> <span class="n">b</span><span class="err">，放在此处为了确保</span> <span class="n">a</span> <span class="err">优先制行</span>
            <span class="n">println</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
        <span class="p">}()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a:&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span> <span class="o">//</span><span class="err">让出当前线程，调度执行</span><span class="n">b</span>
                <span class="n">runtime</span><span class="o">.</span><span class="n">Gosched</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}()</span>

    <span class="o">&lt;-</span><span class="nb">exit</span>
<span class="p">}</span>
</code></pre></div>


<p>Goexit: Goexit立即终止当前任务，运行时确保所有已注册延迟调用被执行。该函数不会影响其他并发任务，不会引发panic，自然也就无法捕获。
如果在main.main里调用Goexit，它会等待其他任务结束，然后让进程直接崩溃
标准库函数os.Exit可终止进程，但不会执行延迟调用。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;runtime&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">exit</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">struct</span><span class="p">{})</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="nb">exit</span><span class="p">)</span>
        <span class="n">defer</span> <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">println</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">recover</span><span class="p">()</span> <span class="o">==</span> <span class="n">nil</span><span class="p">)</span>
            <span class="p">}()</span>

            <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">println</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
                <span class="n">runtime</span><span class="o">.</span><span class="n">Goexit</span><span class="p">()</span> <span class="o">//</span><span class="err">立即终止整个调用堆栈</span>
                <span class="n">println</span><span class="p">(</span><span class="s2">&quot;c done&quot;</span><span class="p">)</span>
            <span class="p">}()</span>
            <span class="n">println</span><span class="p">(</span><span class="s2">&quot;b done&quot;</span><span class="p">)</span>

        <span class="p">}()</span>
        <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a done&quot;</span><span class="p">)</span>
    <span class="p">}()</span>
    <span class="o">&lt;-</span><span class="nb">exit</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;main exit&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="o">/*</span>
<span class="n">c</span>
<span class="n">b</span> <span class="n">true</span>
<span class="n">a</span>
<span class="n">main</span> <span class="nb">exit</span>
<span class="o">*/</span>
</code></pre></div>


<p>通道：Go鼓励使用CSP通道，以通信来代替内存共享，实现并发安全。</p>
<p>Don&rsquo;t communicate by sharing memory，share memory by communicating.
CSP：Communicating Sequential Process.</p>
<p>通过消息来避免竞态的模型除了CSP，还有Actor。但两者有较大区别。</p>
<p>作为CSP核心，通道（channel）是显式的，要求操作双方必须知道数据类型和具体通道，并不关心另一端操作者身份和数量。可如果另一端未准备妥当，或消息未能及时处理时，会阻塞当前端。</p>
<p>除传递消息（数据）外，通道还常被用作事件通知。</p>
<p>相比起来，Actor是透明的，它不在乎数据类型及通道，只要知道接收者信箱即可。默认就是异步方式，发送方对消息是否被接收和处理并不关心。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">done</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">struct</span><span class="p">{})</span> <span class="o">//</span>结束事件
    <span class="n">c</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">string</span><span class="p">)</span>      <span class="o">//</span> 数据传输通道

    <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">s</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">c</span>
        <span class="nf">println</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="nf">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">//</span>关闭通道作为结束通知
    <span class="p">}()</span>

    <span class="n">c</span> <span class="o">&lt;-</span> <span class="s">&quot;hi&quot;</span> <span class="o">//</span>发送消息
    <span class="o">&lt;-</span><span class="n">done</span>    <span class="o">//</span>阻塞直到有数据或者管道关闭
<span class="p">}</span>
</code></pre></div>


<p>同步模式必须有配对操作的goroutine出现，否则会一直阻塞。而异步模式在缓冲区未满或数据未读完前，不会阻塞。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">c</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">//</span><span class="err">带有</span><span class="mi">3</span><span class="err">个缓冲槽的异步通道</span>
    <span class="n">c</span> <span class="o">&lt;-</span> <span class="mi">1</span>
    <span class="n">c</span> <span class="o">&lt;-</span> <span class="mi">2</span>

    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="n">c</span><span class="p">)</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="o">&lt;-</span><span class="n">c</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>内置函数cap和len返回缓冲区大小和当前已缓冲数量；而对于同步通道则都返回0，据此可判断通道是同步还是异步。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">int</span><span class="p">),</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">int</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">&lt;-</span> <span class="m">1</span>
    <span class="n">b</span> <span class="o">&lt;-</span> <span class="m">2</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">&quot;a:&quot;</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nf">cap</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">&quot;b:&quot;</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nf">cap</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">a</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span>
<span class="o">//</span> <span class="n">b</span><span class="o">:</span> <span class="m">2</span> <span class="m">3</span>
</code></pre></div>


<p>首发消息：除使用简单的发送和接收操作符外，还可用ok-idom或range模式处理数据。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="n">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">done</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">struct</span><span class="p">{})</span>
    <span class="n">c</span> <span class="o">:=</span> <span class="nf">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">int</span><span class="p">)</span>

    <span class="n">go</span> <span class="nf">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">defer</span> <span class="nf">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
        <span class="n">for</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">c</span> <span class="o">//</span>判断通道是否关闭
            <span class="n">if</span> <span class="o">!</span><span class="n">ok</span> <span class="p">{</span>
                <span class="n">return</span>
            <span class="p">}</span>
            <span class="nf">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">/*</span>
        <span class="n">for</span> <span class="n">x</span><span class="o">:=</span> <span class="n">range</span> <span class="n">c</span> <span class="p">{</span>  <span class="o">//</span>  使用<span class="n">range</span> 更方便点
            <span class="nf">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">*/</span>
    <span class="p">}()</span>

    <span class="n">c</span> <span class="o">&lt;-</span> <span class="m">1</span>
    <span class="n">c</span> <span class="o">&lt;-</span> <span class="m">2</span>
    <span class="n">c</span> <span class="o">&lt;-</span> <span class="m">3</span>
    <span class="nf">close</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="n">done</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">a</span><span class="o">:</span> <span class="m">0</span> <span class="m">0</span>
<span class="o">//</span> <span class="n">b</span><span class="o">:</span> <span class="m">2</span> <span class="m">3</span>
</code></pre></div>


<p>对于closed或nil通道，发送和接收操作都有相应规则：</p>
<ul>
<li>向已关闭通道发送数据，引发panic。</li>
<li>从已关闭接收数据，返回已缓冲数据或零值。</li>
<li>
<p>无论收发，nil通道都会阻塞。</p>
<p>package main</p>
<p>func main() {
    c := make(chan int, 3)
    c &lt;- 10
    c &lt;- 20
    close(c)</p>
<div class="codehilite"><pre><span></span><code><span class="n">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">cap</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="m">+1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="n">c</span>
    <span class="nf">println</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="n">ok</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>}
// 0 : true 10
// 1 : true 20
// 2 : false 0
// 3 : false 0</p>
</li>
</ul>
<p>单向通道：通道默认是双向的，并不区分发送和接收端。但某些时候，我们可限制收发操作的方向来获得更严谨的操作逻辑。
尽管可用make创建单向通道，但那没有任何意义。通常使用类型转换来获取单向通道，并分别赋予操作双方。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;sync&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">c</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">var</span> <span class="n">send</span> <span class="n">chan</span><span class="o">&lt;-</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">c</span> <span class="o">//</span> <span class="err">注意这里，</span><span class="n">send</span> <span class="err">通道</span>
    <span class="n">var</span> <span class="n">recv</span> <span class="o">&lt;-</span><span class="n">chan</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">c</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">recv</span> <span class="p">{</span>
            <span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}()</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
        <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="n">send</span> <span class="o">&lt;-</span> <span class="n">i</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<p>选择：如要同时处理多个通道，可选用select语句。它会随机选择一个可用通道做收发操作。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;sync&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">),</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="n">var</span> <span class="p">(</span>
                <span class="n">name</span> <span class="n">string</span>
                <span class="n">x</span>    <span class="nb">int</span>
                <span class="n">ok</span>   <span class="nb">bool</span>
            <span class="p">)</span>
            <span class="n">select</span> <span class="p">{</span> <span class="o">//</span><span class="err">随机选择可用</span> <span class="n">channel</span> <span class="err">接收数据</span>
            <span class="n">case</span> <span class="n">x</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="o">&lt;-</span><span class="n">a</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
            <span class="n">case</span> <span class="n">x</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="o">&lt;-</span><span class="n">b</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="err">!</span><span class="n">ok</span> <span class="p">{</span> <span class="o">//</span><span class="err">如果任意一个通道关闭，终止接收</span>
                <span class="k">return</span>
            <span class="p">}</span>
            <span class="n">println</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}()</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="o">//</span><span class="err">发送端</span>
        <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
        <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="n">select</span> <span class="p">{</span> <span class="o">//</span><span class="err">随机选择发送</span><span class="n">channel</span>
            <span class="n">case</span> <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">case</span> <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span><span class="p">:</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<p>如要等全部通道消息处理结束（closed），可将已完成通道设置为nil。这样它就会被阻塞，不再被select选中。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;sync&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
    <span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">),</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="n">select</span> <span class="p">{</span>
            <span class="n">case</span> <span class="n">x</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="o">&lt;-</span><span class="n">a</span><span class="p">:</span>
                <span class="k">if</span> <span class="err">!</span><span class="n">ok</span> <span class="p">{</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">nil</span> <span class="o">//</span><span class="err">如果通道关闭设置为</span> <span class="n">nil</span><span class="err">，阻塞</span>
                    <span class="k">break</span>
                <span class="p">}</span>
                <span class="n">println</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">case</span> <span class="n">x</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="o">&lt;-</span><span class="n">b</span><span class="p">:</span>
                <span class="k">if</span> <span class="err">!</span><span class="n">ok</span> <span class="p">{</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">nil</span>
                    <span class="k">break</span>
                <span class="p">}</span>
                <span class="n">println</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">nil</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">==</span> <span class="n">nil</span> <span class="p">{</span> <span class="o">//</span><span class="err">全部结束退出循环</span>
                <span class="k">return</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}()</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="o">//</span><span class="err">发送端</span>
        <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
        <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="n">a</span> <span class="o">&lt;-</span> <span class="n">i</span>
        <span class="p">}</span>
    <span class="p">}()</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="o">//</span><span class="err">发送端</span>
        <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
        <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
            <span class="n">b</span> <span class="o">&lt;-</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="p">}</span>
    <span class="p">}()</span>

    <span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<p>当所有通道都不可用时，select会执行default语句。如此可避开select阻塞，但须注意处理外层循环，以免陷入空耗。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">done</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">struct</span><span class="p">{})</span>
    <span class="n">c</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>

    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">defer</span> <span class="n">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">{</span>
            <span class="n">select</span> <span class="p">{</span>
            <span class="n">case</span> <span class="n">x</span><span class="p">,</span> <span class="n">ok</span> <span class="p">:</span><span class="o">=</span> <span class="o">&lt;-</span><span class="n">c</span><span class="p">:</span>
                <span class="k">if</span> <span class="err">!</span><span class="n">ok</span> <span class="p">{</span>
                    <span class="k">return</span>
                <span class="p">}</span>
                <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;data:&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">default</span><span class="p">:</span> <span class="o">//</span> <span class="err">避免</span> <span class="n">select</span> <span class="err">阻塞</span>
            <span class="p">}</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">())</span>
            <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span> <span class="o">//</span><span class="err">避免空耗</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">&lt;-</span> <span class="mi">100</span>
    <span class="n">close</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="o">&lt;-</span><span class="n">done</span>
<span class="p">}</span>
</code></pre></div>


<p>也可用default处理一些默认逻辑。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span><span class="w"> </span><span class="n">main</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="n">done</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">make</span><span class="p">(</span><span class="n">chan</span><span class="w"> </span><span class="n">struct</span><span class="err">{}</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">data</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="n">chan</span><span class="w"> </span><span class="nc">int</span><span class="err">{</span><span class="w"> </span><span class="o">//</span><span class="n">缓冲数据区</span><span class="w"></span>
<span class="w">        </span><span class="n">make</span><span class="p">(</span><span class="n">chan</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="n">func</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">defer</span><span class="w"> </span><span class="k">close</span><span class="p">(</span><span class="n">done</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">            </span><span class="k">select</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="k">data</span><span class="o">[</span><span class="n">len(data)-1</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nl">i</span><span class="p">:</span><span class="w"> </span><span class="o">//</span><span class="n">生产数据</span><span class="w"></span>
<span class="w">            </span><span class="k">default</span><span class="err">:</span><span class="w"> </span><span class="o">//</span><span class="n">当前通道已经满</span><span class="err">，</span><span class="n">生成新的缓存通道</span><span class="w"></span>
<span class="w">                </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">make</span><span class="p">(</span><span class="n">chan</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="err">}</span><span class="w"></span>
<span class="w">        </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="o">&lt;-</span><span class="n">done</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="k">data</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">data</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"></span>
<span class="w">        </span><span class="k">close</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">            </span><span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<p>模式: 通常使用工厂方法将goroutine和通道绑定。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;sync&quot;</span>

<span class="nb">type</span> <span class="n">receiver</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
    <span class="n">data</span> <span class="n">chan</span> <span class="nb">int</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">newReceiver</span><span class="p">()</span> <span class="o">*</span><span class="n">receiver</span> <span class="p">{</span>
    <span class="n">r</span> <span class="p">:</span><span class="o">=</span> <span class="o">&amp;</span><span class="n">receiver</span><span class="p">{</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">r</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">defer</span> <span class="n">r</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">r</span><span class="o">.</span><span class="n">data</span> <span class="p">{</span> <span class="o">//</span> <span class="err">接收消息，直到通道被关闭</span>
            <span class="n">println</span><span class="p">(</span><span class="s2">&quot;recv:&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}()</span>

    <span class="k">return</span> <span class="n">r</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">r</span> <span class="p">:</span><span class="o">=</span> <span class="n">newReceiver</span><span class="p">()</span>
    <span class="n">r</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;-</span> <span class="mi">1</span>
    <span class="n">r</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;-</span> <span class="mi">2</span>

    <span class="n">close</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="err">关闭通道，发出结束通知</span>
    <span class="n">r</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>      <span class="o">//</span> <span class="err">等待接收者处理结束</span>
<span class="p">}</span>
</code></pre></div>


<p>用通道实现信号量（semaphore）。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;runtime&quot;</span>
    <span class="s2">&quot;sync&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">runtime</span><span class="o">.</span><span class="n">GOMAXPROCS</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>

    <span class="n">sem</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="n">struct</span><span class="p">{},</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="err">最多允许</span><span class="mi">2</span><span class="err">个并发同时执行</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">go</span> <span class="n">func</span><span class="p">(</span><span class="nb">id</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>

            <span class="n">sem</span> <span class="o">&lt;-</span> <span class="n">struct</span><span class="p">{}{}</span>        <span class="o">//</span><span class="n">acquire</span><span class="p">:</span> <span class="err">获取信号</span>
            <span class="n">defer</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span> <span class="o">&lt;-</span><span class="n">sem</span> <span class="p">}()</span> <span class="o">//</span><span class="n">release</span><span class="p">:</span> <span class="err">释放信号</span>

            <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">())</span>
        <span class="p">}(</span><span class="n">i</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<p>性能:将发往通道的数据打包，减少传输次数，可有效提升性能。从实现上来说，通道队列依旧使用锁同步机制，单次获取更多数据（批处理），可改善因频繁加锁造成的性能问题。</p>
<p>资源泄漏:通道可能会引发goroutine leak，确切地说，是指goroutine处于发送或接收阻塞状态，但一直未被唤醒。垃圾回收器并不收集此类资源，导致它们会在等待队列里长久休眠，形成资源泄漏。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;runtime&quot;</span>
    <span class="s2">&quot;time&quot;</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">test</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">c</span> <span class="p">:</span><span class="o">=</span> <span class="n">make</span><span class="p">(</span><span class="n">chan</span> <span class="nb">int</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">go</span> <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="o">&lt;-</span><span class="n">c</span>
        <span class="p">}()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">test</span><span class="p">()</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
        <span class="n">runtime</span><span class="o">.</span><span class="n">GC</span><span class="p">()</span> <span class="o">//</span> <span class="err">强制垃圾回收</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="err">$</span><span class="n">go</span> <span class="n">build</span><span class="o">-</span><span class="n">o</span> <span class="n">test</span>
<span class="o">//</span> <span class="err">$</span><span class="n">GODEBUG</span><span class="o">=</span><span class="s2">&quot;gctrace=1,schedtrace=1000,scheddetail=1&quot;</span> <span class="o">./</span><span class="n">test</span>
</code></pre></div>


<h3 id="_5">同步<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>通道并非用来取代锁的，它们有各自不同的使用场景。通道倾向于解决逻辑层次的并发处理架构，而锁则用来保护局部范围内的数据安全。
标准库sync提供了互斥和读写锁，另有原子操作等，可基本满足日常开发需要。Mutex、RWMutex的使用并不复杂，只有几个地方需要注意。
将Mutex作为匿名字段时，相关方法必须实现为pointer-receiver，否则会因复制导致锁机制失效。</p>
<p>应将Mutex锁粒度控制在最小范围内，及早释放。</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="err">错误用法</span>
<span class="n">func</span> <span class="n">doSomething</span><span class="p">()</span> <span class="err">{</span>
    <span class="n">m</span><span class="p">.</span><span class="k">Lock</span><span class="p">()</span>
    <span class="n">url</span> <span class="p">:</span><span class="o">=</span> <span class="k">cache</span><span class="p">[</span><span class="ss">&quot;key&quot;</span><span class="p">]</span>
    <span class="n">http</span><span class="p">.</span><span class="k">Get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">//</span> <span class="err">该操作并不需要锁保护</span>
    <span class="n">m</span><span class="p">.</span><span class="n">Unlock</span><span class="p">()</span>
<span class="err">}</span>

<span class="o">//</span> <span class="err">正确用法</span>
<span class="n">func</span> <span class="n">doSomething</span><span class="p">()</span> <span class="err">{</span>
    <span class="n">m</span><span class="p">.</span><span class="k">Lock</span><span class="p">()</span>
    <span class="n">url</span> <span class="p">:</span><span class="o">=</span> <span class="k">cache</span><span class="p">[</span><span class="ss">&quot;key&quot;</span><span class="p">]</span>
    <span class="n">m</span><span class="p">.</span><span class="n">Unlock</span><span class="p">()</span> <span class="o">//</span> <span class="err">如使用</span><span class="n">defer</span><span class="err">，则依旧将</span><span class="n">Get保护在内</span>
    <span class="n">http</span><span class="p">.</span><span class="k">Get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="err">}</span>
</code></pre></div>


<p>Mutex不支持递归锁，即便在同一goroutine下也会导致死锁。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;sync&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">m</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>

    <span class="n">m</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">m</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
        <span class="n">m</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">m</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>对性能要求较高时，应避免使用defer Unlock。</li>
<li>读写并发时，用RWMutex性能会更好一些。</li>
<li>对单个数据读写保护，可尝试用原子操作。</li>
<li>执行严格测试，尽可能打开数据竞争检查。</li>
</ul>
<h1 id="9">9 包结构<a class="headerlink" href="#9" title="Permanent link">&para;</a></h1>
<p>依照规范，工作空间（workspace）由src、bin、pkg三个目录组成。通常需要将空间路径添加到GOPATH环境变量列表中，以便相关工具能正常工作。</p>
<ul>
<li>GOPATH:编译器等相关工具按GOPATH设置的路径搜索目标。也就是说在导入目标库时，排在列表前面的路径比当前工作空间优先级更高。另外，go get默认将下载的第三方包保存到列表中第一个工作空间内。</li>
<li>GOROOT:环境变量GOROOT用于指示工具链和标准库的存放位置。在生成工具链时，相关路径就已经嵌入到可执行文件内，故无须额外设置。 除通过设置GOROOT环境变量覆盖内部路径外，还可移动目录（改名、符号链接等），或重新编译工具链来解决。</li>
<li>GOBIN: 至于GOBIN，则是强制替代工作空间的bin目录，作为go install目标保存路径。这可避免将所有工作空间的bin路径添加到PATH环境变量中。</li>
</ul>
<p>编译器从标准库开始搜索，然后依次搜索GOPATH列表中的各个工作空间。</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span>    <span class="s2">&quot;github.com/qyuhen/test&quot;</span>     <span class="err">默认方式</span><span class="p">:</span><span class="n">test</span><span class="o">.</span><span class="n">A</span>
<span class="kn">import</span> <span class="nn">X</span> <span class="s2">&quot;github.com/qyuhen/test&quot;</span>     <span class="err">别名方式</span><span class="p">:</span><span class="n">X</span><span class="o">.</span><span class="n">A</span>
<span class="kn">import</span> <span class="o">.</span>  <span class="s2">&quot;github.com/qyuhen/test&quot;</span>     <span class="err">简便方式</span><span class="p">:</span><span class="n">A</span><span class="err">，不推荐使用在正式代码，一般测试中用</span>
<span class="kn">import</span> <span class="nn">_</span>  <span class="s2">&quot;github.com/qyuhen/test&quot;</span>     <span class="err">初始化方式</span><span class="p">:</span> <span class="err">无法引用，仅用来初始化目标包</span>
</code></pre></div>


<p>除工作空间和绝对路径外，部分工具还支持相对路径。可在非工作空间目录下，直接运行、编译一些测试代码。 相对路径：当前目录，或以“./”和“../”开头的路径。
不管是否在test目录下，只要命令行路径正确，就可用go build/run/test进行编译、运行或测试。但因缺少工作空间相关目录，go install会无法工作。
在设置了GOPATH的工作空间中，相对路径会导致编译失败。go run不受此影响，可正常执行。</p>
<p>包（package）由一个或多个保存在同一目录下（不含子目录）的源码文件组成。包的用途类似名字空间（namespace），是成员作用域和访问权限的边界。
包名和目录名并无关系，不要求一致。包名称通常单数形式。
同一目录下所有源码文件必须使用相同包名称。因导入时使用绝对路径，所以在搜索路径下，包必须有唯一路径，但无须是唯一名字。</p>
<p>另有几个被保留、有特殊含义的包名称：</p>
<ul>
<li>main：可执行入口（入口函数main.main）。</li>
<li>all：标准库以及GOPATH中能找到的所有包。</li>
<li>std，cmd：标准库及工具链。</li>
<li>documentation：存储文档信息，无法导入（和目录名无关）。</li>
</ul>
<h3 id="_6">权限<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>所有成员在包内均可访问，无论是否在同一源码文件中。但只有名称首字母大写的为可导出成员，在包外可视。
该规则适用于全局变量、全局常量、类型、结构字段、函数、方法等。 可通过指针转换等方式绕开该限制。</p>
<h3 id="_7">初始化<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>包内每个源码文件都可定义一到多个初始化函数，但编译器不保证执行次序。
实际上，所有这些初始化函数（包括标准库和导入的第三方包）都由编译器自动生成的一个包装函数进行调用，因此可保证在单一线程上执行，且仅执行一次。o
编译器首先确保完成所有全局变量初始化，然后才开始执行初始化函数。直到这些全部结束后，运行时才正式进入main.main入口函数。</p>
<h3 id="_8">内部包<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>在进行代码重构时，我们会将一些内部模块陆续分离出来，以独立包形式维护。此时，基于首字母大小写的访问权限控制就显得过于粗旷。因为我们希望这些包导出成员仅在特定范围内访问，而不是向所有用户公开。
内部包机制相当于增加了新的访问权限控制：所有保存在internal目录下的包（包括自身）仅能被其父目录下的包（含所有层次的子目录）访问。</p>
<div class="codehilite"><pre><span></span><code><span class="err">src/</span>
<span class="err">|</span>
<span class="err">+--main.go</span>
<span class="err">|</span>
<span class="err">+--lib/              # 内部包internal、a、b仅能被lib、lib/x、lib/x/y访问</span>
<span class="err">|</span>
<span class="err">+--internal/           # 内部包之间可相互访问</span>
<span class="err">|      |</span>
<span class="err">|      +--a/        # 可导入外部包，比如lib/x/y</span>
<span class="err">|      |</span>
<span class="err">|      +--b/</span>
<span class="err">|</span>
<span class="err">+--x/</span>
<span class="err">    |</span>
<span class="err">    +--y/</span>
</code></pre></div>


<h3 id="_9">依赖管理<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>引入名为vendor的机制，专门存放第三方包，实现将源码和依赖完整打包分发。</p>
<div class="codehilite"><pre><span></span><code><span class="n">src</span><span class="o">/</span><span class="w"></span>
<span class="o">|</span><span class="w"></span>
<span class="o">+</span><span class="c1">--server/</span>
<span class="o">|</span><span class="w"></span>
<span class="o">+</span><span class="c1">--vendor/</span>
<span class="o">|</span><span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">     </span><span class="o">+</span><span class="c1">--github.com/</span>
<span class="o">|</span><span class="w">           </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">           </span><span class="o">+</span><span class="c1">--qyuhen/</span>
<span class="o">|</span><span class="w">                 </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">                 </span><span class="o">+</span><span class="c1">--test/</span>
<span class="o">+</span><span class="c1">--main.go</span>


<span class="o">//</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="k">go</span><span class="w"></span>
<span class="n">package</span><span class="w"> </span><span class="n">main</span><span class="w"></span>

<span class="n">import</span><span class="ss">&quot;github.com/qyuhen/test&quot;</span><span class="w"></span>

<span class="n">func</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="n">test</span><span class="p">.</span><span class="n">Hello</span><span class="p">()</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>


<p>注意：vendor比标准库优先级更高。</p>
<p>当多个vendor目录嵌套时，如何查找正确目标？要知道引入的第三方包也可能有自己的vendor依赖目录。
规则算不上复杂：从当前源文件所在目录开始，逐级向上构造vendor全路径，直到发现路径匹配的目标为止。匹配失败，则依旧搜索GOPATH。</p>
<p>要使用vendor机制，须开启“GO15VENDOREXPERIMENT=1”环境变量开关（Go 1.6默认开启），且必须是设置了GOPATH的工作空间。
使用go get下载第三方包时，依旧使用GOPATH第一个工作空间，而非vendor目录。
当前工具链中并没有真正意义上的包依赖管理，好在有不少第三方工具可选。</p>
<h1 id="10">10 反射<a class="headerlink" href="#10" title="Permanent link">&para;</a></h1>
<p>反射（reflect）让我们能在运行期探知对象的类型信息和内存结构，这从一定程度上弥补了静态语言在动态行为上的不足。同时，反射还是实现元编程的重要手段。</p>
<p>和C数据结构一样，Go对象头部并没有类型指针，通过其自身是无法在运行期获知任何类型相关信息的。反射操作所需的全部信息都源自接口变量。接口变量除存储自身类型外，还会保存实际对象的类型数据。</p>
<div class="codehilite"><pre><span></span><code><span class="err">func TypeOf(i interface{})Type</span>
<span class="err">func ValueOf(i interface{})Value</span>
</code></pre></div>


<p>这两个反射入口函数，会将任何传入的对象转换为接口类型。
在面对类型时，需要区分Type和Kind。前者表示真实类型（静态类型），后者表示其基础结构（底层类型）类别。
有一点和想象的不同，反射能探知当前包或外包的非导出结构成员。</p>
<p>可用反射提取struct tag，还能自动分解。其常用于ORM映射，或数据格式验证。</p>
<div class="codehilite"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;reflect&quot;</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">user</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">name</span> <span class="n">string</span> <span class="sb">`field:&quot;name&quot;type:&quot;varchar(50)&quot;`</span>
    <span class="n">age</span>  <span class="nb">int</span>    <span class="sb">`filed:&quot;age&quot;type:&quot;int&quot;`</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">u</span> <span class="n">user</span>
    <span class="n">t</span> <span class="p">:</span><span class="o">=</span> <span class="n">reflect</span><span class="o">.</span><span class="n">TypeOf</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">t</span><span class="o">.</span><span class="n">NumField</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">f</span> <span class="p">:</span><span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">Tag</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;field&quot;</span><span class="p">),</span> <span class="n">f</span><span class="o">.</span><span class="n">Tag</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">name</span><span class="p">:</span> <span class="n">namevarchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="o">//</span> <span class="n">age</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div>


<h3 id="_10">值<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>和Type获取类型信息不同，Value专注于对象实例数据读写。</p>
<p>反射在带来“方便”的同时，也造成了很大的困扰。很多人对反射避之不及，因为它会造成很大的性能损失。</p>
<h1 id="11">11 测试<a class="headerlink" href="#11" title="Permanent link">&para;</a></h1>
<p>单元测试（unit test）除用来测试逻辑算法是否符合预期外，还承担着监控代码质量的责任。任何时候都可用简单的命令来验证全部功能，找出未完成任务（验收）和任何因修改而造成的错误。它与性能测试、代码覆盖率等一起保障了代码总是在可控范围内，这远比形式化的人工检查要有用得多。</p>
<h3 id="testing">testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h3>
<p>工具链和标准库自带单元测试框架，这让测试工作变得相对容易。</p>
<ul>
<li>测试代码须放在当前包以“_test.go”结尾的文件中。</li>
<li>测试函数以Test为名称前缀。</li>
<li>测试命令（go test）忽略以“_”或“.”开头的测试文件。</li>
<li>
<p>正常编译操作（go build/install）会忽略测试文件。</p>
<p>// main_test.go
// go test -v
package main</p>
<p>import &ldquo;testing&rdquo;</p>
<p>func add(x, y int) int {
    return x + y
}</p>
<p>func TestAdd(t *testing.T) {
    if add(1, 2) != 3 {
        t.FailNow()
    }
}</p>
</li>
</ul>
<p>对于测试是否应该和目标放在同一目录，一直有不同看法。某些人认为应该另建一个专门的包用来存放单元测试，且只测试目标公开接口。好处是，当目标内部发生变化时，无须同步维护测试代码。每个人对于测试都有不同理解，就像覆盖率是否要做到90%以上，也是见仁见智。</p>
<p>table driven: 我们可用一种类似数据表的模式来批量输入条件并依次比对结果。</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">main_test</span><span class="o">.</span><span class="n">go</span>
<span class="o">//</span> <span class="n">go</span> <span class="n">test</span> <span class="o">-</span><span class="n">v</span>
<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;testing&quot;</span>

<span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">TestAdd</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span><span class="n">struct</span> <span class="p">{</span>
        <span class="n">x</span>      <span class="nb">int</span>
        <span class="n">y</span>      <span class="nb">int</span>
        <span class="n">expect</span> <span class="nb">int</span>
    <span class="p">}{</span>
        <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
        <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">tt</span> <span class="p">:</span><span class="o">=</span> <span class="nb">range</span> <span class="n">tests</span> <span class="p">{</span>
        <span class="n">actual</span> <span class="p">:</span><span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">actual</span> <span class="o">!=</span> <span class="n">tt</span><span class="o">.</span><span class="n">expect</span> <span class="p">{</span>
            <span class="n">t</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;add(</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">):expect</span><span class="si">%d</span><span class="s2">,actual</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">expect</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>test main:某些时候，须为测试用例提供初始化和清理操作，但testing并没有setup/teardown机制。解决方法是自定义一个名为TestMain的函数，go test会改为执行该函数，而不再是具体的测试用例。</p>
<div class="codehilite"><pre><span></span><code><span class="err">func TestMain(m *testing.M) {</span>
<span class="err">    //setup</span>
<span class="err">    code := m.Run() // 调用测试用例函数</span>
<span class="err">    //teardown</span>
<span class="err">    os.Exit(code) // 注意：os.Exit不会执行defer</span>
<span class="err">}</span>
</code></pre></div>


<p>M.Run会调用具体的测试用例，但麻烦的是不能为每个测试文件写一个TestMain。
要实现用例组合套件（suite），须借助MainStart自行构建M对象。通过与命令行参数相配合，即可实现不同测试组合。</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="n">TestMain</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">testing</span><span class="p">.</span><span class="n">M</span><span class="p">)</span> <span class="err">{</span>
    <span class="k">match</span> <span class="p">:</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">str</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">bool</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="err">{</span> <span class="o">//</span><span class="n">pat</span><span class="p">:</span> <span class="err">命令行参数</span> <span class="o">-</span><span class="n">run提供的过滤条件</span> <span class="err">}}</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">,</span> <span class="n">nil</span> <span class="o">//</span><span class="n">str</span><span class="p">:</span><span class="n">InternalTest</span><span class="p">.</span><span class="n">Name</span>
    <span class="err">}</span>

    <span class="n">tests</span> <span class="p">:</span><span class="o">=</span> <span class="p">[]</span><span class="n">testing</span><span class="p">.</span><span class="n">InternalTest</span><span class="err">{</span> <span class="o">//</span> <span class="err">用例列表，可排序</span>
        <span class="err">{</span><span class="ss">&quot;b&quot;</span><span class="p">,</span> <span class="n">TestB</span><span class="err">}</span><span class="p">,</span>
        <span class="err">{</span><span class="ss">&quot;a&quot;</span><span class="p">,</span> <span class="n">TestA</span><span class="err">}</span><span class="p">,</span>
    <span class="err">}</span>

    <span class="n">benchmarks</span> <span class="p">:</span><span class="o">=</span> <span class="p">[]</span><span class="n">testing</span><span class="p">.</span><span class="n">InternalBenchmark</span><span class="err">{}</span>
    <span class="n">examples</span> <span class="p">:</span><span class="o">=</span> <span class="p">[]</span><span class="n">testing</span><span class="p">.</span><span class="n">InternalExample</span><span class="err">{}</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">testing</span><span class="p">.</span><span class="n">MainStart</span><span class="p">(</span><span class="k">match</span><span class="p">,</span> <span class="n">tests</span><span class="p">,</span> <span class="n">benchmarks</span><span class="p">,</span> <span class="n">examples</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">Exit</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Run</span><span class="p">())</span>
<span class="err">}</span>
</code></pre></div>


<p>example: 例代码最大的用途不是测试，而是导入到GoDoc等工具生成的帮助文档中。它通过比对输出（stdout）结果和内部output注释是否一致来判断是否成功。</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="n">ExampleAdd</span><span class="p">()</span> <span class="err">{</span>
    <span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="k">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">fmt</span><span class="p">.</span><span class="n">Println</span><span class="p">(</span><span class="k">add</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="o">//</span><span class="k">Output</span><span class="p">:</span>
    <span class="o">//</span><span class="mi">3</span>
    <span class="o">//</span><span class="mi">4</span>
<span class="err">}</span>
</code></pre></div>


<p>如果没有output注释，该示例函数就不会被执行。另外，不能使用内置函数，print/println，因为它们输出到stderr。</p>
<h3 id="_11">性能测试<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>性能测试函数以Benchmark为名称前缀，同样保存在“*_test.go”文件里。</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">main_test</span><span class="o">.</span><span class="n">go</span>
<span class="o">//</span> <span class="n">go</span> <span class="n">test</span> <span class="o">-</span><span class="n">bench</span> <span class="o">.</span>
<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;testing&quot;</span>

<span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">BenchmarkAdd</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>测试工具默认不会执行性能测试，须使用bench参数。它通过逐步调整B.N值，反复执行测试函数，直到能获得准确的测量结果。
如果希望仅执行性能测试，那么可以用run=NONE忽略所有单元测试用例。
默认就以并发方式执行测试，但可用cpu参数设定多个并发限制来观察结果。</p>
<p>timer: 如果在测试函数中要执行一些额外操作，那么应该临时阻止计时器工作。</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="n">BenchmarkAdd</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">testing</span><span class="p">.</span><span class="n">B</span><span class="p">)</span> <span class="err">{</span>
    <span class="k">time</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="k">time</span><span class="p">.</span><span class="k">Second</span><span class="p">)</span>
    <span class="n">b</span><span class="p">.</span><span class="n">ResetTimer</span><span class="p">()</span> <span class="o">//</span> <span class="err">重置</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="err">{</span>
        <span class="n">_</span> <span class="o">=</span> <span class="k">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="err">{</span>
            <span class="n">b</span><span class="p">.</span><span class="n">StopTimer</span><span class="p">()</span> <span class="o">//</span> <span class="err">暂停</span>
            <span class="k">time</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="k">time</span><span class="p">.</span><span class="k">Second</span><span class="p">)</span>
            <span class="n">b</span><span class="p">.</span><span class="n">StartTimer</span><span class="p">()</span> <span class="o">//</span> <span class="err">恢复</span>
        <span class="err">}</span>
    <span class="err">}</span>
<span class="err">}</span>
</code></pre></div>


<p>memory:性能测试关心的不仅仅是执行时间，还包括在堆上的内存分配，因为内存分配和垃圾回收的相关操作也应计入消耗成本。</p>
<div class="codehilite"><pre><span></span><code><span class="o">//</span> <span class="n">go</span> <span class="n">test</span> <span class="o">-</span><span class="n">bench</span> <span class="o">.</span> <span class="o">-</span><span class="n">benchmem</span> <span class="o">-</span><span class="n">gcflags</span> <span class="s2">&quot;-N -l&quot;</span>  <span class="c1"># 禁用内联和优化</span>

<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;testing&quot;</span>

<span class="n">func</span> <span class="n">heap</span><span class="p">()</span> <span class="p">[]</span><span class="n">byte</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">make</span><span class="p">([]</span><span class="n">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">BenchmarkHeap</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">heap</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>输出结果包括单次执行堆内存分配总量和次数。 也可将测试函数设置为总是输出内存分配信息，无论使用benchmem参数与否。</p>
<div class="codehilite"><pre><span></span><code><span class="n">func</span> <span class="n">BenchmarkHeap</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">testing</span><span class="p">.</span><span class="n">B</span><span class="p">)</span> <span class="err">{</span>
    <span class="n">b</span><span class="p">.</span><span class="n">ReportAllocs</span><span class="p">()</span>
    <span class="n">b</span><span class="p">.</span><span class="n">ResetTimer</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="p">:</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="err">{</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">heap</span><span class="p">()</span>
    <span class="err">}</span>
<span class="err">}</span>
</code></pre></div>


<h3 id="_12">代码覆盖率<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>如果说单元测试和性能测试关注代码质量，那么代码覆盖率（code coverage）就是度量测试自身完整和有效性的一种手段。
关键还是为改进测试提供一个可发现缺陷的机会，毕竟只有测试本身的质量得到保障，才能让它免于成为形式主义摆设。</p>
<h1 id="12">12 工具链<a class="headerlink" href="#12" title="Permanent link">&para;</a></h1>
<p>自Go 1.5实现自举（bootstrapping）以后，我们就不得不保留两个版本的Go环境。对于初学者而言，建议先下载C版本的1.4，用GCC完成编译。
自举是指用编译的目标语言编写其编译器，简单点说就是用Go语言编写Go编译器。请提前安装gcc、gdb、binutils等工具。</p>
<h3 id="_13">工具<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>go build: 此命令默认每次都会重新编译除标准库以外的所有依赖包。</p>
<div class="codehilite"><pre><span></span><code><span class="err">参数          说明                 示例</span>
<span class="err">------------------+-------------------------------------------+--------------</span>
<span class="err">-o          可执行文件名（默认与目录同名）</span>
<span class="err">-a          强制重新编译所有包（含标准库）</span>
<span class="err">-p          并行编译所使用的CPU核数量</span>
<span class="err">-v          显示待编译包名字</span>
<span class="err">-n          仅显示编译命令，但不执行</span>
<span class="err">-x          显示正在执行的编译命令</span>
<span class="err">-work       显示临时工作目录，完成后不删除</span>
<span class="err">-race       启动数据竞争检查（仅支持amd64）</span>
<span class="err">-gcflags    编译器参数</span>
<span class="err">-ldflags    链接器参数</span>
</code></pre></div>


<p>gcflags：</p>
<p>参数          说明                 示例
------------------+-------------------------------------------+----------
 -B          禁用越界检查
 -N          禁用优化
 -l          禁用内联
 -u          禁用unsafe
 -S          输出汇编代码
 -m          输出优化信息</p>
<p>ldflags：</p>
<p>参数          说明                 示例
------------------+-------------------------------------------+----------
 -s          禁用符号表
 -w          禁用DRAWF调试信息
 -X          设置字符串全局变量值              -X ver=&rdquo;0.99&rdquo;
 -H          设置可执行文件格式           -H windowsgui</p>
<p>go install:
和build参数相同，但会将编译结果安装到bin、pkg目录。最关键的是，go install支持增量编译，在没有修改的情况下，会直接链接pkg目录中的静态包。
编译器用buildid检查文件清单和导入依赖，对比现有静态库和所有源文件修改时间来判断源码是否变化，以此来决定是否需要对包进行重新编译。至于buildid算法，实现起来很简单：将包的全部文件名，运行时版本号，所有导入的第三方包信息（路径、buildid）数据合并后哈希。
算法源码请阅读src/cmd/go/pkg.go。</p>
<p>go get: 将第三方包下载（check out）到GOPATH列表的第一个工作空间。默认不会检查更新，须使用“-u”参数。</p>
<p>go env: 显示全部或指定环境参数。</p>
<p>go clean: 清理工作目录，删除编译和安装遗留的目标文件。</p>
<h3 id="_14">编译<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>编译并不仅仅是执行“go build”命令，还有一些须额外注意的内容。
如习惯使用GDB这类调试器，建议编译时添加-gcflags&rdquo;-N-l&rdquo;参数阻止优化和内联，否则调试时会有各种“找不到”的情况。</p>
<p>交叉编译: 所谓交叉编译（cross compile），是指在一个平台下编译出其他平台所需的可执行文件。
自Go实现自举后，交叉编译变得更方便。只须使用GOOS、GOARCH环境变量指定目标平台和架构就行。</p>
<p>条件编译: 除在代码中用runtime.GOOS进行判断外，编译器本身就支持文件级别的条件编译。虽说没有C预编译指令那么方便，但是基于文件的组织方式更便于维护。</p>
<ul>
<li>方法一：将平台和架构信息添加到主文件名尾部。</li>
<li>方法二：使用build编译指令。</li>
<li>方法三：使用自定义tag指令。</li>
</ul>
<p>预处理：简单点说，就是用go generate命令扫描源码文件，找出所有“go：generate”注释，提取其中的命令并执行。</p>
<ul>
<li>命令必须放在.go源文件中。</li>
<li>命令必须以“//go：generate”开头（双斜线后不能有空格）。</li>
<li>每个文件可有多条generate命令。</li>
<li>命令支持环境变量。</li>
<li>必须显式执行go generate命令。</li>
<li>按文件名顺序提取命令并执行。</li>
<li>串行执行，出错后终止后续命令的执行。</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../go_in_action%28go%E8%AF%AD%E8%A8%80%E5%AE%9E%E6%88%98%29/" title="Go In Action(Go 实战)" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Go In Action(Go 实战)
              </div>
            </div>
          </a>
        
        
          <a href="../go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/" title="Go学习笔记源码剖析" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Go学习笔记源码剖析
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"search.result.none": "No matching documents", "search.config.separator": "[\\s\\-]+", "search.result.other": "# matching documents", "clipboard.copied": "Copied to clipboard", "search.result.placeholder": "Type to start searching", "search.config.pipeline": "trimmer, stopWordFilter", "search.result.one": "1 matching document", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["instant"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>