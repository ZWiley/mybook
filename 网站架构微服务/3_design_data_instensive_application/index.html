<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>《3_design_data_instensive_application》 - ZWiley的读书笔记</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.0.4, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../../css/style.min.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href="../.." target="_blank" class="custom-link">ZWiley的读书笔记</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="../..">简介</a>
<li class="header">C++</li>

<li>
<a href="../../基础语言/C++编译底层/" class="">《C++编译底层》</a>
</li>

<li>
<a href="../../基础语言/C++基础知识/" class="">《C++基础知识》</a>
</li>

<li>
<a href="../../基础语言/C++智能指针_异常机制_强制转换_RTTI/" class="">《C++智能指针》</a>
</li>

<li>
<a href="../../基础语言/C++面向对象/" class="">《C++面向对象》</a>
</li>

<li>
<a href="../../基础语言/STL/" class="">《C++ STL》</a>
</li>

<li class="header">计算机基础知识</li>

<li>
<a href="../../计算机基础知识/操作系统/" class="">《操作系统》</a>
</li>

<li>
<a href="../../计算机基础知识/计算机网络/" class="">《计算机网络》</a>
</li>

<li>
<a href="../../计算机基础知识/数据结构/" class="">《数据结构》</a>
</li>

<li>
<a href="../../计算机基础知识/海量数据处理/" class="">《海量数据处理》</a>
</li>

<li class="header">《基本手写代码》</li>

<li>
<a href="../../基本手写代码/插入排序.cpp" class="">《插入排序》</a>
</li>

<li>
<a href="../../基本手写代码/单例模式.cpp" class="">《单例模式》</a>
</li>

<li>
<a href="../../基本手写代码/堆排序.cpp" class="">《堆排序》</a>
</li>

<li>
<a href="../../基本手写代码/二分查找法.cpp" class="">《二分查找法》</a>
</li>

<li>
<a href="../../基本手写代码/非递归二叉树遍历.cpp" class="">《非递归二叉树遍历》</a>
</li>

<li>
<a href="../../基本手写代码/归并排序.cpp" class="">《归并排序》</a>
</li>

<li>
<a href="../../基本手写代码/快速排序.cpp" class="">《快速排序》</a>
</li>

<li>
<a href="../../基本手写代码/智能指针的设计与实现.cpp" class="">《智能指针的设计与实现》</a>
</li>

<li class="header">项目基础知识</li>

<li>
<a href="../../项目基础知识/Linux系统编程及基本命令/" class="">《Linux系统编程及基本命令》</a>
</li>

<li>
<a href="../../项目基础知识/MySQL/" class="">《MySQL》</a>
</li>

<li>
<a href="../../项目基础知识/Redis/" class="">《Redis》</a>
</li>

<li>
<a href="../../项目基础知识/Socket编程/" class="">《Socket编程》</a>
</li>

<li class="header">代码</li>

<li>
<a href="../../code/work_with_legacy_code/" class="">《Work with legacy code》</a>
</li>

<li>
<a href="../../code/代码大全/" class="">《代码大全》</a>
</li>

<li>
<a href="../../code/代码的未来/" class="">《代码的未来》</a>
</li>

<li>
<a href="../../code/基本功/" class="">《基本功》</a>
</li>

<li>
<a href="../../code/敏捷技能修炼/" class="">《敏捷技能修炼》</a>
</li>

<li>
<a href="../../code/程序员应该知道的97件事/" class="">《程序员应该知道的97件事》</a>
</li>

<li>
<a href="../../code/编写可读代码的艺术/" class="">《编写可读代码的艺术》</a>
</li>

<li>
<a href="../../code/编程匠艺/" class="">《编程匠艺》</a>
</li>

<li>
<a href="../../code/领域驱动设计/" class="">《领域驱动设计》</a>
</li>

<li>
<a href="../../code/codelife_不止代码/" class="">《codelife_不止代码》</a>
</li>

<li class="header">调试技术</li>

<li>
<a href="../../debug/软件调试修炼之道/book/" class="">《软件调试修炼之道》</a>
</li>

<li>
<a href="../../debug/Effective_Debugging/" class="">《Effective Debugging》</a>
</li>

<li class="header">数据库</li>

<li>
<a href="../../database/getting_started_with_impala/" class="">《Getting started with impala》</a>
</li>

<li>
<a href="../../database/mysql必知必会/" class="">《mysql必知必会》</a>
</li>

<li>
<a href="../../database/mysql性能调优与架构实践/" class="">《mysql性能调优与架构实践》</a>
</li>

<li>
<a href="../../database/Mysql技术内幕InnoDB存储引擎/" class="">《Mysql技术内幕InnoDB存储引擎》</a>
</li>

<li>
<a href="../../database/redis实战/" class="">《Redis实战》</a>
</li>

<li>
<a href="../../database/redis深度历险核心原理和应用实践/book/" class="">《Redis深度历险核心原理和应用实践》</a>
</li>

<li>
<a href="../../database/redis设计与实现/" class="">《redis设计与实现》</a>
</li>

<li>
<a href="../../database/七周七数据库/" class="">《七周七数据库》</a>
</li>

<li>
<a href="../../database/深入浅出mysql/" class="">《深入浅出mysql》</a>
</li>

<li>
<a href="../../database/高性能mysql第三版/" class="">《高性能mysql第三版》</a>
</li>

<li class="header">前端</li>

<li>
<a href="../../frontend/CSS_The_Missing_Manual/" class="">《CSS_The_Missing_Manual》</a>
</li>

<li>
<a href="../../frontend/reactjs_小书/" class="">《reactjs小书》</a>
</li>

<li>
<a href="../../frontend/es6标准入门/" class="">《ES6标准入门》</a>
</li>

<li>
<a href="../../frontend/jquery_pocket_reference/" class="">《jquery_pocket_reference》</a>
</li>

<li>
<a href="../../frontend/深入理解bootstrap/" class="">《深入理解bootstrap》</a>
</li>

<li class="header">golang</li>

<li>
<a href="../../golang/1_the_go_programming_lauguage/" class="">《1 The Go Programming Language》</a>
</li>

<li>
<a href="../../golang/2_the_go_programming_lauguage/" class="">《2 The Go Programming Language》</a>
</li>

<li>
<a href="../../golang/3_the_go_programming_lauguage/" class="">《3 The Go Programming Language》</a>
</li>

<li>
<a href="../../golang/build-web-application-with-golang/" class="">《Build Web Application With Golang》</a>
</li>

<li>
<a href="../../golang/go101/book/" class="">《Go101》</a>
</li>

<li>
<a href="../../golang/network-programming-with-go/book/" class="">《Network Programming with go》</a>
</li>

<li>
<a href="../../golang/building-microservices-with-go/book/" class="">《Building Microservices With Go》</a>
</li>

<li>
<a href="../../golang/building_restful_web_services_with_go/book/" class="">《Building Restful Web Services with Go》</a>
</li>

<li>
<a href="../../golang/concurrency-in-go/concurrency_in_go/" class="">《Concurrency In Go》</a>
</li>

<li>
<a href="../../golang/go_in_action(go语言实战)/" class="">《Go In Action(Go 实战)》</a>
</li>

<li>
<a href="../../golang/go语言学习笔记语言详解/" class="">《Go学习笔记语言详解》</a>
</li>

<li>
<a href="../../golang/go语言学习笔记源码剖析/" class="">《Go学习笔记源码剖析》</a>
</li>

<li>
<a href="../../golang/go语言编程/" class="">《go语言编程》</a>
</li>

<li>
<a href="../../golang/the_way_to_go/book/" class="">《go book》</a>
</li>

<li>
<a href="../../golang/advanced-go-programming-book/advanced-go-programming/" class="">《advanced-go-programming》</a>
</li>

<li>
<a href="../../golang/go-build-web-applications/module1/go-build-web-applications/go-build-web-applications/" class="">《go-build-web-applications》</a>
</li>

<li class="header">java</li>

<li>
<a href="../../java/java-basic-introduction/" class="">《java basic introduction》</a>
</li>

<li class="header">网络</li>

<li>
<a href="../../network/tcp_ip详解卷一/tcp_ip详解卷一/" class="">《TCP IP详解卷一》</a>
</li>

<li class="header">python</li>

<li>
<a href="../../python/fluent_python/" class="">《Fluent Python》</a>
</li>

<li>
<a href="../../python/Python_Microservices_Development/" class="">《Python Microservices Development》</a>
</li>

<li>
<a href="../../python/high_performance_python/" class="">《High Performance Python》</a>
</li>

<li>
<a href="../../python/python_网络编程/" class="">《Python网络编程》</a>
</li>

<li class="header">unix/linux</li>

<li>
<a href="../../unix_linux/Linux高性能服务器编程/Linux高性能服务器编程/" class="">《Linux高性能服务器编程》</a>
</li>

<li>
<a href="../../unix_linux/unix编程艺术/" class="">《unix编程艺术》</a>
</li>

<li>
<a href="../../unix_linux/unix网络编程卷一/" class="">《unix网络编程卷一》</a>
</li>

<li>
<a href="../../unix_linux/unix编程艺术/" class="">《unix编程艺术》</a>
</li>

<li>
<a href="../../unix_linux/APUE/environ/" class="">《APUE environ》</a>
</li>

<li>
<a href="../../unix_linux/APUE/fork/" class="">《APUE fork》</a>
</li>

<li>
<a href="../../unix_linux/APUE/gcc/" class="">《APUE gcc》</a>
</li>

<li>
<a href="../../unix_linux/APUE/IO/" class="">《APUE IO》</a>
</li>

<li>
<a href="../../unix_linux/APUE/IPC/" class="">《APUE IPC》</a>
</li>

<li>
<a href="../../unix_linux/APUE/makefile/" class="">《APUE makefile》</a>
</li>

<li>
<a href="../../unix_linux/APUE/wait/" class="">《APUE wait》</a>
</li>

<li>
<a href="../../unix_linux/APUE/动态库和静态库/" class="">《APUE 动态库和静态库》</a>
</li>

<li>
<a href="../../unix_linux/APUE/守护进程/" class="">《APUE 守护进程》</a>
</li>

<li>
<a href="../../unix_linux/APUE/文件权限/" class="">《APUE 文件权限》</a>
</li>

<li>
<a href="../../unix_linux/APUE/系统IO函数/" class="">《APUE 系统IO函数》</a>
</li>

<li>
<a href="../../unix_linux/APUE/信号/" class="">《APUE 信号》</a>
</li>

<li>
<a href="../../unix_linux/APUE/信号2/" class="">《APUE 信号2》</a>
</li>

<li>
<a href="../../unix_linux/APUE/线程/线程函数/" class="">《线程函数》</a>
</li>

<li>
<a href="../../unix_linux/APUE/线程/线程基础/" class="">《线程基础》</a>
</li>

<li>
<a href="../../unix_linux/APUE/线程/线程同步/" class="">《线程同步》</a>
</li>

<li class="header">分布式</li>

<li>
<a href="../../分布式/Kafka权威指南/" class="">《Kafka 权威指南》</a>
</li>

<li>
<a href="../../分布式/分布式框架原理与应用/" class="">《分布式框架原理与应用》</a>
</li>

<li>
<a href="../../分布式/大规模分布式存储系统/" class="">《大规模分布式存储系统》</a>
</li>

<li>
<a href="../../分布式/深入分布式缓存从原理到实践/" class="">《深入分布式缓存从原理到实践》</a>
</li>

<li class="header">搜索引擎</li>

<li>
<a href="../../搜索引擎/Elasticsearch实战/book/" class="">《Elasticsearch实战》</a>
</li>

<li class="header">容器</li>

<li>
<a href="../../devops/玩转Kubernets-CloudMan/" class="">《玩转Kubernets》</a>
</li>

<li>
<a href="../../devops/第一本docker书/" class="">《第一本docker书》</a>
</li>

<li class="header">开发工具</li>

<li>
<a href="../../开发工具/practical_vim/practical_vim/" class="">《Practical Vim》</a>
</li>

<li>
<a href="../../开发工具/vim8文本处理实战/vim8文本处理实战/" class="">《Vim8文本处理实战》</a>
</li>

<li>
<a href="../../开发工具/learn_vim_the_hard_way/" class="">《Learn vim scrpt the hard way》</a>
</li>

<li>
<a href="../../开发工具/pro_git/" class="">《Pro Git》</a>
</li>

<li>
<a href="../../开发工具/Mastering_vim/" class="">《Mastering Vim》</a>
</li>

<li>
<a href="../../开发工具/mastering_vim_quickly/" class="">《Mastering Vim Quickly》</a>
</li>

<li class="header">思维</li>

<li>
<a href="../../思维认知/专注力_化繁为简的惊人力量/" class="">《专注力》</a>
</li>

<li>
<a href="../../思维认知/为什么精英这样用脑不会累/" class="">《为什么精英这样用脑不会累》</a>
</li>

<li>
<a href="../../思维认知/刻意练习/" class="">《刻意练习》</a>
</li>

<li>
<a href="../../思维认知/如何想到又做到/" class="">《如何想到又做到》</a>
</li>

<li>
<a href="../../思维认知/学习之道/" class="">《学习之道》</a>
</li>

<li>
<a href="../../思维认知/学习力/" class="">《学习力》</a>
</li>

<li>
<a href="../../思维认知/批判性思维工具/" class="">《批判性思维工具》</a>
</li>

<li>
<a href="../../思维认知/程序员的思维修炼(开发认知潜能的九堂课)/" class="">《程序员的思维修炼》</a>
</li>

<li>
<a href="../../思维认知/认知天性/" class="">《认知天性》</a>
</li>

<li>
<a href="../../思维认知/超效率手册/" class="">《超效率手册》</a>
</li>

<li>
<a href="../../思维认知/如何高效记忆/" class="">《如何高效记忆》</a>
</li>

<li>
<a href="../../思维认知/科学学习/" class="">《科学学习》</a>
</li>

<li>
<a href="../../思维认知/高效程序员的45个习惯/" class="">《高效程序员的45个习惯》</a>
</li>

<li class="header">源码</li>

<li>
<a href="../../源码阅读_sourcecode/" class="">《源码阅读》</a>
</li>

<li class="header">网站架构微服务</li>

<li>
<a href="../microservices_patterns_微服务架构设计模式/book/" class="">《微服务架构设计模式》</a>
</li>

<li>
<a href="../从0开始学架构/从0开始学架构/" class="">《从0开始学架构》</a>
</li>

<li>
<a href="../web_scalavility_for_startup_engineers/" class="">《web scalavility for startup engineers》</a>
</li>

<li>
<a href="../design_data_instensive_application/" class="">《design_data_instensive_application》</a>
</li>

<li>
<a href="../clean_architecture/" class="">《clean_architecture》</a>
</li>

<li>
<a href="../微服务设计/" class="">《微服务设计》</a>
</li>

<li>
<a href="../2_design_data_instensive_application/" class="">《2_design_data_instensive_application》</a>
</li>

<li>
<a href="./" class="active">《3_design_data_instensive_application》</a>
</li>

<li class="header">软件工程/项目管理</li>

<li>
<a href="../../软件工程_项目管理/人月神话/" class="">《人月神话》</a>
</li>

<li>
<a href="../../软件工程_项目管理/代码之殇/" class="">《代码之殇》</a>
</li>

<li>
<a href="../../软件工程_项目管理/解析极限编程-拥抱变化/" class="">《解析极限编程》</a>
</li>

<li>
<a href="../../软件工程_项目管理/项目管理修炼之道/" class="">《项目管理修炼之道》</a>
</li>

<li>
<a href="../../软件工程_项目管理/修改软件的艺术/" class="">《修改软件的艺术》</a>
</li>

<li class="header">运维</li>

<li>
<a href="../../运维/linux集群和自动化运维/" class="">《linux集群和自动化运维》</a>
</li>

<li>
<a href="../../运维/python自动化运维/" class="">《python自动化运维》</a>
</li>

<li class="header">金融理财</li>

<li>
<a href="../../金融理财/定投十年/" class="">《定投十年》</a>
</li>

<li>
<a href="../../金融理财/穷查理宝典/" class="">《穷查理宝典》</a>
</li>

<li class="header">写作</li>

<li>
<a href="../../写作/刷屏文案写作技巧/" class="">《刷屏文案写作技巧》</a>
</li>

<li class="header">互联网</li>

<li>
<a href="../../互联网/我的互联网方法论-周鸿祎/" class="">《我的互联网方法论-周鸿祎》</a>
</li>

<li>
<a href="../../互联网/用户思维/" class="">《用户思维》</a>
</li>

<li class="header">区块链</li>

<li>
<a href="../../区块链/区块链技术指南(blockchain_guide)/" class="">《区块链技术指南》</a>
</li>

<li class="header">技术演讲</li>

<li>
<a href="../../lecture/Gopher/哔哩哔哩的go微服务实战/note/" class="">《哔哩哔哩的go微服务实战》</a>
</li>

<li>
<a href="../../lecture/Gopher/Go_Error/go业务基础库之Error&Context/" class="">《go业务基础库之Error&Context》</a>
</li>

<li>
<a href="../../lecture/Gopher/Go同步和并发设计模式/note/" class="">《Go同步和并发设计模式》</a>
</li>

<li>
<a href="../../lecture/技术演讲/左耳朵耗子-我这技术二十年/" class="">《左耳朵耗子-我这技术二十年》</a>
</li>

<li class="header">职场</li>

<li>
<a href="../../career/give_and_take/" class="">《give and take》</a>
</li>

<li>
<a href="../../career/the_effective_engineer/" class="">《the_effective_engineer》</a>
</li>

<li>
<a href="../../career/光速成长/" class="">《光速成长》</a>
</li>

<li>
<a href="../../career/向上管理/" class="">《向上管理》</a>
</li>

<li>
<a href="../../career/成功动机与目标/" class="">《成功动机与目标》</a>
</li>

<li>
<a href="../../career/番茄工作法/" class="">《番茄工作法》</a>
</li>

<li>
<a href="../../career/聆听沟通学/" class="">《聆听沟通学》</a>
</li>

<li>
<a href="../../career/知乎职人觉醒/" class="">《知乎职人觉醒》</a>
</li>

<li>
<a href="../../career/知识变现/" class="">《知识变现》</a>
</li>

<li>
<a href="../../career/聆听沟通学/" class="">《聆听沟通学》</a>
</li>

<li>
<a href="../../career/职场动物进化手册/" class="">《职场动物进化手册》</a>
</li>

<li>
<a href="../../career/职场解释系/" class="">《职场解释系》</a>
</li>

<li>
<a href="../../career/请停止无效努力/" class="">《请停止无效努力》</a>
</li>

<li>
<a href="../../career/软技能/" class="">《软技能》</a>
</li>

<li>
<a href="../../career/高效15法则/" class="">《高效15法则》</a>
</li>

<li>
<a href="../../career/高效清单工作法/" class="">《高效清单工作法》</a>
</li>

<li>
<a href="../../career/程序员的自我修养/" class="">《程序员的自我修养》</a>
</li>

<li class="header">心理学</li>

<li>
<a href="../../psychology/一切都是童年的错吗/" class="">《一切都是童年的错吗》</a>
</li>

<li>
<a href="../../psychology/亲密关系/" class="">《亲密关系》</a>
</li>

<li>
<a href="../../psychology/情商/" class="">《情商》</a>
</li>

<li>
<a href="../../psychology/拖延心理学/" class="">《拖延心理学》</a>
</li>

<li>
<a href="../../psychology/积极心理学/" class="">《积极心理学》</a>
</li>

<li>
<a href="../../psychology/自控力/" class="">《自控力》</a>
</li>

<li>
<a href="../../psychology/自控力-和压力做朋友/" class="">《自控力:和压力做朋友》</a>
</li>

<li>
<a href="../../psychology/活出最乐观的自己/" class="">《活出最乐观的自己》</a>
</li>

<li>
<a href="../../psychology/改变心理学的40项研究/" class="">《改变心理学的40项研究》</a>
</li>

<li>
<a href="../../psychology/超越自卑/" class="">《超越自卑》</a>
</li>

<li>
<a href="../../psychology/反脆弱/" class="">《反脆弱》</a>
</li>

<li class="header">创业</li>

<li>
<a href="../../startup/hello_startup/" class="">《Hello Startup》</a>
</li>

<li>
<a href="../../startup/斯坦福公开课-如何创业/" class="">《斯坦福公开课如何创业》</a>
</li>

<li>
<a href="../../startup/运营其实很简单/" class="">《运营其实很简单》</a>
</li>

<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="10-batch-processing">10. Batch Processing</h1>
<p>先给不同的系统分类：</p>
<ul>
<li>Services(online systems): 等待客户端请求到来尽快处理后响应给客户端。响应时间很重要</li>
<li>Batch processing systems(offline systems): 处理大量输入数据通过跑任务（job）处理，通常衡量指标是吞吐量（处理特定输入的时间）</li>
<li>Stream processing systems(near-real-time systems): 在事件发生后不久后处理，介于在线和离线之间</li>
</ul>
<p>2004 年 google 提出Map-Reduce 批处理算法，被后续狠多系统比如 Hadoop，CouchDB，MongoDB 实现。</p>
<h3 id="batch-processing-with-unix-tools">Batch Processing with Unix Tools</h3>
<p>考虑处理 nginx 请求日志</p>
<h5 id="simple-log-analysis">Simple Log Analysis</h5>
<p>比如你想找到5个访问最多的页面： cat access.log | awk '{print $7}' | sort | uniq -c | sort -r -n | head -n 5</p>
<h5 id="chain-of-commands-versus-custom-program">Chain of commands versus custom program</h5>
<p>下面这段 ruby 代码做了同样的事情</p>
<pre><code class="ruby">counts = Hash.new(0)
File.open('/var/log/nginx/access.log') do |file|
    file.each do |line|
        url = line.split[6]
    counts[url] += 1
    end
end
top5 = counts.map{|url, count| [count, url] }.sort.reverse[0...5]
top5.each{|count, url| puts &quot;#{count} #{url}&quot; }
</code></pre>

<h5 id="sorting-versus-in-memory-aggregation">Sorting versus in-memory aggregation</h5>
<p>ruby 代码里保存了一个 url 的 hash 表，unix pipeline 示例没有 hash 表但是要求数据是预先排序的，那种更好呢？
如果数据量级比较小放在内存没问题， pipeline 工具能处理远大于内存的数据。数据可以被分片排序后写入到段文件，然后每个排序好的段可以被合并成一个大的排序文件。</p>
<h3 id="the-unix-philosophy">The Unix Philosophy</h3>
<p>unix 几十年前的设计哲学至今一般被很多系统借鉴。does one thing well;
管道思想等。通过管道，我们能把不同人写的程序灵活组合起来实现非常强大的功能。</p>
<h5 id="a-uniform-interface">A uniform interface</h5>
<p>如果你想让一个程序的输出成为另一个的输入，意味着这些程序需要使用相同的数据格式，换言之，兼容的接口（相同的输入/输出接口）
在 unix 中这种接口就是文件（准备说应该是文件描述符），文件只是一系列有序字节。通过这个简单的接口，
很多不同的事物可以使用相同的接口来描述:文件系统中一个文件，进程间通信管道（unix
socket，stdin，stdout），设备文件(/dev/audi) ，表示 TCP 连接的 socket等等。</p>
<h5 id="separation-of-logic-and-wiring">Separation of logic and wiring</h5>
<p>另一个 unix 工具特性是它们都是用标准输入(stdin)和标准输出(stdout)，和程序本身逻辑分离，方便重定向到任何其他地方。</p>
<p>但是 unix 工具有个很大的缺陷，就是只能运行在一个机器上，所以 Hadoop 横空出世。</p>
<h3 id="mapreduce-and-distributed-filesystems">MapReduce and Distributed Filesystems</h3>
<p>unix 工具使用 stdin 和 stdout 作为输入和输出，MapReduce jobs 读写文件到分布式文件系统。Hadoop 实现中使用的文件系统叫做
HDFS(Hadoop Distributed System)，作为 Google File System 的开源实现。
HDFS 基于 shared-nothing 原则，不同于使用 shared-disk 的 Net work Attached
Storage(NAS)架构。它不需要特殊的硬件，只需要设备能够连上数据中心的网络。HDFS 由每个机器上的 daemon
进程组成，暴露网络服务让其他机器上的节点访问，由叫做 NameNode 的服务器来跟踪哪个文件块落到了哪个节点上。</p>
<h5 id="mapreduce-job-execution">MapReduce Job Execution</h5>
<p>MapReduce 是一种可以在分布式文件系统比如 HDFS 上处理大量数据集的编程框架。我们回到日志分析的例子，和 Mapreduce 很像：</p>
<ul>
<li>读取输入文件然后分割成记录（records），处理 nginx log 的例子里每条记录就是一行 log（换行符分隔）</li>
<li>调用 mapper 函数从每个输入记录里提取出 key 和 value。之前的例子就是 <code>awk '{print $7}'</code>：提取出  url 作为 key，value 是空值。</li>
<li>根据 key 排序所有的 key 和 value 对。日志例子就是用 sort 命令</li>
<li>调用 reducer 函数迭代有序的 key-value 对，过程中可以高效处理相邻的相同 key。日志例子里就是 uniq -c 命令</li>
</ul>
<p>上边四步 可以被一个MapReduce job 处理，步骤2(map)和步骤4(reduce)就是需要写自定义数据处理代码的地方。为了创建一个
MapRecue 任务，你需要实现两个回调函数：maper 和 reducer：</p>
<ul>
<li>Mapper：mapper 对于每个输入记录都会调用，目的是从记录中提取 key 和 value，每个记录的处理都是独立的</li>
<li>Reducer：MapReduce框架会把 mapper 处理已经得到的很多 key-value 对，按照相同 key 收集起来，，通过迭代器调用
    reducer收集这些值。reducer 可以输出记录</li>
</ul>
<h5 id="distributed-execution-of-mapreduce">Distributed execution of MapReduce</h5>
<p>unix 命令行和 MapReduce 最大的区别就是后者可以并行地在多个机器上执行，而且不用显示写代码处理。在 Hadoop MapReduce
实现中，mapper 和 reducer 就是实现了特定接口的类，Mongodb 和 CouchDB 中是 js 函数。</p>
<h5 id="mapreduce-workflows">MapReduce workflows</h5>
<p>有时候一个 job 完成不了需求，比如我们能通过一个 job 得到每个页面的浏览，但是无法获取最受欢迎的页面，需要二轮排序。
一个通用的做法就是把几个 job 连接成一个 workflows，但是Haddop MapReduce 没有直接提供任何 workflow
支持，可以隐式通过 HDFS 设计好的目录名支持，一个 job 配置写输出到特定 HDFS 目录，然后另一个 job 配置读它作为输入。
但是必须保证第一个 job 成功之后才能执行下一个，很多不同的 workflows 调度被开发出来，比如Oozie, Azkaban, Luigi, Airflow
and Pinball.其他很多高层工具比如 Pig,Hive, Cascading, Crunch, FlumeJava 同样提供了自动串联 workflow 的工具。</p>
<h3 id="reduce-side-joins-and-grouping">Reduce-Side Joins and Grouping</h3>
<p>当我们在批处理的情景下讨论 join 时，一般是数据库里出现的所有关联（不同于关系数据库）
Sort-merge joins</p>
<h3 id="map-side-joins">Map-Side Joins</h3>
<ul>
<li>Broadcase hash joins</li>
<li>Partitioned hash joins(bucketed map joins in Hive)</li>
<li>Map-side merge joins</li>
</ul>
<h3 id="the-output-of-batch-workflows">The output of Batch Workflows</h3>
<h5 id="building-serarch-indexes">Building serarch indexes</h5>
<p>用来构建一些全文搜索引擎的索引</p>
<h5 id="key-value-stores-as-batch-process-output">key-value stores as batch process output</h5>
<p>构建机器学习系统，比如分类器（反作弊过滤、异常检测、图像识别）和推荐系统</p>
<h5 id="philosophy-of-batch-process-outputs">Philosophy of batch process outputs</h5>
<p>MapReduce 遵守同样的unix哲学: 把输入当做不可变的并且避免有副作用（比如写到别的数据库）</p>
<h3 id="comparing-hadoop-to-distributed-databases">Comparing Hadoop to Distributed Databases</h3>
<h3 id="beyond-mapreduce">Beyond MapReduce</h3>
<h3 id="graphs-and-iterative-processing">Graphs and Iterative Processing</h3>
<h3 id="high-level-apis-and-languages">High-Level APIS and Languages</h3>
<h5 id="the-move-toward-declarative-query-languages">The move toward declarative query Languages</h5>
<p>应用层代码只需要指定使用哪种 join 方式，查询优化器就能以一种最优方式运行</p>
<h1 id="11-stream-processing">11. Stream Processing</h1>
<p>之前讨论的数据都是有界的(bounded)，对于 unbounded 数据需要用流式处理(stream processing)</p>
<h3 id="transmitting-event-streams">Transmitting Event Streams</h3>
<p>批处理的输入和输出都是文件，一般处理第一步是分隔文件成记录。流式处理环境里，记录通常作为一个时间(event)，指定时间点内
包含具体细节的小块、自包含不可变对象，通常包含时间戳。流式处理中，一个 event 被一个
生产者生成，然后可能被多个消费者消费。一个文件系统中，文件名标志了相关的记录，流式系统，相关事件通常被分组为一个 topic
或者 stream，然后由消息系统发出。</p>
<h3 id="messaging-systems">Messaging Systems</h3>
<p>通知消费者新事件通常使用消息系统：生产者发送一条包含事件的消息，然后 push 到消费者。一般 tcp
连接只有一个发送者和接收方，而消息系统允许多个生产者节点向同一个 topic 发送消息，也允许多个消费者节点接收同一个 topic
的消息。（发布订阅模式）</p>
<h5 id="direct-messaging-from-producers-to-consumers">Direct messaging from producers to consumers</h5>
<p>有一些消息系统直接在生产者和消费者之间使用连接而不使用中转节点：</p>
<ul>
<li>UDP  多路广播. 经常使用在需要低延迟的场合比如股票市场 feeds，一般生产者需要记住哪些包已经发了方便重试</li>
<li>无中间件的消息库比如 ZeroMQ</li>
<li>StatsD, Brubeck 使用 UDP 收集指标</li>
<li>如果消费者暴露了网络服务，生产者可以直接通过 HTTP  or RPC 请求 push 消息 (webhooks就是这种思想)</li>
</ul>
<h5 id="message-brokers">Message brokers</h5>
<p>一个广泛使用的选择是发送消息到一个消息代理（message broker or message queue），一般通过某种类型的数据库来优化消息流。
通过把数据中心化到代理身上，系统更好地容忍客户端失败重连、crash 等情况，消息持久化落到了 broker
身上。一般可以通过配置选择消息在内存还是持久化到数据库中。通过消息队列实现了异步化，发送者只需要等到 broker
确认消息入队就会立刻返回</p>
<h5 id="message-brokers-compared-to-databases">Message brokers compared to databases</h5>
<p>消息队列虽然有存储功能甚至有的实现了两阶段提交协议，但是和数据库还是有区别：</p>
<ul>
<li>数据库存储的数据不会自动删除，消息 broker 待成功发给消费者后自动删除</li>
<li>消息 broker 假定处理集合比较小，消息会被很快处理，如果大量堆积就会影响吞吐</li>
<li>数据库经常支持二级索引，消息 broker 一般支持某种 topic 匹配的订阅</li>
<li>broker 不支持任意条件的查询</li>
</ul>
<h5 id="multiple-consumers">Multiple consumers</h5>
<p>当多个消费者向同一个 topic 读取消息的时候，使用两种模式：</p>
<ul>
<li>Load balancing: broker 可能随意找一个消费者发，你可能想增加消费者并行处理</li>
<li>Fan-out: 每条信息发送给所有的消费者</li>
</ul>
<h5 id="acknowledgements-and-redelivery">Acknowledgements and redelivery</h5>
<p>一般为了防止消费者崩溃没有处理消息，会使用确认机制：消费者回执处理完消息了然后 broker
才会把消息从队列移除。但是有可能消费者处理成功了但是回执却失败了，通过原子提交协议(atomic commit protocol)处理</p>
<h3 id="partitioned-logs">Partitioned Logs</h3>
<p>本节介绍的是 log-based message brokers</p>
<h5 id="using-logs-for-message-storage">Using logs for message storage</h5>
<p>log 是磁盘上只能追加的一系列记录，同样可以用来实现消息代理。生产者通过在 log 末尾追加消息，消费者通过序列化地读取 log
来获取消息。如果消费者读取到 log 末尾，就等待新的消息到来。(类似于 tail -f)。log
可以被分片到多个机器上，每条消息都附加上一个单调递增的数字（因为消息是只能追加的）。Apache Kafka, Amazon Kinesis
Streams, Twitter's DistributedLog 等消息代理都是这种工作方式。</p>
<h5 id="logs-compared-to-traditional-messaging">Logs compared to traditional messaging</h5>
<p>log-based 支持辐射型消息，消费者可以独立读取 log
互不影响。为了实现一组消费者的负载均衡，不是单独的消息发送给消费者们，而是代理把一整个分片分配给一组消费者中的节点。
然后，消费端处理被分配分片的所有消息，消费者通常单线程顺序读取，这种方式有两个缺点：
- 消费 topic 的节点数最多只能等于 topic 的 log 分片数目
- 如果单个消息处理太慢，该分片后续的消息就被阻塞</p>
<p>如果消息希望被并行处理，并且其顺序不重要， AMQP 风格的消息代理更适合。如果是高吞吐、每个消息被很快处理、并且消息顺序比较重要，log-based 会工作很好</p>
<h5 id="consumer-offsets">Consumer offsets</h5>
<p>分片是怎么知道哪些消息被处理了呢：通过当前消费者处理的偏移和分片记录的偏移，所有大于消费者已经处理的偏移的消息是未处理的。</p>
<h5 id="disk-space-usage">Disk space usage</h5>
<p>通常使用环形 buffer 处理旧消息的丢弃问题</p>
<h5 id="when-consumers-cannot-keep-up-with-producers">When consumers cannot keep up with producers</h5>
<p>通常 log-based 代理使用 buffer 来处理消息堆积问题，一旦发现消费者大幅落后处理跟不上会发出警告，因为 buffer
通常足够大，有时间在消息丢失之前人为干预修复慢消费者。</p>
<h5 id="replaying-old-messages">Replaying old messages</h5>
<p>log-based 重放消息就像读文件，不允许改变 log。唯一的影响是会改变 offset，不过 offset
可以被消费者控制，可以人为地把昨天的 offset 消息重写到另一个地方。这和后边要讲的批处理很像。</p>
<h3 id="databases-and-streams">Databases and Streams</h3>
<h5 id="keeping-systems-in-sync">Keeping Systems in Sync</h5>
<p>双写有并发竞争条件问题，其中一个写失败另一个成功的问题。</p>
<h5 id="change-data-capturecdc">Change Data Capture(CDC)</h5>
<ul>
<li>initial snapshot</li>
<li>Log compaction: Kafka</li>
</ul>
<h3 id="event-sourcing">Event Sourcing</h3>
<ul>
<li>Deriving current state from the event log</li>
<li>Commands and events</li>
</ul>
<h3 id="state-streams-and-immutability">State, Streams and Immutability</h3>
<h3 id="processing-streams">Processing Streams</h3>
<p>处理方式：
- 写入数据库、缓存、查询索引，可以被其他 client 查询
- 通过某种方式把事件 push 给用户
- 处理一个或多个输入流产生一个或多个输出流</p>
<h5 id="uses-of-stream-processing">Uses of Stream Processing</h5>
<p>流式处理很长一段时间用来处理监控，当特定事件发生的时候报警</p>
<ul>
<li>Complex event processing(CEP):</li>
<li>Stream analytics: Apache Storm, Spark Streaming, Flink, Concord, Samza, Kafka Streams</li>
</ul>
<h3 id="reasoning-about-time">Reasoning About Time</h3>
<p>时间窗口</p>
<p>type of windows:
- Tumbling window
- Hopping window
- Sliding window
- Session window</p>
<h3 id="stream-joins">Stream Joins</h3>
<h5 id="stream-stream-joinwindow-join">Stream-stream join(window join)</h5>
<p>广告系统。流处理器需要维护状态</p>
<h5 id="stream-table-joinstream-enrichment">Stream-table join(stream enrichment)</h5>
<h5 id="table-table-joinmaterialized-view-maintenance">Table-table join(materialized view maintenance)</h5>
<p>tweet的例子，需要维护发送和删除的 tweet 以及关注关系。</p>
<h3 id="fault-tolerance">Fault Tolerance</h3>
<h5 id="microbatching-and-checkpointing">Microbatching and checkpointing</h5>
<p>used in spark streaming</p>
<h5 id="atomic-commit-revisited">Atomic commit revisited</h5>
<h5 id="rebuilding-state-after-a-failure">Rebuilding state after a failure</h5>
<h1 id="12-the-future-of-data-systems">12 The Future of Data Systems</h1>
<h2 id="data-integration">Data Integration</h2>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../../js/main.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="../../search/main.js"></script>
<script src="../../js/gitbook.min.js"></script>
<script src="../../js/theme.min.js"></script>
</body>
</html>